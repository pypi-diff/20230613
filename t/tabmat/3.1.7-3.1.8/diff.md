# Comparing `tmp/tabmat-3.1.7.tar.gz` & `tmp/tabmat-3.1.8.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "tabmat-3.1.7.tar", last modified: Tue Mar 28 20:45:13 2023, max compression
+gzip compressed data, was "tabmat-3.1.8.tar", last modified: Tue Jun 13 17:05:37 2023, max compression
```

## Comparing `tabmat-3.1.7.tar` & `tabmat-3.1.8.tar`

### file list

```diff
@@ -1,138 +1,139 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.642703 tabmat-3.1.7/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.614703 tabmat-3.1.7/.ci_support/
--rw-r--r--   0 runner    (1001) docker     (123)      163 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/linux_64_python3.10_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      162 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/linux_64_python3.7_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      162 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/linux_64_python3.8_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      162 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/linux_64_python3.9_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      248 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_64_python3.10_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      246 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_64_python3.7_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      246 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_64_python3.8_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      247 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_64_python3.9_default.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      249 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_arm64_python3.10.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      248 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_arm64_python3.8.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      248 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/osx_arm64_python3.9.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      113 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/win_64_python3.10.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      112 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/win_64_python3.7.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      112 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/win_64_python3.8.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      112 2023-03-28 20:44:56.000000 tabmat-3.1.7/.ci_support/win_64_python3.9.____cpython.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      665 2023-03-28 20:44:56.000000 tabmat-3.1.7/.flake8
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.614703 tabmat-3.1.7/.github/
--rw-r--r--   0 runner    (1001) docker     (123)       67 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/CODEOWNERS
--rw-r--r--   0 runner    (1001) docker     (123)      200 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/PULL_REQUEST_TEMPLATE.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.610703 tabmat-3.1.7/.github/actions/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.614703 tabmat-3.1.7/.github/actions/conda-build/
--rw-r--r--   0 runner    (1001) docker     (123)      367 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/actions/conda-build/action.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.614703 tabmat-3.1.7/.github/actions/linter/
--rw-r--r--   0 runner    (1001) docker     (123)      263 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/actions/linter/action.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.614703 tabmat-3.1.7/.github/actions/unittests/
--rw-r--r--   0 runner    (1001) docker     (123)      703 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/actions/unittests/action.yml
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/dependabot.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.618703 tabmat-3.1.7/.github/workflows/
--rw-r--r--   0 runner    (1001) docker     (123)      188 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/base.sh
--rw-r--r--   0 runner    (1001) docker     (123)     2128 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/build_wheels.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1720 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/ci.yml
--rw-r--r--   0 runner    (1001) docker     (123)      934 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/conda-build-linux-main.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1033 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/conda-build-macos.yml
--rw-r--r--   0 runner    (1001) docker     (123)      990 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/conda-build-win.yml
--rwxr-xr-x   0 runner    (1001) docker     (123)      282 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/conda-build.sh
--rw-r--r--   0 runner    (1001) docker     (123)     2255 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/daily.yml
--rwxr-xr-x   0 runner    (1001) docker     (123)      507 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/macos-conda-build.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)      421 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/macos.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)      301 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/pre-commit.sh
--rwxr-xr-x   0 runner    (1001) docker     (123)     1609 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/test.sh
--rw-r--r--   0 runner    (1001) docker     (123)      742 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/tests-macos-main.yml
--rw-r--r--   0 runner    (1001) docker     (123)      829 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/tests-macos.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1082 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/tests-win-main.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1175 2023-03-28 20:44:56.000000 tabmat-3.1.7/.github/workflows/tests-win.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1594 2023-03-28 20:44:56.000000 tabmat-3.1.7/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     1259 2023-03-28 20:44:56.000000 tabmat-3.1.7/.pre-commit-config.yaml
--rw-r--r--   0 runner    (1001) docker     (123)      212 2023-03-28 20:44:56.000000 tabmat-3.1.7/.readthedocs.yml
--rw-r--r--   0 runner    (1001) docker     (123)     7737 2023-03-28 20:44:56.000000 tabmat-3.1.7/CHANGELOG.rst
--rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-03-28 20:44:56.000000 tabmat-3.1.7/CONTRIBUTING.md
--rw-r--r--   0 runner    (1001) docker     (123)     1461 2023-03-28 20:44:56.000000 tabmat-3.1.7/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     5020 2023-03-28 20:45:13.642703 tabmat-3.1.7/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     4484 2023-03-28 20:44:56.000000 tabmat-3.1.7/README.md
--rwxr-xr-x   0 runner    (1001) docker     (123)      165 2023-03-28 20:44:56.000000 tabmat-3.1.7/build_and_launch
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.618703 tabmat-3.1.7/build_tools/
--rw-r--r--   0 runner    (1001) docker     (123)      238 2023-03-28 20:44:56.000000 tabmat-3.1.7/build_tools/prepare_macos_wheel.sh
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.618703 tabmat-3.1.7/conda.recipe/
--rw-r--r--   0 runner    (1001) docker     (123)     1719 2023-03-28 20:44:56.000000 tabmat-3.1.7/conda.recipe/meta.yaml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.622703 tabmat-3.1.7/docs/
--rw-r--r--   0 runner    (1001) docker     (123)      634 2023-03-28 20:44:56.000000 tabmat-3.1.7/docs/Makefile
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.626703 tabmat-3.1.7/docs/_static/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-28 20:44:56.000000 tabmat-3.1.7/docs/_static/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)   194670 2023-03-28 20:44:56.000000 tabmat-3.1.7/docs/_static/dense_bench.png
--rw-r--r--   0 runner    (1001) docker     (123)   243254 2023-03-28 20:44:56.000000 tabmat-3.1.7/docs/_static/dense_cat_bench.png
--rw-r--r--   0 runner    (1001) docker     (123)   367152 2023-03-28 20:44:56.000000 tabmat-3.1.7/docs/_static/headline.png
--rw-r--r--   0 runner    (1001) docker     (123)   256723 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/_static/one_cat_bench.png
--rw-r--r--   0 runner    (1001) docker     (123)   250426 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/_static/sparse_bench.png
--rw-r--r--   0 runner    (1001) docker     (123)   232045 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/_static/two_cat_bench.png
--rw-r--r--   0 runner    (1001) docker     (123)      546 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/api.rst
--rw-r--r--   0 runner    (1001) docker     (123)      917 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/benchmarks.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7737 2023-03-28 20:44:56.000000 tabmat-3.1.7/docs/changelog.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1325 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/conf.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      468 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/dev
--rw-r--r--   0 runner    (1001) docker     (123)      322 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)      759 2023-03-28 20:44:57.000000 tabmat-3.1.7/docs/make.bat
--rw-r--r--   0 runner    (1001) docker     (123)      475 2023-03-28 20:44:57.000000 tabmat-3.1.7/environment-win.yml
--rw-r--r--   0 runner    (1001) docker     (123)      538 2023-03-28 20:44:57.000000 tabmat-3.1.7/environment.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.626703 tabmat-3.1.7/images/
--rw-r--r--   0 runner    (1001) docker     (123)    28078 2023-03-28 20:44:57.000000 tabmat-3.1.7/images/intermediate_data_sandwich.png
--rw-r--r--   0 runner    (1001) docker     (123)    20274 2023-03-28 20:44:57.000000 tabmat-3.1.7/images/narrow_data_sandwich.png
--rw-r--r--   0 runner    (1001) docker     (123)    31362 2023-03-28 20:44:57.000000 tabmat-3.1.7/images/wide_data_sandwich.png
--rw-r--r--   0 runner    (1001) docker     (123)     1715 2023-03-28 20:44:57.000000 tabmat-3.1.7/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)      160 2023-03-28 20:44:57.000000 tabmat-3.1.7/pytest.ini
--rw-r--r--   0 runner    (1001) docker     (123)       67 2023-03-28 20:45:13.642703 tabmat-3.1.7/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     4742 2023-03-28 20:44:57.000000 tabmat-3.1.7/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.610703 tabmat-3.1.7/src/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.626703 tabmat-3.1.7/src/tabmat/
--rw-r--r--   0 runner    (1001) docker     (123)      475 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.630703 tabmat-3.1.7/src/tabmat/benchmark/
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.630703 tabmat-3.1.7/src/tabmat/benchmark/data/
--rw-r--r--   0 runner    (1001) docker     (123)        2 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/data/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)     4777 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/generate_matrices.py
--rw-r--r--   0 runner    (1001) docker     (123)    11969 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/main.py
--rw-r--r--   0 runner    (1001) docker     (123)     1328 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/memory_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)     5472 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/benchmark/visualize_benchmarks.py
--rw-r--r--   0 runner    (1001) docker     (123)    19832 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/categorical_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)     7756 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/constructor.py
--rw-r--r--   0 runner    (1001) docker     (123)     5731 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/dense_matrix.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.642703 tabmat-3.1.7/src/tabmat/ext/
--rw-r--r--   0 runner    (1001) docker     (123)        6 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1467 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/alloc.h
--rw-r--r--   0 runner    (1001) docker     (123)     3134 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/cat_split_helpers-tmpl.cpp
--rw-r--r--   0 runner    (1001) docker     (123)  1527035 2023-03-28 20:45:06.000000 tabmat-3.1.7/src/tabmat/ext/categorical.cpp
--rw-r--r--   0 runner    (1001) docker     (123)     8835 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/categorical.pyx
--rw-r--r--   0 runner    (1001) docker     (123)  1177162 2023-03-28 20:45:08.000000 tabmat-3.1.7/src/tabmat/ext/dense.cpp
--rw-r--r--   0 runner    (1001) docker     (123)     4136 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/dense.pyx
--rw-r--r--   0 runner    (1001) docker     (123)    12674 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/dense_helpers-tmpl.cpp
--rw-r--r--   0 runner    (1001) docker     (123)  2608080 2023-03-28 20:45:11.000000 tabmat-3.1.7/src/tabmat/ext/sparse.cpp
--rw-r--r--   0 runner    (1001) docker     (123)     8690 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/sparse.pyx
--rw-r--r--   0 runner    (1001) docker     (123)     4102 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/sparse_helpers-tmpl.cpp
--rw-r--r--   0 runner    (1001) docker     (123)  1257034 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat/ext/split.cpp
--rw-r--r--   0 runner    (1001) docker     (123)     5634 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/ext/split.pyx
--rw-r--r--   0 runner    (1001) docker     (123)     5387 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/matrix_base.py
--rw-r--r--   0 runner    (1001) docker     (123)     7592 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/sparse_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)    16342 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/split_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)     9900 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/standardized_mat.py
--rw-r--r--   0 runner    (1001) docker     (123)     1373 2023-03-28 20:44:57.000000 tabmat-3.1.7/src/tabmat/util.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.630703 tabmat-3.1.7/src/tabmat.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     5020 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     3536 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)       19 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        7 2023-03-28 20:45:13.000000 tabmat-3.1.7/src/tabmat.egg-info/top_level.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-03-28 20:45:13.642703 tabmat-3.1.7/tests/
--rw-r--r--   0 runner    (1001) docker     (123)     5779 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/real_matrix.pkl
--rw-r--r--   0 runner    (1001) docker     (123)     1419 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_benchmark_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)     2769 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_categorical_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)     2624 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_fast_sandwich.py
--rw-r--r--   0 runner    (1001) docker     (123)    20061 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_matrices.py
--rw-r--r--   0 runner    (1001) docker     (123)     1079 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_mkl_sparse_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)      894 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_real_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)     8159 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_split_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)     1417 2023-03-28 20:44:57.000000 tabmat-3.1.7/tests/test_standardized_mat.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.685170 tabmat-3.1.8/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.665169 tabmat-3.1.8/.ci_support/
+-rw-r--r--   0 runner    (1001) docker     (123)      163 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/linux_64_python3.10_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      162 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/linux_64_python3.7_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      162 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/linux_64_python3.8_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      162 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/linux_64_python3.9_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      248 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_64_python3.10_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      246 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_64_python3.7_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      246 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_64_python3.8_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      247 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_64_python3.9_default.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      249 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_arm64_python3.10.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      248 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_arm64_python3.8.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      248 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/osx_arm64_python3.9.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      113 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/win_64_python3.10.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/win_64_python3.7.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/win_64_python3.8.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-13 17:05:20.000000 tabmat-3.1.8/.ci_support/win_64_python3.9.____cpython.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      665 2023-06-13 17:05:20.000000 tabmat-3.1.8/.flake8
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.665169 tabmat-3.1.8/.github/
+-rw-r--r--   0 runner    (1001) docker     (123)       67 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/CODEOWNERS
+-rw-r--r--   0 runner    (1001) docker     (123)      200 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/PULL_REQUEST_TEMPLATE.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.661169 tabmat-3.1.8/.github/actions/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.665169 tabmat-3.1.8/.github/actions/conda-build/
+-rw-r--r--   0 runner    (1001) docker     (123)      367 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/actions/conda-build/action.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.665169 tabmat-3.1.8/.github/actions/linter/
+-rw-r--r--   0 runner    (1001) docker     (123)      263 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/actions/linter/action.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.665169 tabmat-3.1.8/.github/actions/unittests/
+-rw-r--r--   0 runner    (1001) docker     (123)      703 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/actions/unittests/action.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/dependabot.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.669169 tabmat-3.1.8/.github/workflows/
+-rw-r--r--   0 runner    (1001) docker     (123)      188 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/base.sh
+-rw-r--r--   0 runner    (1001) docker     (123)     1161 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/build_wheels.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1958 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/build_wheels_release.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1720 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/ci.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      934 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/conda-build-linux-main.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1033 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/conda-build-macos.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      990 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/conda-build-win.yml
+-rwxr-xr-x   0 runner    (1001) docker     (123)      282 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/conda-build.sh
+-rw-r--r--   0 runner    (1001) docker     (123)     2255 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/daily.yml
+-rwxr-xr-x   0 runner    (1001) docker     (123)      507 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/macos-conda-build.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)      421 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/macos.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)      301 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/pre-commit.sh
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1609 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/test.sh
+-rw-r--r--   0 runner    (1001) docker     (123)      750 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/tests-macos-main.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      837 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/tests-macos.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1092 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/tests-win-main.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1185 2023-06-13 17:05:20.000000 tabmat-3.1.8/.github/workflows/tests-win.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1594 2023-06-13 17:05:20.000000 tabmat-3.1.8/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     1258 2023-06-13 17:05:20.000000 tabmat-3.1.8/.pre-commit-config.yaml
+-rw-r--r--   0 runner    (1001) docker     (123)      212 2023-06-13 17:05:20.000000 tabmat-3.1.8/.readthedocs.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     8151 2023-06-13 17:05:20.000000 tabmat-3.1.8/CHANGELOG.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     4252 2023-06-13 17:05:20.000000 tabmat-3.1.8/CONTRIBUTING.md
+-rw-r--r--   0 runner    (1001) docker     (123)     1461 2023-06-13 17:05:20.000000 tabmat-3.1.8/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     5020 2023-06-13 17:05:37.685170 tabmat-3.1.8/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     4484 2023-06-13 17:05:20.000000 tabmat-3.1.8/README.md
+-rwxr-xr-x   0 runner    (1001) docker     (123)      165 2023-06-13 17:05:20.000000 tabmat-3.1.8/build_and_launch
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.669169 tabmat-3.1.8/build_tools/
+-rw-r--r--   0 runner    (1001) docker     (123)      238 2023-06-13 17:05:20.000000 tabmat-3.1.8/build_tools/prepare_macos_wheel.sh
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.669169 tabmat-3.1.8/conda.recipe/
+-rw-r--r--   0 runner    (1001) docker     (123)     1716 2023-06-13 17:05:20.000000 tabmat-3.1.8/conda.recipe/meta.yaml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.669169 tabmat-3.1.8/docs/
+-rw-r--r--   0 runner    (1001) docker     (123)      634 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/Makefile
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.673169 tabmat-3.1.8/docs/_static/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)   194670 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/dense_bench.png
+-rw-r--r--   0 runner    (1001) docker     (123)   243254 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/dense_cat_bench.png
+-rw-r--r--   0 runner    (1001) docker     (123)   367152 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/headline.png
+-rw-r--r--   0 runner    (1001) docker     (123)   256723 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/one_cat_bench.png
+-rw-r--r--   0 runner    (1001) docker     (123)   250426 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/sparse_bench.png
+-rw-r--r--   0 runner    (1001) docker     (123)   232045 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/_static/two_cat_bench.png
+-rw-r--r--   0 runner    (1001) docker     (123)      546 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/api.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      917 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/benchmarks.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     8151 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/changelog.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1325 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/conf.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      468 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/dev
+-rw-r--r--   0 runner    (1001) docker     (123)      322 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      759 2023-06-13 17:05:20.000000 tabmat-3.1.8/docs/make.bat
+-rw-r--r--   0 runner    (1001) docker     (123)      475 2023-06-13 17:05:20.000000 tabmat-3.1.8/environment-win.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      458 2023-06-13 17:05:20.000000 tabmat-3.1.8/environment.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.673169 tabmat-3.1.8/images/
+-rw-r--r--   0 runner    (1001) docker     (123)    28078 2023-06-13 17:05:20.000000 tabmat-3.1.8/images/intermediate_data_sandwich.png
+-rw-r--r--   0 runner    (1001) docker     (123)    20274 2023-06-13 17:05:20.000000 tabmat-3.1.8/images/narrow_data_sandwich.png
+-rw-r--r--   0 runner    (1001) docker     (123)    31362 2023-06-13 17:05:20.000000 tabmat-3.1.8/images/wide_data_sandwich.png
+-rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-06-13 17:05:20.000000 tabmat-3.1.8/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)      160 2023-06-13 17:05:20.000000 tabmat-3.1.8/pytest.ini
+-rw-r--r--   0 runner    (1001) docker     (123)       67 2023-06-13 17:05:37.685170 tabmat-3.1.8/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     5148 2023-06-13 17:05:20.000000 tabmat-3.1.8/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.661169 tabmat-3.1.8/src/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.673169 tabmat-3.1.8/src/tabmat/
+-rw-r--r--   0 runner    (1001) docker     (123)      475 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.677169 tabmat-3.1.8/src/tabmat/benchmark/
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.677169 tabmat-3.1.8/src/tabmat/benchmark/data/
+-rw-r--r--   0 runner    (1001) docker     (123)        2 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/data/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)     4777 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/generate_matrices.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11969 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/main.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1328 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/memory_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5472 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/benchmark/visualize_benchmarks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19775 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/categorical_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7756 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/constructor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5836 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/dense_matrix.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.685170 tabmat-3.1.8/src/tabmat/ext/
+-rw-r--r--   0 runner    (1001) docker     (123)        6 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1467 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/alloc.h
+-rw-r--r--   0 runner    (1001) docker     (123)     3266 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/cat_split_helpers-tmpl.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)  1531001 2023-06-13 17:05:31.000000 tabmat-3.1.8/src/tabmat/ext/categorical.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)     8848 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/categorical.pyx
+-rw-r--r--   0 runner    (1001) docker     (123)  1179999 2023-06-13 17:05:32.000000 tabmat-3.1.8/src/tabmat/ext/dense.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)     4137 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/dense.pyx
+-rw-r--r--   0 runner    (1001) docker     (123)    13004 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/dense_helpers-tmpl.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)  2609092 2023-06-13 17:05:35.000000 tabmat-3.1.8/src/tabmat/ext/sparse.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)     8349 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/sparse.pyx
+-rw-r--r--   0 runner    (1001) docker     (123)     4299 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/sparse_helpers-tmpl.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)  1262994 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat/ext/split.cpp
+-rw-r--r--   0 runner    (1001) docker     (123)     5834 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/ext/split.pyx
+-rw-r--r--   0 runner    (1001) docker     (123)     5399 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/matrix_base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7372 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/sparse_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16354 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/split_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10068 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/standardized_mat.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-06-13 17:05:20.000000 tabmat-3.1.8/src/tabmat/util.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.673169 tabmat-3.1.8/src/tabmat.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     5020 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     3579 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)       19 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        7 2023-06-13 17:05:37.000000 tabmat-3.1.8/src/tabmat.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-13 17:05:37.685170 tabmat-3.1.8/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)     5779 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/real_matrix.pkl
+-rw-r--r--   0 runner    (1001) docker     (123)     1419 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_benchmark_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2769 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_categorical_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3413 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_fast_sandwich.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21161 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_matrices.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1079 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_mkl_sparse_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)      894 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_real_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8161 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_split_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1417 2023-06-13 17:05:20.000000 tabmat-3.1.8/tests/test_standardized_mat.py
```

### Comparing `tabmat-3.1.7/.flake8` & `tabmat-3.1.8/.flake8`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/actions/unittests/action.yml` & `tabmat-3.1.8/.github/actions/unittests/action.yml`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/build_wheels.yml` & `tabmat-3.1.8/.github/workflows/build_wheels_release.yml`

 * *Files 22% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 name: Build and upload to PyPI
 
 on:
-  pull_request:
   release:
     types:
       - published
 
 jobs:
   build_wheels:
     name: Build wheels on ${{ matrix.os }}
@@ -18,15 +17,15 @@
       - uses: actions/checkout@v3
       - name: Set up QEMU
         if: runner.os == 'Linux'
         uses: docker/setup-qemu-action@v2
         with:
           platforms: all
       - name: Build wheels
-        uses: pypa/cibuildwheel@v2.12.1
+        uses: pypa/cibuildwheel@v2.13.1
         env:
           CIBW_ARCHS_LINUX: auto aarch64
           CIBW_ARCHS_MACOS: x86_64 arm64
 
       - uses: actions/upload-artifact@v3
         with:
           path: ./wheelhouse/*.whl
@@ -51,34 +50,32 @@
       - uses: actions/upload-artifact@v3
         with:
           path: dist/*.tar.gz
 
   upload_testpypi:
     needs: [build_wheels, build_sdist]
     runs-on: ubuntu-latest
-    if: github.event_name == 'release' && github.event.action == 'published'
     steps:
       - uses: actions/download-artifact@v3
         with:
           name: artifact
           path: dist
 
-      - uses: pypa/gh-action-pypi-publish@v1.8.3
+      - uses: pypa/gh-action-pypi-publish@v1.8.6
         with:
           user: __token__
           password: ${{ secrets.GH_TESTPYPI_UPLOAD }}
           repository_url: https://test.pypi.org/legacy/
 
   upload_pypi:
     needs: [build_wheels, build_sdist, upload_testpypi]
     runs-on: ubuntu-latest
-    if: github.event_name == 'release' && github.event.action == 'published'
     steps:
       - uses: actions/download-artifact@v3
         with:
           name: artifact
           path: dist
 
-      - uses: pypa/gh-action-pypi-publish@v1.8.3
+      - uses: pypa/gh-action-pypi-publish@v1.8.6
         with:
           user: __token__
           password: ${{ secrets.GH_PYPI_UPLOAD }}
```

### Comparing `tabmat-3.1.7/.github/workflows/ci.yml` & `tabmat-3.1.8/.github/workflows/ci.yml`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/conda-build-linux-main.yml` & `tabmat-3.1.8/.github/workflows/conda-build-linux-main.yml`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/conda-build-macos.yml` & `tabmat-3.1.8/.github/workflows/conda-build-macos.yml`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/conda-build-win.yml` & `tabmat-3.1.8/.github/workflows/conda-build-win.yml`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/daily.yml` & `tabmat-3.1.8/.github/workflows/daily.yml`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/test.sh` & `tabmat-3.1.8/.github/workflows/test.sh`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.github/workflows/tests-macos-main.yml` & `tabmat-3.1.8/.github/workflows/tests-macos-main.yml`

 * *Files 15% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-name: CI
+name: CI - macos
 on:
   push:
     branches:
       - main
 
 jobs:
   macos:
```

### Comparing `tabmat-3.1.7/.github/workflows/tests-macos.yml` & `tabmat-3.1.8/.github/workflows/tests-macos.yml`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-name: CI
+name: CI - macos
 on:
   push:
     paths:
       - '.github/**'
       - '**/*.pyx'
       - '**/*.cpp'
       - 'setup.py'
```

### Comparing `tabmat-3.1.7/.github/workflows/tests-win-main.yml` & `tabmat-3.1.8/.github/workflows/tests-win-main.yml`

 * *Files 10% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-name: CI
+name: CI - Windows
 on:
   push:
     branches:
       - main
 jobs:
   windows-ci:
     name: "Win - tests - Python ${{ matrix.PYTHON_VERSION }}"
```

### Comparing `tabmat-3.1.7/.github/workflows/tests-win.yml` & `tabmat-3.1.8/.github/workflows/tests-win.yml`

 * *Files 11% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-name: CI
+name: CI - Windows
 on:
   push:
     paths:
       - '.github/**'
       - '**/*.pyx'
       - '**/*.cpp'
       - 'setup.py'
```

### Comparing `tabmat-3.1.7/.gitignore` & `tabmat-3.1.8/.gitignore`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/.pre-commit-config.yaml` & `tabmat-3.1.8/.pre-commit-config.yaml`

 * *Files 4% similar despite different names*

```diff
@@ -1,44 +1,44 @@
 repos:
  - repo: https://github.com/Quantco/pre-commit-mirrors-black
-   rev: 22.3.0
+   rev: 23.3.0
    hooks:
      - id: black-conda
        additional_dependencies: [flake8-docstrings, flake8-rst-docstrings]
        args:
          - --safe
          - --target-version=py36
  - repo: https://github.com/Quantco/pre-commit-mirrors-flake8
-   rev: v3.8.4
+   rev: 6.0.0
    hooks:
     - id: flake8-conda
       additional_dependencies: [
           -c,
           conda-forge,
           flake8-bugbear=21.4.3,
           flake8-builtins=1.5.3,
           flake8-comprehensions=3.5.0,
           flake8-docstrings=1.6.0,
           flake8-print=4.0.0,
           pep8-naming=0.11.1,
         ]
  - repo: https://github.com/Quantco/pre-commit-mirrors-isort
-   rev: 5.7.0
+   rev: 5.12.0
    hooks:
     - id: isort-conda
       additional_dependencies: [toml]
  - repo: https://github.com/Quantco/pre-commit-mirrors-mypy
-   rev: "0.812"
+   rev: "1.3.0"
    hooks:
     - id: mypy-conda
       additional_dependencies:
        - python=3.8
  - repo: https://github.com/Quantco/pre-commit-mirrors-pyupgrade
-   rev: 2.10.0
+   rev: 3.6.0
    hooks:
     - id: pyupgrade-conda
  - repo: https://github.com/Quantco/pre-commit-mirrors-cython-lint
-   rev: 0.14.0
+   rev: 0.15.0
    hooks:
     - id: cython-lint-conda
       args: [--no-pycodestyle]
     - id: double-quote-cython-strings-conda
```

### Comparing `tabmat-3.1.7/CHANGELOG.rst` & `tabmat-3.1.8/CHANGELOG.rst`

 * *Files 6% similar despite different names*

```diff
@@ -3,22 +3,31 @@
    * Update the major if you break the public API
    * Update the minor if you add new functionality
    * Update the patch if you fixed a bug
 
 Changelog
 =========
 
+3.1.8 - 2023-06-13
+------------------
+
+**Other changes:**
+
+- The C++ types have been refactored. Loop indices are now using the ``Py_ssize_t`` type. Integers now have a templated type as well.
+- The documentation for `matvec` and `matvec_transpose` has been updated to reflect actual behavior
+- Checks for dimension mismatch in `matvec` and `matvec_transpose` arguments have been added
+- Remove upper pin on xsimd
+
 3.1.7 - 2022-03-28
 ------------------
 
 **Bug fix:**
 
 - We fixed a bug in the cross sandwich product, which would previously segfault for very large matrices.
 
-
 3.1.6 - 2022-03-27
 ------------------
 
 **Bug fix:**
 
 - We fixed a bug in the dense sandwich product, which would previously segfault for very large F-contiguous matrices.
```

### Comparing `tabmat-3.1.7/CONTRIBUTING.md` & `tabmat-3.1.8/CONTRIBUTING.md`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/LICENSE` & `tabmat-3.1.8/LICENSE`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/PKG-INFO` & `tabmat-3.1.8/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: tabmat
-Version: 3.1.7
+Version: 3.1.8
 Summary: Efficient matrix representations for working with tabular data.
 Home-page: https://github.com/Quantco/tabmat
 Author: QuantCo, Inc.
 Author-email: noreply@quantco.com
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
```

### Comparing `tabmat-3.1.7/README.md` & `tabmat-3.1.8/README.md`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/conda.recipe/meta.yaml` & `tabmat-3.1.8/conda.recipe/meta.yaml`

 * *Files 1% similar despite different names*

```diff
@@ -28,15 +28,15 @@
     - cython
     - jemalloc-local  # [not win]
     - llvm-openmp  # [osx]
     - mako
     - numpy
     - pip
     - setuptools_scm
-    - xsimd <9
+    - xsimd
   run:
     - python
     - {{ pin_compatible('numpy') }}
     - pandas
     - scipy
 
 test:
```

### Comparing `tabmat-3.1.7/docs/Makefile` & `tabmat-3.1.8/docs/Makefile`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/_static/dense_bench.png` & `tabmat-3.1.8/docs/_static/dense_bench.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/_static/dense_cat_bench.png` & `tabmat-3.1.8/docs/_static/dense_cat_bench.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/_static/headline.png` & `tabmat-3.1.8/docs/_static/headline.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/_static/one_cat_bench.png` & `tabmat-3.1.8/docs/_static/one_cat_bench.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/_static/sparse_bench.png` & `tabmat-3.1.8/docs/_static/sparse_bench.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/_static/two_cat_bench.png` & `tabmat-3.1.8/docs/_static/two_cat_bench.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/api.rst` & `tabmat-3.1.8/docs/api.rst`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/benchmarks.rst` & `tabmat-3.1.8/docs/benchmarks.rst`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/changelog.rst` & `tabmat-3.1.8/docs/changelog.rst`

 * *Files 6% similar despite different names*

```diff
@@ -3,22 +3,31 @@
    * Update the major if you break the public API
    * Update the minor if you add new functionality
    * Update the patch if you fixed a bug
 
 Changelog
 =========
 
+3.1.8 - 2023-06-13
+------------------
+
+**Other changes:**
+
+- The C++ types have been refactored. Loop indices are now using the ``Py_ssize_t`` type. Integers now have a templated type as well.
+- The documentation for `matvec` and `matvec_transpose` has been updated to reflect actual behavior
+- Checks for dimension mismatch in `matvec` and `matvec_transpose` arguments have been added
+- Remove upper pin on xsimd
+
 3.1.7 - 2022-03-28
 ------------------
 
 **Bug fix:**
 
 - We fixed a bug in the cross sandwich product, which would previously segfault for very large matrices.
 
-
 3.1.6 - 2022-03-27
 ------------------
 
 **Bug fix:**
 
 - We fixed a bug in the dense sandwich product, which would previously segfault for very large F-contiguous matrices.
```

### Comparing `tabmat-3.1.7/docs/conf.py` & `tabmat-3.1.8/docs/conf.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/docs/make.bat` & `tabmat-3.1.8/docs/make.bat`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/images/intermediate_data_sandwich.png` & `tabmat-3.1.8/images/intermediate_data_sandwich.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/images/narrow_data_sandwich.png` & `tabmat-3.1.8/images/narrow_data_sandwich.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/images/wide_data_sandwich.png` & `tabmat-3.1.8/images/wide_data_sandwich.png`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/pyproject.toml` & `tabmat-3.1.8/pyproject.toml`

 * *Files 4% similar despite different names*

```diff
@@ -32,14 +32,15 @@
 skip = [
   "*-win32",
   "*-manylinux_i686",
   "pp*", 
   "*-musllinux_*"
 ]
 test-requires = ["pytest", "pytest-xdist"]
+test-command = "pytest {package}/tests/test_matrices.py"
 # note: ARCHS_LINUX defined in build_wheels.yml file.
 
 [tool.cibuildwheel.macos]
 before-build = [
   "bash build_tools/prepare_macos_wheel.sh",
 ]
```

### Comparing `tabmat-3.1.7/setup.py` & `tabmat-3.1.8/setup.py`

 * *Files 4% similar despite different names*

```diff
@@ -33,26 +33,30 @@
 
     out_fn = fn.split("-tmpl")[0] + ".cpp"
 
     # When the templated source code hasn't changed, we don't want to write the
     # file again because that'll touch the file and result in a rebuild
     write = True
     if path.exists(out_fn):
-        with open(out_fn, "r") as f:
+        with open(out_fn) as f:
             out_fn_src = f.read()
             if out_fn_src == rendered_src:
                 write = False
 
     if write:
         with open(out_fn, "w") as f:
             f.write(rendered_src)
 
 # add numpy headers
 include_dirs = [np.get_include()]
 
+# check if debug build
+debug_build = os.getenv("TABMAT_DEBUG", "0").lower() in ("true", "1")
+print(f"Debug Build: {debug_build}")
+
 if sys.platform == "win32":
     allocator_libs = []
     extra_compile_args = ["/openmp", "/O2"]
     extra_link_args = ["/openmp"]
     # make sure we can find xsimd headers
     include_dirs.append(os.path.join(sys.prefix, "Library", "include"))
 elif sys.platform == "darwin":
@@ -150,10 +154,21 @@
         "Programming Language :: Python :: 3.8",
         "Programming Language :: Python :: 3.9",
         "Programming Language :: Python :: 3.10",
     ],
     package_dir={"": "src"},
     packages=find_packages(where="src"),
     install_requires=["numpy", "pandas", "scipy"],
-    ext_modules=cythonize(ext_modules, annotate=False),
+    ext_modules=cythonize(
+        ext_modules,
+        annotate=False,
+        compiler_directives={
+            "language_level": "3",
+            "boundscheck": debug_build,
+            "wraparound": debug_build,
+            "initializedcheck": False,
+            "nonecheck": False,
+            "cdivision": True,
+        },
+    ),
     zip_safe=False,
 )
```

### Comparing `tabmat-3.1.7/src/tabmat/benchmark/generate_matrices.py` & `tabmat-3.1.8/src/tabmat/benchmark/generate_matrices.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/src/tabmat/benchmark/main.py` & `tabmat-3.1.8/src/tabmat/benchmark/main.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/src/tabmat/benchmark/memory_tools.py` & `tabmat-3.1.8/src/tabmat/benchmark/memory_tools.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/src/tabmat/benchmark/visualize_benchmarks.py` & `tabmat-3.1.8/src/tabmat/benchmark/visualize_benchmarks.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/src/tabmat/categorical_matrix.py` & `tabmat-3.1.8/src/tabmat/categorical_matrix.py`

 * *Files 5% similar despite different names*

```diff
@@ -177,14 +177,15 @@
     transpose_matvec,
     transpose_matvec_drop_first,
 )
 from .ext.split import sandwich_cat_cat, sandwich_cat_dense
 from .matrix_base import MatrixBase
 from .sparse_matrix import SparseMatrix
 from .util import (
+    check_matvec_dimensions,
     check_matvec_out_shape,
     check_transpose_matvec_out_shape,
     set_up_rows_or_cols,
     setup_restrictions,
 )
 
 
@@ -278,19 +279,15 @@
         cols: np.ndarray = None,
     ) -> Tuple[np.ndarray, Optional[np.ndarray]]:
         other = np.asarray(other)
         if other.ndim > 1:
             raise NotImplementedError(
                 """CategoricalMatrix.matvec is only implemented for 1d arrays."""
             )
-        if other.shape[0] != self.shape[1]:
-            raise ValueError(
-                f"""Needed other to have first dimension {self.shape[1]},
-                but it has shape {other.shape}"""
-            )
+        check_matvec_dimensions(self, other, transpose=False)
 
         if cols is not None:
             if len(cols) == self.shape[1]:
                 cols = None
             else:
                 # Needs to be single-precision for compatibility with cython 'int' type
                 # Since we have the same restriction on self.indices, this is not an
@@ -346,15 +343,15 @@
         vec: Union[np.ndarray, List],
         rows: Optional[np.ndarray] = None,
         cols: Optional[np.ndarray] = None,
         out: Optional[np.ndarray] = None,
     ) -> np.ndarray:
         """
 
-        Perform: self[rows, cols].T @ vec.
+        Perform: self[rows, cols].T @ vec[rows].
 
         ::
 
             for i in cols: out[i] += sum_{j in rows} self[j, i] vec[j]
             self[j, i] = 1(indices[j] == i)
 
 
@@ -376,14 +373,15 @@
         If out is None, then a new array will be returned.
 
         Test: tests/test_matrices::test_transpose_matvec
         """
         # TODO: write a function that doesn't reference the data
         # TODO: this should look more like the cat_cat_sandwich
         vec = np.asarray(vec)
+        check_matvec_dimensions(self, vec, transpose=True)
         if vec.ndim > 1:
             raise NotImplementedError(
                 "CategoricalMatrix.transpose_matvec is only implemented for 1d arrays."
             )
 
         out_is_none = out is None
         if out_is_none:
@@ -530,15 +528,14 @@
         self,
         other: np.ndarray,
         d: np.ndarray,
         rows: Optional[np.ndarray],
         L_cols: Optional[np.ndarray],
         R_cols: Optional[np.ndarray],
     ) -> np.ndarray:
-
         if other.flags["C_CONTIGUOUS"]:
             is_c_contiguous = True
         elif other.flags["F_CONTIGUOUS"]:
             is_c_contiguous = False
         else:
             raise ValueError(
                 "Input array needs to be either C-contiguous or F-contiguous."
```

### Comparing `tabmat-3.1.7/src/tabmat/constructor.py` & `tabmat-3.1.8/src/tabmat/constructor.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/src/tabmat/dense_matrix.py` & `tabmat-3.1.8/src/tabmat/dense_matrix.py`

 * *Files 3% similar despite different names*

```diff
@@ -6,14 +6,15 @@
     dense_matvec,
     dense_rmatvec,
     dense_sandwich,
     transpose_square_dot_weights,
 )
 from .matrix_base import MatrixBase
 from .util import (
+    check_matvec_dimensions,
     check_matvec_out_shape,
     check_transpose_matvec_out_shape,
     setup_restrictions,
 )
 
 
 class DenseMatrix(np.ndarray, MatrixBase):
@@ -98,16 +99,17 @@
         # Because the dense_rmatvec takes a row array and col array, it has
         # added overhead compared to a raw matrix vector product. So, when
         # we're not filtering at all, let's just use default numpy dot product.
         #
         # TODO: related to above, it could be nice to have a version that only
         # filters rows and a version that only filters columns. How do we do
         # this without an explosion of code?
-        X = self.T if transpose else self
         vec = np.asarray(vec)
+        check_matvec_dimensions(self, vec, transpose=transpose)
+        X = self.T if transpose else self
 
         # NOTE: We assume that rows and cols are unique
         unrestricted_rows = rows is None or len(rows) == self.shape[0]
         unrestricted_cols = cols is None or len(cols) == self.shape[1]
 
         if unrestricted_rows and unrestricted_cols:
             if out is None:
@@ -138,25 +140,25 @@
     def transpose_matvec(
         self,
         vec: Union[np.ndarray, List],
         rows: np.ndarray = None,
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
-        """Perform: self[rows, cols].T @ vec."""
+        """Perform: self[rows, cols].T @ vec[rows]."""
         check_transpose_matvec_out_shape(self, out)
         return self._matvec_helper(vec, rows, cols, out, True)
 
     def matvec(
         self,
         vec: Union[np.ndarray, List],
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
-        """Perform self[:, cols] @ other."""
+        """Perform self[:, cols] @ other[cols]."""
         check_matvec_out_shape(self, out)
         return self._matvec_helper(vec, None, cols, out, False)
 
     def multiply(self, other):
         """Element-wise multiplication.
 
         This assumes that ``other`` is a vector of size ``self.shape[0]``.
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/alloc.h` & `tabmat-3.1.8/src/tabmat/ext/alloc.h`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/src/tabmat/ext/cat_split_helpers-tmpl.cpp` & `tabmat-3.1.8/src/tabmat/ext/cat_split_helpers-tmpl.cpp`

 * *Files 13% similar despite different names*

```diff
@@ -1,118 +1,118 @@
 #include <vector>
 
 
 <%def name="transpose_matvec(dropfirst)">
-template <typename F>
+template <typename Int, typename F>
 void _transpose_matvec_${dropfirst}(
-    int n_rows,
-    int* indices,
+    Int n_rows,
+    Int* indices,
     F* other,
     F* res,
-    int res_size
+    Int res_size
 ) {
     #pragma omp parallel
     {
         std::vector<F> restemp(res_size, 0.0);
         #pragma omp for
-        for (int i = 0; i < n_rows; i++) {
+        for (Py_ssize_t i = 0; i < n_rows; i++) {
             % if dropfirst == 'all_rows_drop_first':
-                int col_idx = indices[i] - 1;
+                Py_ssize_t col_idx = indices[i] - 1;
                 if (col_idx != -1) {
                     restemp[col_idx] += other[i];
                 }
             % else:
                 restemp[indices[i]] += other[i];
             % endif
         }
-        for (int i = 0; i < res_size; i++) {
+        for (Py_ssize_t i = 0; i < res_size; i++) {
             # pragma omp atomic
             res[i] += restemp[i];
         }
     }
 }
 </%def>
 
 
-template <typename F>
+template <typename Int, typename F>
 void _sandwich_cat_cat(
     F* d,
-    const int* i_indices,
-    const int* j_indices,
-    int* rows,
-    int len_rows,
+    const Int* i_indices,
+    const Int* j_indices,
+    Int* rows,
+    Int len_rows,
     F* res,
-    int res_n_col,
-    int res_size,
+    Int res_n_col,
+    Int res_size,
     bool i_drop_first,
     bool j_drop_first
 )
 {
     #pragma omp parallel
     {
         std::vector<F> restemp(res_size, 0.0);
         # pragma omp for
-        for (int k_idx = 0; k_idx < len_rows; k_idx++) {
-            int k = rows[k_idx];
-            int i = i_indices[k] - i_drop_first;
+        for (Py_ssize_t k_idx = 0; k_idx < len_rows; k_idx++) {
+            Int k = rows[k_idx];
+            Int i = i_indices[k] - i_drop_first;
             if (i == -1) {
                 continue;
             }
-            int j = j_indices[k] - j_drop_first;
+            Int j = j_indices[k] - j_drop_first;
             if (j == -1) {
                 continue;
             }
-            restemp[i * res_n_col + j] += d[k];
+            restemp[(Py_ssize_t) i * res_n_col + j] += d[k];
         }
-        for (int i = 0; i < res_size; i++) {
+        for (Py_ssize_t i = 0; i < res_size; i++) {
             # pragma omp atomic
             res[i] += restemp[i];
         }
     }
 }
 
 
 <%def name="sandwich_cat_dense_tmpl(order)">
-template <typename F>
+template <typename Int, typename F>
 void _sandwich_cat_dense${order}(
     F* d,
-    const int* indices,
-    int* rows,
-    int len_rows,
-    int* j_cols,
-    int len_j_cols,
+    const Int* indices,
+    Int* rows,
+    Int len_rows,
+    Int* j_cols,
+    Int len_j_cols,
     F* res,
-    int res_size,
+    Int res_size,
     F* mat_j,
-    int mat_j_nrow,
-    int mat_j_ncol
+    Int mat_j_nrow,
+    Int mat_j_ncol
     )
 {
     #pragma omp parallel
     {
         std::vector<F> restemp(res_size, 0.0);
         #pragma omp for
-        for (int k_idx = 0; k_idx < len_rows; k_idx++) {
-            int k = rows[k_idx];
-            int i = indices[k];
+        for (Py_ssize_t k_idx = 0; k_idx < len_rows; k_idx++) {
+            Py_ssize_t k = rows[k_idx];
+            Py_ssize_t i = indices[k];
             // MAYBE TODO: explore whether the column restriction slows things down a
             // lot, particularly if not restricting the columns allows using SIMD
             // instructions
             // MAYBE TODO: explore whether swapping the loop order for F-ordered mat_j
             // is useful.
-            for (int j_idx = 0; j_idx < len_j_cols; j_idx++) {
-                int j = j_cols[j_idx];
+            for (Py_ssize_t j_idx = 0; j_idx < len_j_cols; j_idx++) {
+                Py_ssize_t j = j_cols[j_idx];
                 % if order == 'C':
                     restemp[i * len_j_cols + j_idx] += d[k] * mat_j[k * mat_j_ncol + j];
                 % else:
                     restemp[i * len_j_cols + j_idx] += d[k] * mat_j[j * mat_j_nrow + k];
                 % endif
             }
         }
-        for (int i = 0; i < res_size; i++) {
+        for (Py_ssize_t i = 0; i < res_size; i++) {
             #pragma omp atomic
             res[i] += restemp[i];
         }
     }
 }
 </%def>
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/categorical.cpp` & `tabmat-3.1.8/src/tabmat/ext/categorical.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,33 +1,33 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
             "src/tabmat/ext/cat_split_helpers.cpp"
         ],
         "extra_compile_args": [
             "-fopenmp",
             "-O3",
             "-ffast-math",
             "--std=c++17",
             "-DJEMALLOC_INSTALL_SUFFIX="
         ],
         "extra_link_args": [
             "-fopenmp"
         ],
         "include_dirs": [
             "src/tabmat/ext",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include"
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "name": "tabmat.ext.categorical",
         "sources": [
             "src/tabmat/ext/categorical.pyx"
         ]
     },
@@ -40,17 +40,17 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
-#define CYTHON_FUTURE_DIVISION 0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
+#define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
@@ -109,16 +109,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -234,15 +238,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -273,15 +277,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -1141,213 +1145,213 @@
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
 
-/* "tabmat/ext/categorical.pyx":10
+/* "tabmat/ext/categorical.pyx":8
  * from cython.parallel import prange
  * 
  * ctypedef np.uint8_t uint8             # <<<<<<<<<<<<<<
  * ctypedef np.int8_t int8
  * from libcpp cimport bool
  */
 typedef __pyx_t_5numpy_uint8_t __pyx_t_6tabmat_3ext_11categorical_uint8;
 
-/* "tabmat/ext/categorical.pyx":11
+/* "tabmat/ext/categorical.pyx":9
  * 
  * ctypedef np.uint8_t uint8
  * ctypedef np.int8_t int8             # <<<<<<<<<<<<<<
  * from libcpp cimport bool
  * 
  */
 typedef __pyx_t_5numpy_int8_t __pyx_t_6tabmat_3ext_11categorical_int8;
@@ -1378,42 +1382,42 @@
 
 /*--- Type declarations ---*/
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
@@ -2124,22 +2128,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* CythonFunctionShared.proto */
 #define __Pyx_CyFunction_USED 1
@@ -2665,14 +2677,15 @@
 static const char __pyx_k_out_vec[] = "out_vec";
 static const char __pyx_k_row_idx[] = "row_idx";
 static const char __pyx_k_Ellipsis[] = "Ellipsis";
 static const char __pyx_k_defaults[] = "defaults";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_itemsize[] = "itemsize";
 static const char __pyx_k_new_data[] = "new_data";
+static const char __pyx_k_out_size[] = "out_size";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_TypeError[] = "TypeError";
 static const char __pyx_k_enumerate[] = "enumerate";
 static const char __pyx_k_pyx_state[] = "__pyx_state";
 static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
 static const char __pyx_k_rows_view[] = "rows_view";
@@ -2849,19 +2862,20 @@
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
 static PyObject *__pyx_n_s_no_row_restrictions;
 static PyObject *__pyx_n_s_nonref_cnt;
 static PyObject *__pyx_n_s_nonzero_cnt;
 static PyObject *__pyx_n_s_np;
 static PyObject *__pyx_n_s_nrows;
 static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_s_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_s_numpy_core_umath_failed_to_impor;
+static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
+static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_s_other;
 static PyObject *__pyx_n_s_out;
+static PyObject *__pyx_n_s_out_size;
 static PyObject *__pyx_n_s_out_vec;
 static PyObject *__pyx_n_s_pack;
 static PyObject *__pyx_n_s_pickle;
 static PyObject *__pyx_n_s_pyx_PickleError;
 static PyObject *__pyx_n_s_pyx_checksum;
 static PyObject *__pyx_n_s_pyx_getbuffer;
 static PyObject *__pyx_n_s_pyx_result;
@@ -3041,15 +3055,15 @@
 static PyObject *__pyx_codeobj__37;
 static PyObject *__pyx_codeobj__39;
 static PyObject *__pyx_codeobj__41;
 static PyObject *__pyx_codeobj__43;
 static PyObject *__pyx_codeobj__50;
 /* Late includes */
 
-/* "tabmat/ext/categorical.pyx":20
+/* "tabmat/ext/categorical.pyx":18
  * 
  * 
  * def transpose_matvec(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
 
@@ -3090,31 +3104,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 18, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 20, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -3123,15 +3137,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 20, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.categorical.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_11categorical_transpose_matvec(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -3177,51 +3191,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("transpose_matvec", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 20, __pyx_L1_error)
+    __PYX_ERR(0, 18, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 20, __pyx_L1_error)
+      __PYX_ERR(0, 18, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -3230,85 +3244,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 20, __pyx_L1_error)
+    __PYX_ERR(0, 18, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_other, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_other, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 20, __pyx_L1_error)
+      __PYX_ERR(0, 18, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 20, __pyx_L1_error)
+      __PYX_ERR(0, 18, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 20, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_7);
     __Pyx_GIVEREF(__pyx_int_7);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_7);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 20, __pyx_L1_error)
+    __PYX_ERR(0, 18, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -3322,62 +3336,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 20, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 20, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -3396,15 +3410,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3418,100 +3432,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 20, __pyx_L1_error)
+    __PYX_ERR(0, 18, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 20, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 20, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 20, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -3519,43 +3533,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 20, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 20, __pyx_L1_error)
+    __PYX_ERR(0, 18, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 20, __pyx_L1_error)
+    __PYX_ERR(0, 18, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 20, __pyx_L1_error)
+      __PYX_ERR(0, 18, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 20, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -3629,72 +3643,72 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 1); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 1); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 2); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 2); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 3); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 3); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 4); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 4); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 5); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 5); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 6); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 6); __PYX_ERR(0, 18, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec") < 0)) __PYX_ERR(0, 20, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 21, __pyx_L3_error)
-    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 22, __pyx_L3_error)
-    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 19, __pyx_L3_error)
+    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 20, __pyx_L3_error)
+    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 21, __pyx_L3_error)
     __pyx_v_dtype = values[3];
     __pyx_v_rows = values[4];
     __pyx_v_cols = values[5];
-    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 27, __pyx_L3_error)
+    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 25, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 20, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_11categorical_18transpose_matvec(__pyx_self, __pyx_v_indices, __pyx_v_other, __pyx_v_n_cols, __pyx_v_dtype, __pyx_v_rows, __pyx_v_cols, __pyx_v_out);
 
@@ -3705,458 +3719,468 @@
 
 static PyObject *__pyx_pf_6tabmat_3ext_11categorical_18transpose_matvec(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_other, int __pyx_v_n_cols, CYTHON_UNUSED PyObject *__pyx_v_dtype, PyObject *__pyx_v_rows, PyObject *__pyx_v_cols, __Pyx_memviewslice __pyx_v_out) {
   int __pyx_v_row;
   int __pyx_v_row_idx;
   int __pyx_v_n_keep_rows;
   int __pyx_v_col;
   int __pyx_v_n_rows;
+  int __pyx_v_out_size;
   __Pyx_memviewslice __pyx_v_rows_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_cols_included = { 0, 0, { 0 }, { 0 }, { 0 } };
   bool __pyx_v_no_row_restrictions;
   bool __pyx_v_no_col_restrictions;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
-  bool __pyx_t_2;
-  int __pyx_t_3;
-  Py_ssize_t __pyx_t_4;
-  int __pyx_t_5;
-  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  bool __pyx_t_5;
+  int __pyx_t_6;
   Py_ssize_t __pyx_t_7;
-  Py_ssize_t __pyx_t_8;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
+  int __pyx_t_8;
+  Py_ssize_t __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
+  Py_ssize_t __pyx_t_11;
   __Pyx_memviewslice __pyx_t_12 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_t_13;
   int __pyx_t_14;
   PyObject *__pyx_t_15 = NULL;
   PyObject *__pyx_t_16 = NULL;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0transpose_matvec", 0);
 
-  /* "tabmat/ext/categorical.pyx":30
+  /* "tabmat/ext/categorical.pyx":28
  * ):
  *     cdef int row, row_idx, n_keep_rows, col
  *     cdef int n_rows = len(indices)             # <<<<<<<<<<<<<<
+ *     cdef int out_size = out.size
  *     cdef int[:] rows_view, cols_included
- * 
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_indices); 
   __pyx_v_n_rows = __pyx_t_1;
 
-  /* "tabmat/ext/categorical.pyx":33
+  /* "tabmat/ext/categorical.pyx":29
+ *     cdef int row, row_idx, n_keep_rows, col
+ *     cdef int n_rows = len(indices)
+ *     cdef int out_size = out.size             # <<<<<<<<<<<<<<
+ *     cdef int[:] rows_view, cols_included
+ * 
+ */
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_out_size = __pyx_t_4;
+
+  /* "tabmat/ext/categorical.pyx":32
  *     cdef int[:] rows_view, cols_included
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows             # <<<<<<<<<<<<<<
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols
  * 
  */
-  __pyx_t_3 = (__pyx_v_rows == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_rows == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 33, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_rows);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_rows);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L3_bool_binop_done:;
-  __pyx_v_no_row_restrictions = __pyx_t_2;
+  __pyx_v_no_row_restrictions = __pyx_t_5;
 
-  /* "tabmat/ext/categorical.pyx":34
+  /* "tabmat/ext/categorical.pyx":33
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols             # <<<<<<<<<<<<<<
  * 
  *     # Case 1: No row or col restrictions
  */
-  __pyx_t_3 = (__pyx_v_cols == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_cols == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 34, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_cols);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 33, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_cols);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L5_bool_binop_done:;
-  __pyx_v_no_col_restrictions = __pyx_t_2;
+  __pyx_v_no_col_restrictions = __pyx_t_5;
 
-  /* "tabmat/ext/categorical.pyx":37
+  /* "tabmat/ext/categorical.pyx":36
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
-  __pyx_t_5 = (__pyx_v_no_row_restrictions != 0);
-  if (__pyx_t_5) {
+  __pyx_t_8 = (__pyx_v_no_row_restrictions != 0);
+  if (__pyx_t_8) {
   } else {
-    __pyx_t_3 = __pyx_t_5;
+    __pyx_t_6 = __pyx_t_8;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_5 = (__pyx_v_no_col_restrictions != 0);
-  __pyx_t_3 = __pyx_t_5;
+  __pyx_t_8 = (__pyx_v_no_col_restrictions != 0);
+  __pyx_t_6 = __pyx_t_8;
   __pyx_L8_bool_binop_done:;
-  if (__pyx_t_3) {
+  if (__pyx_t_6) {
 
-    /* "tabmat/ext/categorical.pyx":38
+    /* "tabmat/ext/categorical.pyx":37
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)             # <<<<<<<<<<<<<<
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)             # <<<<<<<<<<<<<<
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  */
-    __pyx_t_6 = 0;
-    __pyx_t_7 = 0;
-    __pyx_t_8 = 0;
-    __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 38, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_size); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 38, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_10);
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_10); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 38, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    _transpose_matvec_all_rows<float>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_6 * __pyx_v_indices.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_7 * __pyx_v_other.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_8 * __pyx_v_out.strides[0]) )))), __pyx_t_11);
+    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
+    __pyx_t_11 = 0;
+    _transpose_matvec_all_rows<int,float>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_9 * __pyx_v_indices.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_10 * __pyx_v_other.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_11 * __pyx_v_out.strides[0]) )))), __pyx_v_out_size);
 
-    /* "tabmat/ext/categorical.pyx":37
+    /* "tabmat/ext/categorical.pyx":36
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
     goto __pyx_L7;
   }
 
-  /* "tabmat/ext/categorical.pyx":40
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+  /* "tabmat/ext/categorical.pyx":39
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
-  __pyx_t_3 = (__pyx_v_no_col_restrictions != 0);
-  if (__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_no_col_restrictions != 0);
+  if (__pyx_t_6) {
 
-    /* "tabmat/ext/categorical.pyx":41
+    /* "tabmat/ext/categorical.pyx":40
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  *         rows_view = rows             # <<<<<<<<<<<<<<
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
  */
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 40, __pyx_L1_error)
     __pyx_v_rows_view = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
-    /* "tabmat/ext/categorical.pyx":42
+    /* "tabmat/ext/categorical.pyx":41
  *     elif no_col_restrictions:
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)             # <<<<<<<<<<<<<<
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]
  */
     __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_rows_view); 
     __pyx_v_n_keep_rows = __pyx_t_1;
 
-    /* "tabmat/ext/categorical.pyx":43
+    /* "tabmat/ext/categorical.pyx":42
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *             row = rows_view[row_idx]
  *             out[indices[row]] += other[row]
  */
-    __pyx_t_11 = __pyx_v_n_keep_rows;
-    __pyx_t_13 = __pyx_t_11;
+    __pyx_t_4 = __pyx_v_n_keep_rows;
+    __pyx_t_13 = __pyx_t_4;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_row_idx = __pyx_t_14;
 
-      /* "tabmat/ext/categorical.pyx":44
+      /* "tabmat/ext/categorical.pyx":43
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *             out[indices[row]] += other[row]
  *     # Cases 3 and 4: col restrictions
  */
-      __pyx_t_8 = __pyx_v_row_idx;
-      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+      __pyx_t_11 = __pyx_v_row_idx;
+      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
-      /* "tabmat/ext/categorical.pyx":45
+      /* "tabmat/ext/categorical.pyx":44
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]
  *             out[indices[row]] += other[row]             # <<<<<<<<<<<<<<
  *     # Cases 3 and 4: col restrictions
  *     else:
  */
-      __pyx_t_8 = __pyx_v_row;
-      __pyx_t_7 = __pyx_v_row;
-      __pyx_t_6 = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
-      *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_6 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+      __pyx_t_11 = __pyx_v_row;
+      __pyx_t_10 = __pyx_v_row;
+      __pyx_t_9 = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_10 * __pyx_v_indices.strides[0]) )));
+      *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_9 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
     }
 
-    /* "tabmat/ext/categorical.pyx":40
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+    /* "tabmat/ext/categorical.pyx":39
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
     goto __pyx_L7;
   }
 
-  /* "tabmat/ext/categorical.pyx":48
+  /* "tabmat/ext/categorical.pyx":47
  *     # Cases 3 and 4: col restrictions
  *     else:
  *         cols_included = get_col_included(cols, n_cols)             # <<<<<<<<<<<<<<
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 48, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_15 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 48, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_15 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 47, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
     __pyx_t_16 = NULL;
-    __pyx_t_11 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
-      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_9);
+    __pyx_t_4 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_16)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_16);
         __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_9, function);
-        __pyx_t_11 = 1;
+        __Pyx_DECREF_SET(__pyx_t_2, function);
+        __pyx_t_4 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_9)) {
+    if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 48, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 48, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     {
-      __pyx_t_17 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 48, __pyx_L1_error)
+      __pyx_t_17 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 47, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       if (__pyx_t_16) {
         __Pyx_GIVEREF(__pyx_t_16); PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_16); __pyx_t_16 = NULL;
       }
       __Pyx_INCREF(__pyx_v_cols);
       __Pyx_GIVEREF(__pyx_v_cols);
-      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_11, __pyx_v_cols);
+      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_4, __pyx_v_cols);
       __Pyx_GIVEREF(__pyx_t_15);
-      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_11, __pyx_t_15);
+      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_4, __pyx_t_15);
       __pyx_t_15 = 0;
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_17, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 48, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_10);
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_17, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
     }
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 48, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_cols_included = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
-    /* "tabmat/ext/categorical.pyx":50
+    /* "tabmat/ext/categorical.pyx":49
  *         cols_included = get_col_included(cols, n_cols)
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  */
-    __pyx_t_3 = (__pyx_v_no_row_restrictions != 0);
-    if (__pyx_t_3) {
+    __pyx_t_6 = (__pyx_v_no_row_restrictions != 0);
+    if (__pyx_t_6) {
 
-      /* "tabmat/ext/categorical.pyx":51
+      /* "tabmat/ext/categorical.pyx":50
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):             # <<<<<<<<<<<<<<
  *                 col = indices[row_idx]
  *                 if cols_included[col]:
  */
-      __pyx_t_11 = __pyx_v_n_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
-        /* "tabmat/ext/categorical.pyx":52
+        /* "tabmat/ext/categorical.pyx":51
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]             # <<<<<<<<<<<<<<
  *                 if cols_included[col]:
  *                     out[col] += other[row_idx]
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) )));
 
-        /* "tabmat/ext/categorical.pyx":53
+        /* "tabmat/ext/categorical.pyx":52
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
  */
-        __pyx_t_8 = __pyx_v_col;
-        __pyx_t_3 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        if (__pyx_t_3) {
+        __pyx_t_11 = __pyx_v_col;
+        __pyx_t_6 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        if (__pyx_t_6) {
 
-          /* "tabmat/ext/categorical.pyx":54
+          /* "tabmat/ext/categorical.pyx":53
  *                 col = indices[row_idx]
  *                 if cols_included[col]:
  *                     out[col] += other[row_idx]             # <<<<<<<<<<<<<<
  *         # Case 4: Both col restrictions and row restrictions
  *         else:
  */
-          __pyx_t_8 = __pyx_v_row_idx;
-          __pyx_t_7 = __pyx_v_col;
-          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row_idx;
+          __pyx_t_10 = __pyx_v_col;
+          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
-          /* "tabmat/ext/categorical.pyx":53
+          /* "tabmat/ext/categorical.pyx":52
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
  */
         }
       }
 
-      /* "tabmat/ext/categorical.pyx":50
+      /* "tabmat/ext/categorical.pyx":49
  *         cols_included = get_col_included(cols, n_cols)
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  */
       goto __pyx_L12;
     }
 
-    /* "tabmat/ext/categorical.pyx":57
+    /* "tabmat/ext/categorical.pyx":56
  *         # Case 4: Both col restrictions and row restrictions
  *         else:
  *             rows_view = rows             # <<<<<<<<<<<<<<
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):
  */
     /*else*/ {
-      __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 57, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 56, __pyx_L1_error)
       __pyx_v_rows_view = __pyx_t_12;
       __pyx_t_12.memview = NULL;
       __pyx_t_12.data = NULL;
 
-      /* "tabmat/ext/categorical.pyx":58
+      /* "tabmat/ext/categorical.pyx":57
  *         else:
  *             rows_view = rows
  *             n_keep_rows = len(rows_view)             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]
  */
       __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_rows_view); 
       __pyx_v_n_keep_rows = __pyx_t_1;
 
-      /* "tabmat/ext/categorical.pyx":59
+      /* "tabmat/ext/categorical.pyx":58
  *             rows_view = rows
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *                 row = rows_view[row_idx]
  *                 col = indices[row]
  */
-      __pyx_t_11 = __pyx_v_n_keep_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_keep_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
-        /* "tabmat/ext/categorical.pyx":60
+        /* "tabmat/ext/categorical.pyx":59
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *                 col = indices[row]
  *                 if cols_included[col]:
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
-        /* "tabmat/ext/categorical.pyx":61
+        /* "tabmat/ext/categorical.pyx":60
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]
  *                 col = indices[row]             # <<<<<<<<<<<<<<
  *                 if cols_included[col]:
  *                     out[col] += other[row]
  */
-        __pyx_t_8 = __pyx_v_row;
-        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row;
+        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) )));
 
-        /* "tabmat/ext/categorical.pyx":62
+        /* "tabmat/ext/categorical.pyx":61
  *                 row = rows_view[row_idx]
  *                 col = indices[row]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row]
  * 
  */
-        __pyx_t_8 = __pyx_v_col;
-        __pyx_t_3 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        if (__pyx_t_3) {
+        __pyx_t_11 = __pyx_v_col;
+        __pyx_t_6 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        if (__pyx_t_6) {
 
-          /* "tabmat/ext/categorical.pyx":63
+          /* "tabmat/ext/categorical.pyx":62
  *                 col = indices[row]
  *                 if cols_included[col]:
  *                     out[col] += other[row]             # <<<<<<<<<<<<<<
  * 
  * 
  */
-          __pyx_t_8 = __pyx_v_row;
-          __pyx_t_7 = __pyx_v_col;
-          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row;
+          __pyx_t_10 = __pyx_v_col;
+          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
-          /* "tabmat/ext/categorical.pyx":62
+          /* "tabmat/ext/categorical.pyx":61
  *                 row = rows_view[row_idx]
  *                 col = indices[row]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row]
  * 
  */
         }
       }
     }
     __pyx_L12:;
   }
   __pyx_L7:;
 
-  /* "tabmat/ext/categorical.pyx":20
+  /* "tabmat/ext/categorical.pyx":18
  * 
  * 
  * def transpose_matvec(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
   __Pyx_XDECREF(__pyx_t_15);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_XDECREF(__pyx_t_17);
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
@@ -4216,72 +4240,72 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 1); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 1); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 2); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 2); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 3); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 3); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 4); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 4); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 5); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 5); __PYX_ERR(0, 18, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 6); __PYX_ERR(0, 20, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, 6); __PYX_ERR(0, 18, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec") < 0)) __PYX_ERR(0, 20, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 21, __pyx_L3_error)
-    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 22, __pyx_L3_error)
-    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 19, __pyx_L3_error)
+    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 20, __pyx_L3_error)
+    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 21, __pyx_L3_error)
     __pyx_v_dtype = values[3];
     __pyx_v_rows = values[4];
     __pyx_v_cols = values[5];
-    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 27, __pyx_L3_error)
+    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 25, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 20, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_matvec", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_11categorical_20transpose_matvec(__pyx_self, __pyx_v_indices, __pyx_v_other, __pyx_v_n_cols, __pyx_v_dtype, __pyx_v_rows, __pyx_v_cols, __pyx_v_out);
 
@@ -4292,458 +4316,468 @@
 
 static PyObject *__pyx_pf_6tabmat_3ext_11categorical_20transpose_matvec(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_other, int __pyx_v_n_cols, CYTHON_UNUSED PyObject *__pyx_v_dtype, PyObject *__pyx_v_rows, PyObject *__pyx_v_cols, __Pyx_memviewslice __pyx_v_out) {
   int __pyx_v_row;
   int __pyx_v_row_idx;
   int __pyx_v_n_keep_rows;
   int __pyx_v_col;
   int __pyx_v_n_rows;
+  int __pyx_v_out_size;
   __Pyx_memviewslice __pyx_v_rows_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_cols_included = { 0, 0, { 0 }, { 0 }, { 0 } };
   bool __pyx_v_no_row_restrictions;
   bool __pyx_v_no_col_restrictions;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
-  bool __pyx_t_2;
-  int __pyx_t_3;
-  Py_ssize_t __pyx_t_4;
-  int __pyx_t_5;
-  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  bool __pyx_t_5;
+  int __pyx_t_6;
   Py_ssize_t __pyx_t_7;
-  Py_ssize_t __pyx_t_8;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
+  int __pyx_t_8;
+  Py_ssize_t __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
+  Py_ssize_t __pyx_t_11;
   __Pyx_memviewslice __pyx_t_12 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_t_13;
   int __pyx_t_14;
   PyObject *__pyx_t_15 = NULL;
   PyObject *__pyx_t_16 = NULL;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1transpose_matvec", 0);
 
-  /* "tabmat/ext/categorical.pyx":30
+  /* "tabmat/ext/categorical.pyx":28
  * ):
  *     cdef int row, row_idx, n_keep_rows, col
  *     cdef int n_rows = len(indices)             # <<<<<<<<<<<<<<
+ *     cdef int out_size = out.size
  *     cdef int[:] rows_view, cols_included
- * 
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_indices); 
   __pyx_v_n_rows = __pyx_t_1;
 
-  /* "tabmat/ext/categorical.pyx":33
+  /* "tabmat/ext/categorical.pyx":29
+ *     cdef int row, row_idx, n_keep_rows, col
+ *     cdef int n_rows = len(indices)
+ *     cdef int out_size = out.size             # <<<<<<<<<<<<<<
+ *     cdef int[:] rows_view, cols_included
+ * 
+ */
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_out_size = __pyx_t_4;
+
+  /* "tabmat/ext/categorical.pyx":32
  *     cdef int[:] rows_view, cols_included
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows             # <<<<<<<<<<<<<<
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols
  * 
  */
-  __pyx_t_3 = (__pyx_v_rows == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_rows == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 33, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_rows);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 32, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_rows);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L3_bool_binop_done:;
-  __pyx_v_no_row_restrictions = __pyx_t_2;
+  __pyx_v_no_row_restrictions = __pyx_t_5;
 
-  /* "tabmat/ext/categorical.pyx":34
+  /* "tabmat/ext/categorical.pyx":33
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols             # <<<<<<<<<<<<<<
  * 
  *     # Case 1: No row or col restrictions
  */
-  __pyx_t_3 = (__pyx_v_cols == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_cols == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 34, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_cols);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 33, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_cols);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L5_bool_binop_done:;
-  __pyx_v_no_col_restrictions = __pyx_t_2;
+  __pyx_v_no_col_restrictions = __pyx_t_5;
 
-  /* "tabmat/ext/categorical.pyx":37
+  /* "tabmat/ext/categorical.pyx":36
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
-  __pyx_t_5 = (__pyx_v_no_row_restrictions != 0);
-  if (__pyx_t_5) {
+  __pyx_t_8 = (__pyx_v_no_row_restrictions != 0);
+  if (__pyx_t_8) {
   } else {
-    __pyx_t_3 = __pyx_t_5;
+    __pyx_t_6 = __pyx_t_8;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_5 = (__pyx_v_no_col_restrictions != 0);
-  __pyx_t_3 = __pyx_t_5;
+  __pyx_t_8 = (__pyx_v_no_col_restrictions != 0);
+  __pyx_t_6 = __pyx_t_8;
   __pyx_L8_bool_binop_done:;
-  if (__pyx_t_3) {
+  if (__pyx_t_6) {
 
-    /* "tabmat/ext/categorical.pyx":38
+    /* "tabmat/ext/categorical.pyx":37
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)             # <<<<<<<<<<<<<<
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)             # <<<<<<<<<<<<<<
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  */
-    __pyx_t_6 = 0;
-    __pyx_t_7 = 0;
-    __pyx_t_8 = 0;
-    __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 38, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_size); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 38, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_10);
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_10); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 38, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    _transpose_matvec_all_rows<double>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_6 * __pyx_v_indices.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_7 * __pyx_v_other.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_8 * __pyx_v_out.strides[0]) )))), __pyx_t_11);
+    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
+    __pyx_t_11 = 0;
+    _transpose_matvec_all_rows<int,double>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_9 * __pyx_v_indices.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_10 * __pyx_v_other.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_11 * __pyx_v_out.strides[0]) )))), __pyx_v_out_size);
 
-    /* "tabmat/ext/categorical.pyx":37
+    /* "tabmat/ext/categorical.pyx":36
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
     goto __pyx_L7;
   }
 
-  /* "tabmat/ext/categorical.pyx":40
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+  /* "tabmat/ext/categorical.pyx":39
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
-  __pyx_t_3 = (__pyx_v_no_col_restrictions != 0);
-  if (__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_no_col_restrictions != 0);
+  if (__pyx_t_6) {
 
-    /* "tabmat/ext/categorical.pyx":41
+    /* "tabmat/ext/categorical.pyx":40
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  *         rows_view = rows             # <<<<<<<<<<<<<<
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
  */
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 40, __pyx_L1_error)
     __pyx_v_rows_view = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
-    /* "tabmat/ext/categorical.pyx":42
+    /* "tabmat/ext/categorical.pyx":41
  *     elif no_col_restrictions:
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)             # <<<<<<<<<<<<<<
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]
  */
     __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_rows_view); 
     __pyx_v_n_keep_rows = __pyx_t_1;
 
-    /* "tabmat/ext/categorical.pyx":43
+    /* "tabmat/ext/categorical.pyx":42
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *             row = rows_view[row_idx]
  *             out[indices[row]] += other[row]
  */
-    __pyx_t_11 = __pyx_v_n_keep_rows;
-    __pyx_t_13 = __pyx_t_11;
+    __pyx_t_4 = __pyx_v_n_keep_rows;
+    __pyx_t_13 = __pyx_t_4;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_row_idx = __pyx_t_14;
 
-      /* "tabmat/ext/categorical.pyx":44
+      /* "tabmat/ext/categorical.pyx":43
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *             out[indices[row]] += other[row]
  *     # Cases 3 and 4: col restrictions
  */
-      __pyx_t_8 = __pyx_v_row_idx;
-      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+      __pyx_t_11 = __pyx_v_row_idx;
+      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
-      /* "tabmat/ext/categorical.pyx":45
+      /* "tabmat/ext/categorical.pyx":44
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]
  *             out[indices[row]] += other[row]             # <<<<<<<<<<<<<<
  *     # Cases 3 and 4: col restrictions
  *     else:
  */
-      __pyx_t_8 = __pyx_v_row;
-      __pyx_t_7 = __pyx_v_row;
-      __pyx_t_6 = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_7 * __pyx_v_indices.strides[0]) )));
-      *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_6 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+      __pyx_t_11 = __pyx_v_row;
+      __pyx_t_10 = __pyx_v_row;
+      __pyx_t_9 = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_10 * __pyx_v_indices.strides[0]) )));
+      *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_9 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
     }
 
-    /* "tabmat/ext/categorical.pyx":40
- *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+    /* "tabmat/ext/categorical.pyx":39
+ *         _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
     goto __pyx_L7;
   }
 
-  /* "tabmat/ext/categorical.pyx":48
+  /* "tabmat/ext/categorical.pyx":47
  *     # Cases 3 and 4: col restrictions
  *     else:
  *         cols_included = get_col_included(cols, n_cols)             # <<<<<<<<<<<<<<
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 48, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_15 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 48, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_15 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 47, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
     __pyx_t_16 = NULL;
-    __pyx_t_11 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
-      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_9);
+    __pyx_t_4 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_16)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_16);
         __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_9, function);
-        __pyx_t_11 = 1;
+        __Pyx_DECREF_SET(__pyx_t_2, function);
+        __pyx_t_4 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_9)) {
+    if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 48, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 48, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     {
-      __pyx_t_17 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 48, __pyx_L1_error)
+      __pyx_t_17 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 47, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       if (__pyx_t_16) {
         __Pyx_GIVEREF(__pyx_t_16); PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_16); __pyx_t_16 = NULL;
       }
       __Pyx_INCREF(__pyx_v_cols);
       __Pyx_GIVEREF(__pyx_v_cols);
-      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_11, __pyx_v_cols);
+      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_4, __pyx_v_cols);
       __Pyx_GIVEREF(__pyx_t_15);
-      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_11, __pyx_t_15);
+      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_4, __pyx_t_15);
       __pyx_t_15 = 0;
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_17, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 48, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_10);
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_17, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
     }
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 48, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_cols_included = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
-    /* "tabmat/ext/categorical.pyx":50
+    /* "tabmat/ext/categorical.pyx":49
  *         cols_included = get_col_included(cols, n_cols)
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  */
-    __pyx_t_3 = (__pyx_v_no_row_restrictions != 0);
-    if (__pyx_t_3) {
+    __pyx_t_6 = (__pyx_v_no_row_restrictions != 0);
+    if (__pyx_t_6) {
 
-      /* "tabmat/ext/categorical.pyx":51
+      /* "tabmat/ext/categorical.pyx":50
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):             # <<<<<<<<<<<<<<
  *                 col = indices[row_idx]
  *                 if cols_included[col]:
  */
-      __pyx_t_11 = __pyx_v_n_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
-        /* "tabmat/ext/categorical.pyx":52
+        /* "tabmat/ext/categorical.pyx":51
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]             # <<<<<<<<<<<<<<
  *                 if cols_included[col]:
  *                     out[col] += other[row_idx]
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) )));
 
-        /* "tabmat/ext/categorical.pyx":53
+        /* "tabmat/ext/categorical.pyx":52
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
  */
-        __pyx_t_8 = __pyx_v_col;
-        __pyx_t_3 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        if (__pyx_t_3) {
+        __pyx_t_11 = __pyx_v_col;
+        __pyx_t_6 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        if (__pyx_t_6) {
 
-          /* "tabmat/ext/categorical.pyx":54
+          /* "tabmat/ext/categorical.pyx":53
  *                 col = indices[row_idx]
  *                 if cols_included[col]:
  *                     out[col] += other[row_idx]             # <<<<<<<<<<<<<<
  *         # Case 4: Both col restrictions and row restrictions
  *         else:
  */
-          __pyx_t_8 = __pyx_v_row_idx;
-          __pyx_t_7 = __pyx_v_col;
-          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row_idx;
+          __pyx_t_10 = __pyx_v_col;
+          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
-          /* "tabmat/ext/categorical.pyx":53
+          /* "tabmat/ext/categorical.pyx":52
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
  */
         }
       }
 
-      /* "tabmat/ext/categorical.pyx":50
+      /* "tabmat/ext/categorical.pyx":49
  *         cols_included = get_col_included(cols, n_cols)
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_rows):
  *                 col = indices[row_idx]
  */
       goto __pyx_L12;
     }
 
-    /* "tabmat/ext/categorical.pyx":57
+    /* "tabmat/ext/categorical.pyx":56
  *         # Case 4: Both col restrictions and row restrictions
  *         else:
  *             rows_view = rows             # <<<<<<<<<<<<<<
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):
  */
     /*else*/ {
-      __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 57, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_rows, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 56, __pyx_L1_error)
       __pyx_v_rows_view = __pyx_t_12;
       __pyx_t_12.memview = NULL;
       __pyx_t_12.data = NULL;
 
-      /* "tabmat/ext/categorical.pyx":58
+      /* "tabmat/ext/categorical.pyx":57
  *         else:
  *             rows_view = rows
  *             n_keep_rows = len(rows_view)             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]
  */
       __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_rows_view); 
       __pyx_v_n_keep_rows = __pyx_t_1;
 
-      /* "tabmat/ext/categorical.pyx":59
+      /* "tabmat/ext/categorical.pyx":58
  *             rows_view = rows
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *                 row = rows_view[row_idx]
  *                 col = indices[row]
  */
-      __pyx_t_11 = __pyx_v_n_keep_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_keep_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
-        /* "tabmat/ext/categorical.pyx":60
+        /* "tabmat/ext/categorical.pyx":59
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *                 col = indices[row]
  *                 if cols_included[col]:
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
-        /* "tabmat/ext/categorical.pyx":61
+        /* "tabmat/ext/categorical.pyx":60
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]
  *                 col = indices[row]             # <<<<<<<<<<<<<<
  *                 if cols_included[col]:
  *                     out[col] += other[row]
  */
-        __pyx_t_8 = __pyx_v_row;
-        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row;
+        __pyx_v_col = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) )));
 
-        /* "tabmat/ext/categorical.pyx":62
+        /* "tabmat/ext/categorical.pyx":61
  *                 row = rows_view[row_idx]
  *                 col = indices[row]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row]
  * 
  */
-        __pyx_t_8 = __pyx_v_col;
-        __pyx_t_3 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        if (__pyx_t_3) {
+        __pyx_t_11 = __pyx_v_col;
+        __pyx_t_6 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        if (__pyx_t_6) {
 
-          /* "tabmat/ext/categorical.pyx":63
+          /* "tabmat/ext/categorical.pyx":62
  *                 col = indices[row]
  *                 if cols_included[col]:
  *                     out[col] += other[row]             # <<<<<<<<<<<<<<
  * 
  * 
  */
-          __pyx_t_8 = __pyx_v_row;
-          __pyx_t_7 = __pyx_v_col;
-          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row;
+          __pyx_t_10 = __pyx_v_col;
+          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
-          /* "tabmat/ext/categorical.pyx":62
+          /* "tabmat/ext/categorical.pyx":61
  *                 row = rows_view[row_idx]
  *                 col = indices[row]
  *                 if cols_included[col]:             # <<<<<<<<<<<<<<
  *                     out[col] += other[row]
  * 
  */
         }
       }
     }
     __pyx_L12:;
   }
   __pyx_L7:;
 
-  /* "tabmat/ext/categorical.pyx":20
+  /* "tabmat/ext/categorical.pyx":18
  * 
  * 
  * def transpose_matvec(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
   __Pyx_XDECREF(__pyx_t_15);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_XDECREF(__pyx_t_17);
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
@@ -4753,15 +4787,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_other, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_out, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/categorical.pyx":66
+/* "tabmat/ext/categorical.pyx":65
  * 
  * 
  * def transpose_matvec_drop_first(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
 
@@ -4802,31 +4836,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 65, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 66, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 65, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -4835,15 +4869,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 66, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 65, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.categorical.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_11categorical_2transpose_matvec_drop_first(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -4889,51 +4923,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("transpose_matvec_drop_first", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __PYX_ERR(0, 65, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 66, __pyx_L1_error)
+      __PYX_ERR(0, 65, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -4942,85 +4976,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __PYX_ERR(0, 65, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_other, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_other, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 66, __pyx_L1_error)
+      __PYX_ERR(0, 65, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_other); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 66, __pyx_L1_error)
+      __PYX_ERR(0, 65, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 66, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_7);
     __Pyx_GIVEREF(__pyx_int_7);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_7);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __PYX_ERR(0, 65, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -5034,62 +5068,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 66, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -5108,15 +5142,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -5130,100 +5164,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __PYX_ERR(0, 65, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 66, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 66, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -5231,43 +5265,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 66, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __PYX_ERR(0, 65, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 66, __pyx_L1_error)
+    __PYX_ERR(0, 65, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 66, __pyx_L1_error)
+      __PYX_ERR(0, 65, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -5341,72 +5375,72 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 1); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 1); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 2); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 2); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 3); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 3); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 4); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 4); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 5); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 5); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 6); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 6); __PYX_ERR(0, 65, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec_drop_first") < 0)) __PYX_ERR(0, 66, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec_drop_first") < 0)) __PYX_ERR(0, 65, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 67, __pyx_L3_error)
-    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 68, __pyx_L3_error)
-    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 66, __pyx_L3_error)
+    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 67, __pyx_L3_error)
+    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L3_error)
     __pyx_v_dtype = values[3];
     __pyx_v_rows = values[4];
     __pyx_v_cols = values[5];
-    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 72, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 66, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 65, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec_drop_first", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_11categorical_24transpose_matvec_drop_first(__pyx_self, __pyx_v_indices, __pyx_v_other, __pyx_v_n_cols, __pyx_v_dtype, __pyx_v_rows, __pyx_v_cols, __pyx_v_out);
 
@@ -5417,146 +5451,156 @@
 
 static PyObject *__pyx_pf_6tabmat_3ext_11categorical_24transpose_matvec_drop_first(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_other, int __pyx_v_n_cols, CYTHON_UNUSED PyObject *__pyx_v_dtype, PyObject *__pyx_v_rows, PyObject *__pyx_v_cols, __Pyx_memviewslice __pyx_v_out) {
   int __pyx_v_row;
   int __pyx_v_row_idx;
   int __pyx_v_n_keep_rows;
   int __pyx_v_col_idx;
   int __pyx_v_n_rows;
+  int __pyx_v_out_size;
   __Pyx_memviewslice __pyx_v_rows_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_cols_included = { 0, 0, { 0 }, { 0 }, { 0 } };
   bool __pyx_v_no_row_restrictions;
   bool __pyx_v_no_col_restrictions;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
-  bool __pyx_t_2;
-  int __pyx_t_3;
-  Py_ssize_t __pyx_t_4;
-  int __pyx_t_5;
-  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  bool __pyx_t_5;
+  int __pyx_t_6;
   Py_ssize_t __pyx_t_7;
-  Py_ssize_t __pyx_t_8;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
+  int __pyx_t_8;
+  Py_ssize_t __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
+  Py_ssize_t __pyx_t_11;
   __Pyx_memviewslice __pyx_t_12 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_t_13;
   int __pyx_t_14;
   PyObject *__pyx_t_15 = NULL;
   PyObject *__pyx_t_16 = NULL;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0transpose_matvec_drop_first", 0);
 
-  /* "tabmat/ext/categorical.pyx":76
+  /* "tabmat/ext/categorical.pyx":75
  * ):
  *     cdef int row, row_idx, n_keep_rows, col_idx
  *     cdef int n_rows = len(indices)             # <<<<<<<<<<<<<<
+ *     cdef int out_size = out.size
  *     cdef int[:] rows_view, cols_included
- * 
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_indices); 
   __pyx_v_n_rows = __pyx_t_1;
 
+  /* "tabmat/ext/categorical.pyx":76
+ *     cdef int row, row_idx, n_keep_rows, col_idx
+ *     cdef int n_rows = len(indices)
+ *     cdef int out_size = out.size             # <<<<<<<<<<<<<<
+ *     cdef int[:] rows_view, cols_included
+ * 
+ */
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_out_size = __pyx_t_4;
+
   /* "tabmat/ext/categorical.pyx":79
  *     cdef int[:] rows_view, cols_included
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows             # <<<<<<<<<<<<<<
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols
  * 
  */
-  __pyx_t_3 = (__pyx_v_rows == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_rows == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 79, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_rows);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_rows);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L3_bool_binop_done:;
-  __pyx_v_no_row_restrictions = __pyx_t_2;
+  __pyx_v_no_row_restrictions = __pyx_t_5;
 
   /* "tabmat/ext/categorical.pyx":80
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols             # <<<<<<<<<<<<<<
  * 
  *     # Case 1: No row or col restrictions
  */
-  __pyx_t_3 = (__pyx_v_cols == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_cols == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 80, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_cols);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_cols);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L5_bool_binop_done:;
-  __pyx_v_no_col_restrictions = __pyx_t_2;
+  __pyx_v_no_col_restrictions = __pyx_t_5;
 
   /* "tabmat/ext/categorical.pyx":83
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
-  __pyx_t_5 = (__pyx_v_no_row_restrictions != 0);
-  if (__pyx_t_5) {
+  __pyx_t_8 = (__pyx_v_no_row_restrictions != 0);
+  if (__pyx_t_8) {
   } else {
-    __pyx_t_3 = __pyx_t_5;
+    __pyx_t_6 = __pyx_t_8;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_5 = (__pyx_v_no_col_restrictions != 0);
-  __pyx_t_3 = __pyx_t_5;
+  __pyx_t_8 = (__pyx_v_no_col_restrictions != 0);
+  __pyx_t_6 = __pyx_t_8;
   __pyx_L8_bool_binop_done:;
-  if (__pyx_t_3) {
+  if (__pyx_t_6) {
 
     /* "tabmat/ext/categorical.pyx":84
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)             # <<<<<<<<<<<<<<
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)             # <<<<<<<<<<<<<<
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  */
-    __pyx_t_6 = 0;
-    __pyx_t_7 = 0;
-    __pyx_t_8 = 0;
-    __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 84, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_size); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 84, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_10);
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_10); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    _transpose_matvec_all_rows_drop_first<float>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_6 * __pyx_v_indices.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_7 * __pyx_v_other.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_8 * __pyx_v_out.strides[0]) )))), __pyx_t_11);
+    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
+    __pyx_t_11 = 0;
+    _transpose_matvec_all_rows_drop_first<int,float>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_9 * __pyx_v_indices.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_10 * __pyx_v_other.strides[0]) )))), (&(*((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_11 * __pyx_v_out.strides[0]) )))), __pyx_v_out_size);
 
     /* "tabmat/ext/categorical.pyx":83
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
     goto __pyx_L7;
   }
 
   /* "tabmat/ext/categorical.pyx":86
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
-  __pyx_t_3 = (__pyx_v_no_col_restrictions != 0);
-  if (__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_no_col_restrictions != 0);
+  if (__pyx_t_6) {
 
     /* "tabmat/ext/categorical.pyx":87
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  *         rows_view = rows             # <<<<<<<<<<<<<<
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
@@ -5579,72 +5623,72 @@
     /* "tabmat/ext/categorical.pyx":89
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1
  */
-    __pyx_t_11 = __pyx_v_n_keep_rows;
-    __pyx_t_13 = __pyx_t_11;
+    __pyx_t_4 = __pyx_v_n_keep_rows;
+    __pyx_t_13 = __pyx_t_4;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_row_idx = __pyx_t_14;
 
       /* "tabmat/ext/categorical.pyx":90
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:
  */
-      __pyx_t_8 = __pyx_v_row_idx;
-      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+      __pyx_t_11 = __pyx_v_row_idx;
+      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
       /* "tabmat/ext/categorical.pyx":91
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1             # <<<<<<<<<<<<<<
  *             if col_idx != -1:
  *                 out[col_idx] += other[row]
  */
-      __pyx_t_8 = __pyx_v_row;
-      __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) ))) - 1);
+      __pyx_t_11 = __pyx_v_row;
+      __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) ))) - 1);
 
       /* "tabmat/ext/categorical.pyx":92
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:             # <<<<<<<<<<<<<<
  *                 out[col_idx] += other[row]
  *     # Cases 3 and 4: col restrictions
  */
-      __pyx_t_3 = ((__pyx_v_col_idx != -1L) != 0);
-      if (__pyx_t_3) {
+      __pyx_t_6 = ((__pyx_v_col_idx != -1L) != 0);
+      if (__pyx_t_6) {
 
         /* "tabmat/ext/categorical.pyx":93
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:
  *                 out[col_idx] += other[row]             # <<<<<<<<<<<<<<
  *     # Cases 3 and 4: col restrictions
  *     else:
  */
-        __pyx_t_8 = __pyx_v_row;
-        __pyx_t_7 = __pyx_v_col_idx;
-        *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row;
+        __pyx_t_10 = __pyx_v_col_idx;
+        *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
         /* "tabmat/ext/categorical.pyx":92
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:             # <<<<<<<<<<<<<<
  *                 out[col_idx] += other[row]
  *     # Cases 3 and 4: col restrictions
  */
       }
     }
 
     /* "tabmat/ext/categorical.pyx":86
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
     goto __pyx_L7;
   }
@@ -5653,132 +5697,132 @@
  *     # Cases 3 and 4: col restrictions
  *     else:
  *         cols_included = get_col_included(cols, n_cols)             # <<<<<<<<<<<<<<
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 96, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_15 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 96, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
     __pyx_t_16 = NULL;
-    __pyx_t_11 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
-      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_9);
+    __pyx_t_4 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_16)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_16);
         __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_9, function);
-        __pyx_t_11 = 1;
+        __Pyx_DECREF_SET(__pyx_t_2, function);
+        __pyx_t_4 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_9)) {
+    if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     {
-      __pyx_t_17 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __pyx_t_17 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 96, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       if (__pyx_t_16) {
         __Pyx_GIVEREF(__pyx_t_16); PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_16); __pyx_t_16 = NULL;
       }
       __Pyx_INCREF(__pyx_v_cols);
       __Pyx_GIVEREF(__pyx_v_cols);
-      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_11, __pyx_v_cols);
+      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_4, __pyx_v_cols);
       __Pyx_GIVEREF(__pyx_t_15);
-      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_11, __pyx_t_15);
+      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_4, __pyx_t_15);
       __pyx_t_15 = 0;
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_17, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 96, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_10);
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_17, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
     }
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 96, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_cols_included = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
     /* "tabmat/ext/categorical.pyx":98
  *         cols_included = get_col_included(cols, n_cols)
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1
  */
-    __pyx_t_3 = (__pyx_v_no_row_restrictions != 0);
-    if (__pyx_t_3) {
+    __pyx_t_6 = (__pyx_v_no_row_restrictions != 0);
+    if (__pyx_t_6) {
 
       /* "tabmat/ext/categorical.pyx":99
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):             # <<<<<<<<<<<<<<
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  */
-      __pyx_t_11 = __pyx_v_n_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
         /* "tabmat/ext/categorical.pyx":100
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1             # <<<<<<<<<<<<<<
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row_idx]
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) ))) - 1);
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) ))) - 1);
 
         /* "tabmat/ext/categorical.pyx":101
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
  */
-        __pyx_t_5 = ((__pyx_v_col_idx != -1L) != 0);
-        if (__pyx_t_5) {
+        __pyx_t_8 = ((__pyx_v_col_idx != -1L) != 0);
+        if (__pyx_t_8) {
         } else {
-          __pyx_t_3 = __pyx_t_5;
+          __pyx_t_6 = __pyx_t_8;
           goto __pyx_L17_bool_binop_done;
         }
-        __pyx_t_8 = __pyx_v_col_idx;
-        __pyx_t_5 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        __pyx_t_3 = __pyx_t_5;
+        __pyx_t_11 = __pyx_v_col_idx;
+        __pyx_t_8 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        __pyx_t_6 = __pyx_t_8;
         __pyx_L17_bool_binop_done:;
-        if (__pyx_t_3) {
+        if (__pyx_t_6) {
 
           /* "tabmat/ext/categorical.pyx":102
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row_idx]             # <<<<<<<<<<<<<<
  *         # Case 4: Both col restrictions and row restrictions
  *         else:
  */
-          __pyx_t_8 = __pyx_v_row_idx;
-          __pyx_t_7 = __pyx_v_col_idx;
-          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row_idx;
+          __pyx_t_10 = __pyx_v_col_idx;
+          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
           /* "tabmat/ext/categorical.pyx":101
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
@@ -5822,68 +5866,68 @@
       /* "tabmat/ext/categorical.pyx":107
  *             rows_view = rows
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1
  */
-      __pyx_t_11 = __pyx_v_n_keep_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_keep_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
         /* "tabmat/ext/categorical.pyx":108
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
         /* "tabmat/ext/categorical.pyx":109
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1             # <<<<<<<<<<<<<<
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row]
  */
-        __pyx_t_8 = __pyx_v_row;
-        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) ))) - 1);
+        __pyx_t_11 = __pyx_v_row;
+        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) ))) - 1);
 
         /* "tabmat/ext/categorical.pyx":110
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row]
  * 
  */
-        __pyx_t_5 = ((__pyx_v_col_idx != -1L) != 0);
-        if (__pyx_t_5) {
+        __pyx_t_8 = ((__pyx_v_col_idx != -1L) != 0);
+        if (__pyx_t_8) {
         } else {
-          __pyx_t_3 = __pyx_t_5;
+          __pyx_t_6 = __pyx_t_8;
           goto __pyx_L22_bool_binop_done;
         }
-        __pyx_t_8 = __pyx_v_col_idx;
-        __pyx_t_5 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        __pyx_t_3 = __pyx_t_5;
+        __pyx_t_11 = __pyx_v_col_idx;
+        __pyx_t_8 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        __pyx_t_6 = __pyx_t_8;
         __pyx_L22_bool_binop_done:;
-        if (__pyx_t_3) {
+        if (__pyx_t_6) {
 
           /* "tabmat/ext/categorical.pyx":111
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row]             # <<<<<<<<<<<<<<
  * 
  * 
  */
-          __pyx_t_8 = __pyx_v_row;
-          __pyx_t_7 = __pyx_v_col_idx;
-          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row;
+          __pyx_t_10 = __pyx_v_col_idx;
+          *((float *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
           /* "tabmat/ext/categorical.pyx":110
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row]
  * 
@@ -5891,28 +5935,28 @@
         }
       }
     }
     __pyx_L13:;
   }
   __pyx_L7:;
 
-  /* "tabmat/ext/categorical.pyx":66
+  /* "tabmat/ext/categorical.pyx":65
  * 
  * 
  * def transpose_matvec_drop_first(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
   __Pyx_XDECREF(__pyx_t_15);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_XDECREF(__pyx_t_17);
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec_drop_first", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5972,72 +6016,72 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_other)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 1); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 1); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_n_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 2); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 2); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 3); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 3); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 4); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 4); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 5); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 5); __PYX_ERR(0, 65, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 6); __PYX_ERR(0, 66, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, 6); __PYX_ERR(0, 65, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec_drop_first") < 0)) __PYX_ERR(0, 66, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_matvec_drop_first") < 0)) __PYX_ERR(0, 65, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 67, __pyx_L3_error)
-    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 68, __pyx_L3_error)
-    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 66, __pyx_L3_error)
+    __pyx_v_other = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_other.memview)) __PYX_ERR(0, 67, __pyx_L3_error)
+    __pyx_v_n_cols = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_n_cols == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L3_error)
     __pyx_v_dtype = values[3];
     __pyx_v_rows = values[4];
     __pyx_v_cols = values[5];
-    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_out = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_out.memview)) __PYX_ERR(0, 72, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 66, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_matvec_drop_first", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 65, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec_drop_first", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_11categorical_26transpose_matvec_drop_first(__pyx_self, __pyx_v_indices, __pyx_v_other, __pyx_v_n_cols, __pyx_v_dtype, __pyx_v_rows, __pyx_v_cols, __pyx_v_out);
 
@@ -6048,146 +6092,156 @@
 
 static PyObject *__pyx_pf_6tabmat_3ext_11categorical_26transpose_matvec_drop_first(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_indices, __Pyx_memviewslice __pyx_v_other, int __pyx_v_n_cols, CYTHON_UNUSED PyObject *__pyx_v_dtype, PyObject *__pyx_v_rows, PyObject *__pyx_v_cols, __Pyx_memviewslice __pyx_v_out) {
   int __pyx_v_row;
   int __pyx_v_row_idx;
   int __pyx_v_n_keep_rows;
   int __pyx_v_col_idx;
   int __pyx_v_n_rows;
+  int __pyx_v_out_size;
   __Pyx_memviewslice __pyx_v_rows_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_cols_included = { 0, 0, { 0 }, { 0 }, { 0 } };
   bool __pyx_v_no_row_restrictions;
   bool __pyx_v_no_col_restrictions;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
-  bool __pyx_t_2;
-  int __pyx_t_3;
-  Py_ssize_t __pyx_t_4;
-  int __pyx_t_5;
-  Py_ssize_t __pyx_t_6;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  bool __pyx_t_5;
+  int __pyx_t_6;
   Py_ssize_t __pyx_t_7;
-  Py_ssize_t __pyx_t_8;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
+  int __pyx_t_8;
+  Py_ssize_t __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
+  Py_ssize_t __pyx_t_11;
   __Pyx_memviewslice __pyx_t_12 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_t_13;
   int __pyx_t_14;
   PyObject *__pyx_t_15 = NULL;
   PyObject *__pyx_t_16 = NULL;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1transpose_matvec_drop_first", 0);
 
-  /* "tabmat/ext/categorical.pyx":76
+  /* "tabmat/ext/categorical.pyx":75
  * ):
  *     cdef int row, row_idx, n_keep_rows, col_idx
  *     cdef int n_rows = len(indices)             # <<<<<<<<<<<<<<
+ *     cdef int out_size = out.size
  *     cdef int[:] rows_view, cols_included
- * 
  */
   __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_indices); 
   __pyx_v_n_rows = __pyx_t_1;
 
+  /* "tabmat/ext/categorical.pyx":76
+ *     cdef int row, row_idx, n_keep_rows, col_idx
+ *     cdef int n_rows = len(indices)
+ *     cdef int out_size = out.size             # <<<<<<<<<<<<<<
+ *     cdef int[:] rows_view, cols_included
+ * 
+ */
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_v_out_size = __pyx_t_4;
+
   /* "tabmat/ext/categorical.pyx":79
  *     cdef int[:] rows_view, cols_included
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows             # <<<<<<<<<<<<<<
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols
  * 
  */
-  __pyx_t_3 = (__pyx_v_rows == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_rows == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L3_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 79, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_rows);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_rows); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_rows);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L3_bool_binop_done:;
-  __pyx_v_no_row_restrictions = __pyx_t_2;
+  __pyx_v_no_row_restrictions = __pyx_t_5;
 
   /* "tabmat/ext/categorical.pyx":80
  * 
  *     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows
  *     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols             # <<<<<<<<<<<<<<
  * 
  *     # Case 1: No row or col restrictions
  */
-  __pyx_t_3 = (__pyx_v_cols == Py_None);
-  if (!__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_cols == Py_None);
+  if (!__pyx_t_6) {
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_5 = __pyx_t_6;
     goto __pyx_L5_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 80, __pyx_L1_error)
-  __pyx_t_3 = (__pyx_t_4 == __pyx_v_n_cols);
-  __pyx_t_2 = __pyx_t_3;
+  __pyx_t_7 = PyObject_Length(__pyx_v_cols); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_6 = (__pyx_t_7 == __pyx_v_n_cols);
+  __pyx_t_5 = __pyx_t_6;
   __pyx_L5_bool_binop_done:;
-  __pyx_v_no_col_restrictions = __pyx_t_2;
+  __pyx_v_no_col_restrictions = __pyx_t_5;
 
   /* "tabmat/ext/categorical.pyx":83
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
-  __pyx_t_5 = (__pyx_v_no_row_restrictions != 0);
-  if (__pyx_t_5) {
+  __pyx_t_8 = (__pyx_v_no_row_restrictions != 0);
+  if (__pyx_t_8) {
   } else {
-    __pyx_t_3 = __pyx_t_5;
+    __pyx_t_6 = __pyx_t_8;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_5 = (__pyx_v_no_col_restrictions != 0);
-  __pyx_t_3 = __pyx_t_5;
+  __pyx_t_8 = (__pyx_v_no_col_restrictions != 0);
+  __pyx_t_6 = __pyx_t_8;
   __pyx_L8_bool_binop_done:;
-  if (__pyx_t_3) {
+  if (__pyx_t_6) {
 
     /* "tabmat/ext/categorical.pyx":84
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)             # <<<<<<<<<<<<<<
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)             # <<<<<<<<<<<<<<
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  */
-    __pyx_t_6 = 0;
-    __pyx_t_7 = 0;
-    __pyx_t_8 = 0;
-    __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_out, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 84, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_size); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 84, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_10);
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_10); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    _transpose_matvec_all_rows_drop_first<double>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_6 * __pyx_v_indices.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_7 * __pyx_v_other.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_8 * __pyx_v_out.strides[0]) )))), __pyx_t_11);
+    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
+    __pyx_t_11 = 0;
+    _transpose_matvec_all_rows_drop_first<int,double>(__pyx_v_n_rows, (&(*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_9 * __pyx_v_indices.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_10 * __pyx_v_other.strides[0]) )))), (&(*((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_11 * __pyx_v_out.strides[0]) )))), __pyx_v_out_size);
 
     /* "tabmat/ext/categorical.pyx":83
  * 
  *     # Case 1: No row or col restrictions
  *     if no_row_restrictions and no_col_restrictions:             # <<<<<<<<<<<<<<
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  */
     goto __pyx_L7;
   }
 
   /* "tabmat/ext/categorical.pyx":86
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
-  __pyx_t_3 = (__pyx_v_no_col_restrictions != 0);
-  if (__pyx_t_3) {
+  __pyx_t_6 = (__pyx_v_no_col_restrictions != 0);
+  if (__pyx_t_6) {
 
     /* "tabmat/ext/categorical.pyx":87
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:
  *         rows_view = rows             # <<<<<<<<<<<<<<
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
@@ -6210,72 +6264,72 @@
     /* "tabmat/ext/categorical.pyx":89
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1
  */
-    __pyx_t_11 = __pyx_v_n_keep_rows;
-    __pyx_t_13 = __pyx_t_11;
+    __pyx_t_4 = __pyx_v_n_keep_rows;
+    __pyx_t_13 = __pyx_t_4;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_row_idx = __pyx_t_14;
 
       /* "tabmat/ext/categorical.pyx":90
  *         n_keep_rows = len(rows_view)
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:
  */
-      __pyx_t_8 = __pyx_v_row_idx;
-      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+      __pyx_t_11 = __pyx_v_row_idx;
+      __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
       /* "tabmat/ext/categorical.pyx":91
  *         for row_idx in range(n_keep_rows):
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1             # <<<<<<<<<<<<<<
  *             if col_idx != -1:
  *                 out[col_idx] += other[row]
  */
-      __pyx_t_8 = __pyx_v_row;
-      __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) ))) - 1);
+      __pyx_t_11 = __pyx_v_row;
+      __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) ))) - 1);
 
       /* "tabmat/ext/categorical.pyx":92
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:             # <<<<<<<<<<<<<<
  *                 out[col_idx] += other[row]
  *     # Cases 3 and 4: col restrictions
  */
-      __pyx_t_3 = ((__pyx_v_col_idx != -1L) != 0);
-      if (__pyx_t_3) {
+      __pyx_t_6 = ((__pyx_v_col_idx != -1L) != 0);
+      if (__pyx_t_6) {
 
         /* "tabmat/ext/categorical.pyx":93
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:
  *                 out[col_idx] += other[row]             # <<<<<<<<<<<<<<
  *     # Cases 3 and 4: col restrictions
  *     else:
  */
-        __pyx_t_8 = __pyx_v_row;
-        __pyx_t_7 = __pyx_v_col_idx;
-        *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row;
+        __pyx_t_10 = __pyx_v_col_idx;
+        *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
         /* "tabmat/ext/categorical.pyx":92
  *             row = rows_view[row_idx]
  *             col_idx = indices[row] - 1
  *             if col_idx != -1:             # <<<<<<<<<<<<<<
  *                 out[col_idx] += other[row]
  *     # Cases 3 and 4: col restrictions
  */
       }
     }
 
     /* "tabmat/ext/categorical.pyx":86
- *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+ *         _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
  *     # Case 2: row restrictions but no col restrictions
  *     elif no_col_restrictions:             # <<<<<<<<<<<<<<
  *         rows_view = rows
  *         n_keep_rows = len(rows_view)
  */
     goto __pyx_L7;
   }
@@ -6284,132 +6338,132 @@
  *     # Cases 3 and 4: col restrictions
  *     else:
  *         cols_included = get_col_included(cols, n_cols)             # <<<<<<<<<<<<<<
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 96, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_col_included); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_15 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 96, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
     __pyx_t_16 = NULL;
-    __pyx_t_11 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
-      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_9);
+    __pyx_t_4 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+      __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_16)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_16);
         __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_9, function);
-        __pyx_t_11 = 1;
+        __Pyx_DECREF_SET(__pyx_t_2, function);
+        __pyx_t_4 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_9)) {
+    if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_v_cols, __pyx_t_15};
-      __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     } else
     #endif
     {
-      __pyx_t_17 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __pyx_t_17 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 96, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       if (__pyx_t_16) {
         __Pyx_GIVEREF(__pyx_t_16); PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_16); __pyx_t_16 = NULL;
       }
       __Pyx_INCREF(__pyx_v_cols);
       __Pyx_GIVEREF(__pyx_v_cols);
-      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_11, __pyx_v_cols);
+      PyTuple_SET_ITEM(__pyx_t_17, 0+__pyx_t_4, __pyx_v_cols);
       __Pyx_GIVEREF(__pyx_t_15);
-      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_11, __pyx_t_15);
+      PyTuple_SET_ITEM(__pyx_t_17, 1+__pyx_t_4, __pyx_t_15);
       __pyx_t_15 = 0;
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_17, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 96, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_10);
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_17, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
     }
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 96, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 96, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_cols_included = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
     /* "tabmat/ext/categorical.pyx":98
  *         cols_included = get_col_included(cols, n_cols)
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:             # <<<<<<<<<<<<<<
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1
  */
-    __pyx_t_3 = (__pyx_v_no_row_restrictions != 0);
-    if (__pyx_t_3) {
+    __pyx_t_6 = (__pyx_v_no_row_restrictions != 0);
+    if (__pyx_t_6) {
 
       /* "tabmat/ext/categorical.pyx":99
  *         # Case 3: Col restrictions but no row restrictions
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):             # <<<<<<<<<<<<<<
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  */
-      __pyx_t_11 = __pyx_v_n_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
         /* "tabmat/ext/categorical.pyx":100
  *         if no_row_restrictions:
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1             # <<<<<<<<<<<<<<
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row_idx]
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) ))) - 1);
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) ))) - 1);
 
         /* "tabmat/ext/categorical.pyx":101
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
  */
-        __pyx_t_5 = ((__pyx_v_col_idx != -1L) != 0);
-        if (__pyx_t_5) {
+        __pyx_t_8 = ((__pyx_v_col_idx != -1L) != 0);
+        if (__pyx_t_8) {
         } else {
-          __pyx_t_3 = __pyx_t_5;
+          __pyx_t_6 = __pyx_t_8;
           goto __pyx_L17_bool_binop_done;
         }
-        __pyx_t_8 = __pyx_v_col_idx;
-        __pyx_t_5 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        __pyx_t_3 = __pyx_t_5;
+        __pyx_t_11 = __pyx_v_col_idx;
+        __pyx_t_8 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        __pyx_t_6 = __pyx_t_8;
         __pyx_L17_bool_binop_done:;
-        if (__pyx_t_3) {
+        if (__pyx_t_6) {
 
           /* "tabmat/ext/categorical.pyx":102
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row_idx]             # <<<<<<<<<<<<<<
  *         # Case 4: Both col restrictions and row restrictions
  *         else:
  */
-          __pyx_t_8 = __pyx_v_row_idx;
-          __pyx_t_7 = __pyx_v_col_idx;
-          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row_idx;
+          __pyx_t_10 = __pyx_v_col_idx;
+          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
           /* "tabmat/ext/categorical.pyx":101
  *             for row_idx in range(n_rows):
  *                 col_idx = indices[row_idx] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row_idx]
  *         # Case 4: Both col restrictions and row restrictions
@@ -6453,68 +6507,68 @@
       /* "tabmat/ext/categorical.pyx":107
  *             rows_view = rows
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):             # <<<<<<<<<<<<<<
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1
  */
-      __pyx_t_11 = __pyx_v_n_keep_rows;
-      __pyx_t_13 = __pyx_t_11;
+      __pyx_t_4 = __pyx_v_n_keep_rows;
+      __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
         __pyx_v_row_idx = __pyx_t_14;
 
         /* "tabmat/ext/categorical.pyx":108
  *             n_keep_rows = len(rows_view)
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]             # <<<<<<<<<<<<<<
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  */
-        __pyx_t_8 = __pyx_v_row_idx;
-        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_8 * __pyx_v_rows_view.strides[0]) )));
+        __pyx_t_11 = __pyx_v_row_idx;
+        __pyx_v_row = (*((int *) ( /* dim=0 */ (__pyx_v_rows_view.data + __pyx_t_11 * __pyx_v_rows_view.strides[0]) )));
 
         /* "tabmat/ext/categorical.pyx":109
  *             for row_idx in range(n_keep_rows):
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1             # <<<<<<<<<<<<<<
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row]
  */
-        __pyx_t_8 = __pyx_v_row;
-        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_8 * __pyx_v_indices.strides[0]) ))) - 1);
+        __pyx_t_11 = __pyx_v_row;
+        __pyx_v_col_idx = ((*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_11 * __pyx_v_indices.strides[0]) ))) - 1);
 
         /* "tabmat/ext/categorical.pyx":110
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row]
  * 
  */
-        __pyx_t_5 = ((__pyx_v_col_idx != -1L) != 0);
-        if (__pyx_t_5) {
+        __pyx_t_8 = ((__pyx_v_col_idx != -1L) != 0);
+        if (__pyx_t_8) {
         } else {
-          __pyx_t_3 = __pyx_t_5;
+          __pyx_t_6 = __pyx_t_8;
           goto __pyx_L22_bool_binop_done;
         }
-        __pyx_t_8 = __pyx_v_col_idx;
-        __pyx_t_5 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_8 * __pyx_v_cols_included.strides[0]) ))) != 0);
-        __pyx_t_3 = __pyx_t_5;
+        __pyx_t_11 = __pyx_v_col_idx;
+        __pyx_t_8 = ((*((int *) ( /* dim=0 */ (__pyx_v_cols_included.data + __pyx_t_11 * __pyx_v_cols_included.strides[0]) ))) != 0);
+        __pyx_t_6 = __pyx_t_8;
         __pyx_L22_bool_binop_done:;
-        if (__pyx_t_3) {
+        if (__pyx_t_6) {
 
           /* "tabmat/ext/categorical.pyx":111
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):
  *                     out[col_idx] += other[row]             # <<<<<<<<<<<<<<
  * 
  * 
  */
-          __pyx_t_8 = __pyx_v_row;
-          __pyx_t_7 = __pyx_v_col_idx;
-          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_7 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_8 * __pyx_v_other.strides[0]) )));
+          __pyx_t_11 = __pyx_v_row;
+          __pyx_t_10 = __pyx_v_col_idx;
+          *((double *) ( /* dim=0 */ (__pyx_v_out.data + __pyx_t_10 * __pyx_v_out.strides[0]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_other.data + __pyx_t_11 * __pyx_v_other.strides[0]) )));
 
           /* "tabmat/ext/categorical.pyx":110
  *                 row = rows_view[row_idx]
  *                 col_idx = indices[row] - 1
  *                 if (col_idx != -1) and (cols_included[col_idx]):             # <<<<<<<<<<<<<<
  *                     out[col_idx] += other[row]
  * 
@@ -6522,28 +6576,28 @@
         }
       }
     }
     __pyx_L13:;
   }
   __pyx_L7:;
 
-  /* "tabmat/ext/categorical.pyx":66
+  /* "tabmat/ext/categorical.pyx":65
  * 
  * 
  * def transpose_matvec_drop_first(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
   __Pyx_XDECREF(__pyx_t_15);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_XDECREF(__pyx_t_17);
   __Pyx_AddTraceback("tabmat.ext.categorical.transpose_matvec_drop_first", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
@@ -16000,15 +16054,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_vnew_indptr, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_indices, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -16017,29 +16071,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -16050,15 +16104,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -16067,29 +16121,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -16100,15 +16154,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -16117,29 +16171,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -16150,15 +16204,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -16167,29 +16221,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -16200,15 +16254,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -16217,29 +16271,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -16250,212 +16304,212 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
  *     else:
  *         return ()
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
     __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
  *         return <tuple>d.subarray.shape
  *     else:
  *         return ()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_empty_tuple);
     __pyx_r = __pyx_empty_tuple;
     goto __pyx_L0;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
  * 
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
  *     PyArray_SetBaseObject(arr, base)
  * 
  */
   Py_INCREF(__pyx_v_base);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object get_array_base(ndarray arr):
  */
   (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
   PyObject *__pyx_v_base;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
  *     if base is NULL:
  *         return None
  */
   __pyx_v_base = PyArray_BASE(__pyx_v_arr);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  *         return None             # <<<<<<<<<<<<<<
  *     return <object>base
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
  *     if base is NULL:
  *         return None
  *     return <object>base             # <<<<<<<<<<<<<<
  * 
  * # Versions of the import_* functions which are more suitable for
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_base));
   __pyx_r = ((PyObject *)__pyx_v_base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -16471,15 +16525,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_array", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
   {
@@ -16487,53 +16541,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
  * cdef inline int import_array() except -1:
  *     try:
  *         __pyx_import_array()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")
  */
       __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 942, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
  *     try:
  *         __pyx_import_array()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 943, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 944, __pyx_L5_except_error)
@@ -16541,30 +16595,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 944, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -16579,15 +16633,15 @@
   __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -16603,15 +16657,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_umath", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -16619,53 +16673,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
  * cdef inline int import_umath() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 948, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 949, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 950, __pyx_L5_except_error)
@@ -16673,30 +16727,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 950, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -16711,15 +16765,15 @@
   __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -16735,15 +16789,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_ufunc", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -16751,53 +16805,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
  * cdef inline int import_ufunc() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 954, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 955, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef extern from *:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 956, __pyx_L5_except_error)
@@ -16805,30 +16859,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 956, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -16843,176 +16897,176 @@
   __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_datetime64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
 static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
   npy_datetime __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
  *     also needed.  That can be found using `get_datetime64_unit`.
  *     """
  *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
 static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
   npy_timedelta __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
  *     returns the int64 value underlying scalar numpy timedelta64 object
  *     """
  *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
 static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
   NPY_DATETIMEUNIT __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
  *     returns the unit part of the dtype for a numpy datetime64 object.
  *     """
  *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
  */
   __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
@@ -30245,15 +30299,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -30367,15 +30421,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -30631,15 +30685,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -30780,15 +30834,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -30935,19 +30989,20 @@
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
   {&__pyx_n_s_no_row_restrictions, __pyx_k_no_row_restrictions, sizeof(__pyx_k_no_row_restrictions), 0, 0, 1, 1},
   {&__pyx_n_s_nonref_cnt, __pyx_k_nonref_cnt, sizeof(__pyx_k_nonref_cnt), 0, 0, 1, 1},
   {&__pyx_n_s_nonzero_cnt, __pyx_k_nonzero_cnt, sizeof(__pyx_k_nonzero_cnt), 0, 0, 1, 1},
   {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
   {&__pyx_n_s_nrows, __pyx_k_nrows, sizeof(__pyx_k_nrows), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_s_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 0, 1, 0},
-  {&__pyx_kp_s_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 0, 1, 0},
+  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
+  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_s_other, __pyx_k_other, sizeof(__pyx_k_other), 0, 0, 1, 1},
   {&__pyx_n_s_out, __pyx_k_out, sizeof(__pyx_k_out), 0, 0, 1, 1},
+  {&__pyx_n_s_out_size, __pyx_k_out_size, sizeof(__pyx_k_out_size), 0, 0, 1, 1},
   {&__pyx_n_s_out_vec, __pyx_k_out_vec, sizeof(__pyx_k_out_vec), 0, 0, 1, 1},
   {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_checksum, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_getbuffer, __pyx_k_pyx_getbuffer, sizeof(__pyx_k_pyx_getbuffer), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
@@ -30996,16 +31051,16 @@
   {&__pyx_n_s_vnew_data, __pyx_k_vnew_data, sizeof(__pyx_k_vnew_data), 0, 0, 1, 1},
   {&__pyx_n_s_vnew_indices, __pyx_k_vnew_indices, sizeof(__pyx_k_vnew_indices), 0, 0, 1, 1},
   {&__pyx_n_s_vnew_indptr, __pyx_k_vnew_indptr, sizeof(__pyx_k_vnew_indptr), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 20, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 18, __pyx_L1_error)
   __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 944, __pyx_L1_error)
   __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(2, 134, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(2, 149, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(2, 152, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(2, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(2, 615, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(2, 834, __pyx_L1_error)
@@ -31014,47 +31069,47 @@
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "tabmat/ext/categorical.pyx":20
+  /* "tabmat/ext/categorical.pyx":18
  * 
  * 
  * def transpose_matvec(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__4);
   __Pyx_GIVEREF(__pyx_tuple__4);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 944, __pyx_L1_error)
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__5);
   __Pyx_GIVEREF(__pyx_tuple__5);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 950, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 950, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
@@ -31245,37 +31300,37 @@
   __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__24);
   __Pyx_GIVEREF(__pyx_tuple__24);
   __pyx_tuple__25 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__25);
   __Pyx_GIVEREF(__pyx_tuple__25);
 
-  /* "tabmat/ext/categorical.pyx":20
+  /* "tabmat/ext/categorical.pyx":18
  * 
  * 
  * def transpose_matvec(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
-  __pyx_tuple__26 = PyTuple_Pack(16, __pyx_n_s_indices, __pyx_n_s_other, __pyx_n_s_n_cols, __pyx_n_s_dtype, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_out, __pyx_n_s_row, __pyx_n_s_row_idx, __pyx_n_s_n_keep_rows, __pyx_n_s_col, __pyx_n_s_n_rows, __pyx_n_s_rows_view, __pyx_n_s_cols_included, __pyx_n_s_no_row_restrictions, __pyx_n_s_no_col_restrictions); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_tuple__26 = PyTuple_Pack(17, __pyx_n_s_indices, __pyx_n_s_other, __pyx_n_s_n_cols, __pyx_n_s_dtype, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_out, __pyx_n_s_row, __pyx_n_s_row_idx, __pyx_n_s_n_keep_rows, __pyx_n_s_col, __pyx_n_s_n_rows, __pyx_n_s_out_size, __pyx_n_s_rows_view, __pyx_n_s_cols_included, __pyx_n_s_no_row_restrictions, __pyx_n_s_no_col_restrictions); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__26);
   __Pyx_GIVEREF(__pyx_tuple__26);
-  __pyx_codeobj__27 = (PyObject*)__Pyx_PyCode_New(7, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_categorical_pyx, __pyx_n_s_transpose_matvec, 20, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_codeobj__27 = (PyObject*)__Pyx_PyCode_New(7, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_categorical_pyx, __pyx_n_s_transpose_matvec, 18, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 18, __pyx_L1_error)
 
-  /* "tabmat/ext/categorical.pyx":66
+  /* "tabmat/ext/categorical.pyx":65
  * 
  * 
  * def transpose_matvec_drop_first(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
-  __pyx_tuple__28 = PyTuple_Pack(16, __pyx_n_s_indices, __pyx_n_s_other, __pyx_n_s_n_cols, __pyx_n_s_dtype, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_out, __pyx_n_s_row, __pyx_n_s_row_idx, __pyx_n_s_n_keep_rows, __pyx_n_s_col_idx, __pyx_n_s_n_rows, __pyx_n_s_rows_view, __pyx_n_s_cols_included, __pyx_n_s_no_row_restrictions, __pyx_n_s_no_col_restrictions); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_tuple__28 = PyTuple_Pack(17, __pyx_n_s_indices, __pyx_n_s_other, __pyx_n_s_n_cols, __pyx_n_s_dtype, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_out, __pyx_n_s_row, __pyx_n_s_row_idx, __pyx_n_s_n_keep_rows, __pyx_n_s_col_idx, __pyx_n_s_n_rows, __pyx_n_s_out_size, __pyx_n_s_rows_view, __pyx_n_s_cols_included, __pyx_n_s_no_row_restrictions, __pyx_n_s_no_col_restrictions); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__28);
   __Pyx_GIVEREF(__pyx_tuple__28);
-  __pyx_codeobj__29 = (PyObject*)__Pyx_PyCode_New(7, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_categorical_pyx, __pyx_n_s_transpose_matvec_drop_first, 66, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_codeobj__29 = (PyObject*)__Pyx_PyCode_New(7, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_categorical_pyx, __pyx_n_s_transpose_matvec_drop_first, 65, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 65, __pyx_L1_error)
 
   /* "tabmat/ext/categorical.pyx":114
  * 
  * 
  * def get_col_included(int[:] cols, int n_cols):             # <<<<<<<<<<<<<<
  *     cdef int[:] col_included = np.zeros(n_cols, dtype=np.int32)
  *     cdef int n_cols_included = len(cols)
@@ -31560,55 +31615,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -31828,80 +31867,78 @@
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "tabmat/ext/categorical.pyx":3
- * # cython: boundscheck=False, wraparound=False, cdivision=True
- * 
+  /* "tabmat/ext/categorical.pyx":1
  * import numpy as np             # <<<<<<<<<<<<<<
  * 
  * cimport numpy as np
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 3, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/categorical.pyx":20
+  /* "tabmat/ext/categorical.pyx":18
  * 
  * 
  * def transpose_matvec(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_11categorical_19transpose_matvec, 0, __pyx_n_s_transpose_matvec, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_11categorical_19transpose_matvec, 0, __pyx_n_s_transpose_matvec, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 20, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_11categorical_21transpose_matvec, 0, __pyx_n_s_transpose_matvec, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_11categorical_21transpose_matvec, 0, __pyx_n_s_transpose_matvec, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 20, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_11categorical_1transpose_matvec, 0, __pyx_n_s_transpose_matvec, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 20, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_11categorical_1transpose_matvec, 0, __pyx_n_s_transpose_matvec, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_matvec, __pyx_t_2) < 0) __PYX_ERR(0, 20, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_matvec, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/categorical.pyx":66
+  /* "tabmat/ext/categorical.pyx":65
  * 
  * 
  * def transpose_matvec_drop_first(             # <<<<<<<<<<<<<<
  *     int[:] indices,
  *     floating[:] other,
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_11categorical_25transpose_matvec_drop_first, 0, __pyx_n_s_transpose_matvec_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_11categorical_25transpose_matvec_drop_first, 0, __pyx_n_s_transpose_matvec_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_float, __pyx_t_1) < 0) __PYX_ERR(0, 66, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_float, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_11categorical_27transpose_matvec_drop_first, 0, __pyx_n_s_transpose_matvec_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_11categorical_27transpose_matvec_drop_first, 0, __pyx_n_s_transpose_matvec_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_double, __pyx_t_1) < 0) __PYX_ERR(0, 66, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_double, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_11categorical_3transpose_matvec_drop_first, 0, __pyx_n_s_transpose_matvec_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_11categorical_3transpose_matvec_drop_first, 0, __pyx_n_s_transpose_matvec_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_1)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_matvec_drop_first, __pyx_t_1) < 0) __PYX_ERR(0, 66, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_matvec_drop_first, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "tabmat/ext/categorical.pyx":114
  * 
  * 
  * def get_col_included(int[:] cols, int n_cols):             # <<<<<<<<<<<<<<
  *     cdef int[:] col_included = np.zeros(n_cols, dtype=np.int32)
@@ -32086,17 +32123,17 @@
  */
   __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_6tabmat_3ext_11categorical_17subset_categorical_drop_first, NULL, __pyx_n_s_tabmat_ext_categorical); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 268, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_subset_categorical_drop_first, __pyx_t_2) < 0) __PYX_ERR(0, 268, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "tabmat/ext/categorical.pyx":1
- * # cython: boundscheck=False, wraparound=False, cdivision=True             # <<<<<<<<<<<<<<
+ * import numpy as np             # <<<<<<<<<<<<<<
  * 
- * import numpy as np
+ * cimport numpy as np
  */
   __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "View.MemoryView":210
@@ -32868,28 +32905,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -34762,61 +34799,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -35440,15 +35495,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -35823,15 +35881,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_FusedFunction_init(void) {
     __pyx_FusedFunctionType_type.tp_base = __pyx_CyFunctionType;
     __pyx_FusedFunctionType = __Pyx_FetchCommonType(&__pyx_FusedFunctionType_type);
     if (__pyx_FusedFunctionType == NULL) {
@@ -37570,15 +37631,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -37875,15 +37936,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -38071,15 +38132,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/categorical.pyx` & `tabmat-3.1.8/src/tabmat/ext/categorical.pyx`

 * *Files 2% similar despite different names*

```diff
@@ -1,45 +1,44 @@
-# cython: boundscheck=False, wraparound=False, cdivision=True
-
 import numpy as np
 
 cimport numpy as np
 from cython cimport floating, numeric
 
 from cython.parallel import prange
 
 ctypedef np.uint8_t uint8
 ctypedef np.int8_t int8
 from libcpp cimport bool
 
 
 cdef extern from "cat_split_helpers.cpp":
-    void _transpose_matvec_all_rows[F](int, int*, F*, F*, int)
-    void _transpose_matvec_all_rows_drop_first[F](int, int*, F*, F*, int)
+    void _transpose_matvec_all_rows[Int, F](Int, Int*, F*, F*, Int)
+    void _transpose_matvec_all_rows_drop_first[Int, F](Int, Int*, F*, F*, Int)
 
 
 def transpose_matvec(
     int[:] indices,
     floating[:] other,
     int n_cols,
     dtype,
     rows,
     cols,
     floating[:] out
 ):
     cdef int row, row_idx, n_keep_rows, col
     cdef int n_rows = len(indices)
+    cdef int out_size = out.size
     cdef int[:] rows_view, cols_included
 
     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows
     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols
 
     # Case 1: No row or col restrictions
     if no_row_restrictions and no_col_restrictions:
-        _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out.size)
+        _transpose_matvec_all_rows(n_rows, &indices[0], &other[0], &out[0], out_size)
     # Case 2: row restrictions but no col restrictions
     elif no_col_restrictions:
         rows_view = rows
         n_keep_rows = len(rows_view)
         for row_idx in range(n_keep_rows):
             row = rows_view[row_idx]
             out[indices[row]] += other[row]
@@ -70,22 +69,23 @@
     dtype,
     rows,
     cols,
     floating[:] out
 ):
     cdef int row, row_idx, n_keep_rows, col_idx
     cdef int n_rows = len(indices)
+    cdef int out_size = out.size
     cdef int[:] rows_view, cols_included
 
     cdef bool no_row_restrictions = rows is None or len(rows) == n_rows
     cdef bool no_col_restrictions = cols is None or len(cols) == n_cols
 
     # Case 1: No row or col restrictions
     if no_row_restrictions and no_col_restrictions:
-        _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out.size)
+        _transpose_matvec_all_rows_drop_first(n_rows, &indices[0], &other[0], &out[0], out_size)
     # Case 2: row restrictions but no col restrictions
     elif no_col_restrictions:
         rows_view = rows
         n_keep_rows = len(rows_view)
         for row_idx in range(n_keep_rows):
             row = rows_view[row_idx]
             col_idx = indices[row] - 1
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/dense.cpp` & `tabmat-3.1.8/src/tabmat/ext/dense.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,33 +1,33 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
             "src/tabmat/ext/dense_helpers.cpp"
         ],
         "extra_compile_args": [
             "-fopenmp",
             "-O3",
             "-ffast-math",
             "--std=c++17",
             "-DJEMALLOC_INSTALL_SUFFIX="
         ],
         "extra_link_args": [
             "-fopenmp"
         ],
         "include_dirs": [
             "src/tabmat/ext",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include"
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "libraries": [
             "jemalloc"
         ],
         "name": "tabmat.ext.dense",
         "sources": [
@@ -43,17 +43,17 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
-#define CYTHON_FUTURE_DIVISION 0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
+#define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
@@ -112,16 +112,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -237,15 +241,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -276,15 +280,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -1145,195 +1149,195 @@
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
@@ -1364,42 +1368,42 @@
 
 /*--- Type declarations ---*/
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
@@ -2132,22 +2136,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* CythonFunctionShared.proto */
 #define __Pyx_CyFunction_USED 1
@@ -2715,38 +2727,38 @@
 static const char __pyx_k_got_differing_extents_in_dimensi[] = "got differing extents in dimension %d (got %d and %d)";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
 static const char __pyx_k_numpy_core_umath_failed_to_impor[] = "numpy.core.umath failed to import";
 static const char __pyx_k_unable_to_allocate_shape_and_str[] = "unable to allocate shape and strides.";
 static PyObject *__pyx_kp_s_;
 static PyObject *__pyx_n_s_ASCII;
 static PyObject *__pyx_kp_s_Buffer_view_does_not_expose_stri;
-static PyObject *__pyx_n_s_C_CONTIGUOUS;
+static PyObject *__pyx_n_u_C_CONTIGUOUS;
 static PyObject *__pyx_kp_s_Can_only_create_a_buffer_that_is;
 static PyObject *__pyx_kp_s_Cannot_assign_to_read_only_memor;
 static PyObject *__pyx_kp_s_Cannot_create_writable_memory_vi;
 static PyObject *__pyx_kp_s_Cannot_index_with_type_s;
 static PyObject *__pyx_n_s_Ellipsis;
 static PyObject *__pyx_kp_s_Empty_shape_tuple_for_cython_arr;
 static PyObject *__pyx_kp_s_Expected_at_least_d_argument_s_g;
-static PyObject *__pyx_n_s_F_CONTIGUOUS;
+static PyObject *__pyx_n_u_F_CONTIGUOUS;
 static PyObject *__pyx_kp_s_Function_call_with_ambiguous_arg;
 static PyObject *__pyx_n_s_ImportError;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_n_s_IndexError;
 static PyObject *__pyx_kp_s_Indirect_dimensions_not_supporte;
 static PyObject *__pyx_kp_s_Invalid_mode_expected_c_or_fortr;
 static PyObject *__pyx_kp_s_Invalid_shape_in_axis_d_d;
 static PyObject *__pyx_n_s_MemoryError;
 static PyObject *__pyx_kp_s_MemoryView_of_r_at_0x_x;
 static PyObject *__pyx_kp_s_MemoryView_of_r_object;
 static PyObject *__pyx_kp_s_No_matching_signature_found;
 static PyObject *__pyx_n_b_O;
 static PyObject *__pyx_kp_s_Out_of_bounds_on_buffer_access_a;
 static PyObject *__pyx_n_s_PickleError;
-static PyObject *__pyx_kp_s_The_matrix_X_is_not_contiguous;
+static PyObject *__pyx_kp_u_The_matrix_X_is_not_contiguous;
 static PyObject *__pyx_n_s_TypeError;
 static PyObject *__pyx_kp_s_Unable_to_convert_item_to_object;
 static PyObject *__pyx_n_s_ValueError;
 static PyObject *__pyx_n_s_View_MemoryView;
 static PyObject *__pyx_n_s_X;
 static PyObject *__pyx_n_s_Xp;
 static PyObject *__pyx_kp_s__2;
@@ -2804,16 +2816,16 @@
 static PyObject *__pyx_n_s_ncols;
 static PyObject *__pyx_n_s_ndim;
 static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
 static PyObject *__pyx_n_s_np;
 static PyObject *__pyx_n_s_nrows;
 static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_s_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_s_numpy_core_umath_failed_to_impor;
+static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
+static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_s_out;
 static PyObject *__pyx_n_s_out_m;
 static PyObject *__pyx_n_s_out_view;
 static PyObject *__pyx_n_s_outp;
 static PyObject *__pyx_n_s_pack;
 static PyObject *__pyx_n_s_pickle;
@@ -2965,16 +2977,16 @@
 static PyObject *__pyx_codeobj__28;
 static PyObject *__pyx_codeobj__30;
 static PyObject *__pyx_codeobj__32;
 static PyObject *__pyx_codeobj__34;
 static PyObject *__pyx_codeobj__41;
 /* Late includes */
 
-/* "tabmat/ext/dense.pyx":17
- *     void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+/* "tabmat/ext/dense.pyx":16
+ *     void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
 /* Python wrapper */
@@ -3014,31 +3026,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 16, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 17, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 16, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -3047,15 +3059,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 17, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 16, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_dense_sandwich(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -3101,51 +3113,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("dense_sandwich", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 17, __pyx_L1_error)
+    __PYX_ERR(0, 16, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 17, __pyx_L1_error)
+      __PYX_ERR(0, 16, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -3154,85 +3166,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 17, __pyx_L1_error)
+    __PYX_ERR(0, 16, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 17, __pyx_L1_error)
+      __PYX_ERR(0, 16, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 17, __pyx_L1_error)
+      __PYX_ERR(0, 16, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 17, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 16, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 17, __pyx_L1_error)
+    __PYX_ERR(0, 16, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -3246,62 +3258,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -3320,15 +3332,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3342,100 +3354,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 17, __pyx_L1_error)
+    __PYX_ERR(0, 16, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 17, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 17, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 16, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 16, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -3443,43 +3455,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 17, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 16, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 17, __pyx_L1_error)
+    __PYX_ERR(0, 16, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 17, __pyx_L1_error)
+    __PYX_ERR(0, 16, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 17, __pyx_L1_error)
+      __PYX_ERR(0, 16, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 17, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 16, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -3515,32 +3527,32 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_thresh1d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_thresh1d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_kratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_kratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_innerblock); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_innerblock); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_3, 1, Py_None);
   __pyx_t_4 = 0;
@@ -3609,27 +3621,27 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 1); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 1); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 2); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 2); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 3); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 3); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_thresh1d);
           if (value) { values[4] = value; kw_args--; }
         }
@@ -3643,15 +3655,15 @@
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_innerblock);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_sandwich") < 0)) __PYX_ERR(0, 17, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_sandwich") < 0)) __PYX_ERR(0, 16, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -3662,42 +3674,42 @@
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 17, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 17, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 17, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 16, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 16, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 16, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_thresh1d = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_thresh1d == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L3_error)
+      __pyx_v_thresh1d = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_thresh1d == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L3_error)
     } else {
       __pyx_v_thresh1d = __pyx_dynamic_args->__pyx_arg_thresh1d;
     }
     if (values[5]) {
-      __pyx_v_kratio = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_kratio == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L3_error)
+      __pyx_v_kratio = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_kratio == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L3_error)
     } else {
       __pyx_v_kratio = __pyx_dynamic_args->__pyx_arg_kratio;
     }
     if (values[6]) {
-      __pyx_v_innerblock = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_innerblock == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L3_error)
+      __pyx_v_innerblock = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_innerblock == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L3_error)
     } else {
       __pyx_v_innerblock = __pyx_dynamic_args->__pyx_arg_innerblock;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 17, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 16, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_8dense_sandwich(__pyx_self, __pyx_v_X, __pyx_v_d, __pyx_v_rows, __pyx_v_cols, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -3729,94 +3741,94 @@
   Py_ssize_t __pyx_t_8;
   Py_ssize_t __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0dense_sandwich", 0);
 
-  /* "tabmat/ext/dense.pyx":18
+  /* "tabmat/ext/dense.pyx":17
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):
  *     cdef int n = X.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int m = X.shape[1]
  *     cdef int in_n = rows.shape[0]
  */
   __pyx_v_n = (__pyx_v_X->dimensions[0]);
 
-  /* "tabmat/ext/dense.pyx":19
+  /* "tabmat/ext/dense.pyx":18
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int in_n = rows.shape[0]
  *     cdef int out_m = cols.shape[0]
  */
   __pyx_v_m = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":20
+  /* "tabmat/ext/dense.pyx":19
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  *     cdef int in_n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int out_m = cols.shape[0]
  * 
  */
   __pyx_v_in_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":21
+  /* "tabmat/ext/dense.pyx":20
  *     cdef int m = X.shape[1]
  *     cdef int in_n = rows.shape[0]
  *     cdef int out_m = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  */
   __pyx_v_out_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":23
+  /* "tabmat/ext/dense.pyx":22
  *     cdef int out_m = cols.shape[0]
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     if in_n == 0 or out_m == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/dense.pyx":24
+  /* "tabmat/ext/dense.pyx":23
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  *     if in_n == 0 or out_m == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_6 = ((__pyx_v_in_n == 0) != 0);
@@ -3826,197 +3838,197 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_out_m == 0) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":25
+    /* "tabmat/ext/dense.pyx":24
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  *     if in_n == 0 or out_m == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/dense.pyx":24
+    /* "tabmat/ext/dense.pyx":23
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  *     if in_n == 0 or out_m == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/dense.pyx":27
+  /* "tabmat/ext/dense.pyx":26
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 26, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/dense.pyx":28
+  /* "tabmat/ext/dense.pyx":27
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xp = <floating*>X.data
  */
   __pyx_t_8 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_8 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/dense.pyx":30
+  /* "tabmat/ext/dense.pyx":29
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef floating* dp = &d[0]
  * 
  */
   __pyx_v_Xp = ((float *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":31
+  /* "tabmat/ext/dense.pyx":30
  * 
  *     cdef floating* Xp = <floating*>X.data
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int* colsp = &cols[0]
  */
   __pyx_t_9 = 0;
   __pyx_v_dp = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_9 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":33
+  /* "tabmat/ext/dense.pyx":32
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int* colsp = &cols[0]             # <<<<<<<<<<<<<<
  *     cdef int* rowsp = &rows[0]
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":34
+  /* "tabmat/ext/dense.pyx":33
  * 
  *     cdef int* colsp = &cols[0]
  *     cdef int* rowsp = &rows[0]             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_9 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":36
+  /* "tabmat/ext/dense.pyx":35
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":37
+    /* "tabmat/ext/dense.pyx":36
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  */
-    _denseC_sandwich<float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
+    _denseC_sandwich<int,float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
 
-    /* "tabmat/ext/dense.pyx":36
+    /* "tabmat/ext/dense.pyx":35
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":38
+  /* "tabmat/ext/dense.pyx":37
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":39
+    /* "tabmat/ext/dense.pyx":38
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)             # <<<<<<<<<<<<<<
  *     else:
- *         raise Exception()
+ *         raise Exception("The matrix X is not contiguous.")
  */
-    _denseF_sandwich<float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
+    _denseF_sandwich<int,float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
 
-    /* "tabmat/ext/dense.pyx":38
+    /* "tabmat/ext/dense.pyx":37
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":41
+  /* "tabmat/ext/dense.pyx":40
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
- *         raise Exception()             # <<<<<<<<<<<<<<
+ *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_1 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 41, __pyx_L1_error)
+    __PYX_ERR(0, 40, __pyx_L1_error)
   }
   __pyx_L6:;
 
-  /* "tabmat/ext/dense.pyx":42
+  /* "tabmat/ext/dense.pyx":41
  *     else:
- *         raise Exception()
+ *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":17
- *     void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+  /* "tabmat/ext/dense.pyx":16
+ *     void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
   /* function exit code */
@@ -4047,32 +4059,32 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_thresh1d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_thresh1d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_kratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_kratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_innerblock); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_innerblock); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_3, 1, Py_None);
   __pyx_t_4 = 0;
@@ -4141,27 +4153,27 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 1); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 1); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 2); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 2); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 3); __PYX_ERR(0, 17, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, 3); __PYX_ERR(0, 16, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_thresh1d);
           if (value) { values[4] = value; kw_args--; }
         }
@@ -4175,15 +4187,15 @@
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_innerblock);
           if (value) { values[6] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_sandwich") < 0)) __PYX_ERR(0, 17, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_sandwich") < 0)) __PYX_ERR(0, 16, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -4194,42 +4206,42 @@
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 17, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 17, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 17, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 16, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 16, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 16, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_thresh1d = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_thresh1d == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L3_error)
+      __pyx_v_thresh1d = __Pyx_PyInt_As_int(values[4]); if (unlikely((__pyx_v_thresh1d == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L3_error)
     } else {
       __pyx_v_thresh1d = __pyx_dynamic_args->__pyx_arg_thresh1d;
     }
     if (values[5]) {
-      __pyx_v_kratio = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_kratio == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L3_error)
+      __pyx_v_kratio = __Pyx_PyInt_As_int(values[5]); if (unlikely((__pyx_v_kratio == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L3_error)
     } else {
       __pyx_v_kratio = __pyx_dynamic_args->__pyx_arg_kratio;
     }
     if (values[6]) {
-      __pyx_v_innerblock = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_innerblock == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 17, __pyx_L3_error)
+      __pyx_v_innerblock = __Pyx_PyInt_As_int(values[6]); if (unlikely((__pyx_v_innerblock == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 16, __pyx_L3_error)
     } else {
       __pyx_v_innerblock = __pyx_dynamic_args->__pyx_arg_innerblock;
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 17, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("dense_sandwich", 0, 4, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 16, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_10dense_sandwich(__pyx_self, __pyx_v_X, __pyx_v_d, __pyx_v_rows, __pyx_v_cols, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -4261,94 +4273,94 @@
   Py_ssize_t __pyx_t_8;
   Py_ssize_t __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1dense_sandwich", 0);
 
-  /* "tabmat/ext/dense.pyx":18
+  /* "tabmat/ext/dense.pyx":17
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):
  *     cdef int n = X.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int m = X.shape[1]
  *     cdef int in_n = rows.shape[0]
  */
   __pyx_v_n = (__pyx_v_X->dimensions[0]);
 
-  /* "tabmat/ext/dense.pyx":19
+  /* "tabmat/ext/dense.pyx":18
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int in_n = rows.shape[0]
  *     cdef int out_m = cols.shape[0]
  */
   __pyx_v_m = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":20
+  /* "tabmat/ext/dense.pyx":19
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  *     cdef int in_n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int out_m = cols.shape[0]
  * 
  */
   __pyx_v_in_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":21
+  /* "tabmat/ext/dense.pyx":20
  *     cdef int m = X.shape[1]
  *     cdef int in_n = rows.shape[0]
  *     cdef int out_m = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  */
   __pyx_v_out_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":23
+  /* "tabmat/ext/dense.pyx":22
  *     cdef int out_m = cols.shape[0]
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     if in_n == 0 or out_m == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_out_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/dense.pyx":24
+  /* "tabmat/ext/dense.pyx":23
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  *     if in_n == 0 or out_m == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_6 = ((__pyx_v_in_n == 0) != 0);
@@ -4358,197 +4370,197 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_out_m == 0) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":25
+    /* "tabmat/ext/dense.pyx":24
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  *     if in_n == 0 or out_m == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/dense.pyx":24
+    /* "tabmat/ext/dense.pyx":23
  * 
  *     out = np.zeros((out_m,out_m), dtype=X.dtype)
  *     if in_n == 0 or out_m == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/dense.pyx":27
+  /* "tabmat/ext/dense.pyx":26
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 26, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/dense.pyx":28
+  /* "tabmat/ext/dense.pyx":27
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xp = <floating*>X.data
  */
   __pyx_t_8 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_8 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/dense.pyx":30
+  /* "tabmat/ext/dense.pyx":29
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef floating* dp = &d[0]
  * 
  */
   __pyx_v_Xp = ((double *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":31
+  /* "tabmat/ext/dense.pyx":30
  * 
  *     cdef floating* Xp = <floating*>X.data
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int* colsp = &cols[0]
  */
   __pyx_t_9 = 0;
   __pyx_v_dp = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_9 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":33
+  /* "tabmat/ext/dense.pyx":32
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int* colsp = &cols[0]             # <<<<<<<<<<<<<<
  *     cdef int* rowsp = &rows[0]
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":34
+  /* "tabmat/ext/dense.pyx":33
  * 
  *     cdef int* colsp = &cols[0]
  *     cdef int* rowsp = &rows[0]             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_9 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":36
+  /* "tabmat/ext/dense.pyx":35
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 36, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 35, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":37
+    /* "tabmat/ext/dense.pyx":36
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  */
-    _denseC_sandwich<double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
+    _denseC_sandwich<int,double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
 
-    /* "tabmat/ext/dense.pyx":36
+    /* "tabmat/ext/dense.pyx":35
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":38
+  /* "tabmat/ext/dense.pyx":37
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 38, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 37, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":39
+    /* "tabmat/ext/dense.pyx":38
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)             # <<<<<<<<<<<<<<
  *     else:
- *         raise Exception()
+ *         raise Exception("The matrix X is not contiguous.")
  */
-    _denseF_sandwich<double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
+    _denseF_sandwich<int,double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_dp, __pyx_v_outp, __pyx_v_in_n, __pyx_v_out_m, __pyx_v_m, __pyx_v_n, __pyx_v_thresh1d, __pyx_v_kratio, __pyx_v_innerblock);
 
-    /* "tabmat/ext/dense.pyx":38
+    /* "tabmat/ext/dense.pyx":37
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":41
+  /* "tabmat/ext/dense.pyx":40
  *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
- *         raise Exception()             # <<<<<<<<<<<<<<
+ *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_1 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 41, __pyx_L1_error)
+    __PYX_ERR(0, 40, __pyx_L1_error)
   }
   __pyx_L6:;
 
-  /* "tabmat/ext/dense.pyx":42
+  /* "tabmat/ext/dense.pyx":41
  *     else:
- *         raise Exception()
+ *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":17
- *     void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+  /* "tabmat/ext/dense.pyx":16
+ *     void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
   /* function exit code */
@@ -4567,15 +4579,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/dense.pyx":46
+/* "tabmat/ext/dense.pyx":45
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
@@ -4616,31 +4628,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 45, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 45, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 45, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 46, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 45, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -4649,15 +4661,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 46, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 45, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_2dense_rmatvec(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -4703,51 +4715,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("dense_rmatvec", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 46, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 45, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 46, __pyx_L1_error)
+      __PYX_ERR(0, 45, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -4756,85 +4768,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 46, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 46, __pyx_L1_error)
+      __PYX_ERR(0, 45, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 46, __pyx_L1_error)
+      __PYX_ERR(0, 45, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 46, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 45, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 46, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -4848,62 +4860,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 45, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 45, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -4922,15 +4934,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -4944,100 +4956,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 46, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 46, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 46, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 45, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 46, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 45, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -5045,43 +5057,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 46, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 45, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 46, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 45, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 46, __pyx_L1_error)
+    __PYX_ERR(0, 45, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 46, __pyx_L1_error)
+      __PYX_ERR(0, 45, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 45, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -5146,54 +5158,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 45, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 45, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 45, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_rmatvec") < 0)) __PYX_ERR(0, 46, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_rmatvec") < 0)) __PYX_ERR(0, 45, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 46, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 46, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 46, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 45, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 45, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 45, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 46, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 45, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.dense_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 46, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 45, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_14dense_rmatvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5224,84 +5236,84 @@
   __Pyx_memviewslice __pyx_t_7 = { 0, 0, { 0 }, { 0 }, { 0 } };
   Py_ssize_t __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0dense_rmatvec", 0);
 
-  /* "tabmat/ext/dense.pyx":47
+  /* "tabmat/ext/dense.pyx":46
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  */
   __pyx_v_n = (__pyx_v_X->dimensions[0]);
 
-  /* "tabmat/ext/dense.pyx":48
+  /* "tabmat/ext/dense.pyx":47
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]
  */
   __pyx_v_m = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":49
+  /* "tabmat/ext/dense.pyx":48
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int n_cols = cols.shape[0]
  * 
  */
   __pyx_v_n_rows = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":50
+  /* "tabmat/ext/dense.pyx":49
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)
  */
   __pyx_v_n_cols = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":52
+  /* "tabmat/ext/dense.pyx":51
  *     cdef int n_cols = cols.shape[0]
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     if n_rows == 0 or n_cols == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 52, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":53
+  /* "tabmat/ext/dense.pyx":52
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_6 = ((__pyx_v_n_rows == 0) != 0);
@@ -5311,195 +5323,195 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_n_cols == 0) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":54
+    /* "tabmat/ext/dense.pyx":53
  *     out = np.zeros(n_cols, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/dense.pyx":53
+    /* "tabmat/ext/dense.pyx":52
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/dense.pyx":56
+  /* "tabmat/ext/dense.pyx":55
  *         return out
  * 
  *     cdef floating[:] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0]
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 55, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/dense.pyx":57
+  /* "tabmat/ext/dense.pyx":56
  * 
  *     cdef floating[:] out_view = out
  *     cdef floating* outp = &out_view[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xp = <floating*>X.data
  */
   __pyx_t_8 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_8 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":59
+  /* "tabmat/ext/dense.pyx":58
  *     cdef floating* outp = &out_view[0]
  * 
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef floating* vp = &v[0]
  * 
  */
   __pyx_v_Xp = ((float *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":60
+  /* "tabmat/ext/dense.pyx":59
  * 
  *     cdef floating* Xp = <floating*>X.data
  *     cdef floating* vp = &v[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int* colsp = &cols[0]
  */
   __pyx_t_8 = 0;
   __pyx_v_vp = (&(*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_8 * __pyx_v_v.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":62
+  /* "tabmat/ext/dense.pyx":61
  *     cdef floating* vp = &v[0]
  * 
  *     cdef int* colsp = &cols[0]             # <<<<<<<<<<<<<<
  *     cdef int* rowsp = &rows[0]
  * 
  */
   __pyx_t_8 = 0;
   __pyx_v_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_8 * __pyx_v_cols.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":63
+  /* "tabmat/ext/dense.pyx":62
  * 
  *     cdef int* colsp = &cols[0]
  *     cdef int* rowsp = &rows[0]             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_8 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_8 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":65
+  /* "tabmat/ext/dense.pyx":64
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 64, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 64, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":66
+    /* "tabmat/ext/dense.pyx":65
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  */
-    _denseC_rmatvec<float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseC_rmatvec<int,float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":65
+    /* "tabmat/ext/dense.pyx":64
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":67
+  /* "tabmat/ext/dense.pyx":66
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":68
+    /* "tabmat/ext/dense.pyx":67
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  */
-    _denseF_rmatvec<float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseF_rmatvec<int,float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":67
+    /* "tabmat/ext/dense.pyx":66
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":70
+  /* "tabmat/ext/dense.pyx":69
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 70, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 69, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 70, __pyx_L1_error)
+    __PYX_ERR(0, 69, __pyx_L1_error)
   }
   __pyx_L6:;
 
-  /* "tabmat/ext/dense.pyx":71
+  /* "tabmat/ext/dense.pyx":70
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":46
+  /* "tabmat/ext/dense.pyx":45
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
@@ -5560,54 +5572,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 45, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 45, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 46, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 45, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_rmatvec") < 0)) __PYX_ERR(0, 46, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_rmatvec") < 0)) __PYX_ERR(0, 45, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 46, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 46, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 46, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 45, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 45, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 45, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 46, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("dense_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 45, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.dense_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 46, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 45, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_16dense_rmatvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5638,84 +5650,84 @@
   __Pyx_memviewslice __pyx_t_7 = { 0, 0, { 0 }, { 0 }, { 0 } };
   Py_ssize_t __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1dense_rmatvec", 0);
 
-  /* "tabmat/ext/dense.pyx":47
+  /* "tabmat/ext/dense.pyx":46
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  */
   __pyx_v_n = (__pyx_v_X->dimensions[0]);
 
-  /* "tabmat/ext/dense.pyx":48
+  /* "tabmat/ext/dense.pyx":47
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]
  */
   __pyx_v_m = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":49
+  /* "tabmat/ext/dense.pyx":48
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int n_cols = cols.shape[0]
  * 
  */
   __pyx_v_n_rows = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":50
+  /* "tabmat/ext/dense.pyx":49
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)
  */
   __pyx_v_n_cols = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":52
+  /* "tabmat/ext/dense.pyx":51
  *     cdef int n_cols = cols.shape[0]
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     if n_rows == 0 or n_cols == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 52, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 52, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 51, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":53
+  /* "tabmat/ext/dense.pyx":52
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_6 = ((__pyx_v_n_rows == 0) != 0);
@@ -5725,195 +5737,195 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_n_cols == 0) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":54
+    /* "tabmat/ext/dense.pyx":53
  *     out = np.zeros(n_cols, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/dense.pyx":53
+    /* "tabmat/ext/dense.pyx":52
  * 
  *     out = np.zeros(n_cols, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/dense.pyx":56
+  /* "tabmat/ext/dense.pyx":55
  *         return out
  * 
  *     cdef floating[:] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0]
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 55, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/dense.pyx":57
+  /* "tabmat/ext/dense.pyx":56
  * 
  *     cdef floating[:] out_view = out
  *     cdef floating* outp = &out_view[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xp = <floating*>X.data
  */
   __pyx_t_8 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_8 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":59
+  /* "tabmat/ext/dense.pyx":58
  *     cdef floating* outp = &out_view[0]
  * 
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef floating* vp = &v[0]
  * 
  */
   __pyx_v_Xp = ((double *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":60
+  /* "tabmat/ext/dense.pyx":59
  * 
  *     cdef floating* Xp = <floating*>X.data
  *     cdef floating* vp = &v[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int* colsp = &cols[0]
  */
   __pyx_t_8 = 0;
   __pyx_v_vp = (&(*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_8 * __pyx_v_v.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":62
+  /* "tabmat/ext/dense.pyx":61
  *     cdef floating* vp = &v[0]
  * 
  *     cdef int* colsp = &cols[0]             # <<<<<<<<<<<<<<
  *     cdef int* rowsp = &rows[0]
  * 
  */
   __pyx_t_8 = 0;
   __pyx_v_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_8 * __pyx_v_cols.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":63
+  /* "tabmat/ext/dense.pyx":62
  * 
  *     cdef int* colsp = &cols[0]
  *     cdef int* rowsp = &rows[0]             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_8 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_8 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":65
+  /* "tabmat/ext/dense.pyx":64
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 64, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 64, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":66
+    /* "tabmat/ext/dense.pyx":65
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  */
-    _denseC_rmatvec<double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseC_rmatvec<int,double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":65
+    /* "tabmat/ext/dense.pyx":64
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":67
+  /* "tabmat/ext/dense.pyx":66
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 67, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 66, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":68
+    /* "tabmat/ext/dense.pyx":67
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  */
-    _denseF_rmatvec<double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseF_rmatvec<int,double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":67
+    /* "tabmat/ext/dense.pyx":66
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":70
+  /* "tabmat/ext/dense.pyx":69
  *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 70, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 69, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 70, __pyx_L1_error)
+    __PYX_ERR(0, 69, __pyx_L1_error)
   }
   __pyx_L6:;
 
-  /* "tabmat/ext/dense.pyx":71
+  /* "tabmat/ext/dense.pyx":70
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":46
+  /* "tabmat/ext/dense.pyx":45
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
@@ -5933,15 +5945,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/dense.pyx":74
+/* "tabmat/ext/dense.pyx":73
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
@@ -5982,31 +5994,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 73, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 74, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 73, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -6015,15 +6027,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 74, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 73, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_4dense_matvec(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -6069,51 +6081,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("dense_matvec", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 74, __pyx_L1_error)
+      __PYX_ERR(0, 73, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -6122,85 +6134,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 74, __pyx_L1_error)
+      __PYX_ERR(0, 73, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 74, __pyx_L1_error)
+      __PYX_ERR(0, 73, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -6214,62 +6226,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 74, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 74, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -6288,15 +6300,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -6310,100 +6322,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 74, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 74, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 74, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 73, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -6411,43 +6423,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 73, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 74, __pyx_L1_error)
+      __PYX_ERR(0, 73, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -6512,54 +6524,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 1); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 1); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 2); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 2); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 3); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 3); __PYX_ERR(0, 73, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_matvec") < 0)) __PYX_ERR(0, 74, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_matvec") < 0)) __PYX_ERR(0, 73, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 74, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 73, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.dense_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_20dense_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -6590,84 +6602,84 @@
   __Pyx_memviewslice __pyx_t_7 = { 0, 0, { 0 }, { 0 }, { 0 } };
   Py_ssize_t __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0dense_matvec", 0);
 
-  /* "tabmat/ext/dense.pyx":75
+  /* "tabmat/ext/dense.pyx":74
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  */
   __pyx_v_n = (__pyx_v_X->dimensions[0]);
 
-  /* "tabmat/ext/dense.pyx":76
+  /* "tabmat/ext/dense.pyx":75
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]
  */
   __pyx_v_m = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":77
+  /* "tabmat/ext/dense.pyx":76
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int n_cols = cols.shape[0]
  * 
  */
   __pyx_v_n_rows = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":78
+  /* "tabmat/ext/dense.pyx":77
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)
  */
   __pyx_v_n_cols = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":80
+  /* "tabmat/ext/dense.pyx":79
  *     cdef int n_cols = cols.shape[0]
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     if n_rows == 0 or n_cols == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_rows); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_rows); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 80, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":81
+  /* "tabmat/ext/dense.pyx":80
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_6 = ((__pyx_v_n_rows == 0) != 0);
@@ -6677,195 +6689,195 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_n_cols == 0) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":82
+    /* "tabmat/ext/dense.pyx":81
  *     out = np.zeros(n_rows, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/dense.pyx":81
+    /* "tabmat/ext/dense.pyx":80
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/dense.pyx":84
+  /* "tabmat/ext/dense.pyx":83
  *         return out
  * 
  *     cdef floating[:] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0]
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/dense.pyx":85
+  /* "tabmat/ext/dense.pyx":84
  * 
  *     cdef floating[:] out_view = out
  *     cdef floating* outp = &out_view[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xp = <floating*>X.data
  */
   __pyx_t_8 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_8 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":87
+  /* "tabmat/ext/dense.pyx":86
  *     cdef floating* outp = &out_view[0]
  * 
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef floating* vp = &v[0]
  * 
  */
   __pyx_v_Xp = ((float *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":88
+  /* "tabmat/ext/dense.pyx":87
  * 
  *     cdef floating* Xp = <floating*>X.data
  *     cdef floating* vp = &v[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int* colsp = &cols[0]
  */
   __pyx_t_8 = 0;
   __pyx_v_vp = (&(*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_8 * __pyx_v_v.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":90
+  /* "tabmat/ext/dense.pyx":89
  *     cdef floating* vp = &v[0]
  * 
  *     cdef int* colsp = &cols[0]             # <<<<<<<<<<<<<<
  *     cdef int* rowsp = &rows[0]
  * 
  */
   __pyx_t_8 = 0;
   __pyx_v_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_8 * __pyx_v_cols.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":91
+  /* "tabmat/ext/dense.pyx":90
  * 
  *     cdef int* colsp = &cols[0]
  *     cdef int* rowsp = &rows[0]             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_8 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_8 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":93
+  /* "tabmat/ext/dense.pyx":92
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":94
+    /* "tabmat/ext/dense.pyx":93
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  */
-    _denseC_matvec<float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseC_matvec<int,float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":93
+    /* "tabmat/ext/dense.pyx":92
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":95
+  /* "tabmat/ext/dense.pyx":94
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":96
+    /* "tabmat/ext/dense.pyx":95
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  */
-    _denseF_matvec<float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseF_matvec<int,float>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":95
+    /* "tabmat/ext/dense.pyx":94
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":98
+  /* "tabmat/ext/dense.pyx":97
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 97, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 98, __pyx_L1_error)
+    __PYX_ERR(0, 97, __pyx_L1_error)
   }
   __pyx_L6:;
 
-  /* "tabmat/ext/dense.pyx":99
+  /* "tabmat/ext/dense.pyx":98
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":74
+  /* "tabmat/ext/dense.pyx":73
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
@@ -6926,54 +6938,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 1); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 1); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 2); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 2); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 3); __PYX_ERR(0, 74, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, 3); __PYX_ERR(0, 73, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_matvec") < 0)) __PYX_ERR(0, 74, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dense_matvec") < 0)) __PYX_ERR(0, 73, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 74, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("dense_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 73, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.dense_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 73, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_22dense_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7004,84 +7016,84 @@
   __Pyx_memviewslice __pyx_t_7 = { 0, 0, { 0 }, { 0 }, { 0 } };
   Py_ssize_t __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1dense_matvec", 0);
 
-  /* "tabmat/ext/dense.pyx":75
+  /* "tabmat/ext/dense.pyx":74
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  */
   __pyx_v_n = (__pyx_v_X->dimensions[0]);
 
-  /* "tabmat/ext/dense.pyx":76
+  /* "tabmat/ext/dense.pyx":75
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]
  */
   __pyx_v_m = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":77
+  /* "tabmat/ext/dense.pyx":76
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int n_cols = cols.shape[0]
  * 
  */
   __pyx_v_n_rows = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":78
+  /* "tabmat/ext/dense.pyx":77
  *     cdef int m = X.shape[1]
  *     cdef int n_rows = rows.shape[0]
  *     cdef int n_cols = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)
  */
   __pyx_v_n_cols = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":80
+  /* "tabmat/ext/dense.pyx":79
  *     cdef int n_cols = cols.shape[0]
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     if n_rows == 0 or n_cols == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_rows); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n_rows); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 80, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 80, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":81
+  /* "tabmat/ext/dense.pyx":80
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_6 = ((__pyx_v_n_rows == 0) != 0);
@@ -7091,195 +7103,195 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_n_cols == 0) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":82
+    /* "tabmat/ext/dense.pyx":81
  *     out = np.zeros(n_rows, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/dense.pyx":81
+    /* "tabmat/ext/dense.pyx":80
  * 
  *     out = np.zeros(n_rows, dtype=X.dtype)
  *     if n_rows == 0 or n_cols == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/dense.pyx":84
+  /* "tabmat/ext/dense.pyx":83
  *         return out
  * 
  *     cdef floating[:] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0]
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/dense.pyx":85
+  /* "tabmat/ext/dense.pyx":84
  * 
  *     cdef floating[:] out_view = out
  *     cdef floating* outp = &out_view[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xp = <floating*>X.data
  */
   __pyx_t_8 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_8 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":87
+  /* "tabmat/ext/dense.pyx":86
  *     cdef floating* outp = &out_view[0]
  * 
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef floating* vp = &v[0]
  * 
  */
   __pyx_v_Xp = ((double *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":88
+  /* "tabmat/ext/dense.pyx":87
  * 
  *     cdef floating* Xp = <floating*>X.data
  *     cdef floating* vp = &v[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int* colsp = &cols[0]
  */
   __pyx_t_8 = 0;
   __pyx_v_vp = (&(*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_8 * __pyx_v_v.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":90
+  /* "tabmat/ext/dense.pyx":89
  *     cdef floating* vp = &v[0]
  * 
  *     cdef int* colsp = &cols[0]             # <<<<<<<<<<<<<<
  *     cdef int* rowsp = &rows[0]
  * 
  */
   __pyx_t_8 = 0;
   __pyx_v_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_8 * __pyx_v_cols.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":91
+  /* "tabmat/ext/dense.pyx":90
  * 
  *     cdef int* colsp = &cols[0]
  *     cdef int* rowsp = &rows[0]             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_8 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_8 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/dense.pyx":93
+  /* "tabmat/ext/dense.pyx":92
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 92, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":94
+    /* "tabmat/ext/dense.pyx":93
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  */
-    _denseC_matvec<double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseC_matvec<int,double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":93
+    /* "tabmat/ext/dense.pyx":92
  *     cdef int* rowsp = &rows[0]
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":95
+  /* "tabmat/ext/dense.pyx":94
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":96
+    /* "tabmat/ext/dense.pyx":95
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)             # <<<<<<<<<<<<<<
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  */
-    _denseF_matvec<double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
+    _denseF_matvec<int,double>(__pyx_v_rowsp, __pyx_v_colsp, __pyx_v_Xp, __pyx_v_vp, __pyx_v_outp, __pyx_v_n_rows, __pyx_v_n_cols, __pyx_v_m, __pyx_v_n);
 
-    /* "tabmat/ext/dense.pyx":95
+    /* "tabmat/ext/dense.pyx":94
  *     if X.flags["C_CONTIGUOUS"]:
  *         _denseC_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  */
     goto __pyx_L6;
   }
 
-  /* "tabmat/ext/dense.pyx":98
+  /* "tabmat/ext/dense.pyx":97
  *         _denseF_matvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 97, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 98, __pyx_L1_error)
+    __PYX_ERR(0, 97, __pyx_L1_error)
   }
   __pyx_L6:;
 
-  /* "tabmat/ext/dense.pyx":99
+  /* "tabmat/ext/dense.pyx":98
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":74
+  /* "tabmat/ext/dense.pyx":73
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
 
@@ -7299,15 +7311,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/dense.pyx":101
+/* "tabmat/ext/dense.pyx":100
  *     return out
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):             # <<<<<<<<<<<<<<
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  */
 
@@ -7348,31 +7360,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 101, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 100, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 101, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 100, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 101, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 100, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 101, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 100, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -7381,15 +7393,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 101, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 100, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_6transpose_square_dot_weights(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -7435,51 +7447,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("transpose_square_dot_weights", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 100, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 100, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 101, __pyx_L1_error)
+      __PYX_ERR(0, 100, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -7488,85 +7500,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 100, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_weights, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_weights, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 101, __pyx_L1_error)
+      __PYX_ERR(0, 100, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_weights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_weights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 101, __pyx_L1_error)
+      __PYX_ERR(0, 100, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 100, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_2);
     __Pyx_GIVEREF(__pyx_int_2);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_2);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 100, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -7580,62 +7592,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 101, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 101, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -7654,15 +7666,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -7676,100 +7688,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 100, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 101, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 101, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 100, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 101, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 100, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -7777,43 +7789,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 100, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 100, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 100, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 101, __pyx_L1_error)
+    __PYX_ERR(0, 100, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 101, __pyx_L1_error)
+      __PYX_ERR(0, 100, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 101, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -7872,38 +7884,38 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, 1); __PYX_ERR(0, 101, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, 1); __PYX_ERR(0, 100, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 101, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 100, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 101, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 100, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 101, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 100, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 100, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_26transpose_square_dot_weights(__pyx_self, __pyx_v_X, __pyx_v_weights);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -7934,101 +7946,101 @@
   int64_t __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/dense.pyx":102
+  /* "tabmat/ext/dense.pyx":101
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef int nrows = weights.shape[0]
  *     cdef int ncols = X.shape[1]
  */
   __pyx_v_Xp = ((float *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":103
+  /* "tabmat/ext/dense.pyx":102
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int ncols = X.shape[1]
  *     cdef int64_t i, j
  */
   __pyx_v_nrows = (__pyx_v_weights.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":104
+  /* "tabmat/ext/dense.pyx":103
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  *     cdef int ncols = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int64_t i, j
  * 
  */
   __pyx_v_ncols = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":107
+  /* "tabmat/ext/dense.pyx":106
  *     cdef int64_t i, j
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 107, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 107, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 106, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":108
+  /* "tabmat/ext/dense.pyx":107
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=X.dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_v_outp = ((float *)__pyx_v_out->data);
 
-  /* "tabmat/ext/dense.pyx":110
+  /* "tabmat/ext/dense.pyx":109
  *     cdef floating* outp = <floating*>out.data
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":111
+    /* "tabmat/ext/dense.pyx":110
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  */
     {
@@ -8059,27 +8071,27 @@
                       #endif /* _OPENMP */
                       for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_8; __pyx_t_7++){
                           {
                               __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_7);
                               /* Initialize private variables to invalid values */
                               __pyx_v_i = ((int64_t)0xbad0bad0);
 
-                              /* "tabmat/ext/dense.pyx":112
+                              /* "tabmat/ext/dense.pyx":111
  *     if X.flags["C_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):             # <<<<<<<<<<<<<<
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
                               __pyx_t_9 = __pyx_v_nrows;
                               __pyx_t_10 = __pyx_t_9;
                               for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                 __pyx_v_i = __pyx_t_11;
 
-                                /* "tabmat/ext/dense.pyx":113
+                                /* "tabmat/ext/dense.pyx":112
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):
  */
                                 __pyx_t_12 = __pyx_v_i;
@@ -8094,15 +8106,15 @@
               #undef likely
               #undef unlikely
               #define likely(x)   __builtin_expect(!!(x), 1)
               #define unlikely(x) __builtin_expect(!!(x), 0)
           #endif
         }
 
-        /* "tabmat/ext/dense.pyx":111
+        /* "tabmat/ext/dense.pyx":110
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  */
         /*finally:*/ {
@@ -8113,41 +8125,41 @@
             #endif
             goto __pyx_L6;
           }
           __pyx_L6:;
         }
     }
 
-    /* "tabmat/ext/dense.pyx":110
+    /* "tabmat/ext/dense.pyx":109
  *     cdef floating* outp = <floating*>out.data
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
     goto __pyx_L3;
   }
 
-  /* "tabmat/ext/dense.pyx":114
+  /* "tabmat/ext/dense.pyx":113
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":115
+    /* "tabmat/ext/dense.pyx":114
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  */
     {
@@ -8178,27 +8190,27 @@
                       #endif /* _OPENMP */
                       for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8++){
                           {
                               __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_8);
                               /* Initialize private variables to invalid values */
                               __pyx_v_i = ((int64_t)0xbad0bad0);
 
-                              /* "tabmat/ext/dense.pyx":116
+                              /* "tabmat/ext/dense.pyx":115
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):             # <<<<<<<<<<<<<<
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  *     else:
  */
                               __pyx_t_9 = __pyx_v_nrows;
                               __pyx_t_10 = __pyx_t_9;
                               for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                 __pyx_v_i = __pyx_t_11;
 
-                                /* "tabmat/ext/dense.pyx":117
+                                /* "tabmat/ext/dense.pyx":116
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)             # <<<<<<<<<<<<<<
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  */
                                 __pyx_t_12 = __pyx_v_i;
@@ -8213,15 +8225,15 @@
               #undef likely
               #undef unlikely
               #define likely(x)   __builtin_expect(!!(x), 1)
               #define unlikely(x) __builtin_expect(!!(x), 0)
           #endif
         }
 
-        /* "tabmat/ext/dense.pyx":115
+        /* "tabmat/ext/dense.pyx":114
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  */
         /*finally:*/ {
@@ -8232,50 +8244,50 @@
             #endif
             goto __pyx_L17;
           }
           __pyx_L17:;
         }
     }
 
-    /* "tabmat/ext/dense.pyx":114
+    /* "tabmat/ext/dense.pyx":113
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
     goto __pyx_L3;
   }
 
-  /* "tabmat/ext/dense.pyx":119
+  /* "tabmat/ext/dense.pyx":118
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 119, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 118, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 119, __pyx_L1_error)
+    __PYX_ERR(0, 118, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "tabmat/ext/dense.pyx":120
+  /* "tabmat/ext/dense.pyx":119
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":101
+  /* "tabmat/ext/dense.pyx":100
  *     return out
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):             # <<<<<<<<<<<<<<
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  */
 
@@ -8326,38 +8338,38 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, 1); __PYX_ERR(0, 101, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, 1); __PYX_ERR(0, 100, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 101, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 100, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_X = ((PyArrayObject *)values[0]);
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 101, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 100, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 101, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 100, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.dense.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_X), __pyx_ptype_5numpy_ndarray, 1, "X", 0))) __PYX_ERR(0, 100, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5dense_28transpose_square_dot_weights(__pyx_self, __pyx_v_X, __pyx_v_weights);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -8388,101 +8400,101 @@
   int64_t __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/dense.pyx":102
+  /* "tabmat/ext/dense.pyx":101
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):
  *     cdef floating* Xp = <floating*>X.data             # <<<<<<<<<<<<<<
  *     cdef int nrows = weights.shape[0]
  *     cdef int ncols = X.shape[1]
  */
   __pyx_v_Xp = ((double *)__pyx_v_X->data);
 
-  /* "tabmat/ext/dense.pyx":103
+  /* "tabmat/ext/dense.pyx":102
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int ncols = X.shape[1]
  *     cdef int64_t i, j
  */
   __pyx_v_nrows = (__pyx_v_weights.shape[0]);
 
-  /* "tabmat/ext/dense.pyx":104
+  /* "tabmat/ext/dense.pyx":103
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  *     cdef int ncols = X.shape[1]             # <<<<<<<<<<<<<<
  *     cdef int64_t i, j
  * 
  */
   __pyx_v_ncols = (__pyx_v_X->dimensions[1]);
 
-  /* "tabmat/ext/dense.pyx":107
+  /* "tabmat/ext/dense.pyx":106
  *     cdef int64_t i, j
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 107, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 107, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 106, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":108
+  /* "tabmat/ext/dense.pyx":107
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=X.dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  */
   __pyx_v_outp = ((double *)__pyx_v_out->data);
 
-  /* "tabmat/ext/dense.pyx":110
+  /* "tabmat/ext/dense.pyx":109
  *     cdef floating* outp = <floating*>out.data
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/dense.pyx":111
+    /* "tabmat/ext/dense.pyx":110
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  */
     {
@@ -8513,27 +8525,27 @@
                       #endif /* _OPENMP */
                       for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_8; __pyx_t_7++){
                           {
                               __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_7);
                               /* Initialize private variables to invalid values */
                               __pyx_v_i = ((int64_t)0xbad0bad0);
 
-                              /* "tabmat/ext/dense.pyx":112
+                              /* "tabmat/ext/dense.pyx":111
  *     if X.flags["C_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):             # <<<<<<<<<<<<<<
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:
  */
                               __pyx_t_9 = __pyx_v_nrows;
                               __pyx_t_10 = __pyx_t_9;
                               for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                 __pyx_v_i = __pyx_t_11;
 
-                                /* "tabmat/ext/dense.pyx":113
+                                /* "tabmat/ext/dense.pyx":112
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)             # <<<<<<<<<<<<<<
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):
  */
                                 __pyx_t_12 = __pyx_v_i;
@@ -8548,15 +8560,15 @@
               #undef likely
               #undef unlikely
               #define likely(x)   __builtin_expect(!!(x), 1)
               #define unlikely(x) __builtin_expect(!!(x), 0)
           #endif
         }
 
-        /* "tabmat/ext/dense.pyx":111
+        /* "tabmat/ext/dense.pyx":110
  * 
  *     if X.flags["C_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  */
         /*finally:*/ {
@@ -8567,41 +8579,41 @@
             #endif
             goto __pyx_L6;
           }
           __pyx_L6:;
         }
     }
 
-    /* "tabmat/ext/dense.pyx":110
+    /* "tabmat/ext/dense.pyx":109
  *     cdef floating* outp = <floating*>out.data
  * 
  *     if X.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
     goto __pyx_L3;
   }
 
-  /* "tabmat/ext/dense.pyx":114
+  /* "tabmat/ext/dense.pyx":113
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_X), __pyx_n_s_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_1, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(__pyx_t_5)) {
 
-    /* "tabmat/ext/dense.pyx":115
+    /* "tabmat/ext/dense.pyx":114
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  */
     {
@@ -8632,27 +8644,27 @@
                       #endif /* _OPENMP */
                       for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8++){
                           {
                               __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_8);
                               /* Initialize private variables to invalid values */
                               __pyx_v_i = ((int64_t)0xbad0bad0);
 
-                              /* "tabmat/ext/dense.pyx":116
+                              /* "tabmat/ext/dense.pyx":115
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):             # <<<<<<<<<<<<<<
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  *     else:
  */
                               __pyx_t_9 = __pyx_v_nrows;
                               __pyx_t_10 = __pyx_t_9;
                               for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                                 __pyx_v_i = __pyx_t_11;
 
-                                /* "tabmat/ext/dense.pyx":117
+                                /* "tabmat/ext/dense.pyx":116
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)             # <<<<<<<<<<<<<<
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  */
                                 __pyx_t_12 = __pyx_v_i;
@@ -8667,15 +8679,15 @@
               #undef likely
               #undef unlikely
               #define likely(x)   __builtin_expect(!!(x), 1)
               #define unlikely(x) __builtin_expect(!!(x), 0)
           #endif
         }
 
-        /* "tabmat/ext/dense.pyx":115
+        /* "tabmat/ext/dense.pyx":114
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:
  *         for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  */
         /*finally:*/ {
@@ -8686,50 +8698,50 @@
             #endif
             goto __pyx_L17;
           }
           __pyx_L17:;
         }
     }
 
-    /* "tabmat/ext/dense.pyx":114
+    /* "tabmat/ext/dense.pyx":113
  *             for i in range(nrows):
  *                 outp[j] = outp[j] + weights[i] * (Xp[i * ncols + j] ** 2)
  *     elif X.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         for j in prange(ncols, nogil=True):
  *             for i in range(nrows):
  */
     goto __pyx_L3;
   }
 
-  /* "tabmat/ext/dense.pyx":119
+  /* "tabmat/ext/dense.pyx":118
  *                 outp[j] = outp[j] + weights[i] * (Xp[j * nrows + i] ** 2)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 119, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 118, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 119, __pyx_L1_error)
+    __PYX_ERR(0, 118, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "tabmat/ext/dense.pyx":120
+  /* "tabmat/ext/dense.pyx":119
  *     else:
  *         raise Exception("The matrix X is not contiguous.")
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/dense.pyx":101
+  /* "tabmat/ext/dense.pyx":100
  *     return out
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):             # <<<<<<<<<<<<<<
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  */
 
@@ -8745,15 +8757,15 @@
   __Pyx_XDECREF((PyObject *)__pyx_v_out);
   __PYX_XDEC_MEMVIEW(&__pyx_v_weights, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -8762,29 +8774,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -8795,15 +8807,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -8812,29 +8824,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -8845,15 +8857,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -8862,29 +8874,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -8895,15 +8907,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -8912,29 +8924,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -8945,15 +8957,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -8962,29 +8974,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -8995,212 +9007,212 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
  *     else:
  *         return ()
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
     __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
  *         return <tuple>d.subarray.shape
  *     else:
  *         return ()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_empty_tuple);
     __pyx_r = __pyx_empty_tuple;
     goto __pyx_L0;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
  * 
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
  *     PyArray_SetBaseObject(arr, base)
  * 
  */
   Py_INCREF(__pyx_v_base);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object get_array_base(ndarray arr):
  */
   (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
   PyObject *__pyx_v_base;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
  *     if base is NULL:
  *         return None
  */
   __pyx_v_base = PyArray_BASE(__pyx_v_arr);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  *         return None             # <<<<<<<<<<<<<<
  *     return <object>base
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
  *     if base is NULL:
  *         return None
  *     return <object>base             # <<<<<<<<<<<<<<
  * 
  * # Versions of the import_* functions which are more suitable for
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_base));
   __pyx_r = ((PyObject *)__pyx_v_base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -9216,15 +9228,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_array", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
   {
@@ -9232,53 +9244,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
  * cdef inline int import_array() except -1:
  *     try:
  *         __pyx_import_array()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")
  */
       __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 942, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
  *     try:
  *         __pyx_import_array()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 943, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 944, __pyx_L5_except_error)
@@ -9286,30 +9298,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 944, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -9324,15 +9336,15 @@
   __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9348,15 +9360,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_umath", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -9364,53 +9376,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
  * cdef inline int import_umath() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 948, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 949, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 950, __pyx_L5_except_error)
@@ -9418,30 +9430,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 950, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9456,15 +9468,15 @@
   __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9480,15 +9492,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_ufunc", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -9496,53 +9508,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
  * cdef inline int import_ufunc() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 954, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 955, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef extern from *:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 956, __pyx_L5_except_error)
@@ -9550,30 +9562,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 956, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9588,176 +9600,176 @@
   __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_datetime64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
 static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
   npy_datetime __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
  *     also needed.  That can be found using `get_datetime64_unit`.
  *     """
  *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
 static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
   npy_timedelta __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
  *     returns the int64 value underlying scalar numpy timedelta64 object
  *     """
  *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
 static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
   NPY_DATETIMEUNIT __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
  *     returns the unit part of the dtype for a numpy datetime64 object.
  *     """
  *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
  */
   __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
@@ -22990,15 +23002,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -23112,15 +23124,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -23376,15 +23388,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -23525,15 +23537,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -23579,38 +23591,38 @@
 #endif
 #endif
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_kp_s_, __pyx_k_, sizeof(__pyx_k_), 0, 0, 1, 0},
   {&__pyx_n_s_ASCII, __pyx_k_ASCII, sizeof(__pyx_k_ASCII), 0, 0, 1, 1},
   {&__pyx_kp_s_Buffer_view_does_not_expose_stri, __pyx_k_Buffer_view_does_not_expose_stri, sizeof(__pyx_k_Buffer_view_does_not_expose_stri), 0, 0, 1, 0},
-  {&__pyx_n_s_C_CONTIGUOUS, __pyx_k_C_CONTIGUOUS, sizeof(__pyx_k_C_CONTIGUOUS), 0, 0, 1, 1},
+  {&__pyx_n_u_C_CONTIGUOUS, __pyx_k_C_CONTIGUOUS, sizeof(__pyx_k_C_CONTIGUOUS), 0, 1, 0, 1},
   {&__pyx_kp_s_Can_only_create_a_buffer_that_is, __pyx_k_Can_only_create_a_buffer_that_is, sizeof(__pyx_k_Can_only_create_a_buffer_that_is), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_assign_to_read_only_memor, __pyx_k_Cannot_assign_to_read_only_memor, sizeof(__pyx_k_Cannot_assign_to_read_only_memor), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_create_writable_memory_vi, __pyx_k_Cannot_create_writable_memory_vi, sizeof(__pyx_k_Cannot_create_writable_memory_vi), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_index_with_type_s, __pyx_k_Cannot_index_with_type_s, sizeof(__pyx_k_Cannot_index_with_type_s), 0, 0, 1, 0},
   {&__pyx_n_s_Ellipsis, __pyx_k_Ellipsis, sizeof(__pyx_k_Ellipsis), 0, 0, 1, 1},
   {&__pyx_kp_s_Empty_shape_tuple_for_cython_arr, __pyx_k_Empty_shape_tuple_for_cython_arr, sizeof(__pyx_k_Empty_shape_tuple_for_cython_arr), 0, 0, 1, 0},
   {&__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_k_Expected_at_least_d_argument_s_g, sizeof(__pyx_k_Expected_at_least_d_argument_s_g), 0, 0, 1, 0},
-  {&__pyx_n_s_F_CONTIGUOUS, __pyx_k_F_CONTIGUOUS, sizeof(__pyx_k_F_CONTIGUOUS), 0, 0, 1, 1},
+  {&__pyx_n_u_F_CONTIGUOUS, __pyx_k_F_CONTIGUOUS, sizeof(__pyx_k_F_CONTIGUOUS), 0, 1, 0, 1},
   {&__pyx_kp_s_Function_call_with_ambiguous_arg, __pyx_k_Function_call_with_ambiguous_arg, sizeof(__pyx_k_Function_call_with_ambiguous_arg), 0, 0, 1, 0},
   {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
   {&__pyx_kp_s_Indirect_dimensions_not_supporte, __pyx_k_Indirect_dimensions_not_supporte, sizeof(__pyx_k_Indirect_dimensions_not_supporte), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_mode_expected_c_or_fortr, __pyx_k_Invalid_mode_expected_c_or_fortr, sizeof(__pyx_k_Invalid_mode_expected_c_or_fortr), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_shape_in_axis_d_d, __pyx_k_Invalid_shape_in_axis_d_d, sizeof(__pyx_k_Invalid_shape_in_axis_d_d), 0, 0, 1, 0},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
   {&__pyx_kp_s_MemoryView_of_r_at_0x_x, __pyx_k_MemoryView_of_r_at_0x_x, sizeof(__pyx_k_MemoryView_of_r_at_0x_x), 0, 0, 1, 0},
   {&__pyx_kp_s_MemoryView_of_r_object, __pyx_k_MemoryView_of_r_object, sizeof(__pyx_k_MemoryView_of_r_object), 0, 0, 1, 0},
   {&__pyx_kp_s_No_matching_signature_found, __pyx_k_No_matching_signature_found, sizeof(__pyx_k_No_matching_signature_found), 0, 0, 1, 0},
   {&__pyx_n_b_O, __pyx_k_O, sizeof(__pyx_k_O), 0, 0, 0, 1},
   {&__pyx_kp_s_Out_of_bounds_on_buffer_access_a, __pyx_k_Out_of_bounds_on_buffer_access_a, sizeof(__pyx_k_Out_of_bounds_on_buffer_access_a), 0, 0, 1, 0},
   {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
-  {&__pyx_kp_s_The_matrix_X_is_not_contiguous, __pyx_k_The_matrix_X_is_not_contiguous, sizeof(__pyx_k_The_matrix_X_is_not_contiguous), 0, 0, 1, 0},
+  {&__pyx_kp_u_The_matrix_X_is_not_contiguous, __pyx_k_The_matrix_X_is_not_contiguous, sizeof(__pyx_k_The_matrix_X_is_not_contiguous), 0, 1, 0, 0},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
   {&__pyx_kp_s_Unable_to_convert_item_to_object, __pyx_k_Unable_to_convert_item_to_object, sizeof(__pyx_k_Unable_to_convert_item_to_object), 0, 0, 1, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {&__pyx_n_s_View_MemoryView, __pyx_k_View_MemoryView, sizeof(__pyx_k_View_MemoryView), 0, 0, 1, 1},
   {&__pyx_n_s_X, __pyx_k_X, sizeof(__pyx_k_X), 0, 0, 1, 1},
   {&__pyx_n_s_Xp, __pyx_k_Xp, sizeof(__pyx_k_Xp), 0, 0, 1, 1},
   {&__pyx_kp_s__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 1, 0},
@@ -23668,16 +23680,16 @@
   {&__pyx_n_s_ncols, __pyx_k_ncols, sizeof(__pyx_k_ncols), 0, 0, 1, 1},
   {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
   {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
   {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
   {&__pyx_n_s_nrows, __pyx_k_nrows, sizeof(__pyx_k_nrows), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_s_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 0, 1, 0},
-  {&__pyx_kp_s_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 0, 1, 0},
+  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
+  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_s_out, __pyx_k_out, sizeof(__pyx_k_out), 0, 0, 1, 1},
   {&__pyx_n_s_out_m, __pyx_k_out_m, sizeof(__pyx_k_out_m), 0, 0, 1, 1},
   {&__pyx_n_s_out_view, __pyx_k_out_view, sizeof(__pyx_k_out_view), 0, 0, 1, 1},
   {&__pyx_n_s_outp, __pyx_k_outp, sizeof(__pyx_k_outp), 0, 0, 1, 1},
   {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
@@ -23723,16 +23735,16 @@
   {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
   {&__pyx_n_s_vp, __pyx_k_vp, sizeof(__pyx_k_vp), 0, 0, 1, 1},
   {&__pyx_n_s_weights, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 17, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 16, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 944, __pyx_L1_error)
   __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(2, 134, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(2, 149, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(2, 152, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(2, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(2, 615, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(2, 834, __pyx_L1_error)
@@ -23741,58 +23753,58 @@
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "tabmat/ext/dense.pyx":17
- *     void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+  /* "tabmat/ext/dense.pyx":16
+ *     void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__4);
   __Pyx_GIVEREF(__pyx_tuple__4);
 
-  /* "tabmat/ext/dense.pyx":70
- *         _denseF_rmatvec(rowsp, colsp, Xp, vp, outp, n_rows, n_cols, m, n)
+  /* "tabmat/ext/dense.pyx":40
+ *         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
  *     else:
  *         raise Exception("The matrix X is not contiguous.")             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_The_matrix_X_is_not_contiguous); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 70, __pyx_L1_error)
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_The_matrix_X_is_not_contiguous); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 40, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__5);
   __Pyx_GIVEREF(__pyx_tuple__5);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 944, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 950, __pyx_L1_error)
+  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 950, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__7);
   __Pyx_GIVEREF(__pyx_tuple__7);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
@@ -23983,61 +23995,61 @@
   __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__25);
   __Pyx_GIVEREF(__pyx_tuple__25);
   __pyx_tuple__26 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__26);
   __Pyx_GIVEREF(__pyx_tuple__26);
 
-  /* "tabmat/ext/dense.pyx":17
- *     void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+  /* "tabmat/ext/dense.pyx":16
+ *     void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_tuple__27 = PyTuple_Pack(18, __pyx_n_s_X, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_thresh1d, __pyx_n_s_kratio, __pyx_n_s_innerblock, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_in_n, __pyx_n_s_out_m, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Xp, __pyx_n_s_dp, __pyx_n_s_colsp, __pyx_n_s_rowsp); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_tuple__27 = PyTuple_Pack(18, __pyx_n_s_X, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_thresh1d, __pyx_n_s_kratio, __pyx_n_s_innerblock, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_in_n, __pyx_n_s_out_m, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Xp, __pyx_n_s_dp, __pyx_n_s_colsp, __pyx_n_s_rowsp); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__27);
   __Pyx_GIVEREF(__pyx_tuple__27);
-  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(7, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_dense_sandwich, 17, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(7, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_dense_sandwich, 16, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 16, __pyx_L1_error)
 
-  /* "tabmat/ext/dense.pyx":46
+  /* "tabmat/ext/dense.pyx":45
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_tuple__29 = PyTuple_Pack(15, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_n_rows, __pyx_n_s_n_cols, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Xp, __pyx_n_s_vp, __pyx_n_s_colsp, __pyx_n_s_rowsp); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_tuple__29 = PyTuple_Pack(15, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_n_rows, __pyx_n_s_n_cols, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Xp, __pyx_n_s_vp, __pyx_n_s_colsp, __pyx_n_s_rowsp); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__29);
   __Pyx_GIVEREF(__pyx_tuple__29);
-  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(4, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_dense_rmatvec, 46, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(4, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_dense_rmatvec, 45, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 45, __pyx_L1_error)
 
-  /* "tabmat/ext/dense.pyx":74
+  /* "tabmat/ext/dense.pyx":73
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_tuple__31 = PyTuple_Pack(15, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_n_rows, __pyx_n_s_n_cols, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Xp, __pyx_n_s_vp, __pyx_n_s_colsp, __pyx_n_s_rowsp); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_tuple__31 = PyTuple_Pack(15, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_n_rows, __pyx_n_s_n_cols, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Xp, __pyx_n_s_vp, __pyx_n_s_colsp, __pyx_n_s_rowsp); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__31);
   __Pyx_GIVEREF(__pyx_tuple__31);
-  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(4, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_dense_matvec, 74, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(4, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_dense_matvec, 73, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 73, __pyx_L1_error)
 
-  /* "tabmat/ext/dense.pyx":101
+  /* "tabmat/ext/dense.pyx":100
  *     return out
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):             # <<<<<<<<<<<<<<
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  */
-  __pyx_tuple__33 = PyTuple_Pack(9, __pyx_n_s_X, __pyx_n_s_weights, __pyx_n_s_Xp, __pyx_n_s_nrows, __pyx_n_s_ncols, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_out, __pyx_n_s_outp); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_tuple__33 = PyTuple_Pack(9, __pyx_n_s_X, __pyx_n_s_weights, __pyx_n_s_Xp, __pyx_n_s_nrows, __pyx_n_s_ncols, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_out, __pyx_n_s_outp); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__33);
   __Pyx_GIVEREF(__pyx_tuple__33);
-  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_transpose_square_dot_weights, 101, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_dense_pyx, __pyx_n_s_transpose_square_dot_weights, 100, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 100, __pyx_L1_error)
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
@@ -24236,55 +24248,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -24506,169 +24502,168 @@
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "tabmat/ext/dense.pyx":2
- * # cython: boundscheck=False, wraparound=False, cdivision=True
+  /* "tabmat/ext/dense.pyx":1
  * import numpy as np             # <<<<<<<<<<<<<<
  * cimport numpy as np
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/dense.pyx":17
- *     void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+  /* "tabmat/ext/dense.pyx":16
+ *     void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
  * 
  * def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyInt_From_long(32); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_long(32); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_From_long(16); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_long(16); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_From_long(0x80); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_long(0x80); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_9dense_sandwich, 0, __pyx_n_s_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_9dense_sandwich, 0, __pyx_n_s_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_2, sizeof(__pyx_defaults2), 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_2, sizeof(__pyx_defaults2), 0)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_2)->__pyx_arg_thresh1d = 32;
   __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_2)->__pyx_arg_kratio = 16;
   __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_2)->__pyx_arg_innerblock = 0x80;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_t_4);
   __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_2, __pyx_pf_6tabmat_3ext_5dense_36__defaults__);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_11dense_sandwich, 0, __pyx_n_s_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_11dense_sandwich, 0, __pyx_n_s_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_2, sizeof(__pyx_defaults3), 0)) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_2, sizeof(__pyx_defaults3), 0)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_2)->__pyx_arg_thresh1d = 32;
   __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_2)->__pyx_arg_kratio = 16;
   __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_2)->__pyx_arg_innerblock = 0x80;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_t_4);
   __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_2, __pyx_pf_6tabmat_3ext_5dense_38__defaults__);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_1dense_sandwich, 0, __pyx_n_s_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_1dense_sandwich, 0, __pyx_n_s_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_t_4);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_3;
   __Pyx_GIVEREF(__pyx_t_3);
   __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dense_sandwich, __pyx_t_2) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dense_sandwich, __pyx_t_2) < 0) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":46
+  /* "tabmat/ext/dense.pyx":45
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_15dense_rmatvec, 0, __pyx_n_s_dense_rmatvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_15dense_rmatvec, 0, __pyx_n_s_dense_rmatvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_17dense_rmatvec, 0, __pyx_n_s_dense_rmatvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_17dense_rmatvec, 0, __pyx_n_s_dense_rmatvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_3dense_rmatvec, 0, __pyx_n_s_dense_rmatvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_3dense_rmatvec, 0, __pyx_n_s_dense_rmatvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_4;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dense_rmatvec, __pyx_t_2) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dense_rmatvec, __pyx_t_2) < 0) __PYX_ERR(0, 45, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/dense.pyx":74
+  /* "tabmat/ext/dense.pyx":73
  * 
  * # TODO: lots of duplicated code with dense_sandwich above
  * def dense_matvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int n = X.shape[0]
  *     cdef int m = X.shape[1]
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_21dense_matvec, 0, __pyx_n_s_dense_matvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_21dense_matvec, 0, __pyx_n_s_dense_matvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_float, __pyx_t_4) < 0) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_float, __pyx_t_4) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_23dense_matvec, 0, __pyx_n_s_dense_matvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_23dense_matvec, 0, __pyx_n_s_dense_matvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_double, __pyx_t_4) < 0) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_double, __pyx_t_4) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_5dense_matvec, 0, __pyx_n_s_dense_matvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 74, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_5dense_matvec, 0, __pyx_n_s_dense_matvec, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_4)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dense_matvec, __pyx_t_4) < 0) __PYX_ERR(0, 74, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_dense_matvec, __pyx_t_4) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "tabmat/ext/dense.pyx":101
+  /* "tabmat/ext/dense.pyx":100
  *     return out
  * 
  * def transpose_square_dot_weights(np.ndarray X, floating[:] weights):             # <<<<<<<<<<<<<<
  *     cdef floating* Xp = <floating*>X.data
  *     cdef int nrows = weights.shape[0]
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_27transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5dense_27transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_29transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5dense_29transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_7transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5dense_7transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_dense, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_4;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_square_dot_weights, __pyx_t_2) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_square_dot_weights, __pyx_t_2) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "tabmat/ext/dense.pyx":1
- * # cython: boundscheck=False, wraparound=False, cdivision=True             # <<<<<<<<<<<<<<
- * import numpy as np
+ * import numpy as np             # <<<<<<<<<<<<<<
  * cimport numpy as np
+ * 
  */
   __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "View.MemoryView":210
@@ -25442,28 +25437,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -27239,61 +27234,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -27917,15 +27930,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -28300,15 +28316,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_FusedFunction_init(void) {
     __pyx_FusedFunctionType_type.tp_base = __pyx_CyFunctionType;
     __pyx_FusedFunctionType = __Pyx_FetchCommonType(&__pyx_FusedFunctionType_type);
     if (__pyx_FusedFunctionType == NULL) {
@@ -29980,15 +29999,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -30214,15 +30233,15 @@
                         } else if (8 * sizeof(int64_t) >= 4 * PyLong_SHIFT) {
                             return (int64_t) (((((((((int64_t)digits[3]) << PyLong_SHIFT) | (int64_t)digits[2]) << PyLong_SHIFT) | (int64_t)digits[1]) << PyLong_SHIFT) | (int64_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -30443,15 +30462,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -30639,15 +30658,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/dense.pyx` & `tabmat-3.1.8/src/tabmat/ext/dense.pyx`

 * *Files 10% similar despite different names*

```diff
@@ -1,22 +1,21 @@
-# cython: boundscheck=False, wraparound=False, cdivision=True
 import numpy as np
 cimport numpy as np
 
 from cython cimport floating
 from cython.parallel import prange
 from libc.stdint cimport int64_t
 
 cdef extern from "dense_helpers.cpp":
-    void _denseC_sandwich[F](int*, int*, F*, F*, F*, int, int, int, int, int, int, int) nogil
-    void _denseF_sandwich[F](int*, int*, F*, F*, F*, int, int, int, int, int, int, int) nogil
-    void _denseC_rmatvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
-    void _denseF_rmatvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
-    void _denseC_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
-    void _denseF_matvec[F](int*, int*, F*, F*, F*, int, int, int, int) nogil
+    void _denseC_sandwich[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int, Int, Int, Int) nogil
+    void _denseF_sandwich[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int, Int, Int, Int) nogil
+    void _denseC_rmatvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
+    void _denseF_rmatvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
+    void _denseC_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
+    void _denseF_matvec[Int, F](Int*, Int*, F*, F*, F*, Int, Int, Int, Int) nogil
 
 def dense_sandwich(np.ndarray X, floating[:] d, int[:] rows, int[:] cols, int thresh1d = 32, int kratio = 16, int innerblock = 128):
     cdef int n = X.shape[0]
     cdef int m = X.shape[1]
     cdef int in_n = rows.shape[0]
     cdef int out_m = cols.shape[0]
 
@@ -34,15 +33,15 @@
     cdef int* rowsp = &rows[0]
 
     if X.flags["C_CONTIGUOUS"]:
         _denseC_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
     elif X.flags["F_CONTIGUOUS"]:
         _denseF_sandwich(rowsp, colsp, Xp, dp, outp, in_n, out_m, m, n, thresh1d, kratio, innerblock)
     else:
-        raise Exception()
+        raise Exception("The matrix X is not contiguous.")
     return out
 
 
 # TODO: lots of duplicated code with dense_sandwich above
 def dense_rmatvec(np.ndarray X, floating[:] v, int[:] rows, int[:] cols):
     cdef int n = X.shape[0]
     cdef int m = X.shape[1]
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/dense_helpers-tmpl.cpp` & `tabmat-3.1.8/src/tabmat/ext/dense_helpers-tmpl.cpp`

 * *Files 26% similar despite different names*

```diff
@@ -20,20 +20,14 @@
 
 #include <xsimd/xsimd.hpp>
 #include <iostream>
 #include <omp.h>
 
 #include "alloc.h"
 
-#ifdef _WIN32
-    #define SIZE_T long long
-#else
-    #define SIZE_T size_t
-#endif
-
 #if XSIMD_VERSION_MAJOR >= 8
     #define XSIMD_BROADCAST broadcast
 #else
     #define XSIMD_BROADCAST set_simd
 #endif
 
 #if XSIMD_VERSION_MAJOR >= 9
@@ -145,33 +139,33 @@
             ${middle_j(kparallel, IBLOCK, JBLOCK)}
         }
         % endfor
     }
 </%def>
 
 <%def name="dense_base_tmpl(kparallel)">
-template <typename F>
+template <typename Int, typename F>
 void dense_base${kparallel}(F* R, F* L, F* d, F* out,
-                int out_m,
-                int imin2, int imax2,
-                int jmin2, int jmax2, 
-                int kmin, int kmax, int innerblock, int kstep) 
+                Py_ssize_t out_m,
+                Py_ssize_t imin2, Py_ssize_t imax2,
+                Py_ssize_t jmin2, Py_ssize_t jmax2, 
+                Py_ssize_t kmin, Py_ssize_t kmax, Int innerblock, Int kstep) 
 {
     constexpr std::size_t simd_size = xsimd::simd_type<F>::size;
-    for (int imin = imin2; imin < imax2; imin+=innerblock) {
-        int imax = imin + innerblock; 
+    for (Py_ssize_t imin = imin2; imin < imax2; imin+=innerblock) {
+        Py_ssize_t imax = imin + innerblock; 
         if (imax > imax2) {
             imax = imax2; 
         }
-        for (int jmin = jmin2; jmin < jmax2; jmin+=innerblock) {
-            int jmax = jmin + innerblock; 
+        for (Py_ssize_t jmin = jmin2; jmin < jmax2; jmin+=innerblock) {
+            Py_ssize_t jmax = jmin + innerblock; 
             if (jmax > jmax2) {
                 jmax = jmax2; 
             }
-            int i = imin;
+            Py_ssize_t i = imin;
             % for IBLOCK in [4, 2, 1]:
             {
                 ${outer_i(kparallel, IBLOCK, [4, 2, 1])}
             }
             % endfor
         }
     }
@@ -180,213 +174,213 @@
 
 ${dense_base_tmpl(True)}
 ${dense_base_tmpl(False)}
 
 <%def name="k_loop(kparallel, order)">
 % if kparallel:
     #pragma omp parallel for
-    for (SIZE_T Rk = 0; Rk < in_n; Rk+=kratio*thresh1d) {
+    for (Py_ssize_t Rk = 0; Rk < in_n; Rk+=kratio*thresh1d) {
 % else:
-    for (SIZE_T Rk = 0; Rk < in_n; Rk+=kratio*thresh1d) {
+    for (Py_ssize_t Rk = 0; Rk < in_n; Rk+=kratio*thresh1d) {
 % endif
-    int Rkmax2 = Rk + kratio*thresh1d; 
+    int Rkmax2 = Rk + kratio * thresh1d; 
     if (Rkmax2 > in_n) {
         Rkmax2 = in_n; 
     }
 
     F* R = Rglobal.get();
     % if kparallel:
     R += omp_get_thread_num()*thresh1d*thresh1d*kratio*kratio;
-    for (SIZE_T Cjj = Cj; Cjj < Cjmax2; Cjj++) {
+    for (Py_ssize_t Cjj = Cj; Cjj < Cjmax2; Cjj++) {
     % else:
     #pragma omp parallel for
-    for (SIZE_T Cjj = Cj; Cjj < Cjmax2; Cjj++) {
+    for (Py_ssize_t Cjj = Cj; Cjj < Cjmax2; Cjj++) {
     % endif
         {
-            SIZE_T jj = cols[Cjj];
+            Int jj = cols[Cjj];
             %if order == 'F':
                 //TODO: this could use some pointer logic for the R assignment?
-                for (SIZE_T Rkk=Rk; Rkk<Rkmax2; Rkk++) {
-                    SIZE_T kk = rows[Rkk];
+                for (Py_ssize_t Rkk=Rk; Rkk<Rkmax2; Rkk++) {
+                    Int kk = rows[Rkk];
                     R[(Cjj-Cj)*kratio*thresh1d+(Rkk-Rk)] = d[kk] * X[jj*n+kk];
                 }
             % else:
-                for (SIZE_T Rkk=Rk; Rkk<Rkmax2; Rkk++) {
-                    SIZE_T kk = rows[Rkk];
-                    R[(Cjj-Cj)*kratio*thresh1d+(Rkk-Rk)] = d[kk] * X[kk*m+jj];
+                for (Py_ssize_t Rkk=Rk; Rkk<Rkmax2; Rkk++) {
+                    Int kk = rows[Rkk];
+                    R[(Py_ssize_t) (Cjj-Cj) * kratio * thresh1d + (Rkk-Rk)] = d[kk] * X[(Py_ssize_t) kk * m + jj];
                 }
             % endif
         }
     }
 
     % if kparallel:
-        for (SIZE_T Ci = Cj; Ci < out_m; Ci+=thresh1d) {
+        for (Py_ssize_t Ci = Cj; Ci < out_m; Ci+=thresh1d) {
     % else:
         #pragma omp parallel for
-        for (SIZE_T Ci = Cj; Ci < out_m; Ci+=thresh1d) {
+        for (Py_ssize_t Ci = Cj; Ci < out_m; Ci+=thresh1d) {
     % endif
-        int Cimax2 = Ci + thresh1d; 
+        Py_ssize_t Cimax2 = Ci + thresh1d; 
         if (Cimax2 > out_m) {
             Cimax2 = out_m; 
         }
         F* L = &Lglobal.get()[omp_get_thread_num()*thresh1d*thresh1d*kratio];
-        for (SIZE_T Cii = Ci; Cii < Cimax2; Cii++) {
-            SIZE_T ii = cols[Cii];
+        for (Py_ssize_t Cii = Ci; Cii < Cimax2; Cii++) {
+            Int ii = cols[Cii];
             %if order == 'F':
-                for (SIZE_T Rkk=Rk; Rkk<Rkmax2; Rkk++) {
-                    SIZE_T kk = rows[Rkk];
-                    L[(Cii-Ci)*kratio*thresh1d+(Rkk-Rk)] = X[ii*n+kk];
+                for (Py_ssize_t Rkk=Rk; Rkk<Rkmax2; Rkk++) {
+                    Int kk = rows[Rkk];
+                    L[(Py_ssize_t) (Cii-Ci) * kratio * thresh1d + (Rkk-Rk)] = X[(Py_ssize_t) ii * n + kk];
                 }
             % else:
-                for (SIZE_T Rkk=Rk; Rkk<Rkmax2; Rkk++) {
-                    SIZE_T kk = rows[Rkk];
-                    L[(Cii-Ci)*kratio*thresh1d+(Rkk-Rk)] = X[kk*m+ii];
+                for (Py_ssize_t Rkk=Rk; Rkk<Rkmax2; Rkk++) {
+                    Int kk = rows[Rkk];
+                    L[(Py_ssize_t) (Cii-Ci) * kratio * thresh1d + (Rkk-Rk)] = X[(Py_ssize_t) kk * m + ii];
                 }
             % endif
         }
         dense_base${kparallel}(R, L, d, out, out_m, Ci, Cimax2, Cj, Cjmax2, Rk, Rkmax2, innerblock, kratio*thresh1d);
     }
 }
 </%def>
 
 
 <%def name="dense_sandwich_tmpl(order)">
-template <typename F>
-void _dense${order}_sandwich(int* rows, int* cols, F* X, F* d, F* out,
-        int in_n, int out_m, int m, int n, int thresh1d, int kratio, int innerblock) 
+template <typename Int, typename F>
+void _dense${order}_sandwich(Int* rows, Int* cols, F* X, F* d, F* out,
+        Int in_n, Int out_m, Int m, Int n, Int thresh1d, Int kratio, Int innerblock) 
 {
     constexpr std::size_t simd_size = xsimd::simd_type<F>::size;
     constexpr auto alignment = simd_size * sizeof(F);
 
     bool kparallel = (in_n / (kratio*thresh1d)) > (out_m / thresh1d);
-    size_t Rsize = thresh1d*thresh1d*kratio*kratio;
+    Py_ssize_t Rsize = thresh1d*thresh1d*kratio*kratio;
     if (kparallel) {
         Rsize *= omp_get_max_threads();
     }
 
     auto Rglobal = make_aligned_unique<F>(Rsize, alignment);
     auto Lglobal = make_aligned_unique<F>(
         omp_get_max_threads() * thresh1d * thresh1d * kratio, 
         alignment
     );
-    for (SIZE_T Cj = 0; Cj < out_m; Cj+=kratio*thresh1d) {
-        SIZE_T Cjmax2 = Cj + kratio*thresh1d; 
+    for (Py_ssize_t Cj = 0; Cj < out_m; Cj+=kratio*thresh1d) {
+        Py_ssize_t Cjmax2 = Cj + kratio*thresh1d; 
         if (Cjmax2 > out_m) {
             Cjmax2 = out_m; 
         }
         if (kparallel) {
             ${k_loop(True, order)}
         } else {
             ${k_loop(False, order)}
         }
     }
 
     #pragma omp parallel for if(out_m > 100)
-    for (SIZE_T Ci = 0; Ci < out_m; Ci++) {
-        for (SIZE_T Cj = 0; Cj <= Ci; Cj++) {
+    for (Py_ssize_t Ci = 0; Ci < out_m; Ci++) {
+        for (Py_ssize_t Cj = 0; Cj <= Ci; Cj++) {
             out[Cj * out_m + Ci] = out[Ci * out_m + Cj];
         }
     }
 }
 </%def>
 
 ${dense_sandwich_tmpl('C')}
 ${dense_sandwich_tmpl('F')}
 
 
 <%def name="dense_rmatvec_tmpl(order)">
-template <typename F>
-void _dense${order}_rmatvec(int* rows, int* cols, F* X, F* v, F* out,
-        int n_rows, int n_cols, int m, int n) 
+template <typename Int, typename F>
+void _dense${order}_rmatvec(Int* rows, Int* cols, F* X, F* v, F* out,
+        Int n_rows, Int n_cols, Int m, Int n) 
 {
     constexpr std::size_t simd_size = xsimd::simd_type<F>::size;
     constexpr std::size_t alignment = simd_size * sizeof(F);
 
     auto outglobal = make_aligned_unique<F>(omp_get_max_threads()*n_cols, alignment);
 
     constexpr int rowblocksize = 256;
     constexpr int colblocksize = 4;
 
     #pragma omp parallel for
-    for (SIZE_T Ci = 0; Ci < n_rows; Ci += rowblocksize) {
-        int Cimax = Ci + rowblocksize;
+    for (Py_ssize_t Ci = 0; Ci < n_rows; Ci += rowblocksize) {
+        Py_ssize_t Cimax = Ci + rowblocksize;
         if (Cimax > n_rows) {
             Cimax = n_rows;
         }
 
         F* outlocal = &outglobal.get()[omp_get_thread_num()*n_cols];
 
-        for (SIZE_T Cj = 0; Cj < n_cols; Cj += colblocksize) {
-            int Cjmax = Cj + colblocksize;
+        for (Py_ssize_t Cj = 0; Cj < n_cols; Cj += colblocksize) {
+            Py_ssize_t Cjmax = Cj + colblocksize;
             if (Cjmax > n_cols) {
                 Cjmax = n_cols;
             }
 
             % if order == 'F':
-                for (SIZE_T Cjj = Cj; Cjj < Cjmax; Cjj++) {
-                    int j = cols[Cjj];
+                for (Py_ssize_t Cjj = Cj; Cjj < Cjmax; Cjj++) {
+                    Int j = cols[Cjj];
                     F out_entry = 0.0;
-                    for (SIZE_T Cii = Ci; Cii < Cimax; Cii++) {
-                        int i = rows[Cii];
-                        F Xv = X[j * n + i];
+                    for (Py_ssize_t Cii = Ci; Cii < Cimax; Cii++) {
+                        Int i = rows[Cii];
+                        F Xv = X[(Py_ssize_t) j * n + i];
                         F vv = v[i];
                         out_entry += Xv * vv;
                     }
 
                     outlocal[Cjj] = out_entry;
                 }
             % else:
-                for (SIZE_T Cjj = Cj; Cjj < Cjmax; Cjj++) {
+                for (Py_ssize_t Cjj = Cj; Cjj < Cjmax; Cjj++) {
                     outlocal[Cjj] = 0.0;
                 }
-                for (SIZE_T Cii = Ci; Cii < Cimax; Cii++) {
-                    int i = rows[Cii];
+                for (Py_ssize_t Cii = Ci; Cii < Cimax; Cii++) {
+                    Int i = rows[Cii];
                     F vv = v[i];
-                    for (SIZE_T Cjj = Cj; Cjj < Cjmax; Cjj++) {
-                        int j = cols[Cjj];
-                        F Xv = X[i * m + j];
+                    for (Py_ssize_t Cjj = Cj; Cjj < Cjmax; Cjj++) {
+                        Int j = cols[Cjj];
+                        F Xv = X[(Py_ssize_t) i * m + j];
                         outlocal[Cjj] += Xv * vv;
                     }
                 }
             % endif
         }
 
-        for (SIZE_T Cj = 0; Cj < n_cols; Cj++) {
+        for (Py_ssize_t Cj = 0; Cj < n_cols; Cj++) {
             #pragma omp atomic
             out[Cj] += outlocal[Cj];
         }
     }
 }
 </%def>
 ${dense_rmatvec_tmpl('C')}
 ${dense_rmatvec_tmpl('F')}
 
 <%def name="dense_matvec_tmpl(order)">
-template <typename F>
-void _dense${order}_matvec(int* rows, int* cols, F* X, F* v, F* out,
-        int n_rows, int n_cols, int m, int n) 
+template <typename Int, typename F>
+void _dense${order}_matvec(Int* rows, Int* cols, F* X, F* v, F* out,
+        Int n_rows, Int n_cols, Int m, Int n) 
 {
     constexpr int rowblocksize = 256;
 
     #pragma omp parallel for
-    for (SIZE_T Ci = 0; Ci < n_rows; Ci += rowblocksize) {
-        int Cimax = Ci + rowblocksize;
+    for (Py_ssize_t Ci = 0; Ci < n_rows; Ci += rowblocksize) {
+        Int Cimax = Ci + rowblocksize;
         if (Cimax > n_rows) {
             Cimax = n_rows;
         }
-        for (SIZE_T Cii = Ci; Cii < Cimax; Cii++) {
+        for (Py_ssize_t Cii = Ci; Cii < Cimax; Cii++) {
             F out_entry = 0.0;
-            int i = rows[Cii];
-            for (SIZE_T Cjj = 0; Cjj < n_cols; Cjj++) {
-                int j = cols[Cjj];
+            Int i = rows[Cii];
+            for (Py_ssize_t Cjj = 0; Cjj < n_cols; Cjj++) {
+                Int j = cols[Cjj];
                 F vv = v[j];
                 % if order == 'F':
-                    F Xv = X[j * n + i];
+                    F Xv = X[(Py_ssize_t) j * n + i];
                 % else:
-                    F Xv = X[i * m + j];
+                    F Xv = X[(Py_ssize_t) i * m + j];
                 % endif
                 out_entry += Xv * vv;
             }
             out[Cii] = out_entry;
         }
     }
 }
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/sparse.cpp` & `tabmat-3.1.8/src/tabmat/ext/sparse.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,33 +1,33 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
             "src/tabmat/ext/sparse_helpers.cpp"
         ],
         "extra_compile_args": [
             "-fopenmp",
             "-O3",
             "-ffast-math",
             "--std=c++17",
             "-DJEMALLOC_INSTALL_SUFFIX="
         ],
         "extra_link_args": [
             "-fopenmp"
         ],
         "include_dirs": [
             "src/tabmat/ext",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include"
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "libraries": [
             "jemalloc"
         ],
         "name": "tabmat.ext.sparse",
         "sources": [
@@ -43,17 +43,17 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
-#define CYTHON_FUTURE_DIVISION 0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
+#define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
@@ -112,16 +112,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -237,15 +241,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -276,15 +280,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -1145,204 +1149,204 @@
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
 
-/* "tabmat/ext/sparse.pyx":10
+/* "tabmat/ext/sparse.pyx":8
  * from libc.stdint cimport int64_t
  * 
  * ctypedef np.uint8_t uint8             # <<<<<<<<<<<<<<
  * 
  * ctypedef fused win_integral:
  */
 typedef __pyx_t_5numpy_uint8_t __pyx_t_6tabmat_3ext_6sparse_uint8;
@@ -1373,42 +1377,42 @@
 
 /*--- Type declarations ---*/
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
@@ -2121,22 +2125,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* CythonFunctionShared.proto */
 #define __Pyx_CyFunction_USED 1
@@ -2822,25 +2834,25 @@
 static PyObject *__pyx_n_s_Aindicesp;
 static PyObject *__pyx_n_s_Aindptr;
 static PyObject *__pyx_n_s_B;
 static PyObject *__pyx_n_s_B_cols;
 static PyObject *__pyx_n_s_B_colsp;
 static PyObject *__pyx_n_s_Bp;
 static PyObject *__pyx_kp_s_Buffer_view_does_not_expose_stri;
-static PyObject *__pyx_n_s_C_CONTIGUOUS;
+static PyObject *__pyx_n_u_C_CONTIGUOUS;
 static PyObject *__pyx_kp_s_Can_only_create_a_buffer_that_is;
 static PyObject *__pyx_kp_s_Cannot_assign_to_read_only_memor;
 static PyObject *__pyx_kp_s_Cannot_create_writable_memory_vi;
 static PyObject *__pyx_kp_s_Cannot_index_with_type_s;
 static PyObject *__pyx_n_s_Ci;
 static PyObject *__pyx_n_s_Cj;
 static PyObject *__pyx_n_s_Ellipsis;
 static PyObject *__pyx_kp_s_Empty_shape_tuple_for_cython_arr;
 static PyObject *__pyx_kp_s_Expected_at_least_d_argument_s_g;
-static PyObject *__pyx_n_s_F_CONTIGUOUS;
+static PyObject *__pyx_n_u_F_CONTIGUOUS;
 static PyObject *__pyx_kp_s_Function_call_with_ambiguous_arg;
 static PyObject *__pyx_n_s_ImportError;
 static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
 static PyObject *__pyx_n_s_IndexError;
 static PyObject *__pyx_kp_s_Indirect_dimensions_not_supporte;
 static PyObject *__pyx_kp_s_Invalid_mode_expected_c_or_fortr;
 static PyObject *__pyx_kp_s_Invalid_shape_in_axis_d_d;
@@ -2948,16 +2960,16 @@
 static PyObject *__pyx_n_s_ncols;
 static PyObject *__pyx_n_s_ndim;
 static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
 static PyObject *__pyx_n_s_np;
 static PyObject *__pyx_n_s_nr;
 static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_s_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_s_numpy_core_umath_failed_to_impor;
+static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
+static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_s_out;
 static PyObject *__pyx_n_s_out_view;
 static PyObject *__pyx_n_s_outp;
 static PyObject *__pyx_n_s_pack;
 static PyObject *__pyx_n_s_pickle;
 static PyObject *__pyx_n_s_pyx_PickleError;
@@ -3168,17 +3180,17 @@
 static PyObject *__pyx_codeobj__33;
 static PyObject *__pyx_codeobj__35;
 static PyObject *__pyx_codeobj__37;
 static PyObject *__pyx_codeobj__39;
 static PyObject *__pyx_codeobj__46;
 /* Late includes */
 
-/* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+/* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6tabmat_3ext_6sparse_1sparse_sandwich(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -3217,31 +3229,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -3250,15 +3262,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_sparse_sandwich(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -3308,15 +3320,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("sparse_sandwich", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -3326,41 +3338,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_t_2 = ((2 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 2);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -3369,85 +3381,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_5);
     __Pyx_GIVEREF(__pyx_int_5);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_5);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -3461,62 +3473,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -3535,15 +3547,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3557,35 +3569,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_t_3 = ((3 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 3);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -3594,85 +3606,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_5);
     __Pyx_GIVEREF(__pyx_int_5);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_5);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -3686,118 +3698,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 18, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -3818,15 +3830,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3840,15 +3852,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3862,15 +3874,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3884,100 +3896,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 18, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 18, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 14, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -3985,43 +3997,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 18, __pyx_L1_error)
+    __PYX_ERR(0, 14, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 18, __pyx_L1_error)
+      __PYX_ERR(0, 14, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -4089,56 +4101,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_14sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -4203,372 +4215,372 @@
   int64_t __pyx_t_24;
   int __pyx_t_25;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_4 = (*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_16 = __pyx_t_14;
   for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
     __pyx_v_Cj = __pyx_t_17;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_4 = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -4606,191 +4618,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((float)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_18 = (*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_19 = __pyx_t_18;
                             for (__pyx_t_20 = (*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
                               __pyx_v_A_idx = __pyx_t_20;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_21 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_21) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_22 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_23 = __pyx_t_22;
                               for (__pyx_t_24 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
                                 __pyx_v_AT_idx = __pyx_t_24;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -4808,15 +4820,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -4827,24 +4839,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_25 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -4854,68 +4866,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_25 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_25, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_25, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -4990,56 +5002,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_16sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -5102,372 +5114,372 @@
   int __pyx_t_22;
   int64_t __pyx_t_23;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_15 = __pyx_t_14;
   for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
     __pyx_v_Cj = __pyx_t_16;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -5505,191 +5517,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((float)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_17 = (*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_18 = __pyx_t_17;
                             for (__pyx_t_19 = (*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
                               __pyx_v_A_idx = __pyx_t_19;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_20 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_20) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_21 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_22 = __pyx_t_21;
                               for (__pyx_t_23 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_23 < __pyx_t_22; __pyx_t_23+=1) {
                                 __pyx_v_AT_idx = __pyx_t_23;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_20 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_20) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_20 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_20) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -5707,15 +5719,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -5726,24 +5738,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_17 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -5753,68 +5765,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_17 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_17); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_17); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_17, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_17, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -5888,56 +5900,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_18sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -6002,372 +6014,372 @@
   int64_t __pyx_t_24;
   int __pyx_t_25;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_4 = (*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_16 = __pyx_t_14;
   for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
     __pyx_v_Cj = __pyx_t_17;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_4 = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -6405,191 +6417,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((float)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_18 = (*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_19 = __pyx_t_18;
                             for (__pyx_t_20 = (*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
                               __pyx_v_A_idx = __pyx_t_20;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_21 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_21) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_22 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_23 = __pyx_t_22;
                               for (__pyx_t_24 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
                                 __pyx_v_AT_idx = __pyx_t_24;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -6607,15 +6619,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -6626,24 +6638,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_25 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -6653,68 +6665,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_25 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_25, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_25, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6789,56 +6801,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_20sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -6903,372 +6915,372 @@
   int64_t __pyx_t_24;
   int __pyx_t_25;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_15 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_15 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_17 = __pyx_t_14;
   for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
     __pyx_v_Cj = __pyx_t_18;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_15 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_15 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -7306,191 +7318,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((float)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_15 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_19 = __pyx_t_15;
                             for (__pyx_t_20 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
                               __pyx_v_A_idx = __pyx_t_20;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_21 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_21) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_22 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_23 = __pyx_t_22;
                               for (__pyx_t_24 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
                                 __pyx_v_AT_idx = __pyx_t_24;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -7508,15 +7520,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -7527,24 +7539,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_25 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -7554,68 +7566,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_25 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_25, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_25, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7690,56 +7702,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_22sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -7804,372 +7816,372 @@
   int64_t __pyx_t_24;
   int __pyx_t_25;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_4 = (*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_16 = __pyx_t_14;
   for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
     __pyx_v_Cj = __pyx_t_17;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_4 = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -8207,191 +8219,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((double)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_18 = (*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_19 = __pyx_t_18;
                             for (__pyx_t_20 = (*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
                               __pyx_v_A_idx = __pyx_t_20;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_21 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_21) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_22 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_23 = __pyx_t_22;
                               for (__pyx_t_24 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
                                 __pyx_v_AT_idx = __pyx_t_24;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -8409,15 +8421,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -8428,24 +8440,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_25 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -8455,68 +8467,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_25 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_25, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_25, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -8591,56 +8603,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_24sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -8703,372 +8715,372 @@
   int __pyx_t_22;
   int64_t __pyx_t_23;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_15 = __pyx_t_14;
   for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
     __pyx_v_Cj = __pyx_t_16;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_4 = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -9106,191 +9118,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((double)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_17 = (*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_18 = __pyx_t_17;
                             for (__pyx_t_19 = (*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
                               __pyx_v_A_idx = __pyx_t_19;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_20 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_20) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_21 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_22 = __pyx_t_21;
                               for (__pyx_t_23 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_23 < __pyx_t_22; __pyx_t_23+=1) {
                                 __pyx_v_AT_idx = __pyx_t_23;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_20 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_20) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_20 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_20) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -9308,15 +9320,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -9327,24 +9339,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_17 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -9354,68 +9366,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_17 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_17, 2+__pyx_t_17); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_17); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_17); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_17, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_17, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -9489,56 +9501,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_26sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -9603,372 +9615,372 @@
   int64_t __pyx_t_24;
   int __pyx_t_25;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_4 = (*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_16 = __pyx_t_14;
   for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
     __pyx_v_Cj = __pyx_t_17;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_4 = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -10006,191 +10018,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((double)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_18 = (*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_19 = __pyx_t_18;
                             for (__pyx_t_20 = (*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
                               __pyx_v_A_idx = __pyx_t_20;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_21 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_21) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_22 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_23 = __pyx_t_22;
                               for (__pyx_t_24 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
                                 __pyx_v_AT_idx = __pyx_t_24;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -10208,15 +10220,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -10227,24 +10239,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_25 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -10254,68 +10266,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_25 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_25, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_25, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10390,56 +10402,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_AT)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 1); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 2); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 3); __PYX_ERR(0, 14, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 18, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, 4); __PYX_ERR(0, 14, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 18, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sparse_sandwich") < 0)) __PYX_ERR(0, 14, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
     __pyx_v_A = values[0];
     __pyx_v_AT = values[1];
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 18, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 14, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 18, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sparse_sandwich", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 14, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.sparse_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_28sparse_sandwich(__pyx_self, __pyx_v_A, __pyx_v_AT, __pyx_v_d, __pyx_v_rows, __pyx_v_cols);
 
@@ -10504,372 +10516,372 @@
   int64_t __pyx_t_24;
   int __pyx_t_25;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3sparse_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":23
+  /* "tabmat/ext/sparse.pyx":19
  *     # Computes AT @ diag(d) @ A
  * 
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":24
+  /* "tabmat/ext/sparse.pyx":20
  * 
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 20, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":25
+  /* "tabmat/ext/sparse.pyx":21
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:] ATdata = AT.data
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 21, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":27
+  /* "tabmat/ext/sparse.pyx":23
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  *     cdef floating[:] ATdata = AT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 27, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":28
+  /* "tabmat/ext/sparse.pyx":24
  * 
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 28, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 24, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":29
+  /* "tabmat/ext/sparse.pyx":25
  *     cdef floating[:] ATdata = AT.data
  *     cdef win_integral[:] ATindices = AT.indices
  *     cdef win_integral[:] ATindptr = AT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Adatap = &Adata[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_AT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ATindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":31
+  /* "tabmat/ext/sparse.pyx":27
  *     cdef win_integral[:] ATindptr = AT.indptr
  * 
  *     cdef floating* Adatap = &Adata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Adatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_4 * __pyx_v_Adata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":32
+  /* "tabmat/ext/sparse.pyx":28
  * 
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]             # <<<<<<<<<<<<<<
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_Aindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_4 * __pyx_v_Aindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":33
+  /* "tabmat/ext/sparse.pyx":29
  *     cdef floating* Adatap = &Adata[0]
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_ATdata.data + __pyx_t_4 * __pyx_v_ATdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":34
+  /* "tabmat/ext/sparse.pyx":30
  *     cdef win_integral* Aindicesp = &Aindices[0]
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_ATindices.data + __pyx_t_4 * __pyx_v_ATindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":35
+  /* "tabmat/ext/sparse.pyx":31
  *     cdef floating* ATdatap = &ATdata[0]
  *     cdef win_integral* ATindicesp = &ATindices[0]
  *     cdef win_integral* ATindptrp = &ATindptr[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* dp = &d[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_ATindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_ATindptr.data + __pyx_t_4 * __pyx_v_ATindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":37
+  /* "tabmat/ext/sparse.pyx":33
  *     cdef win_integral* ATindptrp = &ATindptr[0]
  * 
  *     cdef floating* dp = &d[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t m = cols.shape[0]
  */
   __pyx_t_4 = 0;
   __pyx_v_dp = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_4 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":39
+  /* "tabmat/ext/sparse.pyx":35
  *     cdef floating* dp = &d[0]
  * 
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":40
+  /* "tabmat/ext/sparse.pyx":36
  * 
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":41
+  /* "tabmat/ext/sparse.pyx":37
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 37, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":42
+  /* "tabmat/ext/sparse.pyx":38
  *     out = np.zeros((m, m), dtype=A.dtype)
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t AT_idx, A_idx, Ci, i, Cj, j, k
  */
   __pyx_t_4 = 0;
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_4 * __pyx_v_out_view.strides[0]) ) + __pyx_t_9 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":47
+  /* "tabmat/ext/sparse.pyx":43
  *     cdef floating A_val, AT_val
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t((__pyx_v_d.shape[0])); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_row_included = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":48
+  /* "tabmat/ext/sparse.pyx":44
  * 
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_12 = (__pyx_v_rows.shape[0]);
   __pyx_t_13 = __pyx_t_12;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_Ci = __pyx_t_14;
 
-    /* "tabmat/ext/sparse.pyx":49
+    /* "tabmat/ext/sparse.pyx":45
  *     cdef uint8[:] row_included = np.zeros(d.shape[0], dtype=np.uint8)
  *     for Ci in range(rows.shape[0]):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  */
     __pyx_t_9 = __pyx_v_Ci;
     __pyx_t_15 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_15 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":51
+  /* "tabmat/ext/sparse.pyx":47
  *         row_included[rows[Ci]] = True
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_full); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_10, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 51, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 47, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_col_map = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":52
+  /* "tabmat/ext/sparse.pyx":48
  * 
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):             # <<<<<<<<<<<<<<
  *         col_map[cols[Cj]] = Cj
  * 
  */
   __pyx_t_14 = __pyx_v_m;
   __pyx_t_17 = __pyx_t_14;
   for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
     __pyx_v_Cj = __pyx_t_18;
 
-    /* "tabmat/ext/sparse.pyx":53
+    /* "tabmat/ext/sparse.pyx":49
  *     cdef int[:] col_map = np.full(A.shape[1], -1, dtype=np.int32)
  *     for Cj in range(m):
  *         col_map[cols[Cj]] = Cj             # <<<<<<<<<<<<<<
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  */
     __pyx_t_9 = __pyx_v_Cj;
     __pyx_t_15 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
     *((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_15 * __pyx_v_col_map.strides[0]) )) = __pyx_v_Cj;
   }
 
-  /* "tabmat/ext/sparse.pyx":56
+  /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
   {
@@ -10907,191 +10919,191 @@
                             __pyx_v_A_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_A_val = ((double)__PYX_NAN());
                             __pyx_v_Ci = ((int64_t)0xbad0bad0);
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_k = ((int64_t)0xbad0bad0);
 
-                            /* "tabmat/ext/sparse.pyx":57
+                            /* "tabmat/ext/sparse.pyx":53
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  */
                             __pyx_t_9 = __pyx_v_Cj;
                             __pyx_v_j = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_9 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":58
+                            /* "tabmat/ext/sparse.pyx":54
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):             # <<<<<<<<<<<<<<
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  */
                             __pyx_t_9 = (__pyx_v_j + 1);
                             __pyx_t_15 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) )));
                             __pyx_t_9 = __pyx_v_j;
                             __pyx_t_19 = __pyx_t_15;
                             for (__pyx_t_20 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_9 * __pyx_v_Aindptr.strides[0]) ))); __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
                               __pyx_v_A_idx = __pyx_t_20;
 
-                              /* "tabmat/ext/sparse.pyx":59
+                              /* "tabmat/ext/sparse.pyx":55
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[k]:
  *                 continue
  */
                               __pyx_v_k = (__pyx_v_Aindicesp[__pyx_v_A_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":60
+                              /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               __pyx_t_4 = __pyx_v_k;
                               __pyx_t_21 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_4 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_21) {
 
-                                /* "tabmat/ext/sparse.pyx":61
+                                /* "tabmat/ext/sparse.pyx":57
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  */
                                 goto __pyx_L14_continue;
 
-                                /* "tabmat/ext/sparse.pyx":60
+                                /* "tabmat/ext/sparse.pyx":56
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  *             k = Aindicesp[A_idx]
  *             if not row_included[k]:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":63
+                              /* "tabmat/ext/sparse.pyx":59
  *                 continue
  * 
  *             A_val = Adatap[A_idx] * dp[k]             # <<<<<<<<<<<<<<
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  */
                               __pyx_v_A_val = ((__pyx_v_Adatap[__pyx_v_A_idx]) * (__pyx_v_dp[__pyx_v_k]));
 
-                              /* "tabmat/ext/sparse.pyx":64
+                              /* "tabmat/ext/sparse.pyx":60
  * 
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0             # <<<<<<<<<<<<<<
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  */
                               __pyx_v_Ci = 0;
 
-                              /* "tabmat/ext/sparse.pyx":65
+                              /* "tabmat/ext/sparse.pyx":61
  *             A_val = Adatap[A_idx] * dp[k]
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):             # <<<<<<<<<<<<<<
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  */
                               __pyx_t_22 = (__pyx_v_ATindptrp[(__pyx_v_k + 1)]);
                               __pyx_t_23 = __pyx_t_22;
                               for (__pyx_t_24 = (__pyx_v_ATindptrp[__pyx_v_k]); __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
                                 __pyx_v_AT_idx = __pyx_t_24;
 
-                                /* "tabmat/ext/sparse.pyx":66
+                                /* "tabmat/ext/sparse.pyx":62
  *             Ci = 0
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]             # <<<<<<<<<<<<<<
  *                 if i > j:
  *                     break
  */
                                 __pyx_v_i = (__pyx_v_ATindicesp[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":67
+                                /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_i > __pyx_v_j) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":68
+                                  /* "tabmat/ext/sparse.pyx":64
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:
  *                     break             # <<<<<<<<<<<<<<
  * 
  *                 Ci = col_map[i]
  */
                                   goto __pyx_L18_break;
 
-                                  /* "tabmat/ext/sparse.pyx":67
+                                  /* "tabmat/ext/sparse.pyx":63
  *             for AT_idx in range(ATindptrp[k], ATindptrp[k+1]):
  *                 i = ATindicesp[AT_idx]
  *                 if i > j:             # <<<<<<<<<<<<<<
  *                     break
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":70
+                                /* "tabmat/ext/sparse.pyx":66
  *                     break
  * 
  *                 Ci = col_map[i]             # <<<<<<<<<<<<<<
  *                 if Ci == -1:
  *                     continue
  */
                                 __pyx_t_4 = __pyx_v_i;
                                 __pyx_v_Ci = (*((int *) ( /* dim=0 */ (__pyx_v_col_map.data + __pyx_t_4 * __pyx_v_col_map.strides[0]) )));
 
-                                /* "tabmat/ext/sparse.pyx":71
+                                /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 __pyx_t_21 = ((__pyx_v_Ci == -1L) != 0);
                                 if (__pyx_t_21) {
 
-                                  /* "tabmat/ext/sparse.pyx":72
+                                  /* "tabmat/ext/sparse.pyx":68
  *                 Ci = col_map[i]
  *                 if Ci == -1:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 AT_val = ATdatap[AT_idx]
  */
                                   goto __pyx_L17_continue;
 
-                                  /* "tabmat/ext/sparse.pyx":71
+                                  /* "tabmat/ext/sparse.pyx":67
  * 
  *                 Ci = col_map[i]
  *                 if Ci == -1:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
                                 }
 
-                                /* "tabmat/ext/sparse.pyx":74
+                                /* "tabmat/ext/sparse.pyx":70
  *                     continue
  * 
  *                 AT_val = ATdatap[AT_idx]             # <<<<<<<<<<<<<<
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  */
                                 __pyx_v_AT_val = (__pyx_v_ATdatap[__pyx_v_AT_idx]);
 
-                                /* "tabmat/ext/sparse.pyx":75
+                                /* "tabmat/ext/sparse.pyx":71
  * 
  *                 AT_val = ATdatap[AT_idx]
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val             # <<<<<<<<<<<<<<
  * 
  *     out += np.tril(out, -1).T
  */
                                 (__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) = ((__pyx_v_outp[((__pyx_v_Cj * __pyx_v_m) + __pyx_v_Ci)]) + (__pyx_v_AT_val * __pyx_v_A_val));
@@ -11109,15 +11121,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":56
+      /* "tabmat/ext/sparse.pyx":52
  * 
  *     #TODO: see what happens when we swap to having k as the outer loop here?
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for A_idx in range(Aindptr[j], Aindptr[j+1]):
  */
       /*finally:*/ {
@@ -11128,24 +11140,24 @@
           #endif
           goto __pyx_L9;
         }
         __pyx_L9:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":77
+  /* "tabmat/ext/sparse.pyx":73
  *                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
  * 
  *     out += np.tril(out, -1).T             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_tril); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   __pyx_t_25 = 0;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_10);
     if (likely(__pyx_t_6)) {
@@ -11155,68 +11167,68 @@
       __Pyx_DECREF_SET(__pyx_t_10, function);
       __pyx_t_25 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
     PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_v_out, __pyx_int_neg_1};
-    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_25, 2+__pyx_t_25); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GOTREF(__pyx_t_5);
   } else
   #endif
   {
-    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2+__pyx_t_25); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (__pyx_t_6) {
       __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6); __pyx_t_6 = NULL;
     }
     __Pyx_INCREF(__pyx_v_out);
     __Pyx_GIVEREF(__pyx_v_out);
     PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_25, __pyx_v_out);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_25, __pyx_int_neg_1);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_T); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_out, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 73, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "tabmat/ext/sparse.pyx":78
+  /* "tabmat/ext/sparse.pyx":74
  * 
  *     out += np.tril(out, -1).T
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -11247,17 +11259,17 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+/* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6tabmat_3ext_6sparse_3csr_matvec_unrestricted(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -11296,31 +11308,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -11329,15 +11341,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_2csr_matvec_unrestricted(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -11387,15 +11399,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -11405,41 +11417,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -11448,85 +11460,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -11540,62 +11552,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -11614,15 +11626,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -11636,35 +11648,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
   __pyx_t_3 = ((3 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 3);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -11673,85 +11685,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_X_indices, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_X_indices, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_X_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_X_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -11765,118 +11777,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -11897,15 +11909,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -11919,15 +11931,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -11941,15 +11953,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -11963,100 +11975,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 82, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 82, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 76, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -12064,43 +12076,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 76, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 82, __pyx_L1_error)
+    __PYX_ERR(0, 76, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 82, __pyx_L1_error)
+      __PYX_ERR(0, 76, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -12165,48 +12177,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_32csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -12249,184 +12261,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -12460,55 +12472,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -12522,15 +12534,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -12541,29 +12553,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12625,48 +12637,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_34csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -12709,184 +12721,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -12920,55 +12932,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -12982,15 +12994,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -13001,29 +13013,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -13085,48 +13097,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_36csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -13169,184 +13181,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -13380,55 +13392,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -13442,15 +13454,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -13461,29 +13473,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -13545,48 +13557,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_38csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -13629,184 +13641,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -13840,55 +13852,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -13902,15 +13914,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -13921,29 +13933,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14005,48 +14017,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_40csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -14089,184 +14101,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -14300,55 +14312,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -14362,15 +14374,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -14381,29 +14393,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14465,48 +14477,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_42csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -14549,184 +14561,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -14760,55 +14772,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -14822,15 +14834,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -14841,29 +14853,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14925,48 +14937,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_44csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -15009,184 +15021,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -15220,55 +15232,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -15282,15 +15294,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -15301,29 +15313,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15385,48 +15397,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 82, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec_unrestricted") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_X_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_X_indices.memview)) __PYX_ERR(0, 76, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_46csr_matvec_unrestricted(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_out, __pyx_v_X_indices);
 
@@ -15469,184 +15481,184 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3csr_matvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":83
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":77
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 77, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":84
+  /* "tabmat/ext/sparse.pyx":78
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 78, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":85
+  /* "tabmat/ext/sparse.pyx":79
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     if out is None:
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":87
+  /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_4 = (__pyx_v_out == Py_None);
   __pyx_t_5 = (__pyx_t_4 != 0);
   if (__pyx_t_5) {
 
-    /* "tabmat/ext/sparse.pyx":88
+    /* "tabmat/ext/sparse.pyx":82
  * 
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 82, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "tabmat/ext/sparse.pyx":87
+    /* "tabmat/ext/sparse.pyx":81
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":89
+  /* "tabmat/ext/sparse.pyx":83
  *     if out is None:
  *         out = np.zeros(X.shape[0], dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 83, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":91
+  /* "tabmat/ext/sparse.pyx":85
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_9 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":92
+  /* "tabmat/ext/sparse.pyx":86
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_9 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":93
+  /* "tabmat/ext/sparse.pyx":87
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_9 = 0;
   __pyx_v_Xindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_9 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":94
+  /* "tabmat/ext/sparse.pyx":88
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, X_idx, j
  */
   __pyx_t_9 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_9 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":97
+  /* "tabmat/ext/sparse.pyx":91
  * 
  *     cdef int64_t i, X_idx, j
  *     cdef int64_t n = out.shape[0]             # <<<<<<<<<<<<<<
  *     cdef floating Xval, vval
  * 
  */
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_8, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_7); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_n = __pyx_t_10;
 
-  /* "tabmat/ext/sparse.pyx":100
+  /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
   {
@@ -15680,55 +15692,55 @@
                             __pyx_v_i = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":101
+                            /* "tabmat/ext/sparse.pyx":95
  * 
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_X_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":102
+                              /* "tabmat/ext/sparse.pyx":96
  *     for i in prange(n, nogil=True):
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":103
+                              /* "tabmat/ext/sparse.pyx":97
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":104
+                              /* "tabmat/ext/sparse.pyx":98
  *             j = Xindicesp[X_idx]
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[i] = outp[i] + Xval * vval;
  *     return out
  */
                               __pyx_t_9 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_9 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":105
+                              /* "tabmat/ext/sparse.pyx":99
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_i]) = ((__pyx_v_outp[__pyx_v_i]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -15742,15 +15754,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":100
+      /* "tabmat/ext/sparse.pyx":94
  *     cdef floating Xval, vval
  * 
  *     for i in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
       /*finally:*/ {
@@ -15761,29 +15773,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":106
+  /* "tabmat/ext/sparse.pyx":100
  *             vval = v[j]
  *             outp[i] = outp[i] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csr_matvec(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15804,17 +15816,17 @@
   __Pyx_XDECREF(__pyx_v_out);
   __PYX_XDEC_MEMVIEW(&__pyx_v_X_indices, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+/* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6tabmat_3ext_6sparse_5csr_matvec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -15853,31 +15865,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -15886,15 +15898,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_4csr_matvec(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -15944,15 +15956,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("csr_matvec", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -15962,41 +15974,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -16005,85 +16017,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -16097,62 +16109,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -16171,15 +16183,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -16193,35 +16205,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
   __pyx_t_3 = ((2 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 2);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -16230,85 +16242,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -16322,118 +16334,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 102, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -16454,15 +16466,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -16476,15 +16488,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -16498,15 +16510,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -16520,100 +16532,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 110, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 110, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 102, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -16621,43 +16633,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 102, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 110, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 110, __pyx_L1_error)
+      __PYX_ERR(0, 102, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -16722,48 +16734,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_50csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -16813,220 +16825,220 @@
   int64_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -17061,94 +17073,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_16 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_17 = __pyx_t_16;
                             for (__pyx_t_18 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                               __pyx_v_X_idx = __pyx_t_18;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_19 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_19) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -17163,15 +17175,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -17182,29 +17194,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17270,48 +17282,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_52csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -17361,220 +17373,220 @@
   int64_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -17609,94 +17621,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_16 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_17 = __pyx_t_16;
                             for (__pyx_t_18 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                               __pyx_v_X_idx = __pyx_t_18;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_19 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_19) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -17711,15 +17723,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -17730,29 +17742,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17818,48 +17830,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_54csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -17909,220 +17921,220 @@
   int64_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -18157,94 +18169,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_16 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_17 = __pyx_t_16;
                             for (__pyx_t_18 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                               __pyx_v_X_idx = __pyx_t_18;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_19 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_19) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -18259,15 +18271,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -18278,29 +18290,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18366,48 +18378,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_56csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -18456,220 +18468,220 @@
   int64_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -18704,94 +18716,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_16 = __pyx_t_13;
                             for (__pyx_t_17 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
                               __pyx_v_X_idx = __pyx_t_17;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_18 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_18) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -18806,15 +18818,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -18825,29 +18837,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18913,48 +18925,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_58csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -19004,220 +19016,220 @@
   int64_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -19252,94 +19264,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_16 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_17 = __pyx_t_16;
                             for (__pyx_t_18 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                               __pyx_v_X_idx = __pyx_t_18;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_19 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_19) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -19354,15 +19366,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -19373,29 +19385,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -19461,48 +19473,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_60csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -19552,220 +19564,220 @@
   int64_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -19800,94 +19812,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_16 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_17 = __pyx_t_16;
                             for (__pyx_t_18 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                               __pyx_v_X_idx = __pyx_t_18;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_19 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_19) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -19902,15 +19914,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -19921,29 +19933,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20009,48 +20021,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_62csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -20100,220 +20112,220 @@
   int64_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -20348,94 +20360,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_16 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_17 = __pyx_t_16;
                             for (__pyx_t_18 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
                               __pyx_v_X_idx = __pyx_t_18;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_19 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_19) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -20450,15 +20462,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -20469,29 +20481,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -20557,48 +20569,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_X)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 1); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 2); __PYX_ERR(0, 102, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 110, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, 3); __PYX_ERR(0, 102, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_matvec") < 0)) __PYX_ERR(0, 102, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_X = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 112, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 113, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 114, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 104, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 105, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 106, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_matvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 102, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_matvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_64csr_matvec(__pyx_self, __pyx_v_X, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -20647,220 +20659,220 @@
   int64_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3csr_matvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":116
+  /* "tabmat/ext/sparse.pyx":108
  *         win_integral[:] cols
  *     ):
  *     cdef floating[:] Xdata = X.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":117
+  /* "tabmat/ext/sparse.pyx":109
  *     ):
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":118
+  /* "tabmat/ext/sparse.pyx":110
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  *     cdef win_integral[:] Xindptr = X.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Xindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":120
+  /* "tabmat/ext/sparse.pyx":112
  *     cdef win_integral[:] Xindptr = X.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":121
+  /* "tabmat/ext/sparse.pyx":113
  * 
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":122
+  /* "tabmat/ext/sparse.pyx":114
  *     cdef int64_t n = rows.shape[0]
  *     out = np.zeros(n, dtype=X.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 114, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":124
+  /* "tabmat/ext/sparse.pyx":116
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* Xdatap = &Xdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_Xdata.data + __pyx_t_7 * __pyx_v_Xdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":125
+  /* "tabmat/ext/sparse.pyx":117
  * 
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindices.data + __pyx_t_7 * __pyx_v_Xindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":126
+  /* "tabmat/ext/sparse.pyx":118
  *     cdef floating* Xdatap = &Xdata[0];
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_Xindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Xindptr.data + __pyx_t_7 * __pyx_v_Xindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":127
+  /* "tabmat/ext/sparse.pyx":119
  *     cdef win_integral* Xindicesp = &Xindices[0];
  *     cdef win_integral* Xindptrp = &Xindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, X_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":132
+  /* "tabmat/ext/sparse.pyx":124
  *     cdef floating Xval, vval
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_col_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":133
+  /* "tabmat/ext/sparse.pyx":125
  * 
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):             # <<<<<<<<<<<<<<
  *         col_included[cols[Cj]] = True
  * 
  */
   __pyx_t_10 = (__pyx_v_cols.shape[0]);
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Cj = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":134
+    /* "tabmat/ext/sparse.pyx":126
  *     cdef uint8[:] col_included = np.zeros(X.shape[1], dtype=np.uint8)
  *     for Cj in range(cols.shape[0]):
  *         col_included[cols[Cj]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Ci in prange(n, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Cj;
     __pyx_t_13 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_13 * __pyx_v_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":136
+  /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
   {
@@ -20895,94 +20907,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_X_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_Xval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":137
+                            /* "tabmat/ext/sparse.pyx":129
  * 
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]             # <<<<<<<<<<<<<<
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  */
                             __pyx_t_7 = __pyx_v_Ci;
                             __pyx_v_i = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":138
+                            /* "tabmat/ext/sparse.pyx":130
  *     for Ci in prange(n, nogil=True):
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):             # <<<<<<<<<<<<<<
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  */
                             __pyx_t_13 = (__pyx_v_Xindptrp[(__pyx_v_i + 1)]);
                             __pyx_t_16 = __pyx_t_13;
                             for (__pyx_t_17 = (__pyx_v_Xindptrp[__pyx_v_i]); __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
                               __pyx_v_X_idx = __pyx_t_17;
 
-                              /* "tabmat/ext/sparse.pyx":139
+                              /* "tabmat/ext/sparse.pyx":131
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]             # <<<<<<<<<<<<<<
  *             if not col_included[j]:
  *                 continue
  */
                               __pyx_v_j = (__pyx_v_Xindicesp[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":140
+                              /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_t_18 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_col_included.data + __pyx_t_7 * __pyx_v_col_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_18) {
 
-                                /* "tabmat/ext/sparse.pyx":141
+                                /* "tabmat/ext/sparse.pyx":133
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:
  *                 continue             # <<<<<<<<<<<<<<
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":140
+                                /* "tabmat/ext/sparse.pyx":132
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  *             j = Xindicesp[X_idx]
  *             if not col_included[j]:             # <<<<<<<<<<<<<<
  *                 continue
  *             Xval = Xdatap[X_idx]
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":142
+                              /* "tabmat/ext/sparse.pyx":134
  *             if not col_included[j]:
  *                 continue
  *             Xval = Xdatap[X_idx]             # <<<<<<<<<<<<<<
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  */
                               __pyx_v_Xval = (__pyx_v_Xdatap[__pyx_v_X_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":143
+                              /* "tabmat/ext/sparse.pyx":135
  *                 continue
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]             # <<<<<<<<<<<<<<
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_j;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":144
+                              /* "tabmat/ext/sparse.pyx":136
  *             Xval = Xdatap[X_idx]
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Ci]) = ((__pyx_v_outp[__pyx_v_Ci]) + (__pyx_v_Xval * __pyx_v_vval));
@@ -20997,15 +21009,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":136
+      /* "tabmat/ext/sparse.pyx":128
  *         col_included[cols[Cj]] = True
  * 
  *     for Ci in prange(n, nogil=True):             # <<<<<<<<<<<<<<
  *         i = rows[Ci]
  *         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
  */
       /*finally:*/ {
@@ -21016,29 +21028,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":145
+  /* "tabmat/ext/sparse.pyx":137
  *             vval = v[j]
  *             outp[Ci] = outp[Ci] + Xval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -21063,17 +21075,17 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+/* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6tabmat_3ext_6sparse_7csc_rmatvec_unrestricted(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -21112,31 +21124,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -21145,15 +21157,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_6csc_rmatvec_unrestricted(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -21203,15 +21215,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -21221,41 +21233,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -21264,85 +21276,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -21356,62 +21368,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -21430,15 +21442,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -21452,35 +21464,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
   __pyx_t_3 = ((3 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 3);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -21489,85 +21501,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_XT_indices, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_XT_indices, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_XT_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_XT_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -21581,118 +21593,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -21713,15 +21725,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -21735,15 +21747,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -21757,15 +21769,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -21779,100 +21791,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 149, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -21880,43 +21892,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 139, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 149, __pyx_L1_error)
+    __PYX_ERR(0, 139, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 149, __pyx_L1_error)
+      __PYX_ERR(0, 139, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -21981,48 +21993,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_68csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -22065,181 +22077,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -22273,55 +22285,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -22335,15 +22347,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -22354,29 +22366,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22438,48 +22450,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_70csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -22522,181 +22534,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -22730,55 +22742,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -22792,15 +22804,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -22811,29 +22823,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -22895,48 +22907,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_72csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -22979,181 +22991,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -23187,55 +23199,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -23249,15 +23261,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -23268,29 +23280,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -23352,48 +23364,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_74csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -23436,181 +23448,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -23644,55 +23656,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -23706,15 +23718,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -23725,29 +23737,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -23809,48 +23821,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_76csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -23893,181 +23905,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -24101,55 +24113,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -24163,15 +24175,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -24182,29 +24194,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -24266,48 +24278,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_78csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -24350,181 +24362,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -24558,55 +24570,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -24620,15 +24632,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -24639,29 +24651,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -24723,48 +24735,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_80csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -24807,181 +24819,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -25015,55 +25027,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -25077,15 +25089,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -25096,29 +25108,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -25180,48 +25192,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_out)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 149, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 149, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec_unrestricted") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
     __pyx_v_out = values[2];
-    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 149, __pyx_L3_error)
+    __pyx_v_XT_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_XT_indices.memview)) __PYX_ERR(0, 139, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 149, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec_unrestricted", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec_unrestricted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_82csc_rmatvec_unrestricted(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_out, __pyx_v_XT_indices);
 
@@ -25264,181 +25276,181 @@
   int64_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3csc_rmatvec_unrestricted", 0);
   __Pyx_INCREF(__pyx_v_out);
 
-  /* "tabmat/ext/sparse.pyx":150
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":140
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 140, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":151
+  /* "tabmat/ext/sparse.pyx":141
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 151, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":152
+  /* "tabmat/ext/sparse.pyx":142
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int m = XT.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":154
+  /* "tabmat/ext/sparse.pyx":144
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int m = XT.shape[1]             # <<<<<<<<<<<<<<
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":155
+  /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_t_6 = (__pyx_v_out == Py_None);
   __pyx_t_7 = (__pyx_t_6 != 0);
   if (__pyx_t_7) {
 
-    /* "tabmat/ext/sparse.pyx":156
+    /* "tabmat/ext/sparse.pyx":146
  *     cdef int m = XT.shape[1]
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 156, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 156, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 146, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_out, __pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "tabmat/ext/sparse.pyx":155
+    /* "tabmat/ext/sparse.pyx":145
  * 
  *     cdef int m = XT.shape[1]
  *     if out is None:             # <<<<<<<<<<<<<<
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":157
+  /* "tabmat/ext/sparse.pyx":147
  *     if out is None:
  *         out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 147, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":159
+  /* "tabmat/ext/sparse.pyx":149
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_10 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":160
+  /* "tabmat/ext/sparse.pyx":150
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_10 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":161
+  /* "tabmat/ext/sparse.pyx":151
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_10 = 0;
   __pyx_v_XTindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_10 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":162
+  /* "tabmat/ext/sparse.pyx":152
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t i, XT_idx, j
  */
   __pyx_t_10 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_10 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":167
+  /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
   {
@@ -25472,55 +25484,55 @@
                             __pyx_v_j = (int64_t)(0 + 1 * __pyx_t_11);
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":168
+                            /* "tabmat/ext/sparse.pyx":158
  * 
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":169
+                              /* "tabmat/ext/sparse.pyx":159
  *     for j in prange(m, nogil=True):
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":170
+                              /* "tabmat/ext/sparse.pyx":160
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":171
+                              /* "tabmat/ext/sparse.pyx":161
  *             i = XTindicesp[XT_idx]
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + XTval * vval;
  *     return out
  */
                               __pyx_t_10 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_10 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":172
+                              /* "tabmat/ext/sparse.pyx":162
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -25534,15 +25546,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":167
+      /* "tabmat/ext/sparse.pyx":157
  *     cdef floating XTval, vval
  * 
  *     for j in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
       /*finally:*/ {
@@ -25553,29 +25565,29 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":173
+  /* "tabmat/ext/sparse.pyx":163
  *             vval = v[i]
  *             outp[j] = outp[j] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -25596,17 +25608,17 @@
   __Pyx_XDECREF(__pyx_v_out);
   __PYX_XDEC_MEMVIEW(&__pyx_v_XT_indices, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+/* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6tabmat_3ext_6sparse_9csc_rmatvec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -25645,31 +25657,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -25678,15 +25690,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_8csc_rmatvec(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -25736,15 +25748,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("csc_rmatvec", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -25754,41 +25766,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
   __pyx_t_2 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -25797,85 +25809,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_v, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_v); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -25889,62 +25901,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -25963,15 +25975,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -25985,35 +25997,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
   __pyx_t_3 = ((2 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 2);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -26022,85 +26034,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_4);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -26114,118 +26126,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -26246,15 +26258,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -26268,15 +26280,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -26290,15 +26302,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -26312,100 +26324,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 177, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 177, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 165, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -26413,43 +26425,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 165, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 177, __pyx_L1_error)
+    __PYX_ERR(0, 165, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 177, __pyx_L1_error)
+      __PYX_ERR(0, 165, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -26514,48 +26526,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_86csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -26604,229 +26616,229 @@
   int64_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -26861,94 +26873,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_14 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_15 = __pyx_t_14;
                             for (__pyx_t_16 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
                               __pyx_v_XT_idx = __pyx_t_16;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_17 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_17) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -26963,15 +26975,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -26982,29 +26994,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -27070,48 +27082,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_88csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -27160,229 +27172,229 @@
   int64_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -27417,94 +27429,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_14 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_15 = __pyx_t_14;
                             for (__pyx_t_16 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
                               __pyx_v_XT_idx = __pyx_t_16;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_17 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_17) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -27519,15 +27531,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -27538,29 +27550,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -27626,48 +27638,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_90csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -27716,229 +27728,229 @@
   int64_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -27973,94 +27985,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_14 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_15 = __pyx_t_14;
                             for (__pyx_t_16 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
                               __pyx_v_XT_idx = __pyx_t_16;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_17 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_17) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -28075,15 +28087,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -28094,29 +28106,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -28182,48 +28194,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_92csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -28271,229 +28283,229 @@
   int64_t __pyx_t_15;
   int __pyx_t_16;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((float *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -28528,94 +28540,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((float)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_16 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_16) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((float *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -28630,15 +28642,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -28649,29 +28661,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -28737,48 +28749,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_94csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -28827,229 +28839,229 @@
   int64_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((short *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -29084,94 +29096,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((short *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_14 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_15 = __pyx_t_14;
                             for (__pyx_t_16 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
                               __pyx_v_XT_idx = __pyx_t_16;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_17 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_17) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -29186,15 +29198,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -29205,29 +29217,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -29293,48 +29305,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_96csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -29383,229 +29395,229 @@
   int64_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((int *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -29640,94 +29652,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_14 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_15 = __pyx_t_14;
                             for (__pyx_t_16 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
                               __pyx_v_XT_idx = __pyx_t_16;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_17 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_17) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -29742,15 +29754,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -29761,29 +29773,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -29849,48 +29861,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_98csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -29939,229 +29951,229 @@
   int64_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((long *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -30196,94 +30208,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((long *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_14 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_15 = __pyx_t_14;
                             for (__pyx_t_16 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
                               __pyx_v_XT_idx = __pyx_t_16;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_17 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_17) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -30298,15 +30310,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -30317,29 +30329,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -30405,48 +30417,48 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_XT)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 1); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 2); __PYX_ERR(0, 165, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 177, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, 3); __PYX_ERR(0, 165, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 177, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csc_rmatvec") < 0)) __PYX_ERR(0, 165, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
     }
     __pyx_v_XT = values[0];
-    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 177, __pyx_L3_error)
+    __pyx_v_v = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_v.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 165, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 177, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csc_rmatvec", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 165, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csc_rmatvec", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_100csc_rmatvec(__pyx_self, __pyx_v_XT, __pyx_v_v, __pyx_v_rows, __pyx_v_cols);
 
@@ -30494,229 +30506,229 @@
   int64_t __pyx_t_15;
   int __pyx_t_16;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3csc_rmatvec", 0);
 
-  /* "tabmat/ext/sparse.pyx":178
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":166
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 166, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTdata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":179
+  /* "tabmat/ext/sparse.pyx":167
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":180
+  /* "tabmat/ext/sparse.pyx":168
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  *     cdef win_integral[:] XTindptr = XT.indptr             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t n = rows.shape[0]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_XTindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":182
+  /* "tabmat/ext/sparse.pyx":170
  *     cdef win_integral[:] XTindptr = XT.indptr
  * 
  *     cdef int64_t n = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  */
   __pyx_v_n = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":183
+  /* "tabmat/ext/sparse.pyx":171
  * 
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]             # <<<<<<<<<<<<<<
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;
  */
   __pyx_v_m = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":184
+  /* "tabmat/ext/sparse.pyx":172
  *     cdef int64_t n = rows.shape[0]
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)             # <<<<<<<<<<<<<<
  *     cdef floating[:] out_view = out;
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_out = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "tabmat/ext/sparse.pyx":185
+  /* "tabmat/ext/sparse.pyx":173
  *     cdef int64_t m = cols.shape[0]
  *     out = np.zeros(m, dtype=XT.dtype)
  *     cdef floating[:] out_view = out;             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 173, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":187
+  /* "tabmat/ext/sparse.pyx":175
  *     cdef floating[:] out_view = out;
  * 
  *     cdef floating* XTdatap = &XTdata[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTdatap = (&(*((double *) ( /* dim=0 */ (__pyx_v_XTdata.data + __pyx_t_7 * __pyx_v_XTdata.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":188
+  /* "tabmat/ext/sparse.pyx":176
  * 
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindicesp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindices.data + __pyx_t_7 * __pyx_v_XTindices.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":189
+  /* "tabmat/ext/sparse.pyx":177
  *     cdef floating* XTdatap = &XTdata[0];
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0];
  * 
  */
   __pyx_t_7 = 0;
   __pyx_v_XTindptrp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_XTindptr.data + __pyx_t_7 * __pyx_v_XTindptr.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":190
+  /* "tabmat/ext/sparse.pyx":178
  *     cdef win_integral* XTindicesp = &XTindices[0];
  *     cdef win_integral* XTindptrp = &XTindptr[0];
  *     cdef floating* outp = &out_view[0];             # <<<<<<<<<<<<<<
  * 
  *     cdef int64_t Ci, i, Cj, XT_idx, j
  */
   __pyx_t_7 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_7 * __pyx_v_out_view.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":195
+  /* "tabmat/ext/sparse.pyx":183
  *     cdef floating XTval, vval
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_XT, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 195, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 195, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_6sparse_uint8(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_row_included = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":196
+  /* "tabmat/ext/sparse.pyx":184
  * 
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):             # <<<<<<<<<<<<<<
  *         row_included[rows[Ci]] = True
  * 
  */
   __pyx_t_10 = __pyx_v_n;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_Ci = __pyx_t_12;
 
-    /* "tabmat/ext/sparse.pyx":197
+    /* "tabmat/ext/sparse.pyx":185
  *     cdef uint8[:] row_included = np.zeros(XT.shape[0], dtype=np.uint8)
  *     for Ci in range(n):
  *         row_included[rows[Ci]] = True             # <<<<<<<<<<<<<<
  * 
  *     for Cj in prange(m, nogil=True):
  */
     __pyx_t_7 = __pyx_v_Ci;
     __pyx_t_13 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_7 * __pyx_v_rows.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_13 * __pyx_v_row_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/sparse.pyx":199
+  /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
   {
@@ -30751,94 +30763,94 @@
                             /* Initialize private variables to invalid values */
                             __pyx_v_XT_idx = ((int64_t)0xbad0bad0);
                             __pyx_v_XTval = ((double)__PYX_NAN());
                             __pyx_v_i = ((int64_t)0xbad0bad0);
                             __pyx_v_j = ((int64_t)0xbad0bad0);
                             __pyx_v_vval = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":200
+                            /* "tabmat/ext/sparse.pyx":188
  * 
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]             # <<<<<<<<<<<<<<
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  */
                             __pyx_t_7 = __pyx_v_Cj;
                             __pyx_v_j = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_7 * __pyx_v_cols.strides[0]) )));
 
-                            /* "tabmat/ext/sparse.pyx":201
+                            /* "tabmat/ext/sparse.pyx":189
  *     for Cj in prange(m, nogil=True):
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):             # <<<<<<<<<<<<<<
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  */
                             __pyx_t_13 = (__pyx_v_XTindptrp[(__pyx_v_j + 1)]);
                             __pyx_t_14 = __pyx_t_13;
                             for (__pyx_t_15 = (__pyx_v_XTindptrp[__pyx_v_j]); __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
                               __pyx_v_XT_idx = __pyx_t_15;
 
-                              /* "tabmat/ext/sparse.pyx":202
+                              /* "tabmat/ext/sparse.pyx":190
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]             # <<<<<<<<<<<<<<
  *             if not row_included[i]:
  *                 continue
  */
                               __pyx_v_i = (__pyx_v_XTindicesp[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":203
+                              /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_t_16 = ((!((*((__pyx_t_6tabmat_3ext_6sparse_uint8 *) ( /* dim=0 */ (__pyx_v_row_included.data + __pyx_t_7 * __pyx_v_row_included.strides[0]) ))) != 0)) != 0);
                               if (__pyx_t_16) {
 
-                                /* "tabmat/ext/sparse.pyx":204
+                                /* "tabmat/ext/sparse.pyx":192
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:
  *                 continue             # <<<<<<<<<<<<<<
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  */
                                 goto __pyx_L12_continue;
 
-                                /* "tabmat/ext/sparse.pyx":203
+                                /* "tabmat/ext/sparse.pyx":191
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  *             i = XTindicesp[XT_idx]
  *             if not row_included[i]:             # <<<<<<<<<<<<<<
  *                 continue
  *             XTval = XTdatap[XT_idx];
  */
                               }
 
-                              /* "tabmat/ext/sparse.pyx":205
+                              /* "tabmat/ext/sparse.pyx":193
  *             if not row_included[i]:
  *                 continue
  *             XTval = XTdatap[XT_idx];             # <<<<<<<<<<<<<<
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  */
                               __pyx_v_XTval = (__pyx_v_XTdatap[__pyx_v_XT_idx]);
 
-                              /* "tabmat/ext/sparse.pyx":206
+                              /* "tabmat/ext/sparse.pyx":194
  *                 continue
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]             # <<<<<<<<<<<<<<
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out
  */
                               __pyx_t_7 = __pyx_v_i;
                               __pyx_v_vval = (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_7 * __pyx_v_v.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":207
+                              /* "tabmat/ext/sparse.pyx":195
  *             XTval = XTdatap[XT_idx];
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
                               (__pyx_v_outp[__pyx_v_Cj]) = ((__pyx_v_outp[__pyx_v_Cj]) + (__pyx_v_XTval * __pyx_v_vval));
@@ -30853,15 +30865,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":199
+      /* "tabmat/ext/sparse.pyx":187
  *         row_included[rows[Ci]] = True
  * 
  *     for Cj in prange(m, nogil=True):             # <<<<<<<<<<<<<<
  *         j = cols[Cj]
  *         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
  */
       /*finally:*/ {
@@ -30872,29 +30884,29 @@
           #endif
           goto __pyx_L7;
         }
         __pyx_L7:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":208
+  /* "tabmat/ext/sparse.pyx":196
  *             vval = v[i]
  *             outp[Cj] = outp[Cj] + XTval * vval;
  *     return out             # <<<<<<<<<<<<<<
  * 
  * cdef extern from "sparse_helpers.cpp":
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
 
   /* function exit code */
   __pyx_L1_error:;
@@ -30919,15 +30931,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/sparse.pyx":220
+/* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -30968,31 +30980,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -31001,15 +31013,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_10csr_dense_sandwich(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -31059,15 +31071,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("csr_dense_sandwich", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -31077,41 +31089,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_2 = ((2 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 2);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -31120,85 +31132,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_6);
     __Pyx_GIVEREF(__pyx_int_6);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_6);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -31212,62 +31224,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -31286,15 +31298,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -31308,35 +31320,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_3 = ((3 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 3);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -31345,85 +31357,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_rows, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_rows); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_6);
     __Pyx_GIVEREF(__pyx_int_6);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_6);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -31437,118 +31449,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 220, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 208, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -31569,15 +31581,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -31591,15 +31603,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -31613,15 +31625,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -31635,100 +31647,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 220, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 220, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 208, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -31736,43 +31748,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 208, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 220, __pyx_L1_error)
+    __PYX_ERR(0, 208, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 220, __pyx_L1_error)
+      __PYX_ERR(0, 208, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -31843,70 +31855,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_104csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -31949,164 +31961,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_short(__pyx_t_4); if (unlikely((__pyx_t_5 == (short)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_short(__pyx_t_4); if (unlikely((__pyx_t_5 == (short)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_short(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_short(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_short(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_short(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -32123,240 +32135,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((float *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((short *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((short *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<short,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<short,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -32429,70 +32441,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_106csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -32535,164 +32547,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -32709,240 +32721,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((float *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<int,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<int,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -33015,70 +33027,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_108csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -33121,164 +33133,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_long(__pyx_t_4); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_long(__pyx_t_4); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_long(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_long(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -33295,240 +33307,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((float *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((long *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((long *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<long,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<long,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -33601,70 +33613,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_110csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -33707,164 +33719,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_5 == (PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_5 == (PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -33881,240 +33893,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((float *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<PY_LONG_LONG,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<PY_LONG_LONG,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -34187,70 +34199,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_112csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -34293,164 +34305,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_short(__pyx_t_4); if (unlikely((__pyx_t_5 == (short)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_short(__pyx_t_4); if (unlikely((__pyx_t_5 == (short)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_short(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_short(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_short(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_short(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -34467,240 +34479,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((double *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((short *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((short *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((short *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<short,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<short,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((short *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -34773,70 +34785,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_114csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -34879,164 +34891,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -35053,240 +35065,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((double *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((int *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<int,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<int,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -35359,70 +35371,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_116csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -35465,164 +35477,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_long(__pyx_t_4); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_long(__pyx_t_4); if (unlikely((__pyx_t_5 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_long(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_long(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -35639,240 +35651,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((double *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((long *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((long *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((long *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<long,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<long,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((long *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -35945,70 +35957,70 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 1); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 2); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 3); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_A_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 4); __PYX_ERR(0, 208, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_B_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 220, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, 5); __PYX_ERR(0, 208, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 220, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csr_dense_sandwich") < 0)) __PYX_ERR(0, 208, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
     }
     __pyx_v_A = values[0];
     __pyx_v_B = ((PyArrayObject *)values[1]);
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 223, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 224, __pyx_L3_error)
-    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 225, __pyx_L3_error)
-    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 226, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 211, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 212, __pyx_L3_error)
+    __pyx_v_A_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_A_cols.memview)) __PYX_ERR(0, 213, __pyx_L3_error)
+    __pyx_v_B_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_B_cols.memview)) __PYX_ERR(0, 214, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 220, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("csr_dense_sandwich", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 208, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.csr_dense_sandwich", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 222, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_B), __pyx_ptype_5numpy_ndarray, 1, "B", 0))) __PYX_ERR(0, 210, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_118csr_dense_sandwich(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_d, __pyx_v_rows, __pyx_v_A_cols, __pyx_v_B_cols);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -36051,164 +36063,164 @@
   Py_ssize_t __pyx_t_14;
   Py_ssize_t __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3csr_dense_sandwich", 0);
 
-  /* "tabmat/ext/sparse.pyx":230
+  /* "tabmat/ext/sparse.pyx":218
  *     # computes where (A.T * d) @ B
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 218, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Adata = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":231
+  /* "tabmat/ext/sparse.pyx":219
  *     # assumes that A is in csr form
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices             # <<<<<<<<<<<<<<
  *     cdef win_integral[:] Aindptr = A.indptr
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindices = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":232
+  /* "tabmat/ext/sparse.pyx":220
  *     cdef floating[:] Adata = A.data
  *     cdef win_integral[:] Aindices = A.indices
  *     cdef win_integral[:] Aindptr = A.indptr             # <<<<<<<<<<<<<<
  * 
  *     # A has shape (n, m)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_Aindptr = __pyx_t_3;
   __pyx_t_3.memview = NULL;
   __pyx_t_3.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":236
+  /* "tabmat/ext/sparse.pyx":224
  *     # A has shape (n, m)
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]             # <<<<<<<<<<<<<<
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyInt_As_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_5 == (PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_PY_LONG_LONG(__pyx_t_4); if (unlikely((__pyx_t_5 == (PY_LONG_LONG)-1) && PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_m = __pyx_t_5;
 
-  /* "tabmat/ext/sparse.pyx":237
+  /* "tabmat/ext/sparse.pyx":225
  *     # B has shape (n, r)
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral r = B.shape[1]
  * 
  */
   __pyx_v_n = (__pyx_v_d.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":238
+  /* "tabmat/ext/sparse.pyx":226
  *     cdef win_integral m = A.shape[1]
  *     cdef win_integral n = d.shape[0]
  *     cdef win_integral r = B.shape[1]             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral nr = rows.shape[0]
  */
   __pyx_v_r = (__pyx_v_B->dimensions[1]);
 
-  /* "tabmat/ext/sparse.pyx":240
+  /* "tabmat/ext/sparse.pyx":228
  *     cdef win_integral r = B.shape[1]
  * 
  *     cdef win_integral nr = rows.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]
  */
   __pyx_v_nr = (__pyx_v_rows.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":241
+  /* "tabmat/ext/sparse.pyx":229
  * 
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  */
   __pyx_v_nAc = (__pyx_v_A_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":242
+  /* "tabmat/ext/sparse.pyx":230
  *     cdef win_integral nr = rows.shape[0]
  *     cdef win_integral nAc = A_cols.shape[0]
  *     cdef win_integral nBc = B_cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  */
   __pyx_v_nBc = (__pyx_v_B_cols.shape[0]);
 
-  /* "tabmat/ext/sparse.pyx":244
+  /* "tabmat/ext/sparse.pyx":232
  *     cdef win_integral nBc = B_cols.shape[0]
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)             # <<<<<<<<<<<<<<
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nAc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_nBc); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_dtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 244, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_out = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":245
+  /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   __pyx_t_9 = ((__pyx_v_nr == 0) != 0);
@@ -36225,240 +36237,240 @@
   }
   __pyx_t_9 = ((__pyx_v_nBc == 0) != 0);
   if (!__pyx_t_9) {
   } else {
     __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_A, __pyx_n_s_indptr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_7); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_11 = __pyx_t_10;
   __pyx_t_12 = 0;
   __pyx_t_9 = ((((*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_11 * __pyx_v_Aindptr.strides[0]) ))) - (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))) == 0) != 0);
   __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":246
+    /* "tabmat/ext/sparse.pyx":234
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:
  *         return out             # <<<<<<<<<<<<<<
  * 
  *     cdef floating[:, :] out_view = out
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_out);
     __pyx_r = __pyx_v_out;
     goto __pyx_L0;
 
-    /* "tabmat/ext/sparse.pyx":245
+    /* "tabmat/ext/sparse.pyx":233
  * 
  *     out = np.zeros((nAc, nBc), dtype=A.dtype)
  *     if nr == 0 or nAc == 0 or nBc == 0 or (Aindptr[A.indptr.shape[0] - 1] - Aindptr[0]) == 0:             # <<<<<<<<<<<<<<
  *         return out
  * 
  */
   }
 
-  /* "tabmat/ext/sparse.pyx":248
+  /* "tabmat/ext/sparse.pyx":236
  *         return out
  * 
  *     cdef floating[:, :] out_view = out             # <<<<<<<<<<<<<<
  *     cdef floating* outp = &out_view[0,0]
  * 
  */
-  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_out, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 236, __pyx_L1_error)
   __pyx_v_out_view = __pyx_t_13;
   __pyx_t_13.memview = NULL;
   __pyx_t_13.data = NULL;
 
-  /* "tabmat/ext/sparse.pyx":249
+  /* "tabmat/ext/sparse.pyx":237
  * 
  *     cdef floating[:, :] out_view = out
  *     cdef floating* outp = &out_view[0,0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* Bp = <floating*>B.data
  */
   __pyx_t_12 = 0;
   __pyx_t_11 = 0;
   __pyx_v_outp = (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_out_view.data + __pyx_t_12 * __pyx_v_out_view.strides[0]) ) + __pyx_t_11 * __pyx_v_out_view.strides[1]) ))));
 
-  /* "tabmat/ext/sparse.pyx":251
+  /* "tabmat/ext/sparse.pyx":239
  *     cdef floating* outp = &out_view[0,0]
  * 
  *     cdef floating* Bp = <floating*>B.data             # <<<<<<<<<<<<<<
  * 
  *     cdef win_integral* rowsp = &rows[0];
  */
   __pyx_v_Bp = ((double *)__pyx_v_B->data);
 
-  /* "tabmat/ext/sparse.pyx":253
+  /* "tabmat/ext/sparse.pyx":241
  *     cdef floating* Bp = <floating*>B.data
  * 
  *     cdef win_integral* rowsp = &rows[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];
  */
   __pyx_t_11 = 0;
   __pyx_v_rowsp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":254
+  /* "tabmat/ext/sparse.pyx":242
  * 
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];             # <<<<<<<<<<<<<<
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  */
   __pyx_t_11 = 0;
   __pyx_v_A_colsp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_A_cols.data + __pyx_t_11 * __pyx_v_A_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":255
+  /* "tabmat/ext/sparse.pyx":243
  *     cdef win_integral* rowsp = &rows[0];
  *     cdef win_integral* A_colsp = &A_cols[0];
  *     cdef win_integral* B_colsp = &B_cols[0];             # <<<<<<<<<<<<<<
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  */
   __pyx_t_11 = 0;
   __pyx_v_B_colsp = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_B_cols.data + __pyx_t_11 * __pyx_v_B_cols.strides[0]) ))));
 
-  /* "tabmat/ext/sparse.pyx":257
+  /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_s_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_t_7, __pyx_n_u_C_CONTIGUOUS); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_8) {
 
-    /* "tabmat/ext/sparse.pyx":259
+    /* "tabmat/ext/sparse.pyx":247
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_11 = 0;
     __pyx_t_12 = 0;
     __pyx_t_14 = 0;
     __pyx_t_15 = 0;
 
-    /* "tabmat/ext/sparse.pyx":258
+    /* "tabmat/ext/sparse.pyx":246
  * 
  *     if B.flags["C_CONTIGUOUS"]:
  *         _csr_denseC_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseC_sandwich<PY_LONG_LONG,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_11 * __pyx_v_Adata.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_12 * __pyx_v_Aindices.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_14 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_15 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":257
+    /* "tabmat/ext/sparse.pyx":245
  *     cdef win_integral* B_colsp = &B_cols[0];
  * 
  *     if B.flags["C_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseC_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":262
+  /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_B), __pyx_n_s_flags); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_s_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Dict_GetItem(__pyx_t_4, __pyx_n_u_F_CONTIGUOUS); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 250, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (likely(__pyx_t_8)) {
 
-    /* "tabmat/ext/sparse.pyx":264
+    /* "tabmat/ext/sparse.pyx":252
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,             # <<<<<<<<<<<<<<
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  */
     __pyx_t_15 = 0;
     __pyx_t_14 = 0;
     __pyx_t_12 = 0;
     __pyx_t_11 = 0;
 
-    /* "tabmat/ext/sparse.pyx":263
+    /* "tabmat/ext/sparse.pyx":251
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:
  *         _csr_denseF_sandwich(             # <<<<<<<<<<<<<<
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  */
     _csr_denseF_sandwich<PY_LONG_LONG,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_Adata.data + __pyx_t_15 * __pyx_v_Adata.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindices.data + __pyx_t_14 * __pyx_v_Aindices.strides[0]) )))), (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_Aindptr.data + __pyx_t_12 * __pyx_v_Aindptr.strides[0]) )))), __pyx_v_Bp, (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_11 * __pyx_v_d.strides[0]) )))), __pyx_v_outp, __pyx_v_m, __pyx_v_n, __pyx_v_r, __pyx_v_rowsp, __pyx_v_A_colsp, __pyx_v_B_colsp, __pyx_v_nr, __pyx_v_nAc, __pyx_v_nBc);
 
-    /* "tabmat/ext/sparse.pyx":262
+    /* "tabmat/ext/sparse.pyx":250
  *             rowsp, A_colsp, B_colsp, nr, nAc, nBc
  *         )
  *     elif B.flags["F_CONTIGUOUS"]:             # <<<<<<<<<<<<<<
  *         _csr_denseF_sandwich(
  *             &Adata[0], &Aindices[0], &Aindptr[0], Bp, &d[0], outp, m, n, r,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/sparse.pyx":268
+  /* "tabmat/ext/sparse.pyx":256
  *         )
  *     else:
  *         raise Exception()             # <<<<<<<<<<<<<<
  *     return out
  * 
  */
   /*else*/ {
-    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 268, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_CallNoArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0]))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 256, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 268, __pyx_L1_error)
+    __PYX_ERR(0, 256, __pyx_L1_error)
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/sparse.pyx":269
+  /* "tabmat/ext/sparse.pyx":257
  *     else:
  *         raise Exception()
  *     return out             # <<<<<<<<<<<<<<
  * 
  * def transpose_square_dot_weights(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_out);
   __pyx_r = __pyx_v_out;
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
 
@@ -36484,15 +36496,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_A_cols, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_B_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/sparse.pyx":271
+/* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -36533,31 +36545,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -36566,15 +36578,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_12transpose_square_dot_weights(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -36624,15 +36636,15 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("transpose_square_dot_weights", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
       PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None);
     }
@@ -36642,41 +36654,41 @@
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
   __pyx_t_2 = ((0 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 0);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -36685,85 +36697,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_data, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_data, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_data); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_5);
     __Pyx_GIVEREF(__pyx_int_5);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_5);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -36777,62 +36789,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -36851,15 +36863,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -36873,35 +36885,35 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
   __pyx_t_3 = ((1 < __pyx_t_5) != 0);
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
     __pyx_t_6 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
@@ -36910,85 +36922,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_3 = __pyx_t_4;
     goto __pyx_L30_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_indices, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_indices, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_4 != 0);
   __pyx_t_3 = __pyx_t_2;
   __pyx_L30_bool_binop_done:;
   if (__pyx_t_3) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_6);
     __pyx_t_6 = 0;
     goto __pyx_L29;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_5);
     __Pyx_GIVEREF(__pyx_int_5);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_5);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
   __pyx_L29:;
   while (1) {
     __pyx_t_3 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L35;
       }
       __pyx_t_3 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_3 = (__pyx_t_2 != 0);
         if (__pyx_t_3) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L36;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -37002,118 +37014,118 @@
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L35:;
       __pyx_v_itemsize = -1L;
       __pyx_t_3 = (__pyx_v_dtype != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_3 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L39_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L39_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L43_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L43_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           __pyx_t_3 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 271, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_3 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_3) {
           } else {
             __pyx_t_2 = __pyx_t_3;
             goto __pyx_L51_bool_binop_done;
           }
           __pyx_t_3 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_2 = __pyx_t_3;
           __pyx_L51_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
             goto __pyx_L33_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -37134,15 +37146,15 @@
     __pyx_L55_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -37156,15 +37168,15 @@
     __pyx_L59_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -37178,15 +37190,15 @@
     __pyx_L63_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_3 = ((__pyx_v_itemsize == -1L) != 0);
@@ -37200,100 +37212,100 @@
     __pyx_L67_bool_binop_done:;
     if (__pyx_t_2) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_2 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_2) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         goto __pyx_L33_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
     goto __pyx_L33_break;
   }
   __pyx_L33_break:;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_candidates = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_9, &__pyx_t_5, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 271, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_6 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_6 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_6);
       __pyx_t_6 = 0;
       __pyx_t_2 = (__pyx_v_dst_type != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_6, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 271, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 259, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_3) {
           __pyx_v_match_found = 1;
           goto __pyx_L75;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -37301,43 +37313,43 @@
         }
         __pyx_L75:;
       }
     }
     __pyx_L73_break:;
     __pyx_t_3 = (__pyx_v_match_found != 0);
     if (__pyx_t_3) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_3 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_2 = ((!__pyx_t_3) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 259, __pyx_L1_error)
   __pyx_t_2 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_2) {
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 271, __pyx_L1_error)
+    __PYX_ERR(0, 259, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 259, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -37405,56 +37417,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_122transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -37486,64 +37498,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_0transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((float *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -37576,49 +37588,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((short *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((short *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((short *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((float *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * powf(__pyx_v_v, 2.0)));
@@ -37632,15 +37644,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -37651,25 +37663,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -37732,56 +37744,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_124transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -37813,64 +37825,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_1transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((float *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -37903,49 +37915,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((int *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((int *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((float *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * powf(__pyx_v_v, 2.0)));
@@ -37959,15 +37971,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -37978,25 +37990,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -38059,56 +38071,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_126transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -38140,64 +38152,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_2transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((float *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -38230,49 +38242,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((long *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((long *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((long *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((float *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * powf(__pyx_v_v, 2.0)));
@@ -38286,15 +38298,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -38305,25 +38317,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -38386,56 +38398,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_128transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -38467,64 +38479,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_3transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((float *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -38557,49 +38569,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((float)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((float *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * powf(__pyx_v_v, 2.0)));
@@ -38613,15 +38625,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -38632,25 +38644,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -38713,56 +38725,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_short(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_130transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -38794,64 +38806,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_0transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((double *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -38884,49 +38896,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((short *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((short *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((short *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((double *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * pow(__pyx_v_v, 2.0)));
@@ -38940,15 +38952,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -38959,25 +38971,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -39040,56 +39052,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_132transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -39121,64 +39133,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_1transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((double *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -39211,49 +39223,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((int *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((int *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((int *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((double *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * pow(__pyx_v_v, 2.0)));
@@ -39267,15 +39279,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -39286,25 +39298,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -39367,56 +39379,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_long(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_134transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -39448,64 +39460,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_2transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((double *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -39538,49 +39550,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((long *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((long *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((long *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((double *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * pow(__pyx_v_v, 2.0)));
@@ -39594,15 +39606,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -39613,25 +39625,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -39694,56 +39706,56 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 1); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_indptr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 2); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_weights)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 3); __PYX_ERR(0, 259, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 271, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, 4); __PYX_ERR(0, 259, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 271, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "transpose_square_dot_weights") < 0)) __PYX_ERR(0, 259, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
     }
-    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 272, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 273, __pyx_L3_error)
-    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 274, __pyx_L3_error)
-    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 275, __pyx_L3_error)
+    __pyx_v_data = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 260, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 261, __pyx_L3_error)
+    __pyx_v_indptr = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indptr.memview)) __PYX_ERR(0, 262, __pyx_L3_error)
+    __pyx_v_weights = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[3], PyBUF_WRITABLE); if (unlikely(!__pyx_v_weights.memview)) __PYX_ERR(0, 263, __pyx_L3_error)
     __pyx_v_dtype = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 271, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("transpose_square_dot_weights", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 259, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.sparse.transpose_square_dot_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_6sparse_136transpose_square_dot_weights(__pyx_self, __pyx_v_data, __pyx_v_indices, __pyx_v_indptr, __pyx_v_weights, __pyx_v_dtype);
 
@@ -39775,64 +39787,64 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_3transpose_square_dot_weights", 0);
 
-  /* "tabmat/ext/sparse.pyx":278
+  /* "tabmat/ext/sparse.pyx":266
  *         dtype):
  * 
  *     cdef int ncols = indptr.shape[0] - 1             # <<<<<<<<<<<<<<
  * 
  *     cdef int i, j, k
  */
   __pyx_v_ncols = ((__pyx_v_indptr.shape[0]) - 1);
 
-  /* "tabmat/ext/sparse.pyx":282
+  /* "tabmat/ext/sparse.pyx":270
  *     cdef int i, j, k
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)             # <<<<<<<<<<<<<<
  *     cdef floating* outp = <floating*>out.data
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_ncols); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 270, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 270, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 270, __pyx_L1_error)
   __pyx_v_out = ((PyArrayObject *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "tabmat/ext/sparse.pyx":283
+  /* "tabmat/ext/sparse.pyx":271
  * 
  *     cdef np.ndarray out = np.zeros(ncols, dtype=dtype)
  *     cdef floating* outp = <floating*>out.data             # <<<<<<<<<<<<<<
  * 
  *     cdef floating v
  */
   __pyx_v_outp = ((double *)__pyx_v_out->data);
 
-  /* "tabmat/ext/sparse.pyx":286
+  /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
   {
@@ -39865,49 +39877,49 @@
                         {
                             __pyx_v_j = (int)(0 + 1 * __pyx_t_6);
                             /* Initialize private variables to invalid values */
                             __pyx_v_i = ((int)0xbad0bad0);
                             __pyx_v_k = ((int)0xbad0bad0);
                             __pyx_v_v = ((double)__PYX_NAN());
 
-                            /* "tabmat/ext/sparse.pyx":287
+                            /* "tabmat/ext/sparse.pyx":275
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):             # <<<<<<<<<<<<<<
  *             i = indices[k]
  *             v = data[k]
  */
                             __pyx_t_8 = (__pyx_v_j + 1);
                             __pyx_t_9 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) )));
                             __pyx_t_8 = __pyx_v_j;
                             __pyx_t_10 = __pyx_t_9;
                             for (__pyx_t_11 = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_8 * __pyx_v_indptr.strides[0]) ))); __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
                               __pyx_v_k = __pyx_t_11;
 
-                              /* "tabmat/ext/sparse.pyx":288
+                              /* "tabmat/ext/sparse.pyx":276
  *     for j in prange(ncols, nogil=True):
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]             # <<<<<<<<<<<<<<
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_i = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_12 * __pyx_v_indices.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":289
+                              /* "tabmat/ext/sparse.pyx":277
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  *             v = data[k]             # <<<<<<<<<<<<<<
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out
  */
                               __pyx_t_12 = __pyx_v_k;
                               __pyx_v_v = (*((double *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_12 * __pyx_v_data.strides[0]) )));
 
-                              /* "tabmat/ext/sparse.pyx":290
+                              /* "tabmat/ext/sparse.pyx":278
  *             i = indices[k]
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)             # <<<<<<<<<<<<<<
  *     return out
  */
                               __pyx_t_12 = __pyx_v_i;
                               (__pyx_v_outp[__pyx_v_j]) = ((__pyx_v_outp[__pyx_v_j]) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_12 * __pyx_v_weights.strides[0]) ))) * pow(__pyx_v_v, 2.0)));
@@ -39921,15 +39933,15 @@
             #undef likely
             #undef unlikely
             #define likely(x)   __builtin_expect(!!(x), 1)
             #define unlikely(x) __builtin_expect(!!(x), 0)
         #endif
       }
 
-      /* "tabmat/ext/sparse.pyx":286
+      /* "tabmat/ext/sparse.pyx":274
  * 
  *     cdef floating v
  *     for j in prange(ncols, nogil=True):             # <<<<<<<<<<<<<<
  *         for k in range(indptr[j], indptr[j+1]):
  *             i = indices[k]
  */
       /*finally:*/ {
@@ -39940,25 +39952,25 @@
           #endif
           goto __pyx_L5;
         }
         __pyx_L5:;
       }
   }
 
-  /* "tabmat/ext/sparse.pyx":291
+  /* "tabmat/ext/sparse.pyx":279
  *             v = data[k]
  *             outp[j] = outp[j] + weights[i] * (v ** 2)
  *     return out             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_out));
   __pyx_r = ((PyObject *)__pyx_v_out);
   goto __pyx_L0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
 
@@ -39977,15 +39989,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_indptr, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_weights, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -39994,29 +40006,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -40027,15 +40039,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -40044,29 +40056,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -40077,15 +40089,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -40094,29 +40106,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -40127,15 +40139,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -40144,29 +40156,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -40177,15 +40189,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -40194,29 +40206,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -40227,212 +40239,212 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
  *     else:
  *         return ()
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
     __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
  *         return <tuple>d.subarray.shape
  *     else:
  *         return ()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_empty_tuple);
     __pyx_r = __pyx_empty_tuple;
     goto __pyx_L0;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
  * 
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
  *     PyArray_SetBaseObject(arr, base)
  * 
  */
   Py_INCREF(__pyx_v_base);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object get_array_base(ndarray arr):
  */
   (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
   PyObject *__pyx_v_base;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
  *     if base is NULL:
  *         return None
  */
   __pyx_v_base = PyArray_BASE(__pyx_v_arr);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  *         return None             # <<<<<<<<<<<<<<
  *     return <object>base
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
  *     if base is NULL:
  *         return None
  *     return <object>base             # <<<<<<<<<<<<<<
  * 
  * # Versions of the import_* functions which are more suitable for
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_base));
   __pyx_r = ((PyObject *)__pyx_v_base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -40448,15 +40460,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_array", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
   {
@@ -40464,53 +40476,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
  * cdef inline int import_array() except -1:
  *     try:
  *         __pyx_import_array()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")
  */
       __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 942, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
  *     try:
  *         __pyx_import_array()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 943, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 944, __pyx_L5_except_error)
@@ -40518,30 +40530,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 944, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -40556,15 +40568,15 @@
   __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -40580,15 +40592,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_umath", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -40596,53 +40608,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
  * cdef inline int import_umath() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 948, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 949, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 950, __pyx_L5_except_error)
@@ -40650,30 +40662,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 950, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -40688,15 +40700,15 @@
   __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -40712,15 +40724,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_ufunc", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -40728,53 +40740,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
  * cdef inline int import_ufunc() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 954, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 955, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef extern from *:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 956, __pyx_L5_except_error)
@@ -40782,30 +40794,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 956, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -40820,176 +40832,176 @@
   __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_datetime64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
 static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
   npy_datetime __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
  *     also needed.  That can be found using `get_datetime64_unit`.
  *     """
  *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
 static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
   npy_timedelta __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
  *     returns the int64 value underlying scalar numpy timedelta64 object
  *     """
  *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
 static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
   NPY_DATETIMEUNIT __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
  *     returns the unit part of the dtype for a numpy datetime64 object.
  *     """
  *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
  */
   __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
@@ -54222,15 +54234,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -54344,15 +54356,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -54608,15 +54620,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -54757,15 +54769,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -54834,25 +54846,25 @@
   {&__pyx_n_s_Aindicesp, __pyx_k_Aindicesp, sizeof(__pyx_k_Aindicesp), 0, 0, 1, 1},
   {&__pyx_n_s_Aindptr, __pyx_k_Aindptr, sizeof(__pyx_k_Aindptr), 0, 0, 1, 1},
   {&__pyx_n_s_B, __pyx_k_B, sizeof(__pyx_k_B), 0, 0, 1, 1},
   {&__pyx_n_s_B_cols, __pyx_k_B_cols, sizeof(__pyx_k_B_cols), 0, 0, 1, 1},
   {&__pyx_n_s_B_colsp, __pyx_k_B_colsp, sizeof(__pyx_k_B_colsp), 0, 0, 1, 1},
   {&__pyx_n_s_Bp, __pyx_k_Bp, sizeof(__pyx_k_Bp), 0, 0, 1, 1},
   {&__pyx_kp_s_Buffer_view_does_not_expose_stri, __pyx_k_Buffer_view_does_not_expose_stri, sizeof(__pyx_k_Buffer_view_does_not_expose_stri), 0, 0, 1, 0},
-  {&__pyx_n_s_C_CONTIGUOUS, __pyx_k_C_CONTIGUOUS, sizeof(__pyx_k_C_CONTIGUOUS), 0, 0, 1, 1},
+  {&__pyx_n_u_C_CONTIGUOUS, __pyx_k_C_CONTIGUOUS, sizeof(__pyx_k_C_CONTIGUOUS), 0, 1, 0, 1},
   {&__pyx_kp_s_Can_only_create_a_buffer_that_is, __pyx_k_Can_only_create_a_buffer_that_is, sizeof(__pyx_k_Can_only_create_a_buffer_that_is), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_assign_to_read_only_memor, __pyx_k_Cannot_assign_to_read_only_memor, sizeof(__pyx_k_Cannot_assign_to_read_only_memor), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_create_writable_memory_vi, __pyx_k_Cannot_create_writable_memory_vi, sizeof(__pyx_k_Cannot_create_writable_memory_vi), 0, 0, 1, 0},
   {&__pyx_kp_s_Cannot_index_with_type_s, __pyx_k_Cannot_index_with_type_s, sizeof(__pyx_k_Cannot_index_with_type_s), 0, 0, 1, 0},
   {&__pyx_n_s_Ci, __pyx_k_Ci, sizeof(__pyx_k_Ci), 0, 0, 1, 1},
   {&__pyx_n_s_Cj, __pyx_k_Cj, sizeof(__pyx_k_Cj), 0, 0, 1, 1},
   {&__pyx_n_s_Ellipsis, __pyx_k_Ellipsis, sizeof(__pyx_k_Ellipsis), 0, 0, 1, 1},
   {&__pyx_kp_s_Empty_shape_tuple_for_cython_arr, __pyx_k_Empty_shape_tuple_for_cython_arr, sizeof(__pyx_k_Empty_shape_tuple_for_cython_arr), 0, 0, 1, 0},
   {&__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_k_Expected_at_least_d_argument_s_g, sizeof(__pyx_k_Expected_at_least_d_argument_s_g), 0, 0, 1, 0},
-  {&__pyx_n_s_F_CONTIGUOUS, __pyx_k_F_CONTIGUOUS, sizeof(__pyx_k_F_CONTIGUOUS), 0, 0, 1, 1},
+  {&__pyx_n_u_F_CONTIGUOUS, __pyx_k_F_CONTIGUOUS, sizeof(__pyx_k_F_CONTIGUOUS), 0, 1, 0, 1},
   {&__pyx_kp_s_Function_call_with_ambiguous_arg, __pyx_k_Function_call_with_ambiguous_arg, sizeof(__pyx_k_Function_call_with_ambiguous_arg), 0, 0, 1, 0},
   {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
   {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
   {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
   {&__pyx_kp_s_Indirect_dimensions_not_supporte, __pyx_k_Indirect_dimensions_not_supporte, sizeof(__pyx_k_Indirect_dimensions_not_supporte), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_mode_expected_c_or_fortr, __pyx_k_Invalid_mode_expected_c_or_fortr, sizeof(__pyx_k_Invalid_mode_expected_c_or_fortr), 0, 0, 1, 0},
   {&__pyx_kp_s_Invalid_shape_in_axis_d_d, __pyx_k_Invalid_shape_in_axis_d_d, sizeof(__pyx_k_Invalid_shape_in_axis_d_d), 0, 0, 1, 0},
@@ -54960,16 +54972,16 @@
   {&__pyx_n_s_ncols, __pyx_k_ncols, sizeof(__pyx_k_ncols), 0, 0, 1, 1},
   {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
   {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
   {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
   {&__pyx_n_s_nr, __pyx_k_nr, sizeof(__pyx_k_nr), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_s_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 0, 1, 0},
-  {&__pyx_kp_s_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 0, 1, 0},
+  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
+  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_s_out, __pyx_k_out, sizeof(__pyx_k_out), 0, 0, 1, 1},
   {&__pyx_n_s_out_view, __pyx_k_out_view, sizeof(__pyx_k_out_view), 0, 0, 1, 1},
   {&__pyx_n_s_outp, __pyx_k_outp, sizeof(__pyx_k_outp), 0, 0, 1, 1},
   {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
@@ -55019,16 +55031,16 @@
   {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
   {&__pyx_n_s_vval, __pyx_k_vval, sizeof(__pyx_k_vval), 0, 0, 1, 1},
   {&__pyx_n_s_weights, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 18, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 14, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 14, __pyx_L1_error)
   __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 944, __pyx_L1_error)
   __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(2, 134, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(2, 149, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(2, 152, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(2, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(2, 615, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(2, 834, __pyx_L1_error)
@@ -55037,47 +55049,47 @@
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__4);
   __Pyx_GIVEREF(__pyx_tuple__4);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 944, __pyx_L1_error)
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__5);
   __Pyx_GIVEREF(__pyx_tuple__5);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 950, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 950, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
@@ -55268,97 +55280,97 @@
   __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__24);
   __Pyx_GIVEREF(__pyx_tuple__24);
   __pyx_tuple__25 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__25);
   __Pyx_GIVEREF(__pyx_tuple__25);
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
-  __pyx_tuple__26 = PyTuple_Pack(32, __pyx_n_s_A, __pyx_n_s_AT, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_Adata, __pyx_n_s_Aindices, __pyx_n_s_Aindptr, __pyx_n_s_ATdata, __pyx_n_s_ATindices, __pyx_n_s_ATindptr, __pyx_n_s_Adatap, __pyx_n_s_Aindicesp, __pyx_n_s_ATdatap, __pyx_n_s_ATindicesp, __pyx_n_s_ATindptrp, __pyx_n_s_dp, __pyx_n_s_m, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_AT_idx, __pyx_n_s_A_idx, __pyx_n_s_Ci, __pyx_n_s_i, __pyx_n_s_Cj, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_A_val, __pyx_n_s_AT_val, __pyx_n_s_row_included, __pyx_n_s_col_map); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_tuple__26 = PyTuple_Pack(32, __pyx_n_s_A, __pyx_n_s_AT, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_Adata, __pyx_n_s_Aindices, __pyx_n_s_Aindptr, __pyx_n_s_ATdata, __pyx_n_s_ATindices, __pyx_n_s_ATindptr, __pyx_n_s_Adatap, __pyx_n_s_Aindicesp, __pyx_n_s_ATdatap, __pyx_n_s_ATindicesp, __pyx_n_s_ATindptrp, __pyx_n_s_dp, __pyx_n_s_m, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_AT_idx, __pyx_n_s_A_idx, __pyx_n_s_Ci, __pyx_n_s_i, __pyx_n_s_Cj, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_A_val, __pyx_n_s_AT_val, __pyx_n_s_row_included, __pyx_n_s_col_map); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__26);
   __Pyx_GIVEREF(__pyx_tuple__26);
-  __pyx_codeobj__27 = (PyObject*)__Pyx_PyCode_New(5, 0, 32, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_sparse_sandwich, 18, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_codeobj__27 = (PyObject*)__Pyx_PyCode_New(5, 0, 32, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_sparse_sandwich, 14, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 14, __pyx_L1_error)
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
-  __pyx_tuple__28 = PyTuple_Pack(18, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_out, __pyx_n_s_X_indices, __pyx_n_s_Xdata, __pyx_n_s_Xindices, __pyx_n_s_Xindptr, __pyx_n_s_out_view, __pyx_n_s_Xdatap, __pyx_n_s_Xindicesp, __pyx_n_s_Xindptrp, __pyx_n_s_outp, __pyx_n_s_i, __pyx_n_s_X_idx, __pyx_n_s_j, __pyx_n_s_n, __pyx_n_s_Xval, __pyx_n_s_vval); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_tuple__28 = PyTuple_Pack(18, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_out, __pyx_n_s_X_indices, __pyx_n_s_Xdata, __pyx_n_s_Xindices, __pyx_n_s_Xindptr, __pyx_n_s_out_view, __pyx_n_s_Xdatap, __pyx_n_s_Xindicesp, __pyx_n_s_Xindptrp, __pyx_n_s_outp, __pyx_n_s_i, __pyx_n_s_X_idx, __pyx_n_s_j, __pyx_n_s_n, __pyx_n_s_Xval, __pyx_n_s_vval); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__28);
   __Pyx_GIVEREF(__pyx_tuple__28);
-  __pyx_codeobj__29 = (PyObject*)__Pyx_PyCode_New(4, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csr_matvec_unrestricted, 82, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_codeobj__29 = (PyObject*)__Pyx_PyCode_New(4, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csr_matvec_unrestricted, 76, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 76, __pyx_L1_error)
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
-  __pyx_tuple__30 = PyTuple_Pack(22, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_Xdata, __pyx_n_s_Xindices, __pyx_n_s_Xindptr, __pyx_n_s_n, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_Xdatap, __pyx_n_s_Xindicesp, __pyx_n_s_Xindptrp, __pyx_n_s_outp, __pyx_n_s_Ci, __pyx_n_s_i, __pyx_n_s_Cj, __pyx_n_s_X_idx, __pyx_n_s_j, __pyx_n_s_Xval, __pyx_n_s_vval, __pyx_n_s_col_included); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_tuple__30 = PyTuple_Pack(22, __pyx_n_s_X, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_Xdata, __pyx_n_s_Xindices, __pyx_n_s_Xindptr, __pyx_n_s_n, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_Xdatap, __pyx_n_s_Xindicesp, __pyx_n_s_Xindptrp, __pyx_n_s_outp, __pyx_n_s_Ci, __pyx_n_s_i, __pyx_n_s_Cj, __pyx_n_s_X_idx, __pyx_n_s_j, __pyx_n_s_Xval, __pyx_n_s_vval, __pyx_n_s_col_included); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__30);
   __Pyx_GIVEREF(__pyx_tuple__30);
-  __pyx_codeobj__31 = (PyObject*)__Pyx_PyCode_New(4, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csr_matvec, 110, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__31)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_codeobj__31 = (PyObject*)__Pyx_PyCode_New(4, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csr_matvec, 102, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__31)) __PYX_ERR(0, 102, __pyx_L1_error)
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
-  __pyx_tuple__32 = PyTuple_Pack(18, __pyx_n_s_XT, __pyx_n_s_v, __pyx_n_s_out, __pyx_n_s_XT_indices, __pyx_n_s_XTdata, __pyx_n_s_XTindices, __pyx_n_s_XTindptr, __pyx_n_s_m, __pyx_n_s_out_view, __pyx_n_s_XTdatap, __pyx_n_s_XTindicesp, __pyx_n_s_XTindptrp, __pyx_n_s_outp, __pyx_n_s_i, __pyx_n_s_XT_idx, __pyx_n_s_j, __pyx_n_s_XTval, __pyx_n_s_vval); if (unlikely(!__pyx_tuple__32)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_tuple__32 = PyTuple_Pack(18, __pyx_n_s_XT, __pyx_n_s_v, __pyx_n_s_out, __pyx_n_s_XT_indices, __pyx_n_s_XTdata, __pyx_n_s_XTindices, __pyx_n_s_XTindptr, __pyx_n_s_m, __pyx_n_s_out_view, __pyx_n_s_XTdatap, __pyx_n_s_XTindicesp, __pyx_n_s_XTindptrp, __pyx_n_s_outp, __pyx_n_s_i, __pyx_n_s_XT_idx, __pyx_n_s_j, __pyx_n_s_XTval, __pyx_n_s_vval); if (unlikely(!__pyx_tuple__32)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__32);
   __Pyx_GIVEREF(__pyx_tuple__32);
-  __pyx_codeobj__33 = (PyObject*)__Pyx_PyCode_New(4, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__32, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csc_rmatvec_unrestricted, 149, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__33)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_codeobj__33 = (PyObject*)__Pyx_PyCode_New(4, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__32, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csc_rmatvec_unrestricted, 139, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__33)) __PYX_ERR(0, 139, __pyx_L1_error)
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
-  __pyx_tuple__34 = PyTuple_Pack(23, __pyx_n_s_XT, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_XTdata, __pyx_n_s_XTindices, __pyx_n_s_XTindptr, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_XTdatap, __pyx_n_s_XTindicesp, __pyx_n_s_XTindptrp, __pyx_n_s_outp, __pyx_n_s_Ci, __pyx_n_s_i, __pyx_n_s_Cj, __pyx_n_s_XT_idx, __pyx_n_s_j, __pyx_n_s_XTval, __pyx_n_s_vval, __pyx_n_s_row_included); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_tuple__34 = PyTuple_Pack(23, __pyx_n_s_XT, __pyx_n_s_v, __pyx_n_s_rows, __pyx_n_s_cols, __pyx_n_s_XTdata, __pyx_n_s_XTindices, __pyx_n_s_XTindptr, __pyx_n_s_n, __pyx_n_s_m, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_XTdatap, __pyx_n_s_XTindicesp, __pyx_n_s_XTindptrp, __pyx_n_s_outp, __pyx_n_s_Ci, __pyx_n_s_i, __pyx_n_s_Cj, __pyx_n_s_XT_idx, __pyx_n_s_j, __pyx_n_s_XTval, __pyx_n_s_vval, __pyx_n_s_row_included); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__34);
   __Pyx_GIVEREF(__pyx_tuple__34);
-  __pyx_codeobj__35 = (PyObject*)__Pyx_PyCode_New(4, 0, 23, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__34, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csc_rmatvec, 177, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__35)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_codeobj__35 = (PyObject*)__Pyx_PyCode_New(4, 0, 23, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__34, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csc_rmatvec, 165, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__35)) __PYX_ERR(0, 165, __pyx_L1_error)
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
-  __pyx_tuple__36 = PyTuple_Pack(22, __pyx_n_s_A, __pyx_n_s_B, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_A_cols, __pyx_n_s_B_cols, __pyx_n_s_Adata, __pyx_n_s_Aindices, __pyx_n_s_Aindptr, __pyx_n_s_m, __pyx_n_s_n, __pyx_n_s_r, __pyx_n_s_nr, __pyx_n_s_nAc, __pyx_n_s_nBc, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Bp, __pyx_n_s_rowsp, __pyx_n_s_A_colsp, __pyx_n_s_B_colsp); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_tuple__36 = PyTuple_Pack(22, __pyx_n_s_A, __pyx_n_s_B, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_A_cols, __pyx_n_s_B_cols, __pyx_n_s_Adata, __pyx_n_s_Aindices, __pyx_n_s_Aindptr, __pyx_n_s_m, __pyx_n_s_n, __pyx_n_s_r, __pyx_n_s_nr, __pyx_n_s_nAc, __pyx_n_s_nBc, __pyx_n_s_out, __pyx_n_s_out_view, __pyx_n_s_outp, __pyx_n_s_Bp, __pyx_n_s_rowsp, __pyx_n_s_A_colsp, __pyx_n_s_B_colsp); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__36);
   __Pyx_GIVEREF(__pyx_tuple__36);
-  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(6, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csr_dense_sandwich, 220, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(6, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_csr_dense_sandwich, 208, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 208, __pyx_L1_error)
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
-  __pyx_tuple__38 = PyTuple_Pack(12, __pyx_n_s_data, __pyx_n_s_indices, __pyx_n_s_indptr, __pyx_n_s_weights, __pyx_n_s_dtype, __pyx_n_s_ncols, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_out, __pyx_n_s_outp, __pyx_n_s_v); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_tuple__38 = PyTuple_Pack(12, __pyx_n_s_data, __pyx_n_s_indices, __pyx_n_s_indptr, __pyx_n_s_weights, __pyx_n_s_dtype, __pyx_n_s_ncols, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_out, __pyx_n_s_outp, __pyx_n_s_v); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__38);
   __Pyx_GIVEREF(__pyx_tuple__38);
-  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(5, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_transpose_square_dot_weights, 271, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(5, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_sparse_pyx, __pyx_n_s_transpose_square_dot_weights, 259, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 259, __pyx_L1_error)
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
@@ -55558,55 +55570,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -55826,435 +55822,434 @@
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "tabmat/ext/sparse.pyx":2
- * # cython: boundscheck=False, wraparound=False, cdivision=True
+  /* "tabmat/ext/sparse.pyx":1
  * import numpy as np             # <<<<<<<<<<<<<<
  * cimport numpy as np
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":18
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":14
+ *     long long
+ * 
  * def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     # AT is CSC
  *     # A is CSC
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_15sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_15sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_17sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_17sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_19sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_19sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_21sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_21sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_23sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_23sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_25sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_25sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_27sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_27sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_29sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_29sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_1sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_1sparse_sandwich, 0, __pyx_n_s_sparse_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sparse_sandwich, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sparse_sandwich, __pyx_t_2) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/sparse.pyx":82
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":76
+ *     return out
+ * 
  * def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] Xdata = X.data
  *     cdef win_integral[:] Xindices = X.indices
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_33csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_33csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_short, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_short, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_35csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_35csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_int, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_int, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_37csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_37csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_39csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_39csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_41csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_41csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_short, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_short, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_43csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_43csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_int, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_int, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_45csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_45csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_47csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_47csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_3csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_3csr_matvec_unrestricted, 0, __pyx_n_s_csr_matvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_1)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csr_matvec_unrestricted, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csr_matvec_unrestricted, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":110
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":102
+ *     return out
+ * 
  * def csr_matvec(             # <<<<<<<<<<<<<<
  *         X,
  *         floating[:] v,
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_51csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_51csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_53csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_53csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_55csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_55csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_57csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_57csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_59csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_59csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_61csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_61csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_63csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_63csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_65csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_65csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_5csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_5csr_matvec, 0, __pyx_n_s_csr_matvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csr_matvec, __pyx_t_2) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csr_matvec, __pyx_t_2) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/sparse.pyx":149
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":139
+ *     return out
+ * 
  * def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_69csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_69csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_short, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_short, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_71csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_71csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_int, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_int, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_73csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_73csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_75csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_75csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_77csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_77csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_short, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_short, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_79csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_79csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_int, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_int, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_81csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_81csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_83csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_83csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_7csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_7csc_rmatvec_unrestricted, 0, __pyx_n_s_csc_rmatvec_unrestricted, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_1)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csc_rmatvec_unrestricted, __pyx_t_1) < 0) __PYX_ERR(0, 149, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csc_rmatvec_unrestricted, __pyx_t_1) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":177
- * @cython.boundscheck(False)
- * @cython.wraparound(False)
+  /* "tabmat/ext/sparse.pyx":165
+ *     return out
+ * 
  * def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):             # <<<<<<<<<<<<<<
  *     cdef floating[:] XTdata = XT.data
  *     cdef win_integral[:] XTindices = XT.indices
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_87csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_87csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_89csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_89csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_91csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_91csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_93csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_93csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_95csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_95csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_97csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_97csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_99csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_99csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_101csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_101csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_9csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_9csc_rmatvec, 0, __pyx_n_s_csc_rmatvec, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csc_rmatvec, __pyx_t_2) < 0) __PYX_ERR(0, 177, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csc_rmatvec, __pyx_t_2) < 0) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/sparse.pyx":220
+  /* "tabmat/ext/sparse.pyx":208
  *     ) nogil
  * 
  * def csr_dense_sandwich(             # <<<<<<<<<<<<<<
  *         A,
  *         np.ndarray B,
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_105csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_105csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_short, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_short, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_107csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_107csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_int, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_int, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_109csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_109csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_111csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_111csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_float_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_113csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_113csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_short, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_short, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_115csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_115csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_int, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_int, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_117csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_117csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_119csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_119csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_double_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_11csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_11csr_dense_sandwich, 0, __pyx_n_s_csr_dense_sandwich, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_1)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csr_dense_sandwich, __pyx_t_1) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csr_dense_sandwich, __pyx_t_1) < 0) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/sparse.pyx":271
+  /* "tabmat/ext/sparse.pyx":259
  *     return out
  * 
  * def transpose_square_dot_weights(             # <<<<<<<<<<<<<<
  *         floating[:] data,
  *         win_integral[:] indices,
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_123transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_6tabmat_3ext_6sparse_123transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_short, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_125transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_6tabmat_3ext_6sparse_125transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_int, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_127transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_6tabmat_3ext_6sparse_127transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_129transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_6tabmat_3ext_6sparse_129transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_float_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_131transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_6tabmat_3ext_6sparse_131transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_short, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_133transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_6tabmat_3ext_6sparse_133transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_int, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_135transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_6tabmat_3ext_6sparse_135transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_137transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_6tabmat_3ext_6sparse_137transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_kp_s_double_long_long, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_13transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_6sparse_13transpose_square_dot_weights, 0, __pyx_n_s_transpose_square_dot_weights, NULL, __pyx_n_s_tabmat_ext_sparse, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_square_dot_weights, __pyx_t_2) < 0) __PYX_ERR(0, 271, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_transpose_square_dot_weights, __pyx_t_2) < 0) __PYX_ERR(0, 259, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "tabmat/ext/sparse.pyx":1
- * # cython: boundscheck=False, wraparound=False, cdivision=True             # <<<<<<<<<<<<<<
- * import numpy as np
+ * import numpy as np             # <<<<<<<<<<<<<<
  * cimport numpy as np
+ * 
  */
   __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "View.MemoryView":210
@@ -57026,28 +57021,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -58947,61 +58942,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -59625,15 +59638,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -60008,15 +60024,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_FusedFunction_init(void) {
     __pyx_FusedFunctionType_type.tp_base = __pyx_CyFunctionType;
     __pyx_FusedFunctionType = __Pyx_FetchCommonType(&__pyx_FusedFunctionType_type);
     if (__pyx_FusedFunctionType == NULL) {
@@ -61825,15 +61844,15 @@
                         } else if (8 * sizeof(int64_t) >= 4 * PyLong_SHIFT) {
                             return (int64_t) (((((((((int64_t)digits[3]) << PyLong_SHIFT) | (int64_t)digits[2]) << PyLong_SHIFT) | (int64_t)digits[1]) << PyLong_SHIFT) | (int64_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -62135,15 +62154,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -62331,15 +62350,15 @@
                         } else if (8 * sizeof(short) >= 4 * PyLong_SHIFT) {
                             return (short) (((((((((short)digits[3]) << PyLong_SHIFT) | (short)digits[2]) << PyLong_SHIFT) | (short)digits[1]) << PyLong_SHIFT) | (short)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -62527,15 +62546,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -62723,15 +62742,15 @@
                         } else if (8 * sizeof(PY_LONG_LONG) >= 4 * PyLong_SHIFT) {
                             return (PY_LONG_LONG) (((((((((PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (PY_LONG_LONG)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -62945,15 +62964,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/sparse.pyx` & `tabmat-3.1.8/src/tabmat/ext/sparse.pyx`

 * *Files 22% similar despite different names*

```diff
@@ -1,24 +1,20 @@
-# cython: boundscheck=False, wraparound=False, cdivision=True
 import numpy as np
 cimport numpy as np
 
-import cython
 from cython cimport floating, integral
 from cython.parallel import prange
 from libc.stdint cimport int64_t
 
 ctypedef np.uint8_t uint8
 
 ctypedef fused win_integral:
     integral
     long long
 
-@cython.boundscheck(False)
-@cython.wraparound(False)
 def sparse_sandwich(A, AT, floating[:] d, win_integral[:] rows, win_integral[:] cols):
     # AT is CSC
     # A is CSC
     # Computes AT @ diag(d) @ A
 
     cdef floating[:] Adata = A.data
     cdef win_integral[:] Aindices = A.indices
@@ -73,16 +69,14 @@
 
                 AT_val = ATdatap[AT_idx]
                 outp[Cj * m + Ci] = outp[Cj * m + Ci] + AT_val * A_val
 
     out += np.tril(out, -1).T
     return out
 
-@cython.boundscheck(False)
-@cython.wraparound(False)
 def csr_matvec_unrestricted(X, floating[:] v, out, win_integral[:] X_indices):
     cdef floating[:] Xdata = X.data
     cdef win_integral[:] Xindices = X.indices
     cdef win_integral[:] Xindptr = X.indptr
 
     if out is None:
         out = np.zeros(X.shape[0], dtype=X.dtype)
@@ -101,16 +95,14 @@
         for X_idx in range(Xindptrp[i], Xindptrp[i+1]):
             j = Xindicesp[X_idx]
             Xval = Xdatap[X_idx]
             vval = v[j]
             outp[i] = outp[i] + Xval * vval;
     return out
 
-@cython.boundscheck(False)
-@cython.wraparound(False)
 def csr_matvec(
         X,
         floating[:] v,
         win_integral[:] rows,
         win_integral[:] cols
     ):
     cdef floating[:] Xdata = X.data
@@ -140,16 +132,14 @@
             if not col_included[j]:
                 continue
             Xval = Xdatap[X_idx]
             vval = v[j]
             outp[Ci] = outp[Ci] + Xval * vval;
     return out
 
-@cython.boundscheck(False)
-@cython.wraparound(False)
 def csc_rmatvec_unrestricted(XT, floating[:] v, out, win_integral[:] XT_indices):
     cdef floating[:] XTdata = XT.data
     cdef win_integral[:] XTindices = XT.indices
     cdef win_integral[:] XTindptr = XT.indptr
 
     cdef int m = XT.shape[1]
     if out is None:
@@ -168,16 +158,14 @@
         for XT_idx in range(XTindptrp[j], XTindptrp[j+1]):
             i = XTindicesp[XT_idx]
             XTval = XTdatap[XT_idx];
             vval = v[i]
             outp[j] = outp[j] + XTval * vval;
     return out
 
-@cython.boundscheck(False)
-@cython.wraparound(False)
 def csc_rmatvec(XT, floating[:] v, win_integral[:] rows, win_integral[:] cols):
     cdef floating[:] XTdata = XT.data
     cdef win_integral[:] XTindices = XT.indices
     cdef win_integral[:] XTindptr = XT.indptr
 
     cdef int64_t n = rows.shape[0]
     cdef int64_t m = cols.shape[0]
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/sparse_helpers-tmpl.cpp` & `tabmat-3.1.8/src/tabmat/ext/sparse_helpers-tmpl.cpp`

 * *Files 13% similar despite different names*

```diff
@@ -29,100 +29,99 @@
     Int* rows, Int* A_cols, Int* B_cols,
     Int nrows, Int nA_cols, Int nB_cols
     ) 
 {
     constexpr Int simd_size = xsimd::simd_type<F>::size;
     constexpr auto alignment = simd_size*sizeof(F);
 
-    Int kblock = 128;
-    Int jblock = 128;
+    int kblock = 128;
+    int jblock = 128;
     auto Rglobal = make_aligned_unique<F>(
         omp_get_max_threads() * kblock * jblock,
         alignment
     );
 
     std::vector<Int> Acol_map(m, -1);
     // Don't parallelize because the number of columns is small
-    for (Int Ci = 0; Ci < nA_cols; Ci++) {
-        Int i = A_cols[Ci];
-        Acol_map[i] = Ci;
+    for (Py_ssize_t Ci = 0; Ci < nA_cols; Ci++) {
+        Acol_map[A_cols[Ci]] = Ci;
     }
 
     #pragma omp parallel
     {
-        Int nB_cols_rounded = ceil(((float)nB_cols) / ((float)simd_size)) * simd_size;
+        Py_ssize_t nB_cols_rounded = ceil(((float)nB_cols) / ((float)simd_size)) * simd_size;
         auto outtemp = make_aligned_unique<F>(
             nA_cols * nB_cols_rounded,
             alignment
         );
-        for (Int Ci = 0; Ci < nA_cols; Ci++) {
-            for (Int Cj = 0; Cj < nB_cols; Cj++) {
-                outtemp.get()[Ci*nB_cols_rounded+Cj] = 0.0;
+        for (Py_ssize_t Ci = 0; Ci < nA_cols; Ci++) {
+            for (Py_ssize_t Cj = 0; Cj < nB_cols; Cj++) {
+                outtemp.get()[Ci * nB_cols_rounded + Cj] = 0.0;
             }
         }
 
         #pragma omp for
-        for (Int Ckk = 0; Ckk < nrows; Ckk+=kblock) {
-            Int Ckmax = Ckk + kblock;
+        for (Py_ssize_t Ckk = 0; Ckk < nrows; Ckk+=kblock) {
+            Py_ssize_t Ckmax = Ckk + kblock;
             if (Ckmax > nrows) {
                 Ckmax = nrows;
             }
-            for (Int Cjj = 0; Cjj < nB_cols; Cjj+=jblock) {
-                Int Cjmax = Cjj + jblock;
+            for (Py_ssize_t Cjj = 0; Cjj < nB_cols; Cjj+=jblock) {
+                Py_ssize_t Cjmax = Cjj + jblock;
                 if (Cjmax > nB_cols) {
                     Cjmax = nB_cols;
                 }
 
                 F* R = &Rglobal.get()[omp_get_thread_num()*kblock*jblock];
-                for (Int Ck = Ckk; Ck < Ckmax; Ck++) {
-                    SIZE_T k = rows[Ck];
-                    for (Int Cj = Cjj; Cj < Cjmax; Cj++) {
-                        SIZE_T j = B_cols[Cj];
+                for (Py_ssize_t Ck = Ckk; Ck < Ckmax; Ck++) {
+                    Int k = rows[Ck];
+                    for (Py_ssize_t Cj = Cjj; Cj < Cjmax; Cj++) {
+                        Int j = B_cols[Cj];
                         %if order == 'C':
-                            F Bv = B[k * r + j];
+                            F Bv = B[(Py_ssize_t) k * r + j];
                         % else:
-                            F Bv = B[j * n + k];
+                            F Bv = B[(Py_ssize_t) j * n + k];
                         % endif
-                        R[(Ck-Ckk) * jblock + (Cj-Cjj)] = d[k] * Bv;
+                        R[(Py_ssize_t) (Ck-Ckk) * jblock + (Cj-Cjj)] = d[k] * Bv;
                     }
                 }
 
-                for (Int Ck = Ckk; Ck < Ckmax; Ck++) {
+                for (Py_ssize_t Ck = Ckk; Ck < Ckmax; Ck++) {
                     Int k = rows[Ck];
                     for (Int A_idx = Aindptr[k]; A_idx < Aindptr[k+1]; A_idx++) {
                         Int i = Aindices[A_idx];
-                        Int Ci = Acol_map[i];
+                        Py_ssize_t Ci = Acol_map[i];
                         if (Ci == -1) {
                             continue;
                         }
 
                         F Q = Adata[A_idx];
                         auto Qsimd = xs::XSIMD_BROADCAST(Q);
 
-                        Int Cj = Cjj;
-                        Int Cjmax2 = Cjj + ((Cjmax - Cjj) / simd_size) * simd_size;
+                        Py_ssize_t Cj = Cjj;
+                        Py_ssize_t Cjmax2 = Cjj + ((Cjmax - Cjj) / simd_size) * simd_size;
                         for (; Cj < Cjmax2; Cj+=simd_size) {
-                            auto Bsimd = xs::load_aligned(&R[(Ck-Ckk)*jblock+(Cj-Cjj)]);
-                            auto outsimd = xs::load_aligned(&outtemp.get()[Ci*nB_cols_rounded+Cj]);
+                            auto Bsimd = xs::load_aligned(&R[(Py_ssize_t) (Ck-Ckk) * jblock + (Cj-Cjj)]);
+                            auto outsimd = xs::load_aligned(&outtemp.get()[Ci * nB_cols_rounded + Cj]);
                             outsimd = xs::fma(Qsimd, Bsimd, outsimd);
-                            outsimd.store_aligned(&outtemp.get()[Ci*nB_cols_rounded+Cj]);
+                            outsimd.store_aligned(&outtemp.get()[Ci * nB_cols_rounded + Cj]);
                         }
 
                         for (; Cj < Cjmax; Cj++) {
-                            outtemp.get()[Ci*nB_cols_rounded+Cj] += Q * R[(Ck-Ckk)*jblock+(Cj-Cjj)];
+                            outtemp.get()[Ci * nB_cols_rounded + Cj] += Q * R[(Py_ssize_t) (Ck-Ckk) * jblock + (Cj-Cjj)];
                         }
                     }
                 }
             }
         }
 
-        for (Int Ci = 0; Ci < nA_cols; Ci++) {
-            for (Int Cj = 0; Cj < nB_cols; Cj++) {
+        for (Py_ssize_t Ci = 0; Ci < nA_cols; Ci++) {
+            for (Py_ssize_t Cj = 0; Cj < nB_cols; Cj++) {
                 #pragma omp atomic
-                out[Ci*nB_cols+Cj] += outtemp.get()[Ci*nB_cols_rounded+Cj];
+                out[(Py_ssize_t) Ci * nB_cols + Cj] += outtemp.get()[Ci * nB_cols_rounded + Cj];
             }
         }
     }
 }
 </%def>
 
 ${csr_dense_sandwich_tmpl('C')}
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/split.cpp` & `tabmat-3.1.8/src/tabmat/ext/split.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,33 +1,33 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h",
             "src/tabmat/ext/cat_split_helpers.cpp"
         ],
         "extra_compile_args": [
             "-fopenmp",
             "-O3",
             "-ffast-math",
             "--std=c++17",
             "-DJEMALLOC_INSTALL_SUFFIX="
         ],
         "extra_link_args": [
             "-fopenmp"
         ],
         "include_dirs": [
             "src/tabmat/ext",
-            "/opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/core/include"
+            "/opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "name": "tabmat.ext.split",
         "sources": [
             "src/tabmat/ext/split.pyx"
         ]
     },
@@ -40,17 +40,17 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
-#define CYTHON_FUTURE_DIVISION 0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
+#define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
@@ -109,16 +109,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -234,15 +238,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -273,15 +277,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -1146,213 +1150,213 @@
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":689
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":690
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":691
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":692
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":696
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":697
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":698
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":699
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":703
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":704
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":713
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":714
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":715
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":717
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":718
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":719
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":721
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":722
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":724
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":725
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":726
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
 
-/* "tabmat/ext/split.pyx":17
+/* "tabmat/ext/split.pyx":16
  *     Py_ssize_t* data
  *     Py_ssize_t length
  * ctypedef np.uint8_t uint8             # <<<<<<<<<<<<<<
  * ctypedef np.int8_t int8
  * ctypedef fused win_integral:
  */
 typedef __pyx_t_5numpy_uint8_t __pyx_t_6tabmat_3ext_5split_uint8;
 
-/* "tabmat/ext/split.pyx":18
+/* "tabmat/ext/split.pyx":17
  *     Py_ssize_t length
  * ctypedef np.uint8_t uint8
  * ctypedef np.int8_t int8             # <<<<<<<<<<<<<<
  * ctypedef fused win_integral:
  *     integral
  */
 typedef __pyx_t_5numpy_int8_t __pyx_t_6tabmat_3ext_5split_int8;
@@ -1383,52 +1387,52 @@
 
 /*--- Type declarations ---*/
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":728
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":729
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":730
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":732
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
 struct __pyx_t_6tabmat_3ext_5split_ArrayableMemoryView;
 
-/* "tabmat/ext/split.pyx":14
+/* "tabmat/ext/split.pyx":13
  * # memoryviews in Cython
  * # https://stackoverflow.com/questions/56915835/how-to-have-a-list-of-memory-views-in-cython
  * cdef struct ArrayableMemoryView:             # <<<<<<<<<<<<<<
  *     Py_ssize_t* data
  *     Py_ssize_t length
  */
 struct __pyx_t_6tabmat_3ext_5split_ArrayableMemoryView {
@@ -2144,22 +2148,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* CythonFunctionShared.proto */
 #define __Pyx_CyFunction_USED 1
@@ -2757,32 +2769,36 @@
 static const char __pyx_k_i_cols[] = "i_cols";
 static const char __pyx_k_i_ncol[] = "i_ncol";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_j_cols[] = "j_cols";
 static const char __pyx_k_j_ncol[] = "j_ncol";
 static const char __pyx_k_kwargs[] = "kwargs";
 static const char __pyx_k_n_cols[] = "n_cols";
+static const char __pyx_k_n_rows[] = "n_rows";
 static const char __pyx_k_name_2[] = "__name__";
 static const char __pyx_k_pickle[] = "pickle";
 static const char __pyx_k_reduce[] = "__reduce__";
 static const char __pyx_k_rows_p[] = "rows_p";
 static const char __pyx_k_struct[] = "struct";
 static const char __pyx_k_unpack[] = "unpack";
 static const char __pyx_k_update[] = "update";
 static const char __pyx_k_asarray[] = "asarray";
 static const char __pyx_k_fortran[] = "fortran";
 static const char __pyx_k_indices[] = "indices";
 static const char __pyx_k_mat_j_p[] = "mat_j_p";
 static const char __pyx_k_memview[] = "memview";
+static const char __pyx_k_nj_cols[] = "nj_cols";
+static const char __pyx_k_nj_rows[] = "nj_rows";
 static const char __pyx_k_Ellipsis[] = "Ellipsis";
 static const char __pyx_k_defaults[] = "defaults";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_itemsize[] = "itemsize";
 static const char __pyx_k_j_cols_p[] = "j_cols_p";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
+static const char __pyx_k_res_size[] = "res_size";
 static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_TypeError[] = "TypeError";
 static const char __pyx_k_enumerate[] = "enumerate";
 static const char __pyx_k_i_indices[] = "i_indices";
 static const char __pyx_k_is_sorted[] = "is_sorted";
 static const char __pyx_k_j_indices[] = "j_indices";
 static const char __pyx_k_long_long[] = "long long";
@@ -2800,19 +2816,21 @@
 static const char __pyx_k_i_indices_p[] = "i_indices_p";
 static const char __pyx_k_subset_cols[] = "subset_cols";
 static const char __pyx_k_i_drop_first[] = "i_drop_first";
 static const char __pyx_k_indices_arrs[] = "indices_arrs";
 static const char __pyx_k_j_drop_first[] = "j_drop_first";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
 static const char __pyx_k_stringsource[] = "stringsource";
+static const char __pyx_k_n_active_rows[] = "n_active_rows";
 static const char __pyx_k_pyx_getbuffer[] = "__pyx_getbuffer";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_this_idx_view[] = "this_idx_view";
 static const char __pyx_k_i_col_included[] = "i_col_included";
 static const char __pyx_k_j_col_included[] = "j_col_included";
+static const char __pyx_k_nj_active_cols[] = "nj_active_cols";
 static const char __pyx_k_View_MemoryView[] = "View.MemoryView";
 static const char __pyx_k_allocate_buffer[] = "allocate_buffer";
 static const char __pyx_k_dtype_is_object[] = "dtype_is_object";
 static const char __pyx_k_is_c_contiguous[] = "is_c_contiguous";
 static const char __pyx_k_next_subset_idx[] = "next_subset_idx";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
@@ -2948,26 +2966,31 @@
 static PyObject *__pyx_n_s_long;
 static PyObject *__pyx_kp_s_long_long;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_mat_j;
 static PyObject *__pyx_n_s_mat_j_p;
 static PyObject *__pyx_n_s_memview;
 static PyObject *__pyx_n_s_mode;
+static PyObject *__pyx_n_s_n_active_rows;
 static PyObject *__pyx_n_s_n_cols;
 static PyObject *__pyx_n_s_n_matrices;
+static PyObject *__pyx_n_s_n_rows;
 static PyObject *__pyx_n_s_name;
 static PyObject *__pyx_n_s_name_2;
 static PyObject *__pyx_n_s_ndim;
 static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_n_s_next_subset_idx;
+static PyObject *__pyx_n_s_nj_active_cols;
+static PyObject *__pyx_n_s_nj_cols;
+static PyObject *__pyx_n_s_nj_rows;
 static PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
 static PyObject *__pyx_n_s_np;
 static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_s_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_s_numpy_core_umath_failed_to_impor;
+static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
+static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
 static PyObject *__pyx_n_s_obj;
 static PyObject *__pyx_n_s_pack;
 static PyObject *__pyx_n_s_pickle;
 static PyObject *__pyx_n_s_pyx_PickleError;
 static PyObject *__pyx_n_s_pyx_checksum;
 static PyObject *__pyx_n_s_pyx_getbuffer;
 static PyObject *__pyx_n_s_pyx_result;
@@ -2976,14 +2999,15 @@
 static PyObject *__pyx_n_s_pyx_unpickle_Enum;
 static PyObject *__pyx_n_s_pyx_vtable;
 static PyObject *__pyx_n_s_range;
 static PyObject *__pyx_n_s_reduce;
 static PyObject *__pyx_n_s_reduce_cython;
 static PyObject *__pyx_n_s_reduce_ex;
 static PyObject *__pyx_n_s_res;
+static PyObject *__pyx_n_s_res_size;
 static PyObject *__pyx_n_s_rows;
 static PyObject *__pyx_n_s_rows_p;
 static PyObject *__pyx_n_s_s;
 static PyObject *__pyx_n_s_sandwich_cat_cat;
 static PyObject *__pyx_n_s_sandwich_cat_cat_limited_rows_c;
 static PyObject *__pyx_n_s_sandwich_cat_dense;
 static PyObject *__pyx_n_s_self;
@@ -3124,15 +3148,15 @@
 static PyObject *__pyx_codeobj__30;
 static PyObject *__pyx_codeobj__32;
 static PyObject *__pyx_codeobj__34;
 static PyObject *__pyx_codeobj__36;
 static PyObject *__pyx_codeobj__43;
 /* Late includes */
 
-/* "tabmat/ext/split.pyx":30
+/* "tabmat/ext/split.pyx":29
  * 
  * 
  * def sandwich_cat_dense(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int i_ncol,
  */
 
@@ -3173,31 +3197,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 29, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 30, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 29, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -3206,15 +3230,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 30, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 29, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_sandwich_cat_dense(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -3260,51 +3284,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("sandwich_cat_dense", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 30, __pyx_L1_error)
+    __PYX_ERR(0, 29, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 29, __pyx_L1_error)
   __pyx_t_2 = ((2 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 30, __pyx_L1_error)
+      __PYX_ERR(0, 29, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 2);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -3313,85 +3337,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 30, __pyx_L1_error)
+    __PYX_ERR(0, 29, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 30, __pyx_L1_error)
+      __PYX_ERR(0, 29, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 30, __pyx_L1_error)
+      __PYX_ERR(0, 29, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 30, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 29, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_7);
     __Pyx_GIVEREF(__pyx_int_7);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_7);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 30, __pyx_L1_error)
+    __PYX_ERR(0, 29, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -3405,62 +3429,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 30, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 30, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -3479,15 +3503,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -3501,100 +3525,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 30, __pyx_L1_error)
+    __PYX_ERR(0, 29, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 30, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 30, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 29, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 30, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 29, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -3602,43 +3626,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 30, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 29, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 30, __pyx_L1_error)
+    __PYX_ERR(0, 29, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 29, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 30, __pyx_L1_error)
+    __PYX_ERR(0, 29, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 30, __pyx_L1_error)
+      __PYX_ERR(0, 29, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -3712,429 +3736,458 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 1); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 1); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 2); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 2); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mat_j)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 3); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 3); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 4); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 4); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 5); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 5); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_is_c_contiguous)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 6); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 6); __PYX_ERR(0, 29, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_dense") < 0)) __PYX_ERR(0, 30, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_dense") < 0)) __PYX_ERR(0, 29, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 31, __pyx_L3_error)
-    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 32, __pyx_L3_error)
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 33, __pyx_L3_error)
+    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 30, __pyx_L3_error)
+    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 31, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 32, __pyx_L3_error)
     __pyx_v_mat_j = ((PyArrayObject *)values[3]);
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 35, __pyx_L3_error)
-    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 36, __pyx_L3_error)
-    __pyx_v_is_c_contiguous = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_is_c_contiguous == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 37, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 34, __pyx_L3_error)
+    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 35, __pyx_L3_error)
+    __pyx_v_is_c_contiguous = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_is_c_contiguous == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 36, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 30, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 29, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.sandwich_cat_dense", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mat_j), __pyx_ptype_5numpy_ndarray, 1, "mat_j", 0))) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mat_j), __pyx_ptype_5numpy_ndarray, 1, "mat_j", 0))) __PYX_ERR(0, 33, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_10sandwich_cat_dense(__pyx_self, __pyx_v_i_indices, __pyx_v_i_ncol, __pyx_v_d, __pyx_v_mat_j, __pyx_v_rows, __pyx_v_j_cols, __pyx_v_is_c_contiguous);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6tabmat_3ext_5split_10sandwich_cat_dense(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_i_indices, int __pyx_v_i_ncol, __Pyx_memviewslice __pyx_v_d, PyArrayObject *__pyx_v_mat_j, __Pyx_memviewslice __pyx_v_rows, __Pyx_memviewslice __pyx_v_j_cols, bool __pyx_v_is_c_contiguous) {
+  int __pyx_v_nj_rows;
+  int __pyx_v_nj_cols;
+  int __pyx_v_n_active_rows;
+  int __pyx_v_nj_active_cols;
   __Pyx_memviewslice __pyx_v_res = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_v_res_size;
   float *__pyx_v_d_p;
   int *__pyx_v_i_indices_p;
   int *__pyx_v_rows_p;
   int *__pyx_v_j_cols_p;
   float *__pyx_v_mat_j_p;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  size_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  size_t __pyx_t_3;
+  PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   __Pyx_memviewslice __pyx_t_6 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_t_7;
   int __pyx_t_8;
-  Py_ssize_t __pyx_t_9;
-  size_t __pyx_t_10;
+  int __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
   Py_ssize_t __pyx_t_11;
-  int __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0sandwich_cat_dense", 0);
 
+  /* "tabmat/ext/split.pyx":38
+ *     bool is_c_contiguous
+ * ):
+ *     cdef int nj_rows = mat_j.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef int nj_cols = mat_j.shape[1]
+ *     cdef int n_active_rows = len(rows)
+ */
+  __pyx_v_nj_rows = (__pyx_v_mat_j->dimensions[0]);
+
+  /* "tabmat/ext/split.pyx":39
+ * ):
+ *     cdef int nj_rows = mat_j.shape[0]
+ *     cdef int nj_cols = mat_j.shape[1]             # <<<<<<<<<<<<<<
+ *     cdef int n_active_rows = len(rows)
+ *     cdef int nj_active_cols = len(j_cols)
+ */
+  __pyx_v_nj_cols = (__pyx_v_mat_j->dimensions[1]);
+
+  /* "tabmat/ext/split.pyx":40
+ *     cdef int nj_rows = mat_j.shape[0]
+ *     cdef int nj_cols = mat_j.shape[1]
+ *     cdef int n_active_rows = len(rows)             # <<<<<<<<<<<<<<
+ *     cdef int nj_active_cols = len(j_cols)
+ *     cdef floating[:, :] res
+ */
+  __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_v_n_active_rows = __pyx_t_1;
+
   /* "tabmat/ext/split.pyx":41
- * 
+ *     cdef int nj_cols = mat_j.shape[1]
+ *     cdef int n_active_rows = len(rows)
+ *     cdef int nj_active_cols = len(j_cols)             # <<<<<<<<<<<<<<
+ *     cdef floating[:, :] res
+ *     res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)
+ */
+  __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
+  __pyx_v_nj_active_cols = __pyx_t_1;
+
+  /* "tabmat/ext/split.pyx":43
+ *     cdef int nj_active_cols = len(j_cols)
  *     cdef floating[:, :] res
- *     res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)             # <<<<<<<<<<<<<<
+ *     res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)             # <<<<<<<<<<<<<<
+ *     cdef int res_size = res.size
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
-  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_nj_active_cols); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
-  __pyx_t_1 = 0;
+  __pyx_t_2 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_mat_j), __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_mat_j), __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_res = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "tabmat/ext/split.pyx":43
- *     res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)
+  /* "tabmat/ext/split.pyx":44
+ *     cdef floating[:, :] res
+ *     res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)
+ *     cdef int res_size = res.size             # <<<<<<<<<<<<<<
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:
+ */
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 44, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_5); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 44, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_v_res_size = __pyx_t_7;
+
+  /* "tabmat/ext/split.pyx":46
+ *     cdef int res_size = res.size
+ * 
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
  *         return np.asarray(res)
  * 
  */
-  __pyx_t_8 = (((__pyx_v_d.shape[0]) == 0) != 0);
-  if (!__pyx_t_8) {
+  __pyx_t_9 = (((__pyx_v_d.shape[0]) == 0) != 0);
+  if (!__pyx_t_9) {
   } else {
-    __pyx_t_7 = __pyx_t_8;
+    __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_rows); 
-  __pyx_t_8 = ((__pyx_t_3 == 0) != 0);
-  if (!__pyx_t_8) {
+  __pyx_t_9 = ((__pyx_v_n_active_rows == 0) != 0);
+  if (!__pyx_t_9) {
   } else {
-    __pyx_t_7 = __pyx_t_8;
+    __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
-  __pyx_t_8 = ((__pyx_t_3 == 0) != 0);
-  if (!__pyx_t_8) {
+  __pyx_t_9 = ((__pyx_v_nj_active_cols == 0) != 0);
+  if (!__pyx_t_9) {
   } else {
-    __pyx_t_7 = __pyx_t_8;
+    __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_8 = ((__pyx_v_i_ncol == 0) != 0);
-  __pyx_t_7 = __pyx_t_8;
+  __pyx_t_9 = ((__pyx_v_i_ncol == 0) != 0);
+  __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_7) {
+  if (__pyx_t_8) {
 
-    /* "tabmat/ext/split.pyx":44
+    /* "tabmat/ext/split.pyx":47
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:
  *         return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* d_p = &d[0]
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 44, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 44, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 47, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 44, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_2 = NULL;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_2)) {
+      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_2);
+        __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
-    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 44, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_r = __pyx_t_5;
+    __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "tabmat/ext/split.pyx":43
- *     res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)
+    /* "tabmat/ext/split.pyx":46
+ *     cdef int res_size = res.size
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
  *         return np.asarray(res)
  * 
  */
   }
 
-  /* "tabmat/ext/split.pyx":46
+  /* "tabmat/ext/split.pyx":49
  *         return np.asarray(res)
  * 
  *     cdef floating* d_p = &d[0]             # <<<<<<<<<<<<<<
  *     cdef int* i_indices_p = &i_indices[0]
  *     cdef int* rows_p = &rows[0]
  */
-  __pyx_t_9 = 0;
-  __pyx_v_d_p = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_9 * __pyx_v_d.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_d_p = (&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_10 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":47
+  /* "tabmat/ext/split.pyx":50
  * 
  *     cdef floating* d_p = &d[0]
  *     cdef int* i_indices_p = &i_indices[0]             # <<<<<<<<<<<<<<
  *     cdef int* rows_p = &rows[0]
  *     cdef int* j_cols_p = &j_cols[0]
  */
-  __pyx_t_9 = 0;
-  __pyx_v_i_indices_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_9 * __pyx_v_i_indices.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_i_indices_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_10 * __pyx_v_i_indices.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":48
+  /* "tabmat/ext/split.pyx":51
  *     cdef floating* d_p = &d[0]
  *     cdef int* i_indices_p = &i_indices[0]
  *     cdef int* rows_p = &rows[0]             # <<<<<<<<<<<<<<
  *     cdef int* j_cols_p = &j_cols[0]
  * 
  */
-  __pyx_t_9 = 0;
-  __pyx_v_rows_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_rows_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_10 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":49
+  /* "tabmat/ext/split.pyx":52
  *     cdef int* i_indices_p = &i_indices[0]
  *     cdef int* rows_p = &rows[0]
  *     cdef int* j_cols_p = &j_cols[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* mat_j_p = <floating*>mat_j.data
  */
-  __pyx_t_9 = 0;
-  __pyx_v_j_cols_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_j_cols.data + __pyx_t_9 * __pyx_v_j_cols.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_j_cols_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_j_cols.data + __pyx_t_10 * __pyx_v_j_cols.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":51
+  /* "tabmat/ext/split.pyx":54
  *     cdef int* j_cols_p = &j_cols[0]
  * 
  *     cdef floating* mat_j_p = <floating*>mat_j.data             # <<<<<<<<<<<<<<
  * 
  *     if is_c_contiguous:
  */
   __pyx_v_mat_j_p = ((float *)__pyx_v_mat_j->data);
 
-  /* "tabmat/ext/split.pyx":53
+  /* "tabmat/ext/split.pyx":56
  *     cdef floating* mat_j_p = <floating*>mat_j.data
  * 
  *     if is_c_contiguous:             # <<<<<<<<<<<<<<
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
  */
-  __pyx_t_7 = (__pyx_v_is_c_contiguous != 0);
-  if (__pyx_t_7) {
-
-    /* "tabmat/ext/split.pyx":54
- * 
- *     if is_c_contiguous:
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
- */
-    __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_t_8 = (__pyx_v_is_c_contiguous != 0);
+  if (__pyx_t_8) {
 
-    /* "tabmat/ext/split.pyx":55
+    /* "tabmat/ext/split.pyx":58
  *     if is_c_contiguous:
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,             # <<<<<<<<<<<<<<
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,             # <<<<<<<<<<<<<<
+ *                             nj_rows, nj_cols)
  *     else:
  */
-    __pyx_t_10 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
-    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
     __pyx_t_11 = 0;
-    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 55, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 55, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 55, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "tabmat/ext/split.pyx":54
+    /* "tabmat/ext/split.pyx":57
  * 
  *     if is_c_contiguous:
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,             # <<<<<<<<<<<<<<
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
+ *                             nj_rows, nj_cols)
  */
-    _sandwich_cat_denseC<float>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_t_3, __pyx_v_j_cols_p, __pyx_t_10, (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_9 * __pyx_v_res.strides[0]) ) + __pyx_t_11 * __pyx_v_res.strides[1]) )))), __pyx_t_12, __pyx_v_mat_j_p, (__pyx_v_mat_j->dimensions[0]), (__pyx_v_mat_j->dimensions[1]));
+    _sandwich_cat_denseC<int,float>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_v_n_active_rows, __pyx_v_j_cols_p, __pyx_v_nj_active_cols, (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_10 * __pyx_v_res.strides[0]) ) + __pyx_t_11 * __pyx_v_res.strides[1]) )))), __pyx_v_res_size, __pyx_v_mat_j_p, __pyx_v_nj_rows, __pyx_v_nj_cols);
 
-    /* "tabmat/ext/split.pyx":53
+    /* "tabmat/ext/split.pyx":56
  *     cdef floating* mat_j_p = <floating*>mat_j.data
  * 
  *     if is_c_contiguous:             # <<<<<<<<<<<<<<
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/split.pyx":58
- *                             mat_j.shape[0], mat_j.shape[1])
+  /* "tabmat/ext/split.pyx":61
+ *                             nj_rows, nj_cols)
  *     else:
- *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,             # <<<<<<<<<<<<<<
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
+ *                             nj_rows, nj_cols)
  */
   /*else*/ {
-    __pyx_t_10 = __Pyx_MemoryView_Len(__pyx_v_rows); 
 
-    /* "tabmat/ext/split.pyx":59
+    /* "tabmat/ext/split.pyx":62
  *     else:
- *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,             # <<<<<<<<<<<<<<
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,             # <<<<<<<<<<<<<<
+ *                             nj_rows, nj_cols)
  * 
  */
-    __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
     __pyx_t_11 = 0;
-    __pyx_t_9 = 0;
-    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 59, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 59, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 59, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_10 = 0;
 
-    /* "tabmat/ext/split.pyx":58
- *                             mat_j.shape[0], mat_j.shape[1])
+    /* "tabmat/ext/split.pyx":61
+ *                             nj_rows, nj_cols)
  *     else:
- *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,             # <<<<<<<<<<<<<<
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
+ *                             nj_rows, nj_cols)
  */
-    _sandwich_cat_denseF<float>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_t_10, __pyx_v_j_cols_p, __pyx_t_3, (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_11 * __pyx_v_res.strides[0]) ) + __pyx_t_9 * __pyx_v_res.strides[1]) )))), __pyx_t_12, __pyx_v_mat_j_p, (__pyx_v_mat_j->dimensions[0]), (__pyx_v_mat_j->dimensions[1]));
+    _sandwich_cat_denseF<int,float>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_v_n_active_rows, __pyx_v_j_cols_p, __pyx_v_nj_active_cols, (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_11 * __pyx_v_res.strides[0]) ) + __pyx_t_10 * __pyx_v_res.strides[1]) )))), __pyx_v_res_size, __pyx_v_mat_j_p, __pyx_v_nj_rows, __pyx_v_nj_cols);
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/split.pyx":62
- *                             mat_j.shape[0], mat_j.shape[1])
+  /* "tabmat/ext/split.pyx":65
+ *                             nj_rows, nj_cols)
  * 
  *     return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 62, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = NULL;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
-    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
-    if (likely(__pyx_t_2)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
-      __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_3 = NULL;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_3)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_5, function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
-  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":30
+  /* "tabmat/ext/split.pyx":29
  * 
  * 
  * def sandwich_cat_dense(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int i_ncol,
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
   __Pyx_AddTraceback("tabmat.ext.split.sandwich_cat_dense", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_res, 1);
@@ -4193,429 +4246,458 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 1); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 1); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 2); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 2); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_mat_j)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 3); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 3); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 4); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 4); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 5); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 5); __PYX_ERR(0, 29, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_is_c_contiguous)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 6); __PYX_ERR(0, 30, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, 6); __PYX_ERR(0, 29, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_dense") < 0)) __PYX_ERR(0, 30, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_dense") < 0)) __PYX_ERR(0, 29, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
     }
-    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 31, __pyx_L3_error)
-    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 32, __pyx_L3_error)
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 33, __pyx_L3_error)
+    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 30, __pyx_L3_error)
+    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 31, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 32, __pyx_L3_error)
     __pyx_v_mat_j = ((PyArrayObject *)values[3]);
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 35, __pyx_L3_error)
-    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 36, __pyx_L3_error)
-    __pyx_v_is_c_contiguous = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_is_c_contiguous == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 37, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 34, __pyx_L3_error)
+    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 35, __pyx_L3_error)
+    __pyx_v_is_c_contiguous = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_is_c_contiguous == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 36, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 30, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sandwich_cat_dense", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 29, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.sandwich_cat_dense", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mat_j), __pyx_ptype_5numpy_ndarray, 1, "mat_j", 0))) __PYX_ERR(0, 34, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mat_j), __pyx_ptype_5numpy_ndarray, 1, "mat_j", 0))) __PYX_ERR(0, 33, __pyx_L1_error)
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_12sandwich_cat_dense(__pyx_self, __pyx_v_i_indices, __pyx_v_i_ncol, __pyx_v_d, __pyx_v_mat_j, __pyx_v_rows, __pyx_v_j_cols, __pyx_v_is_c_contiguous);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6tabmat_3ext_5split_12sandwich_cat_dense(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_i_indices, int __pyx_v_i_ncol, __Pyx_memviewslice __pyx_v_d, PyArrayObject *__pyx_v_mat_j, __Pyx_memviewslice __pyx_v_rows, __Pyx_memviewslice __pyx_v_j_cols, bool __pyx_v_is_c_contiguous) {
+  int __pyx_v_nj_rows;
+  int __pyx_v_nj_cols;
+  int __pyx_v_n_active_rows;
+  int __pyx_v_nj_active_cols;
   __Pyx_memviewslice __pyx_v_res = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_v_res_size;
   double *__pyx_v_d_p;
   int *__pyx_v_i_indices_p;
   int *__pyx_v_rows_p;
   int *__pyx_v_j_cols_p;
   double *__pyx_v_mat_j_p;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  size_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  size_t __pyx_t_3;
+  PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   __Pyx_memviewslice __pyx_t_6 = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_t_7;
   int __pyx_t_8;
-  Py_ssize_t __pyx_t_9;
-  size_t __pyx_t_10;
+  int __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
   Py_ssize_t __pyx_t_11;
-  int __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1sandwich_cat_dense", 0);
 
+  /* "tabmat/ext/split.pyx":38
+ *     bool is_c_contiguous
+ * ):
+ *     cdef int nj_rows = mat_j.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef int nj_cols = mat_j.shape[1]
+ *     cdef int n_active_rows = len(rows)
+ */
+  __pyx_v_nj_rows = (__pyx_v_mat_j->dimensions[0]);
+
+  /* "tabmat/ext/split.pyx":39
+ * ):
+ *     cdef int nj_rows = mat_j.shape[0]
+ *     cdef int nj_cols = mat_j.shape[1]             # <<<<<<<<<<<<<<
+ *     cdef int n_active_rows = len(rows)
+ *     cdef int nj_active_cols = len(j_cols)
+ */
+  __pyx_v_nj_cols = (__pyx_v_mat_j->dimensions[1]);
+
+  /* "tabmat/ext/split.pyx":40
+ *     cdef int nj_rows = mat_j.shape[0]
+ *     cdef int nj_cols = mat_j.shape[1]
+ *     cdef int n_active_rows = len(rows)             # <<<<<<<<<<<<<<
+ *     cdef int nj_active_cols = len(j_cols)
+ *     cdef floating[:, :] res
+ */
+  __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_v_n_active_rows = __pyx_t_1;
+
   /* "tabmat/ext/split.pyx":41
- * 
+ *     cdef int nj_cols = mat_j.shape[1]
+ *     cdef int n_active_rows = len(rows)
+ *     cdef int nj_active_cols = len(j_cols)             # <<<<<<<<<<<<<<
+ *     cdef floating[:, :] res
+ *     res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)
+ */
+  __pyx_t_1 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
+  __pyx_v_nj_active_cols = __pyx_t_1;
+
+  /* "tabmat/ext/split.pyx":43
+ *     cdef int nj_active_cols = len(j_cols)
  *     cdef floating[:, :] res
- *     res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)             # <<<<<<<<<<<<<<
+ *     res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)             # <<<<<<<<<<<<<<
+ *     cdef int res_size = res.size
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
-  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_nj_active_cols); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
-  __pyx_t_1 = 0;
+  __pyx_t_2 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 41, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_mat_j), __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_mat_j), __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 41, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 43, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_res = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "tabmat/ext/split.pyx":43
- *     res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)
+  /* "tabmat/ext/split.pyx":44
+ *     cdef floating[:, :] res
+ *     res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)
+ *     cdef int res_size = res.size             # <<<<<<<<<<<<<<
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:
+ */
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 44, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_5); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 44, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_v_res_size = __pyx_t_7;
+
+  /* "tabmat/ext/split.pyx":46
+ *     cdef int res_size = res.size
+ * 
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
  *         return np.asarray(res)
  * 
  */
-  __pyx_t_8 = (((__pyx_v_d.shape[0]) == 0) != 0);
-  if (!__pyx_t_8) {
+  __pyx_t_9 = (((__pyx_v_d.shape[0]) == 0) != 0);
+  if (!__pyx_t_9) {
   } else {
-    __pyx_t_7 = __pyx_t_8;
+    __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_rows); 
-  __pyx_t_8 = ((__pyx_t_3 == 0) != 0);
-  if (!__pyx_t_8) {
+  __pyx_t_9 = ((__pyx_v_n_active_rows == 0) != 0);
+  if (!__pyx_t_9) {
   } else {
-    __pyx_t_7 = __pyx_t_8;
+    __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
-  __pyx_t_8 = ((__pyx_t_3 == 0) != 0);
-  if (!__pyx_t_8) {
+  __pyx_t_9 = ((__pyx_v_nj_active_cols == 0) != 0);
+  if (!__pyx_t_9) {
   } else {
-    __pyx_t_7 = __pyx_t_8;
+    __pyx_t_8 = __pyx_t_9;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_8 = ((__pyx_v_i_ncol == 0) != 0);
-  __pyx_t_7 = __pyx_t_8;
+  __pyx_t_9 = ((__pyx_v_i_ncol == 0) != 0);
+  __pyx_t_8 = __pyx_t_9;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_7) {
+  if (__pyx_t_8) {
 
-    /* "tabmat/ext/split.pyx":44
+    /* "tabmat/ext/split.pyx":47
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:
  *         return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* d_p = &d[0]
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 44, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 44, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 47, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 44, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_2 = NULL;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_2)) {
+      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_2);
+        __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
-    __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 44, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_r = __pyx_t_5;
+    __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "tabmat/ext/split.pyx":43
- *     res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)
+    /* "tabmat/ext/split.pyx":46
+ *     cdef int res_size = res.size
  * 
- *     if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
+ *     if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:             # <<<<<<<<<<<<<<
  *         return np.asarray(res)
  * 
  */
   }
 
-  /* "tabmat/ext/split.pyx":46
+  /* "tabmat/ext/split.pyx":49
  *         return np.asarray(res)
  * 
  *     cdef floating* d_p = &d[0]             # <<<<<<<<<<<<<<
  *     cdef int* i_indices_p = &i_indices[0]
  *     cdef int* rows_p = &rows[0]
  */
-  __pyx_t_9 = 0;
-  __pyx_v_d_p = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_9 * __pyx_v_d.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_d_p = (&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_10 * __pyx_v_d.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":47
+  /* "tabmat/ext/split.pyx":50
  * 
  *     cdef floating* d_p = &d[0]
  *     cdef int* i_indices_p = &i_indices[0]             # <<<<<<<<<<<<<<
  *     cdef int* rows_p = &rows[0]
  *     cdef int* j_cols_p = &j_cols[0]
  */
-  __pyx_t_9 = 0;
-  __pyx_v_i_indices_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_9 * __pyx_v_i_indices.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_i_indices_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_10 * __pyx_v_i_indices.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":48
+  /* "tabmat/ext/split.pyx":51
  *     cdef floating* d_p = &d[0]
  *     cdef int* i_indices_p = &i_indices[0]
  *     cdef int* rows_p = &rows[0]             # <<<<<<<<<<<<<<
  *     cdef int* j_cols_p = &j_cols[0]
  * 
  */
-  __pyx_t_9 = 0;
-  __pyx_v_rows_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_rows_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_10 * __pyx_v_rows.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":49
+  /* "tabmat/ext/split.pyx":52
  *     cdef int* i_indices_p = &i_indices[0]
  *     cdef int* rows_p = &rows[0]
  *     cdef int* j_cols_p = &j_cols[0]             # <<<<<<<<<<<<<<
  * 
  *     cdef floating* mat_j_p = <floating*>mat_j.data
  */
-  __pyx_t_9 = 0;
-  __pyx_v_j_cols_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_j_cols.data + __pyx_t_9 * __pyx_v_j_cols.strides[0]) ))));
+  __pyx_t_10 = 0;
+  __pyx_v_j_cols_p = (&(*((int *) ( /* dim=0 */ (__pyx_v_j_cols.data + __pyx_t_10 * __pyx_v_j_cols.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":51
+  /* "tabmat/ext/split.pyx":54
  *     cdef int* j_cols_p = &j_cols[0]
  * 
  *     cdef floating* mat_j_p = <floating*>mat_j.data             # <<<<<<<<<<<<<<
  * 
  *     if is_c_contiguous:
  */
   __pyx_v_mat_j_p = ((double *)__pyx_v_mat_j->data);
 
-  /* "tabmat/ext/split.pyx":53
+  /* "tabmat/ext/split.pyx":56
  *     cdef floating* mat_j_p = <floating*>mat_j.data
  * 
  *     if is_c_contiguous:             # <<<<<<<<<<<<<<
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
  */
-  __pyx_t_7 = (__pyx_v_is_c_contiguous != 0);
-  if (__pyx_t_7) {
-
-    /* "tabmat/ext/split.pyx":54
- * 
- *     if is_c_contiguous:
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
- */
-    __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_t_8 = (__pyx_v_is_c_contiguous != 0);
+  if (__pyx_t_8) {
 
-    /* "tabmat/ext/split.pyx":55
+    /* "tabmat/ext/split.pyx":58
  *     if is_c_contiguous:
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,             # <<<<<<<<<<<<<<
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,             # <<<<<<<<<<<<<<
+ *                             nj_rows, nj_cols)
  *     else:
  */
-    __pyx_t_10 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
-    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
     __pyx_t_11 = 0;
-    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 55, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 55, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 55, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "tabmat/ext/split.pyx":54
+    /* "tabmat/ext/split.pyx":57
  * 
  *     if is_c_contiguous:
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,             # <<<<<<<<<<<<<<
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
+ *                             nj_rows, nj_cols)
  */
-    _sandwich_cat_denseC<double>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_t_3, __pyx_v_j_cols_p, __pyx_t_10, (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_9 * __pyx_v_res.strides[0]) ) + __pyx_t_11 * __pyx_v_res.strides[1]) )))), __pyx_t_12, __pyx_v_mat_j_p, (__pyx_v_mat_j->dimensions[0]), (__pyx_v_mat_j->dimensions[1]));
+    _sandwich_cat_denseC<int,double>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_v_n_active_rows, __pyx_v_j_cols_p, __pyx_v_nj_active_cols, (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_10 * __pyx_v_res.strides[0]) ) + __pyx_t_11 * __pyx_v_res.strides[1]) )))), __pyx_v_res_size, __pyx_v_mat_j_p, __pyx_v_nj_rows, __pyx_v_nj_cols);
 
-    /* "tabmat/ext/split.pyx":53
+    /* "tabmat/ext/split.pyx":56
  *     cdef floating* mat_j_p = <floating*>mat_j.data
  * 
  *     if is_c_contiguous:             # <<<<<<<<<<<<<<
- *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
+ *         _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
  */
     goto __pyx_L8;
   }
 
-  /* "tabmat/ext/split.pyx":58
- *                             mat_j.shape[0], mat_j.shape[1])
+  /* "tabmat/ext/split.pyx":61
+ *                             nj_rows, nj_cols)
  *     else:
- *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,             # <<<<<<<<<<<<<<
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
+ *                             nj_rows, nj_cols)
  */
   /*else*/ {
-    __pyx_t_10 = __Pyx_MemoryView_Len(__pyx_v_rows); 
 
-    /* "tabmat/ext/split.pyx":59
+    /* "tabmat/ext/split.pyx":62
  *     else:
- *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,             # <<<<<<<<<<<<<<
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,             # <<<<<<<<<<<<<<
+ *                             nj_rows, nj_cols)
  * 
  */
-    __pyx_t_3 = __Pyx_MemoryView_Len(__pyx_v_j_cols); 
     __pyx_t_11 = 0;
-    __pyx_t_9 = 0;
-    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 59, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 59, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 59, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_10 = 0;
 
-    /* "tabmat/ext/split.pyx":58
- *                             mat_j.shape[0], mat_j.shape[1])
+    /* "tabmat/ext/split.pyx":61
+ *                             nj_rows, nj_cols)
  *     else:
- *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,             # <<<<<<<<<<<<<<
- *                             len(j_cols), &res[0, 0], res.size, mat_j_p,
- *                             mat_j.shape[0], mat_j.shape[1])
+ *         _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,             # <<<<<<<<<<<<<<
+ *                             nj_active_cols, &res[0, 0], res_size, mat_j_p,
+ *                             nj_rows, nj_cols)
  */
-    _sandwich_cat_denseF<double>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_t_10, __pyx_v_j_cols_p, __pyx_t_3, (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_11 * __pyx_v_res.strides[0]) ) + __pyx_t_9 * __pyx_v_res.strides[1]) )))), __pyx_t_12, __pyx_v_mat_j_p, (__pyx_v_mat_j->dimensions[0]), (__pyx_v_mat_j->dimensions[1]));
+    _sandwich_cat_denseF<int,double>(__pyx_v_d_p, __pyx_v_i_indices_p, __pyx_v_rows_p, __pyx_v_n_active_rows, __pyx_v_j_cols_p, __pyx_v_nj_active_cols, (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_11 * __pyx_v_res.strides[0]) ) + __pyx_t_10 * __pyx_v_res.strides[1]) )))), __pyx_v_res_size, __pyx_v_mat_j_p, __pyx_v_nj_rows, __pyx_v_nj_cols);
   }
   __pyx_L8:;
 
-  /* "tabmat/ext/split.pyx":62
- *                             mat_j.shape[0], mat_j.shape[1])
+  /* "tabmat/ext/split.pyx":65
+ *                             nj_rows, nj_cols)
  * 
  *     return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 62, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 62, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = NULL;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
-    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
-    if (likely(__pyx_t_2)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
-      __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_3 = NULL;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_3)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_5, function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
-  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":30
+  /* "tabmat/ext/split.pyx":29
  * 
  * 
  * def sandwich_cat_dense(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int i_ncol,
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __PYX_XDEC_MEMVIEW(&__pyx_t_6, 1);
   __Pyx_AddTraceback("tabmat.ext.split.sandwich_cat_dense", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_res, 1);
@@ -4624,15 +4706,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_j_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/split.pyx":65
+/* "tabmat/ext/split.pyx":68
  * 
  * 
  * def sandwich_cat_cat(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
 
@@ -4674,31 +4756,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 68, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 65, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 68, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -4707,15 +4789,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 65, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 68, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_2sandwich_cat_cat(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -4761,51 +4843,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("sandwich_cat_cat", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 65, __pyx_L1_error)
+    __PYX_ERR(0, 68, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
   __pyx_t_2 = ((4 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 65, __pyx_L1_error)
+      __PYX_ERR(0, 68, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 4);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -4814,85 +4896,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 65, __pyx_L1_error)
+    __PYX_ERR(0, 68, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 65, __pyx_L1_error)
+      __PYX_ERR(0, 68, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 65, __pyx_L1_error)
+      __PYX_ERR(0, 68, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_9);
     __Pyx_GIVEREF(__pyx_int_9);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_9);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 65, __pyx_L1_error)
+    __PYX_ERR(0, 68, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -4906,62 +4988,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 65, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -4980,15 +5062,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -5002,100 +5084,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 65, __pyx_L1_error)
+    __PYX_ERR(0, 68, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 65, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 65, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 65, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 68, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -5103,43 +5185,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 65, __pyx_L1_error)
+    __PYX_ERR(0, 68, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 68, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 65, __pyx_L1_error)
+    __PYX_ERR(0, 68, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 65, __pyx_L1_error)
+      __PYX_ERR(0, 68, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -5219,240 +5301,260 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 1); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 1); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 2); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 2); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 3); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 3); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 4); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 4); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 5); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 5); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 6); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 6); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
         if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_drop_first)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 7); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 7); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  8:
         if (likely((values[8] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_drop_first)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 8); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 8); __PYX_ERR(0, 68, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_cat") < 0)) __PYX_ERR(0, 65, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_cat") < 0)) __PYX_ERR(0, 68, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 9) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
       values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
       values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
     }
-    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 66, __pyx_L3_error)
-    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 67, __pyx_L3_error)
-    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L3_error)
-    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L3_error)
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 70, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 71, __pyx_L3_error)
+    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 69, __pyx_L3_error)
+    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 70, __pyx_L3_error)
+    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 71, __pyx_L3_error)
+    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 72, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
     __pyx_v_dtype = values[6];
-    __pyx_v_i_drop_first = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_i_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
-    __pyx_v_j_drop_first = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_j_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 74, __pyx_L3_error)
+    __pyx_v_i_drop_first = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_i_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L3_error)
+    __pyx_v_j_drop_first = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_j_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 77, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 65, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 68, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.sandwich_cat_cat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_16sandwich_cat_cat(__pyx_self, __pyx_v_i_indices, __pyx_v_j_indices, __pyx_v_i_ncol, __pyx_v_j_ncol, __pyx_v_d, __pyx_v_rows, __pyx_v_dtype, __pyx_v_i_drop_first, __pyx_v_j_drop_first);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6tabmat_3ext_5split_16sandwich_cat_cat(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_i_indices, __Pyx_memviewslice __pyx_v_j_indices, int __pyx_v_i_ncol, int __pyx_v_j_ncol, __Pyx_memviewslice __pyx_v_d, __Pyx_memviewslice __pyx_v_rows, PyObject *__pyx_v_dtype, int __pyx_v_i_drop_first, int __pyx_v_j_drop_first) {
   __Pyx_memviewslice __pyx_v_res = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_v_n_rows;
+  int __pyx_v_res_size;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   __Pyx_memviewslice __pyx_t_5 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  Py_ssize_t __pyx_t_6;
-  Py_ssize_t __pyx_t_7;
+  size_t __pyx_t_6;
+  int __pyx_t_7;
   Py_ssize_t __pyx_t_8;
   Py_ssize_t __pyx_t_9;
-  size_t __pyx_t_10;
+  Py_ssize_t __pyx_t_10;
   Py_ssize_t __pyx_t_11;
   Py_ssize_t __pyx_t_12;
-  int __pyx_t_13;
+  Py_ssize_t __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0sandwich_cat_cat", 0);
 
-  /* "tabmat/ext/split.pyx":79
+  /* "tabmat/ext/split.pyx":82
  *     (X1.T @ diag(d) @ X2)[i, j] = sum_k X1[k, i] d[k] X2[k, j]
  *     """
  *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)             # <<<<<<<<<<<<<<
- * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),
+ *     cdef int n_rows = len(rows)
+ *     cdef int res_size = res.size
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 79, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_res = __pyx_t_5;
   __pyx_t_5.memview = NULL;
   __pyx_t_5.data = NULL;
 
-  /* "tabmat/ext/split.pyx":81
+  /* "tabmat/ext/split.pyx":83
+ *     """
  *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+ *     cdef int n_rows = len(rows)             # <<<<<<<<<<<<<<
+ *     cdef int res_size = res.size
  * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),             # <<<<<<<<<<<<<<
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+ */
+  __pyx_t_6 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_v_n_rows = __pyx_t_6;
+
+  /* "tabmat/ext/split.pyx":84
+ *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+ *     cdef int n_rows = len(rows)
+ *     cdef int res_size = res.size             # <<<<<<<<<<<<<<
+ * 
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,
+ */
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_v_res_size = __pyx_t_7;
+
+  /* "tabmat/ext/split.pyx":86
+ *     cdef int res_size = res.size
+ * 
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,             # <<<<<<<<<<<<<<
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
  * 
  */
-  __pyx_t_6 = 0;
-  __pyx_t_7 = 0;
   __pyx_t_8 = 0;
   __pyx_t_9 = 0;
-  __pyx_t_10 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_t_10 = 0;
+  __pyx_t_11 = 0;
 
-  /* "tabmat/ext/split.pyx":82
+  /* "tabmat/ext/split.pyx":87
  * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)             # <<<<<<<<<<<<<<
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)             # <<<<<<<<<<<<<<
  * 
  *     return np.asarray(res)
  */
-  __pyx_t_11 = 0;
   __pyx_t_12 = 0;
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_13 = 0;
 
-  /* "tabmat/ext/split.pyx":81
- *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+  /* "tabmat/ext/split.pyx":86
+ *     cdef int res_size = res.size
  * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),             # <<<<<<<<<<<<<<
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,             # <<<<<<<<<<<<<<
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
  * 
  */
-  _sandwich_cat_cat<float>((&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_6 * __pyx_v_d.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_7 * __pyx_v_i_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_j_indices.data + __pyx_t_8 * __pyx_v_j_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )))), __pyx_t_10, (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_11 * __pyx_v_res.strides[0]) ) + __pyx_t_12 * __pyx_v_res.strides[1]) )))), __pyx_v_j_ncol, __pyx_t_13, __pyx_v_i_drop_first, __pyx_v_j_drop_first);
+  _sandwich_cat_cat<int,float>((&(*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_8 * __pyx_v_d.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_9 * __pyx_v_i_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_j_indices.data + __pyx_t_10 * __pyx_v_j_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) )))), __pyx_v_n_rows, (&(*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_12 * __pyx_v_res.strides[0]) ) + __pyx_t_13 * __pyx_v_res.strides[1]) )))), __pyx_v_j_ncol, __pyx_v_res_size, __pyx_v_i_drop_first, __pyx_v_j_drop_first);
 
-  /* "tabmat/ext/split.pyx":84
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+  /* "tabmat/ext/split.pyx":89
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
  * 
  *     return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":65
+  /* "tabmat/ext/split.pyx":68
  * 
  * 
  * def sandwich_cat_cat(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
 
@@ -5528,240 +5630,260 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 1); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 1); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 2); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 2); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 3); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 3); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 4); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 4); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 5); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 5); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_dtype)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 6); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 6); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
         if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_drop_first)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 7); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 7); __PYX_ERR(0, 68, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  8:
         if (likely((values[8] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_drop_first)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 8); __PYX_ERR(0, 65, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, 8); __PYX_ERR(0, 68, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_cat") < 0)) __PYX_ERR(0, 65, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sandwich_cat_cat") < 0)) __PYX_ERR(0, 68, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 9) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
       values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
       values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
     }
-    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 66, __pyx_L3_error)
-    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 67, __pyx_L3_error)
-    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L3_error)
-    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L3_error)
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 70, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 71, __pyx_L3_error)
+    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 69, __pyx_L3_error)
+    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 70, __pyx_L3_error)
+    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 71, __pyx_L3_error)
+    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 72, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 73, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 74, __pyx_L3_error)
     __pyx_v_dtype = values[6];
-    __pyx_v_i_drop_first = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_i_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
-    __pyx_v_j_drop_first = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_j_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 74, __pyx_L3_error)
+    __pyx_v_i_drop_first = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_i_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 76, __pyx_L3_error)
+    __pyx_v_j_drop_first = __Pyx_PyObject_IsTrue(values[8]); if (unlikely((__pyx_v_j_drop_first == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 77, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 65, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("sandwich_cat_cat", 1, 9, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 68, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.sandwich_cat_cat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_18sandwich_cat_cat(__pyx_self, __pyx_v_i_indices, __pyx_v_j_indices, __pyx_v_i_ncol, __pyx_v_j_ncol, __pyx_v_d, __pyx_v_rows, __pyx_v_dtype, __pyx_v_i_drop_first, __pyx_v_j_drop_first);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyObject *__pyx_pf_6tabmat_3ext_5split_18sandwich_cat_cat(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_i_indices, __Pyx_memviewslice __pyx_v_j_indices, int __pyx_v_i_ncol, int __pyx_v_j_ncol, __Pyx_memviewslice __pyx_v_d, __Pyx_memviewslice __pyx_v_rows, PyObject *__pyx_v_dtype, int __pyx_v_i_drop_first, int __pyx_v_j_drop_first) {
   __Pyx_memviewslice __pyx_v_res = { 0, 0, { 0 }, { 0 }, { 0 } };
+  int __pyx_v_n_rows;
+  int __pyx_v_res_size;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   __Pyx_memviewslice __pyx_t_5 = { 0, 0, { 0 }, { 0 }, { 0 } };
-  Py_ssize_t __pyx_t_6;
-  Py_ssize_t __pyx_t_7;
+  size_t __pyx_t_6;
+  int __pyx_t_7;
   Py_ssize_t __pyx_t_8;
   Py_ssize_t __pyx_t_9;
-  size_t __pyx_t_10;
+  Py_ssize_t __pyx_t_10;
   Py_ssize_t __pyx_t_11;
   Py_ssize_t __pyx_t_12;
-  int __pyx_t_13;
+  Py_ssize_t __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1sandwich_cat_cat", 0);
 
-  /* "tabmat/ext/split.pyx":79
+  /* "tabmat/ext/split.pyx":82
  *     (X1.T @ diag(d) @ X2)[i, j] = sum_k X1[k, i] d[k] X2[k, j]
  *     """
  *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)             # <<<<<<<<<<<<<<
- * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),
+ *     cdef int n_rows = len(rows)
+ *     cdef int res_size = res.size
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 79, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_v_dtype) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_res = __pyx_t_5;
   __pyx_t_5.memview = NULL;
   __pyx_t_5.data = NULL;
 
-  /* "tabmat/ext/split.pyx":81
+  /* "tabmat/ext/split.pyx":83
+ *     """
  *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+ *     cdef int n_rows = len(rows)             # <<<<<<<<<<<<<<
+ *     cdef int res_size = res.size
  * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),             # <<<<<<<<<<<<<<
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+ */
+  __pyx_t_6 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_v_n_rows = __pyx_t_6;
+
+  /* "tabmat/ext/split.pyx":84
+ *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+ *     cdef int n_rows = len(rows)
+ *     cdef int res_size = res.size             # <<<<<<<<<<<<<<
+ * 
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,
+ */
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_v_res_size = __pyx_t_7;
+
+  /* "tabmat/ext/split.pyx":86
+ *     cdef int res_size = res.size
+ * 
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,             # <<<<<<<<<<<<<<
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
  * 
  */
-  __pyx_t_6 = 0;
-  __pyx_t_7 = 0;
   __pyx_t_8 = 0;
   __pyx_t_9 = 0;
-  __pyx_t_10 = __Pyx_MemoryView_Len(__pyx_v_rows); 
+  __pyx_t_10 = 0;
+  __pyx_t_11 = 0;
 
-  /* "tabmat/ext/split.pyx":82
+  /* "tabmat/ext/split.pyx":87
  * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)             # <<<<<<<<<<<<<<
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)             # <<<<<<<<<<<<<<
  * 
  *     return np.asarray(res)
  */
-  __pyx_t_11 = 0;
   __pyx_t_12 = 0;
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_13 = __Pyx_PyInt_As_int(__pyx_t_4); if (unlikely((__pyx_t_13 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_13 = 0;
 
-  /* "tabmat/ext/split.pyx":81
- *     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+  /* "tabmat/ext/split.pyx":86
+ *     cdef int res_size = res.size
  * 
- *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),             # <<<<<<<<<<<<<<
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+ *     _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,             # <<<<<<<<<<<<<<
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
  * 
  */
-  _sandwich_cat_cat<double>((&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_6 * __pyx_v_d.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_7 * __pyx_v_i_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_j_indices.data + __pyx_t_8 * __pyx_v_j_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_9 * __pyx_v_rows.strides[0]) )))), __pyx_t_10, (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_11 * __pyx_v_res.strides[0]) ) + __pyx_t_12 * __pyx_v_res.strides[1]) )))), __pyx_v_j_ncol, __pyx_t_13, __pyx_v_i_drop_first, __pyx_v_j_drop_first);
+  _sandwich_cat_cat<int,double>((&(*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_8 * __pyx_v_d.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_9 * __pyx_v_i_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_j_indices.data + __pyx_t_10 * __pyx_v_j_indices.strides[0]) )))), (&(*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_11 * __pyx_v_rows.strides[0]) )))), __pyx_v_n_rows, (&(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_12 * __pyx_v_res.strides[0]) ) + __pyx_t_13 * __pyx_v_res.strides[1]) )))), __pyx_v_j_ncol, __pyx_v_res_size, __pyx_v_i_drop_first, __pyx_v_j_drop_first);
 
-  /* "tabmat/ext/split.pyx":84
- *                         &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+  /* "tabmat/ext/split.pyx":89
+ *                         &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
  * 
  *     return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":65
+  /* "tabmat/ext/split.pyx":68
  * 
  * 
  * def sandwich_cat_cat(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
 
@@ -5781,15 +5903,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_d, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_rows, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/split.pyx":88
+/* "tabmat/ext/split.pyx":93
  * 
  * # This seems slower, so not using it for now
  * def _sandwich_cat_cat_limited_rows_cols(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
 
@@ -5831,31 +5953,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 93, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 88, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 93, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -5864,15 +5986,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 88, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 93, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_4_sandwich_cat_cat_limited_rows_cols(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -5918,51 +6040,51 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_sandwich_cat_cat_limited_rows_cols", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 88, __pyx_L1_error)
+    __PYX_ERR(0, 93, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
   __pyx_t_2 = ((4 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 88, __pyx_L1_error)
+      __PYX_ERR(0, 93, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 4);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -5971,85 +6093,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 88, __pyx_L1_error)
+    __PYX_ERR(0, 93, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_d, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 88, __pyx_L1_error)
+      __PYX_ERR(0, 93, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_d); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 88, __pyx_L1_error)
+      __PYX_ERR(0, 93, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_8);
     __Pyx_GIVEREF(__pyx_int_8);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_8);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 88, __pyx_L1_error)
+    __PYX_ERR(0, 93, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -6063,62 +6185,62 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           break;
           case 'f':
           __pyx_t_2 = (((sizeof(float)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 93, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(double)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 93, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'c':
           break;
           case 'O':
           break;
@@ -6137,15 +6259,15 @@
     __pyx_L22_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_float, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -6159,100 +6281,100 @@
     __pyx_L26_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_double, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 88, __pyx_L1_error)
+    __PYX_ERR(0, 93, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 88, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 93, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L34;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -6260,43 +6382,43 @@
         }
         __pyx_L34:;
       }
     }
     __pyx_L32_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 88, __pyx_L1_error)
+    __PYX_ERR(0, 93, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 93, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 88, __pyx_L1_error)
+    __PYX_ERR(0, 93, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 88, __pyx_L1_error)
+      __PYX_ERR(0, 93, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 93, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -6373,80 +6495,80 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 1); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 1); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 2); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 2); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 3); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 3); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 4); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 4); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 5); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 5); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 6); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 6); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
         if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 7); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 7); __PYX_ERR(0, 93, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_sandwich_cat_cat_limited_rows_cols") < 0)) __PYX_ERR(0, 88, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_sandwich_cat_cat_limited_rows_cols") < 0)) __PYX_ERR(0, 93, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 8) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
       values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
     }
-    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 89, __pyx_L3_error)
-    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 90, __pyx_L3_error)
-    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L3_error)
-    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 92, __pyx_L3_error)
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 93, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 94, __pyx_L3_error)
-    __pyx_v_i_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_cols.memview)) __PYX_ERR(0, 95, __pyx_L3_error)
-    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[7], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 96, __pyx_L3_error)
+    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 94, __pyx_L3_error)
+    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 95, __pyx_L3_error)
+    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 96, __pyx_L3_error)
+    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_float(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 98, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 99, __pyx_L3_error)
+    __pyx_v_i_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_cols.memview)) __PYX_ERR(0, 100, __pyx_L3_error)
+    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[7], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 101, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 88, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 93, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split._sandwich_cat_cat_limited_rows_cols", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_22_sandwich_cat_cat_limited_rows_cols(__pyx_self, __pyx_v_i_indices, __pyx_v_j_indices, __pyx_v_i_ncol, __pyx_v_j_ncol, __pyx_v_d, __pyx_v_rows, __pyx_v_i_cols, __pyx_v_j_cols);
 
@@ -6486,31 +6608,31 @@
   size_t __pyx_t_18;
   size_t __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0_sandwich_cat_cat_limited_rows_cols", 0);
 
-  /* "tabmat/ext/split.pyx":108
+  /* "tabmat/ext/split.pyx":113
  * 
  *     cdef floating[:, :] res
  *     res = np.zeros((i_ncol, j_ncol))             # <<<<<<<<<<<<<<
  *     cdef size_t k_idx, k, i, j
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_2 = 0;
   __pyx_t_4 = 0;
@@ -6523,280 +6645,280 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_float(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_res = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "tabmat/ext/split.pyx":111
+  /* "tabmat/ext/split.pyx":116
  *     cdef size_t k_idx, k, i, j
  * 
  *     cdef uint8[:] i_col_included = np.zeros(i_ncol, dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(i_ncol):
  *         i_col_included[i_cols[Ci]] = 1
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 111, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_i_col_included = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/split.pyx":112
+  /* "tabmat/ext/split.pyx":117
  * 
  *     cdef uint8[:] i_col_included = np.zeros(i_ncol, dtype=np.uint8)
  *     for Ci in range(i_ncol):             # <<<<<<<<<<<<<<
  *         i_col_included[i_cols[Ci]] = 1
  * 
  */
   __pyx_t_8 = __pyx_v_i_ncol;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_Ci = __pyx_t_10;
 
-    /* "tabmat/ext/split.pyx":113
+    /* "tabmat/ext/split.pyx":118
  *     cdef uint8[:] i_col_included = np.zeros(i_ncol, dtype=np.uint8)
  *     for Ci in range(i_ncol):
  *         i_col_included[i_cols[Ci]] = 1             # <<<<<<<<<<<<<<
  * 
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)
  */
     __pyx_t_11 = __pyx_v_Ci;
     __pyx_t_12 = (*((int *) ( /* dim=0 */ (__pyx_v_i_cols.data + __pyx_t_11 * __pyx_v_i_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_i_col_included.data + __pyx_t_12 * __pyx_v_i_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/split.pyx":115
+  /* "tabmat/ext/split.pyx":120
  *         i_col_included[i_cols[Ci]] = 1
  * 
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(j_ncol):
  *         j_col_included[j_cols[Ci]] = 1
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uint8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uint8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_j_col_included = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/split.pyx":116
+  /* "tabmat/ext/split.pyx":121
  * 
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)
  *     for Ci in range(j_ncol):             # <<<<<<<<<<<<<<
  *         j_col_included[j_cols[Ci]] = 1
  * 
  */
   __pyx_t_8 = __pyx_v_j_ncol;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_Ci = __pyx_t_10;
 
-    /* "tabmat/ext/split.pyx":117
+    /* "tabmat/ext/split.pyx":122
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)
  *     for Ci in range(j_ncol):
  *         j_col_included[j_cols[Ci]] = 1             # <<<<<<<<<<<<<<
  * 
  *     for k_idx in range(len(rows)):
  */
     __pyx_t_11 = __pyx_v_Ci;
     __pyx_t_12 = (*((int *) ( /* dim=0 */ (__pyx_v_j_cols.data + __pyx_t_11 * __pyx_v_j_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_j_col_included.data + __pyx_t_12 * __pyx_v_j_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/split.pyx":119
+  /* "tabmat/ext/split.pyx":124
  *         j_col_included[j_cols[Ci]] = 1
  * 
  *     for k_idx in range(len(rows)):             # <<<<<<<<<<<<<<
  *         k = rows[k_idx]
  *         i = i_indices[k]
  */
   __pyx_t_13 = __Pyx_MemoryView_Len(__pyx_v_rows); 
   __pyx_t_14 = __pyx_t_13;
   for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
     __pyx_v_k_idx = __pyx_t_15;
 
-    /* "tabmat/ext/split.pyx":120
+    /* "tabmat/ext/split.pyx":125
  * 
  *     for k_idx in range(len(rows)):
  *         k = rows[k_idx]             # <<<<<<<<<<<<<<
  *         i = i_indices[k]
  *         if i_col_included[i]:
  */
     __pyx_t_16 = __pyx_v_k_idx;
     __pyx_v_k = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_16 * __pyx_v_rows.strides[0]) )));
 
-    /* "tabmat/ext/split.pyx":121
+    /* "tabmat/ext/split.pyx":126
  *     for k_idx in range(len(rows)):
  *         k = rows[k_idx]
  *         i = i_indices[k]             # <<<<<<<<<<<<<<
  *         if i_col_included[i]:
  *             j = j_indices[k]
  */
     __pyx_t_16 = __pyx_v_k;
     __pyx_v_i = (*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_16 * __pyx_v_i_indices.strides[0]) )));
 
-    /* "tabmat/ext/split.pyx":122
+    /* "tabmat/ext/split.pyx":127
  *         k = rows[k_idx]
  *         i = i_indices[k]
  *         if i_col_included[i]:             # <<<<<<<<<<<<<<
  *             j = j_indices[k]
  *             if j_col_included[j]:
  */
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_17 = ((*((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_i_col_included.data + __pyx_t_16 * __pyx_v_i_col_included.strides[0]) ))) != 0);
     if (__pyx_t_17) {
 
-      /* "tabmat/ext/split.pyx":123
+      /* "tabmat/ext/split.pyx":128
  *         i = i_indices[k]
  *         if i_col_included[i]:
  *             j = j_indices[k]             # <<<<<<<<<<<<<<
  *             if j_col_included[j]:
  *                 res[i, j] += d[k]
  */
       __pyx_t_16 = __pyx_v_k;
       __pyx_v_j = (*((int *) ( /* dim=0 */ (__pyx_v_j_indices.data + __pyx_t_16 * __pyx_v_j_indices.strides[0]) )));
 
-      /* "tabmat/ext/split.pyx":124
+      /* "tabmat/ext/split.pyx":129
  *         if i_col_included[i]:
  *             j = j_indices[k]
  *             if j_col_included[j]:             # <<<<<<<<<<<<<<
  *                 res[i, j] += d[k]
  * 
  */
       __pyx_t_16 = __pyx_v_j;
       __pyx_t_17 = ((*((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_j_col_included.data + __pyx_t_16 * __pyx_v_j_col_included.strides[0]) ))) != 0);
       if (__pyx_t_17) {
 
-        /* "tabmat/ext/split.pyx":125
+        /* "tabmat/ext/split.pyx":130
  *             j = j_indices[k]
  *             if j_col_included[j]:
  *                 res[i, j] += d[k]             # <<<<<<<<<<<<<<
  * 
  *     return np.asarray(res)
  */
         __pyx_t_16 = __pyx_v_k;
         __pyx_t_18 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_j;
         *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_18 * __pyx_v_res.strides[0]) ) + __pyx_t_19 * __pyx_v_res.strides[1]) )) += (*((float *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_16 * __pyx_v_d.strides[0]) )));
 
-        /* "tabmat/ext/split.pyx":124
+        /* "tabmat/ext/split.pyx":129
  *         if i_col_included[i]:
  *             j = j_indices[k]
  *             if j_col_included[j]:             # <<<<<<<<<<<<<<
  *                 res[i, j] += d[k]
  * 
  */
       }
 
-      /* "tabmat/ext/split.pyx":122
+      /* "tabmat/ext/split.pyx":127
  *         k = rows[k_idx]
  *         i = i_indices[k]
  *         if i_col_included[i]:             # <<<<<<<<<<<<<<
  *             j = j_indices[k]
  *             if j_col_included[j]:
  */
     }
   }
 
-  /* "tabmat/ext/split.pyx":127
+  /* "tabmat/ext/split.pyx":132
  *                 res[i, j] += d[k]
  * 
  *     return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_float, (int (*)(char *, PyObject *)) __pyx_memview_set_float, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 127, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":88
+  /* "tabmat/ext/split.pyx":93
  * 
  * # This seems slower, so not using it for now
  * def _sandwich_cat_cat_limited_rows_cols(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
 
@@ -6875,80 +6997,80 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_indices)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_indices)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 1); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 1); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 2); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 2); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_ncol)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 3); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 3); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 4); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 4); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_rows)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 5); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 5); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_i_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 6); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 6); __PYX_ERR(0, 93, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
         if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_j_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 7); __PYX_ERR(0, 88, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, 7); __PYX_ERR(0, 93, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_sandwich_cat_cat_limited_rows_cols") < 0)) __PYX_ERR(0, 88, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_sandwich_cat_cat_limited_rows_cols") < 0)) __PYX_ERR(0, 93, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 8) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
       values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
       values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
     }
-    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 89, __pyx_L3_error)
-    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 90, __pyx_L3_error)
-    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L3_error)
-    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 92, __pyx_L3_error)
-    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 93, __pyx_L3_error)
-    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 94, __pyx_L3_error)
-    __pyx_v_i_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_cols.memview)) __PYX_ERR(0, 95, __pyx_L3_error)
-    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[7], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 96, __pyx_L3_error)
+    __pyx_v_i_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_indices.memview)) __PYX_ERR(0, 94, __pyx_L3_error)
+    __pyx_v_j_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_indices.memview)) __PYX_ERR(0, 95, __pyx_L3_error)
+    __pyx_v_i_ncol = __Pyx_PyInt_As_int(values[2]); if (unlikely((__pyx_v_i_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 96, __pyx_L3_error)
+    __pyx_v_j_ncol = __Pyx_PyInt_As_int(values[3]); if (unlikely((__pyx_v_j_ncol == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
+    __pyx_v_d = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[4], PyBUF_WRITABLE); if (unlikely(!__pyx_v_d.memview)) __PYX_ERR(0, 98, __pyx_L3_error)
+    __pyx_v_rows = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[5], PyBUF_WRITABLE); if (unlikely(!__pyx_v_rows.memview)) __PYX_ERR(0, 99, __pyx_L3_error)
+    __pyx_v_i_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[6], PyBUF_WRITABLE); if (unlikely(!__pyx_v_i_cols.memview)) __PYX_ERR(0, 100, __pyx_L3_error)
+    __pyx_v_j_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[7], PyBUF_WRITABLE); if (unlikely(!__pyx_v_j_cols.memview)) __PYX_ERR(0, 101, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 88, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_sandwich_cat_cat_limited_rows_cols", 1, 8, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 93, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split._sandwich_cat_cat_limited_rows_cols", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_24_sandwich_cat_cat_limited_rows_cols(__pyx_self, __pyx_v_i_indices, __pyx_v_j_indices, __pyx_v_i_ncol, __pyx_v_j_ncol, __pyx_v_d, __pyx_v_rows, __pyx_v_i_cols, __pyx_v_j_cols);
 
@@ -6988,31 +7110,31 @@
   size_t __pyx_t_18;
   size_t __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1_sandwich_cat_cat_limited_rows_cols", 0);
 
-  /* "tabmat/ext/split.pyx":108
+  /* "tabmat/ext/split.pyx":113
  * 
  *     cdef floating[:, :] res
  *     res = np.zeros((i_ncol, j_ncol))             # <<<<<<<<<<<<<<
  *     cdef size_t k_idx, k, i, j
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_2 = 0;
   __pyx_t_4 = 0;
@@ -7025,280 +7147,280 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_res = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "tabmat/ext/split.pyx":111
+  /* "tabmat/ext/split.pyx":116
  *     cdef size_t k_idx, k, i, j
  * 
  *     cdef uint8[:] i_col_included = np.zeros(i_ncol, dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(i_ncol):
  *         i_col_included[i_cols[Ci]] = 1
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i_ncol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 111, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_i_col_included = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/split.pyx":112
+  /* "tabmat/ext/split.pyx":117
  * 
  *     cdef uint8[:] i_col_included = np.zeros(i_ncol, dtype=np.uint8)
  *     for Ci in range(i_ncol):             # <<<<<<<<<<<<<<
  *         i_col_included[i_cols[Ci]] = 1
  * 
  */
   __pyx_t_8 = __pyx_v_i_ncol;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_Ci = __pyx_t_10;
 
-    /* "tabmat/ext/split.pyx":113
+    /* "tabmat/ext/split.pyx":118
  *     cdef uint8[:] i_col_included = np.zeros(i_ncol, dtype=np.uint8)
  *     for Ci in range(i_ncol):
  *         i_col_included[i_cols[Ci]] = 1             # <<<<<<<<<<<<<<
  * 
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)
  */
     __pyx_t_11 = __pyx_v_Ci;
     __pyx_t_12 = (*((int *) ( /* dim=0 */ (__pyx_v_i_cols.data + __pyx_t_11 * __pyx_v_i_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_i_col_included.data + __pyx_t_12 * __pyx_v_i_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/split.pyx":115
+  /* "tabmat/ext/split.pyx":120
  *         i_col_included[i_cols[Ci]] = 1
  * 
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)             # <<<<<<<<<<<<<<
  *     for Ci in range(j_ncol):
  *         j_col_included[j_cols[Ci]] = 1
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_j_ncol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uint8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uint8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_6tabmat_3ext_5split_uint8(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_j_col_included = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/split.pyx":116
+  /* "tabmat/ext/split.pyx":121
  * 
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)
  *     for Ci in range(j_ncol):             # <<<<<<<<<<<<<<
  *         j_col_included[j_cols[Ci]] = 1
  * 
  */
   __pyx_t_8 = __pyx_v_j_ncol;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_Ci = __pyx_t_10;
 
-    /* "tabmat/ext/split.pyx":117
+    /* "tabmat/ext/split.pyx":122
  *     cdef uint8[:] j_col_included = np.zeros(j_ncol, dtype=np.uint8)
  *     for Ci in range(j_ncol):
  *         j_col_included[j_cols[Ci]] = 1             # <<<<<<<<<<<<<<
  * 
  *     for k_idx in range(len(rows)):
  */
     __pyx_t_11 = __pyx_v_Ci;
     __pyx_t_12 = (*((int *) ( /* dim=0 */ (__pyx_v_j_cols.data + __pyx_t_11 * __pyx_v_j_cols.strides[0]) )));
     *((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_j_col_included.data + __pyx_t_12 * __pyx_v_j_col_included.strides[0]) )) = 1;
   }
 
-  /* "tabmat/ext/split.pyx":119
+  /* "tabmat/ext/split.pyx":124
  *         j_col_included[j_cols[Ci]] = 1
  * 
  *     for k_idx in range(len(rows)):             # <<<<<<<<<<<<<<
  *         k = rows[k_idx]
  *         i = i_indices[k]
  */
   __pyx_t_13 = __Pyx_MemoryView_Len(__pyx_v_rows); 
   __pyx_t_14 = __pyx_t_13;
   for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
     __pyx_v_k_idx = __pyx_t_15;
 
-    /* "tabmat/ext/split.pyx":120
+    /* "tabmat/ext/split.pyx":125
  * 
  *     for k_idx in range(len(rows)):
  *         k = rows[k_idx]             # <<<<<<<<<<<<<<
  *         i = i_indices[k]
  *         if i_col_included[i]:
  */
     __pyx_t_16 = __pyx_v_k_idx;
     __pyx_v_k = (*((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_16 * __pyx_v_rows.strides[0]) )));
 
-    /* "tabmat/ext/split.pyx":121
+    /* "tabmat/ext/split.pyx":126
  *     for k_idx in range(len(rows)):
  *         k = rows[k_idx]
  *         i = i_indices[k]             # <<<<<<<<<<<<<<
  *         if i_col_included[i]:
  *             j = j_indices[k]
  */
     __pyx_t_16 = __pyx_v_k;
     __pyx_v_i = (*((int *) ( /* dim=0 */ (__pyx_v_i_indices.data + __pyx_t_16 * __pyx_v_i_indices.strides[0]) )));
 
-    /* "tabmat/ext/split.pyx":122
+    /* "tabmat/ext/split.pyx":127
  *         k = rows[k_idx]
  *         i = i_indices[k]
  *         if i_col_included[i]:             # <<<<<<<<<<<<<<
  *             j = j_indices[k]
  *             if j_col_included[j]:
  */
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_17 = ((*((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_i_col_included.data + __pyx_t_16 * __pyx_v_i_col_included.strides[0]) ))) != 0);
     if (__pyx_t_17) {
 
-      /* "tabmat/ext/split.pyx":123
+      /* "tabmat/ext/split.pyx":128
  *         i = i_indices[k]
  *         if i_col_included[i]:
  *             j = j_indices[k]             # <<<<<<<<<<<<<<
  *             if j_col_included[j]:
  *                 res[i, j] += d[k]
  */
       __pyx_t_16 = __pyx_v_k;
       __pyx_v_j = (*((int *) ( /* dim=0 */ (__pyx_v_j_indices.data + __pyx_t_16 * __pyx_v_j_indices.strides[0]) )));
 
-      /* "tabmat/ext/split.pyx":124
+      /* "tabmat/ext/split.pyx":129
  *         if i_col_included[i]:
  *             j = j_indices[k]
  *             if j_col_included[j]:             # <<<<<<<<<<<<<<
  *                 res[i, j] += d[k]
  * 
  */
       __pyx_t_16 = __pyx_v_j;
       __pyx_t_17 = ((*((__pyx_t_6tabmat_3ext_5split_uint8 *) ( /* dim=0 */ (__pyx_v_j_col_included.data + __pyx_t_16 * __pyx_v_j_col_included.strides[0]) ))) != 0);
       if (__pyx_t_17) {
 
-        /* "tabmat/ext/split.pyx":125
+        /* "tabmat/ext/split.pyx":130
  *             j = j_indices[k]
  *             if j_col_included[j]:
  *                 res[i, j] += d[k]             # <<<<<<<<<<<<<<
  * 
  *     return np.asarray(res)
  */
         __pyx_t_16 = __pyx_v_k;
         __pyx_t_18 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_j;
         *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_res.data + __pyx_t_18 * __pyx_v_res.strides[0]) ) + __pyx_t_19 * __pyx_v_res.strides[1]) )) += (*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_16 * __pyx_v_d.strides[0]) )));
 
-        /* "tabmat/ext/split.pyx":124
+        /* "tabmat/ext/split.pyx":129
  *         if i_col_included[i]:
  *             j = j_indices[k]
  *             if j_col_included[j]:             # <<<<<<<<<<<<<<
  *                 res[i, j] += d[k]
  * 
  */
       }
 
-      /* "tabmat/ext/split.pyx":122
+      /* "tabmat/ext/split.pyx":127
  *         k = rows[k_idx]
  *         i = i_indices[k]
  *         if i_col_included[i]:             # <<<<<<<<<<<<<<
  *             j = j_indices[k]
  *             if j_col_included[j]:
  */
     }
   }
 
-  /* "tabmat/ext/split.pyx":127
+  /* "tabmat/ext/split.pyx":132
  *                 res[i, j] += d[k]
  * 
  *     return np.asarray(res)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_res, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 127, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":88
+  /* "tabmat/ext/split.pyx":93
  * 
  * # This seems slower, so not using it for now
  * def _sandwich_cat_cat_limited_rows_cols(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
 
@@ -7324,15 +7446,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_i_cols, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_j_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/split.pyx":130
+/* "tabmat/ext/split.pyx":135
  * 
  * 
  * def split_col_subsets(self, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int[:] next_subset_idx = np.zeros(len(self.indices), dtype=np.int32)
  *     cdef vector[vector[int]] subset_cols_indices
  */
 
@@ -7367,32 +7489,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_cols)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("split_col_subsets", 1, 2, 2, 1); __PYX_ERR(0, 130, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("split_col_subsets", 1, 2, 2, 1); __PYX_ERR(0, 135, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "split_col_subsets") < 0)) __PYX_ERR(0, 130, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "split_col_subsets") < 0)) __PYX_ERR(0, 135, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
-    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 130, __pyx_L3_error)
+    __pyx_v_cols = __Pyx_PyObject_to_MemoryviewSlice_ds_int(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_cols.memview)) __PYX_ERR(0, 135, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("split_col_subsets", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 130, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("split_col_subsets", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 135, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.split_col_subsets", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_6split_col_subsets(__pyx_self, __pyx_v_self, __pyx_v_cols);
 
@@ -7408,14 +7530,16 @@
   std::vector<int>  __pyx_v_empty;
   int __pyx_v_j;
   int __pyx_v_n_matrices;
   struct __pyx_t_6tabmat_3ext_5split_ArrayableMemoryView *__pyx_v_indices_arrs;
   __Pyx_memviewslice __pyx_v_this_idx_view = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_v_i;
   int __pyx_v_n_cols;
+  int __pyx_7genexpr__pyx_v_j;
+  int __pyx_8genexpr1__pyx_v_j;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   Py_ssize_t __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -7437,539 +7561,543 @@
   PyObject *__pyx_t_21 = NULL;
   PyObject *__pyx_t_22 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("split_col_subsets", 0);
 
-  /* "tabmat/ext/split.pyx":131
+  /* "tabmat/ext/split.pyx":136
  * 
  * def split_col_subsets(self, int[:] cols):
  *     cdef int[:] next_subset_idx = np.zeros(len(self.indices), dtype=np.int32)             # <<<<<<<<<<<<<<
  *     cdef vector[vector[int]] subset_cols_indices
  *     cdef vector[vector[int]] subset_cols
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_3 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 136, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_next_subset_idx = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "tabmat/ext/split.pyx":134
+  /* "tabmat/ext/split.pyx":139
  *     cdef vector[vector[int]] subset_cols_indices
  *     cdef vector[vector[int]] subset_cols
  *     cdef vector[int] empty = []             # <<<<<<<<<<<<<<
  * 
  *     cdef int j
  */
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 134, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_8 = __pyx_convert_vector_from_py_int(__pyx_t_6); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 134, __pyx_L1_error)
+  __pyx_t_8 = __pyx_convert_vector_from_py_int(__pyx_t_6); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_empty = __pyx_t_8;
 
-  /* "tabmat/ext/split.pyx":137
+  /* "tabmat/ext/split.pyx":142
  * 
  *     cdef int j
  *     cdef int n_matrices = len(self.indices)             # <<<<<<<<<<<<<<
  *     cdef ArrayableMemoryView* indices_arrs = <ArrayableMemoryView*> malloc(
  *         sizeof(ArrayableMemoryView) * n_matrices
  */
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 137, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 137, __pyx_L1_error)
+  __pyx_t_3 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 142, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_n_matrices = __pyx_t_3;
 
-  /* "tabmat/ext/split.pyx":138
+  /* "tabmat/ext/split.pyx":143
  *     cdef int j
  *     cdef int n_matrices = len(self.indices)
  *     cdef ArrayableMemoryView* indices_arrs = <ArrayableMemoryView*> malloc(             # <<<<<<<<<<<<<<
  *         sizeof(ArrayableMemoryView) * n_matrices
  *     );
  */
   __pyx_v_indices_arrs = ((struct __pyx_t_6tabmat_3ext_5split_ArrayableMemoryView *)malloc(((sizeof(struct __pyx_t_6tabmat_3ext_5split_ArrayableMemoryView)) * __pyx_v_n_matrices)));
 
-  /* "tabmat/ext/split.pyx":142
+  /* "tabmat/ext/split.pyx":147
  *     );
  *     cdef Py_ssize_t[:] this_idx_view
  *     for j in range(n_matrices):             # <<<<<<<<<<<<<<
  *         this_idx_view = self.indices[j]
  *         indices_arrs[j].length = len(this_idx_view)
  */
   __pyx_t_9 = __pyx_v_n_matrices;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_j = __pyx_t_11;
 
-    /* "tabmat/ext/split.pyx":143
+    /* "tabmat/ext/split.pyx":148
  *     cdef Py_ssize_t[:] this_idx_view
  *     for j in range(n_matrices):
  *         this_idx_view = self.indices[j]             # <<<<<<<<<<<<<<
  *         indices_arrs[j].length = len(this_idx_view)
  *         if indices_arrs[j].length > 0:
  */
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_indices); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_j, int, 1, __Pyx_PyInt_From_int, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_Py_ssize_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_ds_Py_ssize_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 148, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_this_idx_view, 1);
     __pyx_v_this_idx_view = __pyx_t_12;
     __pyx_t_12.memview = NULL;
     __pyx_t_12.data = NULL;
 
-    /* "tabmat/ext/split.pyx":144
+    /* "tabmat/ext/split.pyx":149
  *     for j in range(n_matrices):
  *         this_idx_view = self.indices[j]
  *         indices_arrs[j].length = len(this_idx_view)             # <<<<<<<<<<<<<<
  *         if indices_arrs[j].length > 0:
  *             indices_arrs[j].data = &(this_idx_view[0])
  */
     __pyx_t_13 = __Pyx_MemoryView_Len(__pyx_v_this_idx_view); 
     (__pyx_v_indices_arrs[__pyx_v_j]).length = __pyx_t_13;
 
-    /* "tabmat/ext/split.pyx":145
+    /* "tabmat/ext/split.pyx":150
  *         this_idx_view = self.indices[j]
  *         indices_arrs[j].length = len(this_idx_view)
  *         if indices_arrs[j].length > 0:             # <<<<<<<<<<<<<<
  *             indices_arrs[j].data = &(this_idx_view[0])
  *         subset_cols_indices.push_back(empty)
  */
     __pyx_t_14 = (((__pyx_v_indices_arrs[__pyx_v_j]).length > 0) != 0);
     if (__pyx_t_14) {
 
-      /* "tabmat/ext/split.pyx":146
+      /* "tabmat/ext/split.pyx":151
  *         indices_arrs[j].length = len(this_idx_view)
  *         if indices_arrs[j].length > 0:
  *             indices_arrs[j].data = &(this_idx_view[0])             # <<<<<<<<<<<<<<
  *         subset_cols_indices.push_back(empty)
  *         subset_cols.push_back(empty)
  */
       __pyx_t_15 = 0;
       (__pyx_v_indices_arrs[__pyx_v_j]).data = (&(*((Py_ssize_t *) ( /* dim=0 */ (__pyx_v_this_idx_view.data + __pyx_t_15 * __pyx_v_this_idx_view.strides[0]) ))));
 
-      /* "tabmat/ext/split.pyx":145
+      /* "tabmat/ext/split.pyx":150
  *         this_idx_view = self.indices[j]
  *         indices_arrs[j].length = len(this_idx_view)
  *         if indices_arrs[j].length > 0:             # <<<<<<<<<<<<<<
  *             indices_arrs[j].data = &(this_idx_view[0])
  *         subset_cols_indices.push_back(empty)
  */
     }
 
-    /* "tabmat/ext/split.pyx":147
+    /* "tabmat/ext/split.pyx":152
  *         if indices_arrs[j].length > 0:
  *             indices_arrs[j].data = &(this_idx_view[0])
  *         subset_cols_indices.push_back(empty)             # <<<<<<<<<<<<<<
  *         subset_cols.push_back(empty)
  * 
  */
     try {
       __pyx_v_subset_cols_indices.push_back(__pyx_v_empty);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 147, __pyx_L1_error)
+      __PYX_ERR(0, 152, __pyx_L1_error)
     }
 
-    /* "tabmat/ext/split.pyx":148
+    /* "tabmat/ext/split.pyx":153
  *             indices_arrs[j].data = &(this_idx_view[0])
  *         subset_cols_indices.push_back(empty)
  *         subset_cols.push_back(empty)             # <<<<<<<<<<<<<<
  * 
  *     cdef int i
  */
     try {
       __pyx_v_subset_cols.push_back(__pyx_v_empty);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 148, __pyx_L1_error)
+      __PYX_ERR(0, 153, __pyx_L1_error)
     }
   }
 
-  /* "tabmat/ext/split.pyx":151
+  /* "tabmat/ext/split.pyx":156
  * 
  *     cdef int i
  *     cdef int n_cols = cols.shape[0]             # <<<<<<<<<<<<<<
  * 
  *     for i in range(n_cols):
  */
   __pyx_v_n_cols = (__pyx_v_cols.shape[0]);
 
-  /* "tabmat/ext/split.pyx":153
+  /* "tabmat/ext/split.pyx":158
  *     cdef int n_cols = cols.shape[0]
  * 
  *     for i in range(n_cols):             # <<<<<<<<<<<<<<
  *         for j in range(n_matrices):
  * 
  */
   __pyx_t_9 = __pyx_v_n_cols;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_i = __pyx_t_11;
 
-    /* "tabmat/ext/split.pyx":154
+    /* "tabmat/ext/split.pyx":159
  * 
  *     for i in range(n_cols):
  *         for j in range(n_matrices):             # <<<<<<<<<<<<<<
  * 
  *             while (
  */
     __pyx_t_16 = __pyx_v_n_matrices;
     __pyx_t_17 = __pyx_t_16;
     for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
       __pyx_v_j = __pyx_t_18;
 
-      /* "tabmat/ext/split.pyx":156
+      /* "tabmat/ext/split.pyx":161
  *         for j in range(n_matrices):
  * 
  *             while (             # <<<<<<<<<<<<<<
  *                 next_subset_idx[j] < indices_arrs[j].length
  *                 and indices_arrs[j].data[next_subset_idx[j]] < cols[i]
  */
       while (1) {
 
-        /* "tabmat/ext/split.pyx":157
+        /* "tabmat/ext/split.pyx":162
  * 
  *             while (
  *                 next_subset_idx[j] < indices_arrs[j].length             # <<<<<<<<<<<<<<
  *                 and indices_arrs[j].data[next_subset_idx[j]] < cols[i]
  *             ):
  */
         __pyx_t_15 = __pyx_v_j;
         __pyx_t_19 = (((*((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_15 * __pyx_v_next_subset_idx.strides[0]) ))) < (__pyx_v_indices_arrs[__pyx_v_j]).length) != 0);
         if (__pyx_t_19) {
         } else {
           __pyx_t_14 = __pyx_t_19;
           goto __pyx_L12_bool_binop_done;
         }
 
-        /* "tabmat/ext/split.pyx":158
+        /* "tabmat/ext/split.pyx":163
  *             while (
  *                 next_subset_idx[j] < indices_arrs[j].length
  *                 and indices_arrs[j].data[next_subset_idx[j]] < cols[i]             # <<<<<<<<<<<<<<
  *             ):
  *                 next_subset_idx[j] += 1
  */
         __pyx_t_15 = __pyx_v_j;
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = ((((__pyx_v_indices_arrs[__pyx_v_j]).data[(*((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_15 * __pyx_v_next_subset_idx.strides[0]) )))]) < (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_20 * __pyx_v_cols.strides[0]) )))) != 0);
         __pyx_t_14 = __pyx_t_19;
         __pyx_L12_bool_binop_done:;
         if (!__pyx_t_14) break;
 
-        /* "tabmat/ext/split.pyx":160
+        /* "tabmat/ext/split.pyx":165
  *                 and indices_arrs[j].data[next_subset_idx[j]] < cols[i]
  *             ):
  *                 next_subset_idx[j] += 1             # <<<<<<<<<<<<<<
  * 
  *             if (
  */
         __pyx_t_20 = __pyx_v_j;
         *((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_20 * __pyx_v_next_subset_idx.strides[0]) )) += 1;
       }
 
-      /* "tabmat/ext/split.pyx":163
+      /* "tabmat/ext/split.pyx":168
  * 
  *             if (
  *                 next_subset_idx[j] < indices_arrs[j].length             # <<<<<<<<<<<<<<
  *                 and indices_arrs[j].data[next_subset_idx[j]] == cols[i]
  *             ):
  */
       __pyx_t_20 = __pyx_v_j;
       __pyx_t_19 = (((*((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_20 * __pyx_v_next_subset_idx.strides[0]) ))) < (__pyx_v_indices_arrs[__pyx_v_j]).length) != 0);
       if (__pyx_t_19) {
       } else {
         __pyx_t_14 = __pyx_t_19;
         goto __pyx_L15_bool_binop_done;
       }
 
-      /* "tabmat/ext/split.pyx":164
+      /* "tabmat/ext/split.pyx":169
  *             if (
  *                 next_subset_idx[j] < indices_arrs[j].length
  *                 and indices_arrs[j].data[next_subset_idx[j]] == cols[i]             # <<<<<<<<<<<<<<
  *             ):
  *                 subset_cols_indices[j].push_back(i)
  */
       __pyx_t_20 = __pyx_v_j;
       __pyx_t_15 = __pyx_v_i;
       __pyx_t_19 = ((((__pyx_v_indices_arrs[__pyx_v_j]).data[(*((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_20 * __pyx_v_next_subset_idx.strides[0]) )))]) == (*((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_15 * __pyx_v_cols.strides[0]) )))) != 0);
       __pyx_t_14 = __pyx_t_19;
       __pyx_L15_bool_binop_done:;
 
-      /* "tabmat/ext/split.pyx":162
+      /* "tabmat/ext/split.pyx":167
  *                 next_subset_idx[j] += 1
  * 
  *             if (             # <<<<<<<<<<<<<<
  *                 next_subset_idx[j] < indices_arrs[j].length
  *                 and indices_arrs[j].data[next_subset_idx[j]] == cols[i]
  */
       if (__pyx_t_14) {
 
-        /* "tabmat/ext/split.pyx":166
+        /* "tabmat/ext/split.pyx":171
  *                 and indices_arrs[j].data[next_subset_idx[j]] == cols[i]
  *             ):
  *                 subset_cols_indices[j].push_back(i)             # <<<<<<<<<<<<<<
  *                 subset_cols[j].push_back(next_subset_idx[j])
  *                 next_subset_idx[j] += 1
  */
         try {
           (__pyx_v_subset_cols_indices[__pyx_v_j]).push_back(__pyx_v_i);
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 166, __pyx_L1_error)
+          __PYX_ERR(0, 171, __pyx_L1_error)
         }
 
-        /* "tabmat/ext/split.pyx":167
+        /* "tabmat/ext/split.pyx":172
  *             ):
  *                 subset_cols_indices[j].push_back(i)
  *                 subset_cols[j].push_back(next_subset_idx[j])             # <<<<<<<<<<<<<<
  *                 next_subset_idx[j] += 1
  *                 break
  */
         __pyx_t_15 = __pyx_v_j;
         try {
           (__pyx_v_subset_cols[__pyx_v_j]).push_back((*((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_15 * __pyx_v_next_subset_idx.strides[0]) ))));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 167, __pyx_L1_error)
+          __PYX_ERR(0, 172, __pyx_L1_error)
         }
 
-        /* "tabmat/ext/split.pyx":168
+        /* "tabmat/ext/split.pyx":173
  *                 subset_cols_indices[j].push_back(i)
  *                 subset_cols[j].push_back(next_subset_idx[j])
  *                 next_subset_idx[j] += 1             # <<<<<<<<<<<<<<
  *                 break
  * 
  */
         __pyx_t_15 = __pyx_v_j;
         *((int *) ( /* dim=0 */ (__pyx_v_next_subset_idx.data + __pyx_t_15 * __pyx_v_next_subset_idx.strides[0]) )) += 1;
 
-        /* "tabmat/ext/split.pyx":169
+        /* "tabmat/ext/split.pyx":174
  *                 subset_cols[j].push_back(next_subset_idx[j])
  *                 next_subset_idx[j] += 1
  *                 break             # <<<<<<<<<<<<<<
  * 
  *     free(indices_arrs)
  */
         goto __pyx_L9_break;
 
-        /* "tabmat/ext/split.pyx":162
+        /* "tabmat/ext/split.pyx":167
  *                 next_subset_idx[j] += 1
  * 
  *             if (             # <<<<<<<<<<<<<<
  *                 next_subset_idx[j] < indices_arrs[j].length
  *                 and indices_arrs[j].data[next_subset_idx[j]] == cols[i]
  */
       }
     }
     __pyx_L9_break:;
   }
 
-  /* "tabmat/ext/split.pyx":171
+  /* "tabmat/ext/split.pyx":176
  *                 break
  * 
  *     free(indices_arrs)             # <<<<<<<<<<<<<<
  *     return (
  *         [
  */
   free(__pyx_v_indices_arrs);
 
-  /* "tabmat/ext/split.pyx":172
+  /* "tabmat/ext/split.pyx":177
  * 
  *     free(indices_arrs)
  *     return (             # <<<<<<<<<<<<<<
  *         [
  *             np.array(subset_cols_indices[j], dtype=np.int32)
  */
   __Pyx_XDECREF(__pyx_r);
+  { /* enter inner scope */
 
-  /* "tabmat/ext/split.pyx":173
+    /* "tabmat/ext/split.pyx":178
  *     free(indices_arrs)
  *     return (
  *         [             # <<<<<<<<<<<<<<
  *             np.array(subset_cols_indices[j], dtype=np.int32)
  *             for j in range(n_matrices)
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 178, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
 
-  /* "tabmat/ext/split.pyx":175
+    /* "tabmat/ext/split.pyx":180
  *         [
  *             np.array(subset_cols_indices[j], dtype=np.int32)
  *             for j in range(n_matrices)             # <<<<<<<<<<<<<<
  *         ],
  *         [
  */
-  __pyx_t_9 = __pyx_v_n_matrices;
-  __pyx_t_10 = __pyx_t_9;
-  for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
-    __pyx_v_j = __pyx_t_11;
+    __pyx_t_9 = __pyx_v_n_matrices;
+    __pyx_t_10 = __pyx_t_9;
+    for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
+      __pyx_7genexpr__pyx_v_j = __pyx_t_11;
 
-    /* "tabmat/ext/split.pyx":174
+      /* "tabmat/ext/split.pyx":179
  *     return (
  *         [
  *             np.array(subset_cols_indices[j], dtype=np.int32)             # <<<<<<<<<<<<<<
  *             for j in range(n_matrices)
  *         ],
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __pyx_convert_vector_to_py_int((__pyx_v_subset_cols_indices[__pyx_v_j])); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_GIVEREF(__pyx_t_6);
-    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6);
-    __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_21 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_21);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_21) < 0) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
-    __pyx_t_21 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_6); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 174, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_21);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_21))) __PYX_ERR(0, 173, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
-  }
+      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_6 = __pyx_convert_vector_to_py_int((__pyx_v_subset_cols_indices[__pyx_7genexpr__pyx_v_j])); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_GIVEREF(__pyx_t_6);
+      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6);
+      __pyx_t_6 = 0;
+      __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_21 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_21);
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_21) < 0) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
+      __pyx_t_21 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_6); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 179, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_21);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_21))) __PYX_ERR(0, 178, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
+    }
+  } /* exit inner scope */
+  { /* enter inner scope */
 
-  /* "tabmat/ext/split.pyx":177
+    /* "tabmat/ext/split.pyx":182
  *             for j in range(n_matrices)
  *         ],
  *         [             # <<<<<<<<<<<<<<
  *             np.array(subset_cols[j], dtype=np.int32)
  *             for j in range(n_matrices)
  */
-  __pyx_t_21 = PyList_New(0); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 177, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_21);
+    __pyx_t_21 = PyList_New(0); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 182, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_21);
 
-  /* "tabmat/ext/split.pyx":179
+    /* "tabmat/ext/split.pyx":184
  *         [
  *             np.array(subset_cols[j], dtype=np.int32)
  *             for j in range(n_matrices)             # <<<<<<<<<<<<<<
  *         ],
  *         n_cols
  */
-  __pyx_t_9 = __pyx_v_n_matrices;
-  __pyx_t_10 = __pyx_t_9;
-  for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
-    __pyx_v_j = __pyx_t_11;
+    __pyx_t_9 = __pyx_v_n_matrices;
+    __pyx_t_10 = __pyx_t_9;
+    for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
+      __pyx_8genexpr1__pyx_v_j = __pyx_t_11;
 
-    /* "tabmat/ext/split.pyx":178
+      /* "tabmat/ext/split.pyx":183
  *         ],
  *         [
  *             np.array(subset_cols[j], dtype=np.int32)             # <<<<<<<<<<<<<<
  *             for j in range(n_matrices)
  *         ],
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __pyx_convert_vector_to_py_int((__pyx_v_subset_cols[__pyx_v_j])); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_GIVEREF(__pyx_t_6);
-    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
-    __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_22 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_22);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_22) < 0) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
-    __pyx_t_22 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 178, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_22);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(__Pyx_ListComp_Append(__pyx_t_21, (PyObject*)__pyx_t_22))) __PYX_ERR(0, 177, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
-  }
+      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_6 = __pyx_convert_vector_to_py_int((__pyx_v_subset_cols[__pyx_8genexpr1__pyx_v_j])); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_GIVEREF(__pyx_t_6);
+      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
+      __pyx_t_6 = 0;
+      __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_22 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_22);
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_22) < 0) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
+      __pyx_t_22 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 183, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_22);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_21, (PyObject*)__pyx_t_22))) __PYX_ERR(0, 182, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
+    }
+  } /* exit inner scope */
 
-  /* "tabmat/ext/split.pyx":181
+  /* "tabmat/ext/split.pyx":186
  *             for j in range(n_matrices)
  *         ],
  *         n_cols             # <<<<<<<<<<<<<<
  *     )
  * 
  */
-  __pyx_t_22 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 181, __pyx_L1_error)
+  __pyx_t_22 = __Pyx_PyInt_From_int(__pyx_v_n_cols); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_22);
 
-  /* "tabmat/ext/split.pyx":173
+  /* "tabmat/ext/split.pyx":178
  *     free(indices_arrs)
  *     return (
  *         [             # <<<<<<<<<<<<<<
  *             np.array(subset_cols_indices[j], dtype=np.int32)
  *             for j in range(n_matrices)
  */
-  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 173, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_21);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_21);
   __Pyx_GIVEREF(__pyx_t_22);
   PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_22);
   __pyx_t_1 = 0;
   __pyx_t_21 = 0;
   __pyx_t_22 = 0;
   __pyx_r = __pyx_t_6;
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":130
+  /* "tabmat/ext/split.pyx":135
  * 
  * 
  * def split_col_subsets(self, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int[:] next_subset_idx = np.zeros(len(self.indices), dtype=np.int32)
  *     cdef vector[vector[int]] subset_cols_indices
  */
 
@@ -7991,15 +8119,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_this_idx_view, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_cols, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "tabmat/ext/split.pyx":184
+/* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
 
@@ -8040,31 +8168,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_signatures)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_args)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 184, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 1); __PYX_ERR(0, 189, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_kwargs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 184, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 2); __PYX_ERR(0, 189, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_defaults)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 184, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, 3); __PYX_ERR(0, 189, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 184, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 189, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -8073,15 +8201,15 @@
     __pyx_v_signatures = values[0];
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 184, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 189, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6tabmat_3ext_5split_8is_sorted(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults);
 
@@ -8131,55 +8259,55 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("is_sorted", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
   __pyx_t_3 = ((!__pyx_t_4) != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v_short_is_signed = (!((((short)-1L) > 0) != 0));
   __pyx_v_int_is_signed = (!((((int)-1L) > 0) != 0));
   __pyx_v_long_is_signed = (!((((long)-1L) > 0) != 0));
   __pyx_v_long_long_is_signed = (!((((PY_LONG_LONG)-1L) > 0) != 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
-  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 189, __pyx_L1_error)
   __pyx_t_2 = ((0 < __pyx_t_5) != 0);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 184, __pyx_L1_error)
+      __PYX_ERR(0, 189, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 0);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -8188,85 +8316,85 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_a, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_a, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
   __pyx_t_3 = (__pyx_t_4 != 0);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L7_bool_binop_done:;
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 184, __pyx_L1_error)
+      __PYX_ERR(0, 189, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 184, __pyx_L1_error)
+      __PYX_ERR(0, 189, __pyx_L1_error)
     }
-    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 189, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_1);
     __Pyx_GIVEREF(__pyx_int_1);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_1);
     __Pyx_INCREF(__pyx_kp_s__5);
     __Pyx_GIVEREF(__pyx_kp_s__5);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_kp_s__5);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     __pyx_t_3 = (__pyx_t_2 != 0);
     if (__pyx_t_3) {
       __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         __pyx_t_2 = (__pyx_t_3 != 0);
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -8280,118 +8408,118 @@
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       __pyx_t_3 = (__pyx_t_2 != 0);
       if (__pyx_t_3) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 'i');
         switch (__pyx_v_kind) {
           case 'i':
           case 'u':
           __pyx_t_2 = (((sizeof(short)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L16_bool_binop_done;
           }
           __pyx_t_2 = ((!((__pyx_v_short_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(int)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L20_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L20_bool_binop_done;
           }
           __pyx_t_2 = ((!((__pyx_v_int_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L20_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(long)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L24_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_2 = ((!((__pyx_v_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_2 = (((sizeof(PY_LONG_LONG)) == __pyx_v_itemsize) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L28_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 184, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_2 = ((((Py_ssize_t)__pyx_t_5) == 1) != 0);
           if (__pyx_t_2) {
           } else {
             __pyx_t_3 = __pyx_t_2;
             goto __pyx_L28_bool_binop_done;
           }
           __pyx_t_2 = ((!((__pyx_v_long_long_is_signed ^ __pyx_v_dtype_signed) != 0)) != 0);
           __pyx_t_3 = __pyx_t_2;
           __pyx_L28_bool_binop_done:;
           if (__pyx_t_3) {
-            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+            if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 'f':
           break;
           case 'c':
           break;
@@ -8412,15 +8540,15 @@
     __pyx_L32_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_short, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -8434,15 +8562,15 @@
     __pyx_L36_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -8456,15 +8584,15 @@
     __pyx_L40_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
     __pyx_t_2 = ((__pyx_v_itemsize == -1L) != 0);
@@ -8478,100 +8606,100 @@
     __pyx_L44_bool_binop_done:;
     if (__pyx_t_3) {
       __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_v_arg, 0); 
       __pyx_v_memslice = __pyx_t_8;
       __pyx_t_3 = (__pyx_v_memslice.memview != 0);
       if (__pyx_t_3) {
         __PYX_XDEC_MEMVIEW((&__pyx_v_memslice), 1); 
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_long_long, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
         goto __pyx_L10_break;
       }
       /*else*/ {
         PyErr_Clear(); 
       }
     }
-    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+    if (unlikely(__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   if (unlikely(__pyx_v_signatures == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_9), (&__pyx_t_10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __pyx_t_6 = __pyx_t_1;
   __pyx_t_1 = 0;
   while (1) {
     __pyx_t_11 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_9, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_11 == 0)) break;
-    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 184, __pyx_L1_error)
+    if (unlikely(__pyx_t_11 == -1)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
     __pyx_t_1 = 0;
     __pyx_v_match_found = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_12 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_kp_s_) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s_);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 184, __pyx_L1_error)
+    if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_split); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_t_12 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_13);
       if (likely(__pyx_t_12)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
         __Pyx_INCREF(__pyx_t_12);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_kp_s__2) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_kp_s__2);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF_SET(__pyx_v_src_sig, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_15 = PyList_GET_SIZE(__pyx_v_dest_sig); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 189, __pyx_L1_error)
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_v_i = __pyx_t_17;
       __pyx_t_1 = PyList_GET_ITEM(__pyx_v_dest_sig, __pyx_v_i);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_3 = (__pyx_v_dst_type != Py_None);
       __pyx_t_2 = (__pyx_t_3 != 0);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_src_sig, __pyx_v_i, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_13 = PyObject_RichCompare(__pyx_t_1, __pyx_v_dst_type, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 184, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 189, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if (__pyx_t_2) {
           __pyx_v_match_found = 1;
           goto __pyx_L52;
         }
         /*else*/ {
           __pyx_v_match_found = 0;
@@ -8579,43 +8707,43 @@
         }
         __pyx_L52:;
       }
     }
     __pyx_L50_break:;
     __pyx_t_2 = (__pyx_v_match_found != 0);
     if (__pyx_t_2) {
-      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyList_Append(__pyx_v_candidates, __pyx_v_sig); if (unlikely(__pyx_t_18 == ((int)-1))) __PYX_ERR(0, 189, __pyx_L1_error)
     }
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_3 = ((!__pyx_t_2) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
-  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_9 = PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 189, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_9 > 1) != 0);
   if (__pyx_t_3) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __PYX_ERR(0, 189, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 184, __pyx_L1_error)
+      __PYX_ERR(0, 189, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 189, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -8651,15 +8779,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_sorted (wrapper)", 0);
   assert(__pyx_arg_a); {
-    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 184, __pyx_L3_error)
+    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_short(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 189, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.is_sorted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -8683,87 +8811,87 @@
   short __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_0is_sorted", 0);
 
-  /* "tabmat/ext/split.pyx":185
+  /* "tabmat/ext/split.pyx":190
  * 
  * def is_sorted(win_integral[:] a):
  *     cdef win_integral* a_ptr = &a[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  */
   __pyx_t_1 = 0;
   __pyx_v_a_ptr = (&(*((short *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_1 * __pyx_v_a.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":187
+  /* "tabmat/ext/split.pyx":192
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  *     for i in range(a.size - 1):             # <<<<<<<<<<<<<<
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  */
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_short, (int (*)(char *, PyObject *)) __pyx_memview_set_short, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_short, (int (*)(char *, PyObject *)) __pyx_memview_set_short, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
-    /* "tabmat/ext/split.pyx":188
+    /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     __pyx_t_7 = (((__pyx_v_a_ptr[(__pyx_v_i + 1)]) < (__pyx_v_a_ptr[__pyx_v_i])) != 0);
     if (__pyx_t_7) {
 
-      /* "tabmat/ext/split.pyx":189
+      /* "tabmat/ext/split.pyx":194
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False             # <<<<<<<<<<<<<<
  *     return True
  */
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(Py_False);
       __pyx_r = Py_False;
       goto __pyx_L0;
 
-      /* "tabmat/ext/split.pyx":188
+      /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     }
   }
 
-  /* "tabmat/ext/split.pyx":190
+  /* "tabmat/ext/split.pyx":195
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  *     return True             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":184
+  /* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
 
@@ -8788,15 +8916,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_sorted (wrapper)", 0);
   assert(__pyx_arg_a); {
-    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 184, __pyx_L3_error)
+    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 189, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.is_sorted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -8820,87 +8948,87 @@
   int __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_1is_sorted", 0);
 
-  /* "tabmat/ext/split.pyx":185
+  /* "tabmat/ext/split.pyx":190
  * 
  * def is_sorted(win_integral[:] a):
  *     cdef win_integral* a_ptr = &a[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  */
   __pyx_t_1 = 0;
   __pyx_v_a_ptr = (&(*((int *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_1 * __pyx_v_a.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":187
+  /* "tabmat/ext/split.pyx":192
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  *     for i in range(a.size - 1):             # <<<<<<<<<<<<<<
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  */
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
-    /* "tabmat/ext/split.pyx":188
+    /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     __pyx_t_7 = (((__pyx_v_a_ptr[(__pyx_v_i + 1)]) < (__pyx_v_a_ptr[__pyx_v_i])) != 0);
     if (__pyx_t_7) {
 
-      /* "tabmat/ext/split.pyx":189
+      /* "tabmat/ext/split.pyx":194
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False             # <<<<<<<<<<<<<<
  *     return True
  */
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(Py_False);
       __pyx_r = Py_False;
       goto __pyx_L0;
 
-      /* "tabmat/ext/split.pyx":188
+      /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     }
   }
 
-  /* "tabmat/ext/split.pyx":190
+  /* "tabmat/ext/split.pyx":195
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  *     return True             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":184
+  /* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
 
@@ -8925,15 +9053,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_sorted (wrapper)", 0);
   assert(__pyx_arg_a); {
-    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 184, __pyx_L3_error)
+    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 189, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.is_sorted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -8957,87 +9085,87 @@
   long __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_2is_sorted", 0);
 
-  /* "tabmat/ext/split.pyx":185
+  /* "tabmat/ext/split.pyx":190
  * 
  * def is_sorted(win_integral[:] a):
  *     cdef win_integral* a_ptr = &a[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  */
   __pyx_t_1 = 0;
   __pyx_v_a_ptr = (&(*((long *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_1 * __pyx_v_a.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":187
+  /* "tabmat/ext/split.pyx":192
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  *     for i in range(a.size - 1):             # <<<<<<<<<<<<<<
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  */
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
-    /* "tabmat/ext/split.pyx":188
+    /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     __pyx_t_7 = (((__pyx_v_a_ptr[(__pyx_v_i + 1)]) < (__pyx_v_a_ptr[__pyx_v_i])) != 0);
     if (__pyx_t_7) {
 
-      /* "tabmat/ext/split.pyx":189
+      /* "tabmat/ext/split.pyx":194
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False             # <<<<<<<<<<<<<<
  *     return True
  */
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(Py_False);
       __pyx_r = Py_False;
       goto __pyx_L0;
 
-      /* "tabmat/ext/split.pyx":188
+      /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     }
   }
 
-  /* "tabmat/ext/split.pyx":190
+  /* "tabmat/ext/split.pyx":195
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  *     return True             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":184
+  /* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
 
@@ -9062,15 +9190,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_sorted (wrapper)", 0);
   assert(__pyx_arg_a); {
-    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 184, __pyx_L3_error)
+    __pyx_v_a = __Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG(__pyx_arg_a, PyBUF_WRITABLE); if (unlikely(!__pyx_v_a.memview)) __PYX_ERR(0, 189, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   __Pyx_AddTraceback("tabmat.ext.split.is_sorted", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
@@ -9094,87 +9222,87 @@
   PY_LONG_LONG __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__pyx_fuse_3is_sorted", 0);
 
-  /* "tabmat/ext/split.pyx":185
+  /* "tabmat/ext/split.pyx":190
  * 
  * def is_sorted(win_integral[:] a):
  *     cdef win_integral* a_ptr = &a[0]             # <<<<<<<<<<<<<<
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  */
   __pyx_t_1 = 0;
   __pyx_v_a_ptr = (&(*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_1 * __pyx_v_a.strides[0]) ))));
 
-  /* "tabmat/ext/split.pyx":187
+  /* "tabmat/ext/split.pyx":192
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  *     for i in range(a.size - 1):             # <<<<<<<<<<<<<<
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  */
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_PY_LONG_LONG, (int (*)(char *, PyObject *)) __pyx_memview_set_PY_LONG_LONG, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_a, 1, (PyObject *(*)(char *)) __pyx_memview_get_PY_LONG_LONG, (int (*)(char *, PyObject *)) __pyx_memview_set_PY_LONG_LONG, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_As_long(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
-    /* "tabmat/ext/split.pyx":188
+    /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     __pyx_t_7 = (((__pyx_v_a_ptr[(__pyx_v_i + 1)]) < (__pyx_v_a_ptr[__pyx_v_i])) != 0);
     if (__pyx_t_7) {
 
-      /* "tabmat/ext/split.pyx":189
+      /* "tabmat/ext/split.pyx":194
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False             # <<<<<<<<<<<<<<
  *     return True
  */
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(Py_False);
       __pyx_r = Py_False;
       goto __pyx_L0;
 
-      /* "tabmat/ext/split.pyx":188
+      /* "tabmat/ext/split.pyx":193
  *     cdef win_integral i
  *     for i in range(a.size - 1):
  *         if a_ptr[i + 1] < a_ptr[i]:             # <<<<<<<<<<<<<<
  *             return False
  *     return True
  */
     }
   }
 
-  /* "tabmat/ext/split.pyx":190
+  /* "tabmat/ext/split.pyx":195
  *         if a_ptr[i + 1] < a_ptr[i]:
  *             return False
  *     return True             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "tabmat/ext/split.pyx":184
+  /* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
 
@@ -9187,15 +9315,15 @@
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_a, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -9204,29 +9332,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":735
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":734
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -9237,15 +9365,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -9254,29 +9382,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":738
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":737
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -9287,15 +9415,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -9304,29 +9432,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":741
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":740
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -9337,15 +9465,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -9354,29 +9482,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":744
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":743
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -9387,15 +9515,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -9404,29 +9532,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":747
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":746
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -9437,212 +9565,212 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":751
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
  *     else:
  *         return ()
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
     __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":750
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":753
  *         return <tuple>d.subarray.shape
  *     else:
  *         return ()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_empty_tuple);
     __pyx_r = __pyx_empty_tuple;
     goto __pyx_L0;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":749
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("set_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":929
  * 
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
  *     PyArray_SetBaseObject(arr, base)
  * 
  */
   Py_INCREF(__pyx_v_base);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":930
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object get_array_base(ndarray arr):
  */
   (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":928
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
   PyObject *__pyx_v_base;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":933
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
  *     if base is NULL:
  *         return None
  */
   __pyx_v_base = PyArray_BASE(__pyx_v_arr);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
   if (__pyx_t_1) {
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":935
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  *         return None             # <<<<<<<<<<<<<<
  *     return <object>base
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":934
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":936
  *     if base is NULL:
  *         return None
  *     return <object>base             # <<<<<<<<<<<<<<
  * 
  * # Versions of the import_* functions which are more suitable for
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_base));
   __pyx_r = ((PyObject *)__pyx_v_base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":932
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -9658,15 +9786,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_array", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
   {
@@ -9674,53 +9802,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":942
  * cdef inline int import_array() except -1:
  *     try:
  *         __pyx_import_array()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")
  */
       __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 942, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":943
  *     try:
  *         __pyx_import_array()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 943, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 944, __pyx_L5_except_error)
@@ -9728,30 +9856,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 944, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":941
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":940
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -9766,15 +9894,15 @@
   __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9790,15 +9918,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_umath", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -9806,53 +9934,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":948
  * cdef inline int import_umath() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 948, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":949
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 949, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 950, __pyx_L5_except_error)
@@ -9860,30 +9988,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 950, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":947
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":946
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9898,15 +10026,15 @@
   __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -9922,15 +10050,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_ufunc", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -9938,53 +10066,53 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":954
  * cdef inline int import_ufunc() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 954, __pyx_L3_error)
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":955
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 955, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
+      /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":956
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef extern from *:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 956, __pyx_L5_except_error)
@@ -9992,30 +10120,30 @@
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(1, 956, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
+    /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":953
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":952
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -10030,176 +10158,176 @@
   __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":978
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":966
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("is_datetime64_object", 0);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":993
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":981
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
 static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
   npy_datetime __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1003
  *     also needed.  That can be found using `get_datetime64_unit`.
  *     """
  *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":996
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
 static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
   npy_timedelta __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1010
  *     returns the int64 value underlying scalar numpy timedelta64 object
  *     """
  *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1006
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+/* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
 static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
   NPY_DATETIMEUNIT __pyx_r;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1017
  *     returns the unit part of the dtype for a numpy datetime64 object.
  *     """
  *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
  */
   __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
   goto __pyx_L0;
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":1013
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
@@ -23619,15 +23747,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -23741,15 +23869,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -24005,15 +24133,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -24154,15 +24282,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -24303,26 +24431,31 @@
   {&__pyx_n_s_long, __pyx_k_long, sizeof(__pyx_k_long), 0, 0, 1, 1},
   {&__pyx_kp_s_long_long, __pyx_k_long_long, sizeof(__pyx_k_long_long), 0, 0, 1, 0},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_mat_j, __pyx_k_mat_j, sizeof(__pyx_k_mat_j), 0, 0, 1, 1},
   {&__pyx_n_s_mat_j_p, __pyx_k_mat_j_p, sizeof(__pyx_k_mat_j_p), 0, 0, 1, 1},
   {&__pyx_n_s_memview, __pyx_k_memview, sizeof(__pyx_k_memview), 0, 0, 1, 1},
   {&__pyx_n_s_mode, __pyx_k_mode, sizeof(__pyx_k_mode), 0, 0, 1, 1},
+  {&__pyx_n_s_n_active_rows, __pyx_k_n_active_rows, sizeof(__pyx_k_n_active_rows), 0, 0, 1, 1},
   {&__pyx_n_s_n_cols, __pyx_k_n_cols, sizeof(__pyx_k_n_cols), 0, 0, 1, 1},
   {&__pyx_n_s_n_matrices, __pyx_k_n_matrices, sizeof(__pyx_k_n_matrices), 0, 0, 1, 1},
+  {&__pyx_n_s_n_rows, __pyx_k_n_rows, sizeof(__pyx_k_n_rows), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
   {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
   {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
   {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_n_s_next_subset_idx, __pyx_k_next_subset_idx, sizeof(__pyx_k_next_subset_idx), 0, 0, 1, 1},
+  {&__pyx_n_s_nj_active_cols, __pyx_k_nj_active_cols, sizeof(__pyx_k_nj_active_cols), 0, 0, 1, 1},
+  {&__pyx_n_s_nj_cols, __pyx_k_nj_cols, sizeof(__pyx_k_nj_cols), 0, 0, 1, 1},
+  {&__pyx_n_s_nj_rows, __pyx_k_nj_rows, sizeof(__pyx_k_nj_rows), 0, 0, 1, 1},
   {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
   {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
   {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_s_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 0, 1, 0},
-  {&__pyx_kp_s_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 0, 1, 0},
+  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
+  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
   {&__pyx_n_s_obj, __pyx_k_obj, sizeof(__pyx_k_obj), 0, 0, 1, 1},
   {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_checksum, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_getbuffer, __pyx_k_pyx_getbuffer, sizeof(__pyx_k_pyx_getbuffer), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
@@ -24331,14 +24464,15 @@
   {&__pyx_n_s_pyx_unpickle_Enum, __pyx_k_pyx_unpickle_Enum, sizeof(__pyx_k_pyx_unpickle_Enum), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
   {&__pyx_n_s_reduce, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
   {&__pyx_n_s_reduce_cython, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
   {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
   {&__pyx_n_s_res, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
+  {&__pyx_n_s_res_size, __pyx_k_res_size, sizeof(__pyx_k_res_size), 0, 0, 1, 1},
   {&__pyx_n_s_rows, __pyx_k_rows, sizeof(__pyx_k_rows), 0, 0, 1, 1},
   {&__pyx_n_s_rows_p, __pyx_k_rows_p, sizeof(__pyx_k_rows_p), 0, 0, 1, 1},
   {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
   {&__pyx_n_s_sandwich_cat_cat, __pyx_k_sandwich_cat_cat, sizeof(__pyx_k_sandwich_cat_cat), 0, 0, 1, 1},
   {&__pyx_n_s_sandwich_cat_cat_limited_rows_c, __pyx_k_sandwich_cat_cat_limited_rows_c, sizeof(__pyx_k_sandwich_cat_cat_limited_rows_c), 0, 0, 1, 1},
   {&__pyx_n_s_sandwich_cat_dense, __pyx_k_sandwich_cat_dense, sizeof(__pyx_k_sandwich_cat_dense), 0, 0, 1, 1},
   {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
@@ -24370,16 +24504,16 @@
   {&__pyx_kp_s_unable_to_allocate_shape_and_str, __pyx_k_unable_to_allocate_shape_and_str, sizeof(__pyx_k_unable_to_allocate_shape_and_str), 0, 0, 1, 0},
   {&__pyx_n_s_unpack, __pyx_k_unpack, sizeof(__pyx_k_unpack), 0, 0, 1, 1},
   {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 30, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 29, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 29, __pyx_L1_error)
   __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 944, __pyx_L1_error)
   __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(2, 134, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(2, 149, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(2, 152, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(2, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(2, 615, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(2, 834, __pyx_L1_error)
@@ -24388,47 +24522,47 @@
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "tabmat/ext/split.pyx":30
+  /* "tabmat/ext/split.pyx":29
  * 
  * 
  * def sandwich_cat_dense(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int i_ncol,
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__4);
   __Pyx_GIVEREF(__pyx_tuple__4);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":944
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 944, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(1, 944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
 
-  /* "../../../../../opt/hostedtoolcache/Python/3.10.10/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
+  /* "../../../../../opt/hostedtoolcache/Python/3.10.12/x64/lib/python3.10/site-packages/numpy/__init__.pxd":950
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 950, __pyx_L1_error)
+  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 950, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__7);
   __Pyx_GIVEREF(__pyx_tuple__7);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
@@ -24619,73 +24753,73 @@
   __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__25);
   __Pyx_GIVEREF(__pyx_tuple__25);
   __pyx_tuple__26 = PyTuple_Pack(3, __pyx_int_184977713, __pyx_int_136983863, __pyx_int_112105877); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(2, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__26);
   __Pyx_GIVEREF(__pyx_tuple__26);
 
-  /* "tabmat/ext/split.pyx":30
+  /* "tabmat/ext/split.pyx":29
  * 
  * 
  * def sandwich_cat_dense(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int i_ncol,
  */
-  __pyx_tuple__27 = PyTuple_Pack(13, __pyx_n_s_i_indices, __pyx_n_s_i_ncol, __pyx_n_s_d, __pyx_n_s_mat_j, __pyx_n_s_rows, __pyx_n_s_j_cols, __pyx_n_s_is_c_contiguous, __pyx_n_s_res, __pyx_n_s_d_p, __pyx_n_s_i_indices_p, __pyx_n_s_rows_p, __pyx_n_s_j_cols_p, __pyx_n_s_mat_j_p); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_tuple__27 = PyTuple_Pack(18, __pyx_n_s_i_indices, __pyx_n_s_i_ncol, __pyx_n_s_d, __pyx_n_s_mat_j, __pyx_n_s_rows, __pyx_n_s_j_cols, __pyx_n_s_is_c_contiguous, __pyx_n_s_nj_rows, __pyx_n_s_nj_cols, __pyx_n_s_n_active_rows, __pyx_n_s_nj_active_cols, __pyx_n_s_res, __pyx_n_s_res_size, __pyx_n_s_d_p, __pyx_n_s_i_indices_p, __pyx_n_s_rows_p, __pyx_n_s_j_cols_p, __pyx_n_s_mat_j_p); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__27);
   __Pyx_GIVEREF(__pyx_tuple__27);
-  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(7, 0, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_sandwich_cat_dense, 30, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(7, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_sandwich_cat_dense, 29, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 29, __pyx_L1_error)
 
-  /* "tabmat/ext/split.pyx":65
+  /* "tabmat/ext/split.pyx":68
  * 
  * 
  * def sandwich_cat_cat(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
-  __pyx_tuple__29 = PyTuple_Pack(10, __pyx_n_s_i_indices, __pyx_n_s_j_indices, __pyx_n_s_i_ncol, __pyx_n_s_j_ncol, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_dtype, __pyx_n_s_i_drop_first, __pyx_n_s_j_drop_first, __pyx_n_s_res); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_tuple__29 = PyTuple_Pack(12, __pyx_n_s_i_indices, __pyx_n_s_j_indices, __pyx_n_s_i_ncol, __pyx_n_s_j_ncol, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_dtype, __pyx_n_s_i_drop_first, __pyx_n_s_j_drop_first, __pyx_n_s_res, __pyx_n_s_n_rows, __pyx_n_s_res_size); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__29);
   __Pyx_GIVEREF(__pyx_tuple__29);
-  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(9, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_sandwich_cat_cat, 65, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(9, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_sandwich_cat_cat, 68, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 68, __pyx_L1_error)
 
-  /* "tabmat/ext/split.pyx":88
+  /* "tabmat/ext/split.pyx":93
  * 
  * # This seems slower, so not using it for now
  * def _sandwich_cat_cat_limited_rows_cols(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
-  __pyx_tuple__31 = PyTuple_Pack(16, __pyx_n_s_i_indices, __pyx_n_s_j_indices, __pyx_n_s_i_ncol, __pyx_n_s_j_ncol, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_i_cols, __pyx_n_s_j_cols, __pyx_n_s_res, __pyx_n_s_k_idx, __pyx_n_s_k, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_i_col_included, __pyx_n_s_Ci, __pyx_n_s_j_col_included); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_tuple__31 = PyTuple_Pack(16, __pyx_n_s_i_indices, __pyx_n_s_j_indices, __pyx_n_s_i_ncol, __pyx_n_s_j_ncol, __pyx_n_s_d, __pyx_n_s_rows, __pyx_n_s_i_cols, __pyx_n_s_j_cols, __pyx_n_s_res, __pyx_n_s_k_idx, __pyx_n_s_k, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_i_col_included, __pyx_n_s_Ci, __pyx_n_s_j_col_included); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__31);
   __Pyx_GIVEREF(__pyx_tuple__31);
-  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(8, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_sandwich_cat_cat_limited_rows_c, 88, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(8, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_sandwich_cat_cat_limited_rows_c, 93, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 93, __pyx_L1_error)
 
-  /* "tabmat/ext/split.pyx":130
+  /* "tabmat/ext/split.pyx":135
  * 
  * 
  * def split_col_subsets(self, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int[:] next_subset_idx = np.zeros(len(self.indices), dtype=np.int32)
  *     cdef vector[vector[int]] subset_cols_indices
  */
-  __pyx_tuple__33 = PyTuple_Pack(12, __pyx_n_s_self, __pyx_n_s_cols, __pyx_n_s_next_subset_idx, __pyx_n_s_subset_cols_indices, __pyx_n_s_subset_cols, __pyx_n_s_empty, __pyx_n_s_j, __pyx_n_s_n_matrices, __pyx_n_s_indices_arrs, __pyx_n_s_this_idx_view, __pyx_n_s_i, __pyx_n_s_n_cols); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_tuple__33 = PyTuple_Pack(14, __pyx_n_s_self, __pyx_n_s_cols, __pyx_n_s_next_subset_idx, __pyx_n_s_subset_cols_indices, __pyx_n_s_subset_cols, __pyx_n_s_empty, __pyx_n_s_j, __pyx_n_s_n_matrices, __pyx_n_s_indices_arrs, __pyx_n_s_this_idx_view, __pyx_n_s_i, __pyx_n_s_n_cols, __pyx_n_s_j, __pyx_n_s_j); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__33);
   __Pyx_GIVEREF(__pyx_tuple__33);
-  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(2, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_split_col_subsets, 130, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(2, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_split_col_subsets, 135, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 135, __pyx_L1_error)
 
-  /* "tabmat/ext/split.pyx":184
+  /* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
-  __pyx_tuple__35 = PyTuple_Pack(4, __pyx_n_s_a, __pyx_n_s_a, __pyx_n_s_a_ptr, __pyx_n_s_i); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_tuple__35 = PyTuple_Pack(4, __pyx_n_s_a, __pyx_n_s_a, __pyx_n_s_a_ptr, __pyx_n_s_i); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__35);
   __Pyx_GIVEREF(__pyx_tuple__35);
-  __pyx_codeobj__36 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_is_sorted, 184, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_codeobj__36 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_tabmat_ext_split_pyx, __pyx_n_s_is_sorted, 189, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(0, 189, __pyx_L1_error)
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
  * cdef strided = Enum("<strided and direct>") # default
  * cdef indirect = Enum("<strided and indirect>")
@@ -24878,55 +25012,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -25146,163 +25264,162 @@
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "tabmat/ext/split.pyx":2
- * # cython: boundscheck=False, wraparound=False, cdivision=True
+  /* "tabmat/ext/split.pyx":1
  * import numpy as np             # <<<<<<<<<<<<<<
  * 
  * cimport numpy as np
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, -1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/split.pyx":30
+  /* "tabmat/ext/split.pyx":29
  * 
  * 
  * def sandwich_cat_dense(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int i_ncol,
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_11sandwich_cat_dense, 0, __pyx_n_s_sandwich_cat_dense, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_11sandwich_cat_dense, 0, __pyx_n_s_sandwich_cat_dense, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 30, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_13sandwich_cat_dense, 0, __pyx_n_s_sandwich_cat_dense, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_13sandwich_cat_dense, 0, __pyx_n_s_sandwich_cat_dense, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 30, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_1sandwich_cat_dense, 0, __pyx_n_s_sandwich_cat_dense, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_1sandwich_cat_dense, 0, __pyx_n_s_sandwich_cat_dense, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sandwich_cat_dense, __pyx_t_2) < 0) __PYX_ERR(0, 30, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sandwich_cat_dense, __pyx_t_2) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/split.pyx":65
+  /* "tabmat/ext/split.pyx":68
  * 
  * 
  * def sandwich_cat_cat(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_17sandwich_cat_cat, 0, __pyx_n_s_sandwich_cat_cat, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_17sandwich_cat_cat, 0, __pyx_n_s_sandwich_cat_cat, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_float, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_float, __pyx_t_1) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_19sandwich_cat_cat, 0, __pyx_n_s_sandwich_cat_cat, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_19sandwich_cat_cat, 0, __pyx_n_s_sandwich_cat_cat, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_double, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_double, __pyx_t_1) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_3sandwich_cat_cat, 0, __pyx_n_s_sandwich_cat_cat, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_3sandwich_cat_cat, 0, __pyx_n_s_sandwich_cat_cat, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_1)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sandwich_cat_cat, __pyx_t_1) < 0) __PYX_ERR(0, 65, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sandwich_cat_cat, __pyx_t_1) < 0) __PYX_ERR(0, 68, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "tabmat/ext/split.pyx":88
+  /* "tabmat/ext/split.pyx":93
  * 
  * # This seems slower, so not using it for now
  * def _sandwich_cat_cat_limited_rows_cols(             # <<<<<<<<<<<<<<
  *     int[:] i_indices,
  *     int[:] j_indices,
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_23_sandwich_cat_cat_limited_rows_cols, 0, __pyx_n_s_sandwich_cat_cat_limited_rows_c, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_23_sandwich_cat_cat_limited_rows_cols, 0, __pyx_n_s_sandwich_cat_cat_limited_rows_c, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_float, __pyx_t_2) < 0) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_25_sandwich_cat_cat_limited_rows_cols, 0, __pyx_n_s_sandwich_cat_cat_limited_rows_c, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_25_sandwich_cat_cat_limited_rows_cols, 0, __pyx_n_s_sandwich_cat_cat_limited_rows_c, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_double, __pyx_t_2) < 0) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_5_sandwich_cat_cat_limited_rows_cols, 0, __pyx_n_s_sandwich_cat_cat_limited_rows_c, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_2 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_5_sandwich_cat_cat_limited_rows_cols, 0, __pyx_n_s_sandwich_cat_cat_limited_rows_c, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_2)->__signatures__ = __pyx_t_1;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sandwich_cat_cat_limited_rows_c, __pyx_t_2) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sandwich_cat_cat_limited_rows_c, __pyx_t_2) < 0) __PYX_ERR(0, 93, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/split.pyx":130
+  /* "tabmat/ext/split.pyx":135
  * 
  * 
  * def split_col_subsets(self, int[:] cols):             # <<<<<<<<<<<<<<
  *     cdef int[:] next_subset_idx = np.zeros(len(self.indices), dtype=np.int32)
  *     cdef vector[vector[int]] subset_cols_indices
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_6tabmat_3ext_5split_7split_col_subsets, NULL, __pyx_n_s_tabmat_ext_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_6tabmat_3ext_5split_7split_col_subsets, NULL, __pyx_n_s_tabmat_ext_split); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_split_col_subsets, __pyx_t_2) < 0) __PYX_ERR(0, 130, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_split_col_subsets, __pyx_t_2) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "tabmat/ext/split.pyx":184
+  /* "tabmat/ext/split.pyx":189
  *     )
  * 
  * def is_sorted(win_integral[:] a):             # <<<<<<<<<<<<<<
  *     cdef win_integral* a_ptr = &a[0]
  *     cdef win_integral i
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_29is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_6tabmat_3ext_5split_29is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_short, __pyx_t_1) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_short, __pyx_t_1) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_31is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_6tabmat_3ext_5split_31is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_int, __pyx_t_1) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_int, __pyx_t_1) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_6tabmat_3ext_5split_33is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_6tabmat_3ext_5split_33is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_long, __pyx_t_1) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_long, __pyx_t_1) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_6tabmat_3ext_5split_35is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_6tabmat_3ext_5split_35is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_s_long_long, __pyx_t_1) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_9is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_1 = __pyx_FusedFunction_New(&__pyx_mdef_6tabmat_3ext_5split_9is_sorted, 0, __pyx_n_s_is_sorted, NULL, __pyx_n_s_tabmat_ext_split, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_1, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_1)->__signatures__ = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_sorted, __pyx_t_1) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_sorted, __pyx_t_1) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "tabmat/ext/split.pyx":1
- * # cython: boundscheck=False, wraparound=False, cdivision=True             # <<<<<<<<<<<<<<
- * import numpy as np
+ * import numpy as np             # <<<<<<<<<<<<<<
  * 
+ * cimport numpy as np
  */
   __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "View.MemoryView":210
@@ -26074,28 +26191,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -27995,61 +28112,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -28673,15 +28808,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -29056,15 +29194,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_FusedFunction_init(void) {
     __pyx_FusedFunctionType_type.tp_base = __pyx_CyFunctionType;
     __pyx_FusedFunctionType = __Pyx_FetchCommonType(&__pyx_FusedFunctionType_type);
     if (__pyx_FusedFunctionType == NULL) {
@@ -30897,15 +31038,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -31169,15 +31310,15 @@
                         } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
                             return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -31403,15 +31544,15 @@
                         } else if (8 * sizeof(short) >= 4 * PyLong_SHIFT) {
                             return (short) (((((((((short)digits[3]) << PyLong_SHIFT) | (short)digits[2]) << PyLong_SHIFT) | (short)digits[1]) << PyLong_SHIFT) | (short)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -31599,15 +31740,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -31833,15 +31974,15 @@
                         } else if (8 * sizeof(PY_LONG_LONG) >= 4 * PyLong_SHIFT) {
                             return (PY_LONG_LONG) (((((((((PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (PY_LONG_LONG)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -32062,15 +32203,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
```

### Comparing `tabmat-3.1.7/src/tabmat/ext/split.pyx` & `tabmat-3.1.8/src/tabmat/ext/split.pyx`

 * *Files 12% similar despite different names*

```diff
@@ -1,8 +1,7 @@
-# cython: boundscheck=False, wraparound=False, cdivision=True
 import numpy as np
 
 cimport numpy as np
 from cython cimport floating, integral
 from libc.stdlib cimport free, malloc
 from libcpp cimport bool
 from libcpp.vector cimport vector
@@ -18,50 +17,54 @@
 ctypedef np.int8_t int8
 ctypedef fused win_integral:
     integral
     long long
 
 
 cdef extern from "cat_split_helpers.cpp":
-    void _sandwich_cat_denseC[F](F*, int*, int*, int, int*, int, F*, int, F*, int, int) nogil
-    void _sandwich_cat_denseF[F](F*, int*, int*, int, int*, int, F*, int, F*, int, int) nogil
-    void _sandwich_cat_cat[F](F*, const int*, const int*, int*, int, F*, int, int, bool, bool)
+    void _sandwich_cat_denseC[Int, F](F*, Int*, Int*, Int, Int*, Int, F*, Int, F*, Int, Int) nogil
+    void _sandwich_cat_denseF[Int, F](F*, Int*, Int*, Int, Int*, Int, F*, Int, F*, Int, Int) nogil
+    void _sandwich_cat_cat[Int, F](F*, const Int*, const Int*, Int*, Int, F*, Int, Int, bool, bool)
 
 
 def sandwich_cat_dense(
     int[:] i_indices,
     int i_ncol,
     floating[:] d,
     np.ndarray mat_j,
     int[:] rows,
     int[:] j_cols,
     bool is_c_contiguous
 ):
-
+    cdef int nj_rows = mat_j.shape[0]
+    cdef int nj_cols = mat_j.shape[1]
+    cdef int n_active_rows = len(rows)
+    cdef int nj_active_cols = len(j_cols)
     cdef floating[:, :] res
-    res = np.zeros((i_ncol, len(j_cols)), dtype=mat_j.dtype)
+    res = np.zeros((i_ncol, nj_active_cols), dtype=mat_j.dtype)
+    cdef int res_size = res.size
 
-    if d.shape[0] == 0 or len(rows) == 0 or len(j_cols) == 0 or i_ncol == 0:
+    if d.shape[0] == 0 or n_active_rows == 0 or nj_active_cols == 0 or i_ncol == 0:
         return np.asarray(res)
 
     cdef floating* d_p = &d[0]
     cdef int* i_indices_p = &i_indices[0]
     cdef int* rows_p = &rows[0]
     cdef int* j_cols_p = &j_cols[0]
 
     cdef floating* mat_j_p = <floating*>mat_j.data
 
     if is_c_contiguous:
-        _sandwich_cat_denseC(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
-                            len(j_cols), &res[0, 0], res.size, mat_j_p,
-                            mat_j.shape[0], mat_j.shape[1])
+        _sandwich_cat_denseC(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+                            nj_active_cols, &res[0, 0], res_size, mat_j_p,
+                            nj_rows, nj_cols)
     else:
-        _sandwich_cat_denseF(d_p, i_indices_p, rows_p, len(rows), j_cols_p,
-                            len(j_cols), &res[0, 0], res.size, mat_j_p,
-                            mat_j.shape[0], mat_j.shape[1])
+        _sandwich_cat_denseF(d_p, i_indices_p, rows_p, n_active_rows, j_cols_p,
+                            nj_active_cols, &res[0, 0], res_size, mat_j_p,
+                            nj_rows, nj_cols)
 
     return np.asarray(res)
 
 
 def sandwich_cat_cat(
     int[:] i_indices,
     int[:] j_indices,
@@ -73,17 +76,19 @@
     bint i_drop_first,
     bint j_drop_first
 ):
     """
     (X1.T @ diag(d) @ X2)[i, j] = sum_k X1[k, i] d[k] X2[k, j]
     """
     cdef floating[:, :] res = np.zeros((i_ncol, j_ncol), dtype=dtype)
+    cdef int n_rows = len(rows)
+    cdef int res_size = res.size
 
-    _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], len(rows),
-                        &res[0, 0], j_ncol, res.size, i_drop_first, j_drop_first)
+    _sandwich_cat_cat(&d[0], &i_indices[0], &j_indices[0], &rows[0], n_rows,
+                        &res[0, 0], j_ncol, res_size, i_drop_first, j_drop_first)
 
     return np.asarray(res)
 
 
 # This seems slower, so not using it for now
 def _sandwich_cat_cat_limited_rows_cols(
     int[:] i_indices,
```

### Comparing `tabmat-3.1.7/src/tabmat/matrix_base.py` & `tabmat-3.1.8/src/tabmat/matrix_base.py`

 * *Files 1% similar despite different names*

```diff
@@ -10,15 +10,15 @@
     ndim = 2
     shape: Tuple[int, int]
     dtype: np.dtype
 
     @abstractmethod
     def matvec(self, other, cols: np.ndarray = None, out: np.ndarray = None):
         """
-        Perform: self[:, cols] @ other, so result[i] = sum_j self[i, j] other[j].
+        Perform: self[:, cols] @ other[cols], so result[i] = sum_j self[i, j] other[j].
 
         The 'cols' parameter allows restricting to a subset of the matrix without making
         a copy. If provided:
 
         ::
 
             result[i] = sum_{j in cols} self[i, j] other[j].
@@ -33,15 +33,15 @@
         self,
         vec: Union[np.ndarray, List],
         rows: np.ndarray = None,
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
         """
-        Perform: self[rows, cols].T @ vec, so result[i] = sum_j self[j, i] vec[j].
+        Perform: self[rows, cols].T @ vec[rows], so result[i] = sum_j self[j, i] vec[j].
 
         The rows and cols parameters allow restricting to a subset of the
         matrix without making a copy.
 
         If 'rows' and 'cols' are provided:
 
         ::
```

### Comparing `tabmat-3.1.7/src/tabmat/sparse_matrix.py` & `tabmat-3.1.8/src/tabmat/sparse_matrix.py`

 * *Files 6% similar despite different names*

```diff
@@ -10,14 +10,15 @@
     csr_matvec,
     csr_matvec_unrestricted,
     sparse_sandwich,
     transpose_square_dot_weights,
 )
 from .matrix_base import MatrixBase
 from .util import (
+    check_matvec_dimensions,
     check_matvec_out_shape,
     check_transpose_matvec_out_shape,
     set_up_rows_or_cols,
     setup_restrictions,
 )
 
 
@@ -116,21 +117,16 @@
         self,
         vec: Union[List, np.ndarray],
         rows: Optional[np.ndarray],
         cols: Optional[np.ndarray],
         out: Optional[np.ndarray],
         transpose: bool,
     ):
-        match_dim = 0 if transpose else 1
         vec = np.asarray(vec)
-        if self.shape[match_dim] != vec.shape[0]:
-            raise ValueError(
-                f"shapes {self.shape} and {vec.shape} not aligned:"
-                f"{self.shape[match_dim]} (dim {match_dim}) != {vec.shape[0]} (dim 0)"
-            )
+        check_matvec_dimensions(self, vec, transpose)
 
         unrestricted_rows = rows is None or len(rows) == self.shape[0]
         unrestricted_cols = cols is None or len(cols) == self.shape[1]
         if unrestricted_rows and unrestricted_cols and vec.ndim == 1:
             if transpose:
                 return csc_rmatvec_unrestricted(self, vec, out, self.indices)
             else:
@@ -171,15 +167,15 @@
     def transpose_matvec(
         self,
         vec: Union[np.ndarray, List],
         rows: np.ndarray = None,
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
-        """Perform: self[rows, cols].T @ vec."""
+        """Perform: self[rows, cols].T @ vec[rows]."""
         check_transpose_matvec_out_shape(self, out)
         return self._matvec_helper(vec, rows, cols, out, True)
 
     def _get_col_stds(self, weights: np.ndarray, col_means: np.ndarray) -> np.ndarray:
         """Get standard deviations of columns."""
         sqrt_arg = (
             transpose_square_dot_weights(
@@ -191,15 +187,15 @@
         # negative sqrt_arg (e.g. -5e-16). We just set those values equal to
         # zero.
         sqrt_arg[sqrt_arg < 0] = 0
         return np.sqrt(sqrt_arg)
 
     def astype(self, dtype, order="K", casting="unsafe", copy=True):
         """Return SparseMatrix cast to new type."""
-        return super(SparseMatrix, self).astype(dtype, casting, copy)
+        return super().astype(dtype, casting, copy)
 
     def multiply(self, other):
         """Element-wise multiplication.
 
         See ``scipy.sparse.csc_matrix.multiply``. The method is taken almost directly
         from the parent class except that ``other`` is assumed to be a vector of size
         ``self.shape[0]``.
```

### Comparing `tabmat-3.1.7/src/tabmat/split_matrix.py` & `tabmat-3.1.8/src/tabmat/split_matrix.py`

 * *Files 0% similar despite different names*

```diff
@@ -318,15 +318,15 @@
             col_stds[idx] = mat._get_col_stds(weights, col_means[idx])
 
         return col_stds
 
     def matvec(
         self, v: np.ndarray, cols: np.ndarray = None, out: np.ndarray = None
     ) -> np.ndarray:
-        """Perform self[:, cols] @ other."""
+        """Perform self[:, cols] @ other[cols]."""
         assert not isinstance(v, sps.spmatrix)
         check_matvec_out_shape(self, out)
 
         v = np.asarray(v)
         if v.shape[0] != self.shape[1]:
             raise ValueError(f"shapes {self.shape} and {v.shape} not aligned")
 
@@ -367,15 +367,15 @@
         self,
         v: Union[np.ndarray, List],
         rows: np.ndarray = None,
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
         """
-        Perform: self[rows, cols].T @ vec.
+        Perform: self[rows, cols].T @ vec[rows].
 
         ::
 
             self.transpose_matvec(v, rows, cols) = self[rows, cols].T @ v[rows]
             self.transpose_matvec(v, rows, cols)[i]
                 = sum_{j in rows} self[j, cols[i]] v[j]
                 = sum_{j in rows} sum_{mat in self.matrices} 1(cols[i] in mat)
```

### Comparing `tabmat-3.1.7/src/tabmat/standardized_mat.py` & `tabmat-3.1.8/src/tabmat/standardized_mat.py`

 * *Files 4% similar despite different names*

```diff
@@ -3,14 +3,15 @@
 import numpy as np
 from scipy import sparse as sps
 
 from .dense_matrix import DenseMatrix
 from .matrix_base import MatrixBase
 from .sparse_matrix import SparseMatrix
 from .util import (
+    check_matvec_dimensions,
     check_transpose_matvec_out_shape,
     set_up_rows_or_cols,
     setup_restrictions,
 )
 
 
 class StandardizedMatrix:
@@ -66,22 +67,23 @@
     def matvec(
         self,
         other_mat: Union[np.ndarray, List],
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
         """
-        Perform self[:, cols] @ other.
+        Perform self[:, cols] @ other[cols].
 
         This function returns a dense output, so it is best geared for the
         matrix-vector case.
         """
         cols = set_up_rows_or_cols(cols, self.shape[1])
 
         other_mat = np.asarray(other_mat)
+        check_matvec_dimensions(self, other_mat, transpose=False)
         mult_other = other_mat
         if self.mult is not None:
             mult = self.mult
             # Avoiding an outer product by matching dimensions.
             for _ in range(len(other_mat.shape) - 1):
                 mult = mult[:, np.newaxis]
             mult_other = mult * other_mat
@@ -168,15 +170,15 @@
         self,
         other: Union[np.ndarray, List],
         rows: np.ndarray = None,
         cols: np.ndarray = None,
         out: np.ndarray = None,
     ) -> np.ndarray:
         """
-        Perform: self[rows, cols].T @ vec.
+        Perform: self[rows, cols].T @ vec[rows].
 
         Let self.shape = (N, K) and other.shape = (M, N).
         Let shift_mat = outer(ones(N), shift)
 
         (X.T @ other)[k, i] = (X.mat.T @ other)[k, i] + (shift_mat @ other)[k, i]
         (shift_mat @ other)[k, i] = (outer(shift, ones(N)) @ other)[k, i]
         = sum_j outer(shift, ones(N))[k, j] other[j, i]
@@ -190,14 +192,15 @@
             = self.mat.transpose_matvec(other, rows, cols)[i, j]
               + (outer(self.shift, ones(N))[rows, cols] @ other[cols])
             = self.mat.transpose_matvec(other, rows, cols)[i, j]
               + shift[cols[i]] other.sum(0)[rows[j]
         """
         check_transpose_matvec_out_shape(self, out)
         other = np.asarray(other)
+        check_matvec_dimensions(self, other, transpose=True)
         res = self.mat.transpose_matvec(other, rows, cols)
 
         rows, cols = setup_restrictions(self.shape, rows, cols)
         other_sum = np.sum(other[rows], 0)
 
         shift_part_tmp = np.outer(self.shift[cols], other_sum)
         output_shape = ((self.shape[1] if cols is None else len(cols)),) + res.shape[1:]
```

### Comparing `tabmat-3.1.7/src/tabmat/util.py` & `tabmat-3.1.8/src/tabmat/util.py`

 * *Files 7% similar despite different names*

```diff
@@ -36,7 +36,17 @@
     """Assert that the first dimension of the transpose_matvec output is correct."""
     _check_out_shape(out, mat.shape[1])
 
 
 def check_matvec_out_shape(mat, out: Optional[np.ndarray]) -> None:
     """Assert that the first dimension of the matvec output is correct."""
     _check_out_shape(out, mat.shape[0])
+
+
+def check_matvec_dimensions(mat, vec: np.ndarray, transpose: bool) -> None:
+    """Assert that the dimensions for the matvec operation are compatible."""
+    match_dim = 0 if transpose else 1
+    if mat.shape[match_dim] != vec.shape[0]:
+        raise ValueError(
+            f"shapes {mat.shape} and {vec.shape} not aligned: "
+            f"{mat.shape[match_dim]} (dim {match_dim}) != {vec.shape[0]} (dim 0)"
+        )
```

### Comparing `tabmat-3.1.7/src/tabmat.egg-info/PKG-INFO` & `tabmat-3.1.8/src/tabmat.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: tabmat
-Version: 3.1.7
+Version: 3.1.8
 Summary: Efficient matrix representations for working with tabular data.
 Home-page: https://github.com/Quantco/tabmat
 Author: QuantCo, Inc.
 Author-email: noreply@quantco.com
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
```

### Comparing `tabmat-3.1.7/src/tabmat.egg-info/SOURCES.txt` & `tabmat-3.1.8/src/tabmat.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -32,14 +32,15 @@
 .github/PULL_REQUEST_TEMPLATE.md
 .github/dependabot.yml
 .github/actions/conda-build/action.yml
 .github/actions/linter/action.yml
 .github/actions/unittests/action.yml
 .github/workflows/base.sh
 .github/workflows/build_wheels.yml
+.github/workflows/build_wheels_release.yml
 .github/workflows/ci.yml
 .github/workflows/conda-build-linux-main.yml
 .github/workflows/conda-build-macos.yml
 .github/workflows/conda-build-win.yml
 .github/workflows/conda-build.sh
 .github/workflows/daily.yml
 .github/workflows/macos-conda-build.sh
```

### Comparing `tabmat-3.1.7/tests/real_matrix.pkl` & `tabmat-3.1.8/tests/real_matrix.pkl`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/tests/test_benchmark_cli.py` & `tabmat-3.1.8/tests/test_benchmark_cli.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/tests/test_categorical_matrix.py` & `tabmat-3.1.8/tests/test_categorical_matrix.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/tests/test_fast_sandwich.py` & `tabmat-3.1.8/tests/test_fast_sandwich.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,12 +1,14 @@
 import numpy as np
 import pytest
 import scipy as sp
 import scipy.sparse
+from scipy.sparse import csc_matrix
 
+from tabmat import DenseMatrix, SparseMatrix, SplitMatrix
 from tabmat.ext.dense import dense_sandwich
 from tabmat.ext.sparse import sparse_sandwich
 
 
 @pytest.mark.parametrize("dtype", [np.float64, np.float32])
 def test_fast_sandwich_sparse(dtype):
     np.random.seed(123)
@@ -26,15 +28,14 @@
             np.arange(A.shape[1], dtype=np.int32),
         )
         np.testing.assert_allclose(true, out, atol=np.sqrt(np.finfo(dtype).eps))
 
 
 @pytest.mark.skip("Skipping because this test allocates a matrix of 50_000 x 50_000.")
 def test_fast_sandwich_sparse_large():
-
     # note that 50000 * 50000 > 2^31 - 1, so this will segfault when we index
     # with 32 bit integers (see GH #160)
     A = simulate_matrix(
         nonzero_frac=1e-8, shape=(50000, 50000), seed=None, dtype=np.float32
     ).tocsc()
     d = np.random.rand(A.shape[0]).astype(np.float32)
 
@@ -58,24 +59,45 @@
 
         cols = np.random.choice(
             np.arange(A.shape[1]), size=np.random.randint(A.shape[1]), replace=False
         ).astype(np.int32)
         check(A, d, cols)
 
 
+def test_dense_sandwich_on_non_contiguous():
+    """Non-regression test for #208"""
+    rng = np.random.default_rng(seed=123)
+    X = rng.standard_normal(size=(100, 20))
+
+    # Xd wraps a not-contiguous array.
+    Xd = DenseMatrix(X[:, :10])
+    Xs = SparseMatrix(csc_matrix(X[:, 10:]))
+    Xm = SplitMatrix([Xd, Xs])
+
+    # Making the sandwich product fail.
+    with pytest.raises(Exception, match="The matrix X is not contiguous"):
+        Xm.sandwich(np.ones(X.shape[0]))
+
+    # Xd wraps a copy, which makes the data contiguous.
+    Xd = DenseMatrix(X[:, :10].copy())
+    Xm = SplitMatrix([Xd, Xs])
+
+    # The sandwich product works without problem here.
+    Xm.sandwich(np.ones(X.shape[0]))
+
+
 def check(A, d, cols):
     Asub = A[:, cols]
     true = (Asub.T.multiply(d)).dot(Asub).toarray()
     nonzero = np.where(np.abs(d) > 1e-14)[0].astype(np.int32)
     out = dense_sandwich(np.asfortranarray(A.toarray()), d, nonzero, cols)
     np.testing.assert_allclose(true, out, atol=np.sqrt(np.finfo(np.float64).eps))
 
 
 def simulate_matrix(nonzero_frac=0.05, shape=(100, 50), seed=0, dtype=np.float64):
-
     if seed is not None:
         np.random.seed(seed)
     nnz = int(np.prod(shape) * nonzero_frac)
     row_index = np.random.randint(shape[0], size=nnz)
     col_index = np.random.randint(shape[1], size=nnz)
     A = sp.sparse.csr_matrix(
         (np.random.randn(nnz).astype(dtype), (row_index, col_index)), shape
```

### Comparing `tabmat-3.1.7/tests/test_matrices.py` & `tabmat-3.1.8/tests/test_matrices.py`

 * *Files 1% similar despite different names*

```diff
@@ -41,17 +41,17 @@
 
 
 def categorical_matrix():
     vec = [1, 0, 1]
     return tm.CategoricalMatrix(vec)
 
 
-def get_unscaled_matrices() -> List[
-    Union[tm.DenseMatrix, tm.SparseMatrix, tm.CategoricalMatrix]
-]:
+def get_unscaled_matrices() -> (
+    List[Union[tm.DenseMatrix, tm.SparseMatrix, tm.CategoricalMatrix]]
+):
     return [
         dense_matrix_F(),
         dense_matrix_C(),
         dense_matrix_not_writeable(),
         sparse_matrix(),
         sparse_matrix_64(),
         categorical_matrix(),
@@ -162,14 +162,37 @@
         correct[cols] += matvec_part
 
     np.testing.assert_almost_equal(out, out2)
     np.testing.assert_almost_equal(out, correct)
 
 
 @pytest.mark.parametrize("mat", get_matrices())
+@pytest.mark.parametrize("cols", [None, [], [1], np.array([0, 1])])
+@pytest.mark.parametrize("rows", [None, [], [1], np.array([0, 2])])
+def test_matvec_dimension_mismatch_raises(mat, rows, cols):
+    too_short = np.ones(mat.shape[1] - 1, dtype=mat.dtype)
+    just_right = np.ones(mat.shape[1], dtype=mat.dtype)
+    too_long = np.ones(mat.shape[1] + 1, dtype=mat.dtype)
+    mat.matvec(just_right, cols=cols)
+    with pytest.raises(ValueError):
+        mat.matvec(too_short, cols=cols)
+    with pytest.raises(ValueError):
+        mat.matvec(too_long, cols=cols)
+
+    too_short_transpose = np.ones(mat.shape[0] - 1, dtype=mat.dtype)
+    just_right_transpose = np.ones(mat.shape[0], dtype=mat.dtype)
+    too_long_transpose = np.ones(mat.shape[0] + 1, dtype=mat.dtype)
+    mat.transpose_matvec(just_right_transpose, rows=rows, cols=cols)
+    with pytest.raises(ValueError):
+        mat.transpose_matvec(too_short_transpose, rows=rows, cols=cols)
+    with pytest.raises(ValueError):
+        mat.transpose_matvec(too_long_transpose, rows=rows, cols=cols)
+
+
+@pytest.mark.parametrize("mat", get_matrices())
 @pytest.mark.parametrize("i", [1, -2])
 def test_getcol(mat: Union[tm.MatrixBase, tm.StandardizedMatrix], i):
     col = mat.getcol(i)
 
     if not isinstance(col, np.ndarray):
         col = col.A
     np.testing.assert_almost_equal(col, mat.A[:, [i]])
```

### Comparing `tabmat-3.1.7/tests/test_mkl_sparse_matrix.py` & `tabmat-3.1.8/tests/test_mkl_sparse_matrix.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/tests/test_real_matrix.py` & `tabmat-3.1.8/tests/test_real_matrix.py`

 * *Files identical despite different names*

### Comparing `tabmat-3.1.7/tests/test_split_matrix.py` & `tabmat-3.1.8/tests/test_split_matrix.py`

 * *Files 1% similar despite different names*

```diff
@@ -57,17 +57,17 @@
     mat = SplitMatrix(
         [dense, sparse, cat_mat],
         [dense_ix, sparse_ix, range(cat_start, cat_start + cat_mat.shape[1])],
     )
     return mat
 
 
-def get_split_with_cat_components() -> List[
-    Union[tm.SparseMatrix, tm.DenseMatrix, tm.CategoricalMatrix]
-]:
+def get_split_with_cat_components() -> (
+    List[Union[tm.SparseMatrix, tm.DenseMatrix, tm.CategoricalMatrix]]
+):
     n_rows = 10
     np.random.seed(0)
     dense_1 = tm.DenseMatrix(np.random.random((n_rows, 3)))
     sparse_1 = tm.SparseMatrix(sps.random(n_rows, 3).tocsc())
     cat = tm.CategoricalMatrix(np.random.choice(range(3), n_rows))
     dense_2 = tm.DenseMatrix(np.random.random((n_rows, 3)))
     sparse_2 = tm.SparseMatrix(sps.random(n_rows, 3, density=0.5).tocsc())
```

### Comparing `tabmat-3.1.7/tests/test_standardized_mat.py` & `tabmat-3.1.8/tests/test_standardized_mat.py`

 * *Files identical despite different names*

